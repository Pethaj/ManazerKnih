import { supabase } from '../lib/supabase';

export type UserRole = 'admin' | 'spravce';

export interface UserProfile {
    id: string;
    email: string;
    role: UserRole;
    created_at: string;
    updated_at: string;
}

export interface AuthUser {
    id: string;
    email: string;
    role: UserRole;
}

/**
 * P≈ôihl√°≈°en√≠ u≈æivatele pomoc√≠ emailu a hesla
 */
export async function login(email: string, password: string): Promise<{ user: AuthUser | null; error: string | null }> {
    try {
        const { data, error } = await supabase.auth.signInWithPassword({
            email,
            password
        });

        if (error) {
            console.error('Chyba p≈ôi p≈ôihl√°≈°en√≠:', error);
            return { user: null, error: error.message };
        }

        if (!data.user) {
            return { user: null, error: 'Nepoda≈ôilo se p≈ôihl√°sit' };
        }

        // Z√≠skat roli u≈æivatele z user_profiles
        const { data: profileData, error: profileError } = await supabase
            .from('user_profiles')
            .select('*')
            .eq('id', data.user.id)
            .single();

        if (profileError || !profileData) {
            console.error('Chyba p≈ôi naƒç√≠t√°n√≠ profilu:', profileError);
            // Odhl√°sit u≈æivatele, pokud nem√° profil
            await supabase.auth.signOut();
            return { user: null, error: 'U≈æivatelsk√Ω profil nebyl nalezen' };
        }

        return {
            user: {
                id: data.user.id,
                email: data.user.email || '',
                role: profileData.role as UserRole
            },
            error: null
        };
    } catch (err) {
        console.error('Neoƒçek√°van√° chyba p≈ôi p≈ôihl√°≈°en√≠:', err);
        return { user: null, error: 'Neoƒçek√°van√° chyba p≈ôi p≈ôihl√°≈°en√≠' };
    }
}

/**
 * Odhl√°≈°en√≠ aktu√°ln√≠ho u≈æivatele
 */
export async function logout(): Promise<{ error: string | null }> {
    try {
        const { error } = await supabase.auth.signOut();
        if (error) {
            console.error('Chyba p≈ôi odhl√°≈°en√≠:', error);
            return { error: error.message };
        }
        return { error: null };
    } catch (err) {
        console.error('Neoƒçek√°van√° chyba p≈ôi odhl√°≈°en√≠:', err);
        return { error: 'Neoƒçek√°van√° chyba p≈ôi odhl√°≈°en√≠' };
    }
}

/**
 * NOV√ù SYST√âM: Odesl√°n√≠ magic link pro p≈ôihl√°≈°en√≠ (m√≠sto reset hesla)
 * U≈æivatel dostane magic link na email, kter√Ωm se m≈Ø≈æe p≈ô√≠mo p≈ôihl√°sit
 * Explicitnƒõ nastavuje redirect URL na aktu√°ln√≠ origin aplikace
 */
export async function sendMagicLink(email: string): Promise<{ error: string | null }> {
    try {
        const { error } = await supabase.auth.signInWithOtp({
            email: email.toLowerCase(),
            options: {
                shouldCreateUser: false, // Nepovol√≠me vytvo≈ôen√≠ nov√©ho u≈æivatele
                emailRedirectTo: window.location.origin // Explicitn√≠ redirect na aplikaci
            }
        });

        if (error) {
            console.error('Chyba p≈ôi odes√≠l√°n√≠ magic link:', error);
            return { error: error.message };
        }

        console.log('‚úÖ Magic link odesl√°n na:', email);
        console.log('üìç Redirect URL:', window.location.origin);
        return { error: null };
    } catch (err) {
        console.error('Neoƒçek√°van√° chyba p≈ôi odes√≠l√°n√≠ magic link:', err);
        return { error: 'Neoƒçek√°van√° chyba p≈ôi odes√≠l√°n√≠ emailu' };
    }
}

/**
 * DEPRECATED: Star√° metoda pro reset hesla
 * Ponech√°no pro zpƒõtnou kompatibilitu, ale doporuƒçujeme pou≈æ√≠t sendMagicLink
 */
export async function resetPassword(email: string): Promise<{ error: string | null }> {
    // Nyn√≠ pou≈æ√≠v√°me magic link m√≠sto reset hesla
    return sendMagicLink(email);
}

/**
 * Generov√°n√≠ hesla ze jm√©na a p≈ô√≠jmen√≠
 * @param firstName Jm√©no u≈æivatele
 * @param surname P≈ô√≠jmen√≠ u≈æivatele
 * @returns Heslo ve form√°tu: 2 p√≠smena ze jm√©na + 2 p√≠smena z p≈ô√≠jmen√≠ + 4 n√°hodn√© ƒç√≠slice
 */
export function generatePasswordFromName(firstName: string, surname: string): string {
    if (!firstName || firstName.length < 2) {
        throw new Error('Jm√©no mus√≠ m√≠t alespo≈à 2 znaky');
    }
    if (!surname || surname.length < 2) {
        throw new Error('P≈ô√≠jmen√≠ mus√≠ m√≠t alespo≈à 2 znaky');
    }
    
    // Vezme prvn√≠ 2 p√≠smena ze jm√©na (p≈ôeveden√° na mal√° p√≠smena)
    const firstNamePart = firstName.substring(0, 2).toLowerCase();
    
    // Vezme prvn√≠ 2 p√≠smena z p≈ô√≠jmen√≠ (p≈ôeveden√° na mal√° p√≠smena)
    const surnamePart = surname.substring(0, 2).toLowerCase();
    
    // Vygeneruje 4 n√°hodn√© ƒç√≠slice
    const randomDigits = Math.floor(1000 + Math.random() * 9000).toString();
    
    return firstNamePart + surnamePart + randomDigits;
}

/**
 * Vytvo≈ôen√≠ nov√©ho u≈æivatele se jm√©nem a p≈ô√≠jmen√≠m a automaticky generovan√Ωm heslem
 * @param email Email u≈æivatele
 * @param firstName Jm√©no u≈æivatele
 * @param surname P≈ô√≠jmen√≠ u≈æivatele
 * @param role Role u≈æivatele
 * @returns Informace o √∫spƒõchu, p≈ô√≠padn√° chyba a vygenerovan√© heslo
 */
export async function createUserWithName(
    email: string,
    firstName: string,
    surname: string,
    role: UserRole
): Promise<{ success: boolean; error: string | null; password?: string }> {
    try {
        // Zkontrolovat, zda je aktu√°ln√≠ u≈æivatel spr√°vce
        const isAdmin = await isSpravce();
        if (!isAdmin) {
            return { success: false, error: 'Pouze spr√°vce m≈Ø≈æe vytv√°≈ôet u≈æivatele' };
        }

        // Zkontrolovat, zda email ji≈æ existuje
        const { data: existingUsers } = await supabase
            .from('user_profiles')
            .select('email')
            .eq('email', email)
            .limit(1);

        if (existingUsers && existingUsers.length > 0) {
            return { success: false, error: 'U≈æivatel s t√≠mto emailem ji≈æ existuje' };
        }

        // Vygenerovat heslo ze jm√©na a p≈ô√≠jmen√≠
        const generatedPassword = generatePasswordFromName(firstName, surname);
        
        // Vytvo≈ôit u≈æivatele
        const { data: signUpData, error: signUpError } = await supabase.auth.signUp({
            email: email,
            password: generatedPassword,
            options: {
                emailRedirectTo: `${window.location.origin}`,
                data: {
                    firstName: firstName,
                    surname: surname,
                    created_by: 'admin'
                }
            }
        });

        if (signUpError) {
            console.error('Chyba p≈ôi vytv√°≈ôen√≠ u≈æivatele:', signUpError);
            return { success: false, error: signUpError.message };
        }

        if (!signUpData.user) {
            return { success: false, error: 'Nepoda≈ôilo se vytvo≈ôit u≈æivatele' };
        }

        // Vytvo≈ôit profil pro nov√©ho u≈æivatele
        const { error: profileError } = await supabase
            .from('user_profiles')
            .insert({
                id: signUpData.user.id,
                email: email,
                role: role
            });

        if (profileError) {
            console.error('Chyba p≈ôi vytv√°≈ôen√≠ profilu:', profileError);
            return { success: false, error: 'U≈æivatel byl vytvo≈ôen, ale profil se nepoda≈ôilo p≈ôidat' };
        }

        return { 
            success: true, 
            error: null,
            password: generatedPassword
        };
    } catch (err) {
        console.error('Neoƒçek√°van√° chyba p≈ôi vytv√°≈ôen√≠ u≈æivatele:', err);
        return { success: false, error: 'Neoƒçek√°van√° chyba p≈ôi vytv√°≈ôen√≠ u≈æivatele' };
    }
}

/**
 * Pozv√°n√≠ nov√©ho u≈æivatele - vytvo≈ôen√≠ doƒçasn√©ho √∫ƒçtu
 * U≈æivatel si vytvo≈ô√≠ heslo s√°m po p≈ôihl√°≈°en√≠ pomoc√≠ reset hesla
 */
export async function inviteUser(
    email: string,
    role: UserRole
): Promise<{ success: boolean; error: string | null; tempPassword?: string }> {
    try {
        // Zkontrolovat, zda je aktu√°ln√≠ u≈æivatel spr√°vce
        const isAdmin = await isSpravce();
        if (!isAdmin) {
            return { success: false, error: 'Pouze spr√°vce m≈Ø≈æe zv√°t u≈æivatele' };
        }

        // Zkontrolovat, zda email ji≈æ existuje
        const { data: existingUsers } = await supabase
            .from('user_profiles')
            .select('email')
            .eq('email', email)
            .limit(1);

        if (existingUsers && existingUsers.length > 0) {
            return { success: false, error: 'U≈æivatel s t√≠mto emailem ji≈æ existuje' };
        }

        // Vygenerovat n√°hodn√© doƒçasn√© heslo (min. 8 znak≈Ø)
        const tempPassword = Math.random().toString(36).slice(-12) + 'A1!';
        
        // Vytvo≈ôit u≈æivatele s doƒçasn√Ωm heslem
        // POZN√ÅMKA: Toto vy≈æaduje, aby v Supabase bylo vypnuto "Confirm email"
        const { data: signUpData, error: signUpError } = await supabase.auth.signUp({
            email: email,
            password: tempPassword,
            options: {
                emailRedirectTo: `${window.location.origin}`,
                data: {
                    invited_by: 'admin',
                    must_reset_password: true
                }
            }
        });

        if (signUpError) {
            console.error('Chyba p≈ôi vytv√°≈ôen√≠ u≈æivatele:', signUpError);
            return { success: false, error: signUpError.message };
        }

        if (!signUpData.user) {
            return { success: false, error: 'Nepoda≈ôilo se vytvo≈ôit u≈æivatele' };
        }

        // Vytvo≈ôit profil pro nov√©ho u≈æivatele
        const { error: profileError } = await supabase
            .from('user_profiles')
            .insert({
                id: signUpData.user.id,
                email: email,
                role: role
            });

        if (profileError) {
            console.error('Chyba p≈ôi vytv√°≈ôen√≠ profilu:', profileError);
            return { success: false, error: 'U≈æivatel byl vytvo≈ôen, ale profil se nepoda≈ôilo p≈ôidat' };
        }

        // Odeslat reset hesla email
        const { error: resetError } = await supabase.auth.resetPasswordForEmail(email, {
            redirectTo: `${window.location.origin}`,
        });

        if (resetError) {
            console.warn('Varov√°n√≠: Email pro reset hesla se nepoda≈ôilo odeslat:', resetError);
            // Nebudeme vracet chybu, proto≈æe u≈æivatel byl vytvo≈ôen
        }

        return { 
            success: true, 
            error: null,
            tempPassword: tempPassword // Pro dev √∫ƒçely - v produkci by se nemƒõlo vracet
        };
    } catch (err) {
        console.error('Neoƒçek√°van√° chyba p≈ôi pozvan√≠ u≈æivatele:', err);
        return { success: false, error: 'Neoƒçek√°van√° chyba p≈ôi pozvan√≠ u≈æivatele' };
    }
}

/**
 * Z√≠sk√°n√≠ aktu√°lnƒõ p≈ôihl√°≈°en√©ho u≈æivatele vƒçetnƒõ role
 */
export async function getCurrentUser(): Promise<{ user: AuthUser | null; error: string | null }> {
    try {
        console.log('üîç getCurrentUser: Zaƒç√≠n√°m kontrolu u≈æivatele...');
        
        // D≈ÆLE≈ΩIT√â: Pou≈æ√≠v√°me getSession() m√≠sto getUser()
        // getSession() kontroluje lok√°ln√≠ session v localStorage
        // getUser() v≈ædy vol√° API, co≈æ m≈Ø≈æe selhat p≈ôi refresh
        const { data: { session }, error: sessionError } = await supabase.auth.getSession();

        if (sessionError) {
            console.error('‚ùå Chyba p≈ôi z√≠sk√°v√°n√≠ session:', sessionError);
            return { user: null, error: sessionError.message };
        }

        if (!session || !session.user) {
            console.log('‚ÑπÔ∏è ≈Ω√°dn√° aktivn√≠ session');
            return { user: null, error: null };
        }

        const user = session.user;
        console.log('‚úÖ Session nalezena pro u≈æivatele:', user.email);

        // Z√≠skat roli u≈æivatele z user_profiles
        const { data: profileData, error: profileError } = await supabase
            .from('user_profiles')
            .select('*')
            .eq('id', user.id)
            .single();

        if (profileError || !profileData) {
            console.error('‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ profilu:', profileError);
            return { user: null, error: 'U≈æivatelsk√Ω profil nebyl nalezen' };
        }

        console.log('‚úÖ Profil naƒçten, role:', profileData.role);

        return {
            user: {
                id: user.id,
                email: user.email || '',
                role: profileData.role as UserRole
            },
            error: null
        };
    } catch (err) {
        console.error('‚ùå Neoƒçek√°van√° chyba p≈ôi z√≠sk√°v√°n√≠ u≈æivatele:', err);
        return { user: null, error: 'Neoƒçek√°van√° chyba' };
    }
}

/**
 * Z√≠sk√°n√≠ role aktu√°ln√≠ho u≈æivatele
 */
export async function getUserRole(): Promise<{ role: UserRole | null; error: string | null }> {
    const { user, error } = await getCurrentUser();
    if (error || !user) {
        return { role: null, error: error || 'U≈æivatel nen√≠ p≈ôihl√°≈°en' };
    }
    return { role: user.role, error: null };
}

/**
 * Kontrola, zda je aktu√°ln√≠ u≈æivatel spr√°vce
 */
export async function isSpravce(): Promise<boolean> {
    const { role } = await getUserRole();
    return role === 'spravce';
}

/**
 * Vytvo≈ôen√≠ nov√©ho u≈æivatele (pouze pro spr√°vce)
 * Pozn√°mka: Tato funkce vy≈æaduje Supabase Service Role Key, kter√Ω by mƒõl b√Ωt pouze na backendu
 * Pro production je lep≈°√≠ vytvo≈ôit Edge Function
 */
export async function createUser(
    email: string, 
    password: string, 
    role: UserRole
): Promise<{ userId: string | null; error: string | null }> {
    try {
        // Nejprve zkontrolovat, zda je aktu√°ln√≠ u≈æivatel spr√°vce
        const isAdmin = await isSpravce();
        if (!isAdmin) {
            return { userId: null, error: 'Pouze spr√°vce m≈Ø≈æe vytv√°≈ôet u≈æivatele' };
        }

        // POZN√ÅMKA: Pro vytvo≈ôen√≠ u≈æivatele pot≈ôebujeme Service Role Key
        // To by mƒõlo b√Ωt ≈ôe≈°eno p≈ôes Edge Function nebo Admin API
        // Pro √∫ƒçely tohoto demo vr√°t√≠me chybu s instrukcemi
        
        console.warn('‚ö†Ô∏è Vytv√°≈ôen√≠ u≈æivatel≈Ø vy≈æaduje Supabase Service Role Key');
        console.warn('Pro production implementaci vytvo≈ôte Edge Function nebo pou≈æijte Admin API');
        
        return { 
            userId: null, 
            error: 'Vytv√°≈ôen√≠ u≈æivatel≈Ø moment√°lnƒõ nen√≠ implementov√°no. Pou≈æijte Supabase Dashboard ‚Üí Authentication ‚Üí Add User' 
        };

        // TODO: Implementovat p≈ôes Edge Function
        // const response = await fetch(`${supabaseUrl}/functions/v1/create-user`, {
        //     method: 'POST',
        //     headers: {
        //         'Content-Type': 'application/json',
        //         'Authorization': `Bearer ${token}`
        //     },
        //     body: JSON.stringify({ email, password, role })
        // });
    } catch (err) {
        console.error('Neoƒçek√°van√° chyba p≈ôi vytv√°≈ôen√≠ u≈æivatele:', err);
        return { userId: null, error: 'Neoƒçek√°van√° chyba p≈ôi vytv√°≈ôen√≠ u≈æivatele' };
    }
}

/**
 * Manu√°ln√≠ p≈ôid√°n√≠ profilu pro existuj√≠c√≠ho u≈æivatele
 * (pou≈æiteln√© pokud u≈æivatel byl vytvo≈ôen p≈ôes Dashboard)
 */
export async function addUserProfile(
    userId: string,
    email: string,
    role: UserRole
): Promise<{ success: boolean; error: string | null }> {
    try {
        // Zkontrolovat, zda je aktu√°ln√≠ u≈æivatel spr√°vce
        const isAdmin = await isSpravce();
        if (!isAdmin) {
            return { success: false, error: 'Pouze spr√°vce m≈Ø≈æe p≈ôid√°vat profily' };
        }

        const { error } = await supabase
            .from('user_profiles')
            .insert({
                id: userId,
                email,
                role
            });

        if (error) {
            console.error('Chyba p≈ôi p≈ôid√°v√°n√≠ profilu:', error);
            return { success: false, error: error.message };
        }

        return { success: true, error: null };
    } catch (err) {
        console.error('Neoƒçek√°van√° chyba p≈ôi p≈ôid√°v√°n√≠ profilu:', err);
        return { success: false, error: 'Neoƒçek√°van√° chyba' };
    }
}

/**
 * Smaz√°n√≠ u≈æivatele (pouze pro spr√°vce)
 */
export async function deleteUser(userId: string): Promise<{ success: boolean; error: string | null }> {
    try {
        // Zkontrolovat, zda je aktu√°ln√≠ u≈æivatel spr√°vce
        const isAdmin = await isSpravce();
        if (!isAdmin) {
            return { success: false, error: 'Pouze spr√°vce m≈Ø≈æe mazat u≈æivatele' };
        }

        // Nejprve smazat profil (kask√°dovƒõ se sma≈æe d√≠ky ON DELETE CASCADE)
        const { error } = await supabase
            .from('user_profiles')
            .delete()
            .eq('id', userId);

        if (error) {
            console.error('Chyba p≈ôi maz√°n√≠ profilu:', error);
            return { success: false, error: error.message };
        }

        // POZN√ÅMKA: Smaz√°n√≠ z auth.users vy≈æaduje Admin API
        // Pro production implementaci vytvo≈ôte Edge Function
        console.warn('‚ö†Ô∏è U≈æivatel byl odstranƒõn z user_profiles, ale st√°le existuje v auth.users');
        console.warn('Pro kompletn√≠ smaz√°n√≠ pou≈æijte Supabase Dashboard nebo implementujte Edge Function');

        return { success: true, error: null };
    } catch (err) {
        console.error('Neoƒçek√°van√° chyba p≈ôi maz√°n√≠ u≈æivatele:', err);
        return { success: false, error: 'Neoƒçek√°van√° chyba' };
    }
}

/**
 * Z√≠sk√°n√≠ seznamu v≈°ech u≈æivatel≈Ø (pouze pro spr√°vce)
 */
export async function listUsers(): Promise<{ users: UserProfile[] | null; error: string | null }> {
    try {
        // Zkontrolovat, zda je aktu√°ln√≠ u≈æivatel spr√°vce
        const isAdmin = await isSpravce();
        if (!isAdmin) {
            return { users: null, error: 'Pouze spr√°vce m≈Ø≈æe zobrazit seznam u≈æivatel≈Ø' };
        }

        const { data, error } = await supabase
            .from('user_profiles')
            .select('*')
            .order('created_at', { ascending: false });

        if (error) {
            console.error('Chyba p≈ôi naƒç√≠t√°n√≠ u≈æivatel≈Ø:', error);
            return { users: null, error: error.message };
        }

        return { users: data as UserProfile[], error: null };
    } catch (err) {
        console.error('Neoƒçek√°van√° chyba p≈ôi naƒç√≠t√°n√≠ u≈æivatel≈Ø:', err);
        return { users: null, error: 'Neoƒçek√°van√° chyba' };
    }
}

/**
 * Aktualizace role u≈æivatele (pouze pro spr√°vce)
 */
export async function updateUserRole(
    userId: string,
    newRole: UserRole
): Promise<{ success: boolean; error: string | null }> {
    try {
        // Zkontrolovat, zda je aktu√°ln√≠ u≈æivatel spr√°vce
        const isAdmin = await isSpravce();
        if (!isAdmin) {
            return { success: false, error: 'Pouze spr√°vce m≈Ø≈æe mƒõnit role u≈æivatel≈Ø' };
        }

        const { error } = await supabase
            .from('user_profiles')
            .update({ role: newRole })
            .eq('id', userId);

        if (error) {
            console.error('Chyba p≈ôi aktualizaci role:', error);
            return { success: false, error: error.message };
        }

        return { success: true, error: null };
    } catch (err) {
        console.error('Neoƒçek√°van√° chyba p≈ôi aktualizaci role:', err);
        return { success: false, error: 'Neoƒçek√°van√° chyba' };
    }
}

/**
 * Zmƒõna hesla aktu√°ln√≠ho u≈æivatele
 * POZN√ÅMKA: Nepo≈æaduje ovƒõ≈ôen√≠ souƒçasn√©ho hesla
 */
export async function changePassword(
    currentPassword: string, // Deprecated - ponech√°no pro zpƒõtnou kompatibilitu
    newPassword: string
): Promise<{ success: boolean; error: string | null }> {
    try {
        const { user: currentUser } = await getCurrentUser();
        
        if (!currentUser) {
            return { success: false, error: 'U≈æivatel nen√≠ p≈ôihl√°≈°en' };
        }

        // Zmƒõna hesla bez ovƒõ≈ôen√≠ souƒçasn√©ho hesla
        const { error: updateError } = await supabase.auth.updateUser({
            password: newPassword
        });

        if (updateError) {
            console.error('Chyba p≈ôi zmƒõnƒõ hesla:', updateError);
            return { success: false, error: updateError.message };
        }

        return { success: true, error: null };
    } catch (err) {
        console.error('Neoƒçek√°van√° chyba p≈ôi zmƒõnƒõ hesla:', err);
        return { success: false, error: 'Neoƒçek√°van√° chyba p≈ôi zmƒõnƒõ hesla' };
    }
}

/**
 * Automatick√© vytvo≈ôen√≠ prvn√≠ho spr√°vce (pokud neexistuje ≈æ√°dn√Ω u≈æivatel)
 * POZN√ÅMKA: Toto je pomocn√° funkce pro development
 */
export async function ensureFirstAdmin(): Promise<{ success: boolean; error: string | null }> {
    try {
        // Zkontrolovat, zda existuj√≠ nƒõjak√© profily
        const { data, error } = await supabase
            .from('user_profiles')
            .select('id')
            .limit(1);

        if (error) {
            console.error('Chyba p≈ôi kontrole profil≈Ø:', error);
            return { success: false, error: error.message };
        }

        if (data && data.length > 0) {
            // Ji≈æ existuj√≠ u≈æivatel√©, nen√≠ pot≈ôeba vytv√°≈ôet prvn√≠ho spr√°vce
            return { success: true, error: null };
        }

        // Neexistuj√≠ ≈æ√°dn√© profily
        // Pro vytvo≈ôen√≠ prvn√≠ho spr√°vce pou≈æijte Supabase Dashboard
        console.warn('‚ö†Ô∏è Neexistuj√≠ ≈æ√°dn√© u≈æivatelsk√© profily.');
        console.warn('Pro vytvo≈ôen√≠ prvn√≠ho spr√°vce:');
        console.warn('1. Jdƒõte do Supabase Dashboard ‚Üí Authentication ‚Üí Users ‚Üí Add User');
        console.warn('2. Email: petr.hajduk@bewit.team, Password: wewe');
        console.warn('3. Po vytvo≈ôen√≠ spus≈•te SQL pro p≈ôid√°n√≠ profilu');

        return { success: false, error: 'Prvn√≠ spr√°vce mus√≠ b√Ωt vytvo≈ôen manu√°lnƒõ p≈ôes Supabase Dashboard' };
    } catch (err) {
        console.error('Neoƒçek√°van√° chyba:', err);
        return { success: false, error: 'Neoƒçek√°van√° chyba' };
    }
}

