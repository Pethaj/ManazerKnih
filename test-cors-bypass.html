<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test CORS Bypass ≈ôe≈°en√≠</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .method {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            background-color: #f9f9f9;
        }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        .info { color: #007bff; font-weight: bold; }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background-color: #0056b3; }
        .log {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>üîß Test CORS Bypass ≈ôe≈°en√≠</h1>
    
    <div class="method">
        <h2>1. Test p≈ô√≠m√©ho GroupDocs API (oƒçek√°v√° CORS chybu)</h2>
        <button onclick="testDirectAPI()">Test p≈ô√≠m√© API</button>
        <div id="directResult" class="log"></div>
    </div>

    <div class="method">
        <h2>2. Test N8N Proxy (pokud je workflow aktivn√≠)</h2>
        <p>URL: <code>https://n8n.srv980546.hstgr.cloud/webhook/groupdocs-conversion</code></p>
        <button onclick="testN8NProxy()">Test N8N proxy</button>
        <div id="n8nResult" class="log"></div>
    </div>

    <div class="method">
        <h2>3. Test s CORS-Anywhere proxy</h2>
        <p><strong>Varov√°n√≠:</strong> Pouze pro testov√°n√≠!</p>
        <button onclick="testCORSProxy()">Test CORS proxy</button>
        <div id="corsResult" class="log"></div>
    </div>

    <div class="method">
        <h2>4. Instrukce pro Chrome bez CORS</h2>
        <p><strong>macOS:</strong></p>
        <code>open -n -a /Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome --args --user-data-dir="/tmp/chrome_dev_test" --disable-web-security</code>
        <p><strong>Windows:</strong></p>
        <code>chrome.exe --user-data-dir="C:/chrome-dev-session" --disable-web-security</code>
        <button onclick="checkCORSDisabled()">Zkontrolovat CORS stav</button>
        <div id="corsStatus" class="log"></div>
    </div>

    <script>
        function logMessage(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            element.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            element.scrollTop = element.scrollHeight;
        }

        async function testDirectAPI() {
            const resultDiv = document.getElementById('directResult');
            resultDiv.innerHTML = '';
            
            try {
                logMessage('directResult', 'üîÑ Testov√°n√≠ p≈ô√≠m√©ho GroupDocs API...', 'info');
                
                const response = await fetch('https://api.groupdocs.cloud/connect/token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        grant_type: 'client_credentials',
                        client_id: '022eaad9-af7c-446a-b94e-a3a75f6cc35e',
                        client_secret: '7cd5e2e58337595bffff974a29c0ecc6'
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    logMessage('directResult', '‚úÖ √öSPƒöCH! CORS je vypnut√Ω nebo proxy funguje', 'success');
                    logMessage('directResult', `Token: ${data.access_token.substring(0, 20)}...`, 'info');
                } else {
                    logMessage('directResult', `‚ùå API chyba: ${response.status}`, 'error');
                }
            } catch (error) {
                if (error.message.includes('CORS')) {
                    logMessage('directResult', '‚ùå CORS chyba - oƒçek√°v√°no! Pot≈ôebujete proxy nebo vypnout CORS', 'error');
                } else {
                    logMessage('directResult', `‚ùå Jin√° chyba: ${error.message}`, 'error');
                }
            }
        }

        async function testN8NProxy() {
            const resultDiv = document.getElementById('n8nResult');
            resultDiv.innerHTML = '';
            
            try {
                logMessage('n8nResult', 'üîÑ Testov√°n√≠ N8N proxy...', 'info');
                
                // Vytvo≈ô√≠me testovac√≠ textov√Ω soubor
                const testContent = 'Test content for conversion';
                const testFile = new Blob([testContent], { type: 'text/plain' });
                
                const formData = new FormData();
                formData.append('file', testFile, 'test.txt');
                formData.append('targetFormat', 'pdf');
                
                const response = await fetch('https://n8n.srv980546.hstgr.cloud/webhook/groupdocs-conversion', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const contentType = response.headers.get('content-type');
                    if (contentType && contentType.includes('application/pdf')) {
                        logMessage('n8nResult', '‚úÖ N8N proxy funguje! Dostal jsem PDF', 'success');
                        const blob = await response.blob();
                        logMessage('n8nResult', `üìÑ PDF velikost: ${blob.size} bytes`, 'info');
                    } else {
                        const text = await response.text();
                        logMessage('n8nResult', `üìù Odpovƒõƒè: ${text.substring(0, 200)}...`, 'info');
                    }
                } else {
                    const errorText = await response.text();
                    logMessage('n8nResult', `‚ùå N8N chyba: ${response.status} - ${errorText}`, 'error');
                }
            } catch (error) {
                logMessage('n8nResult', `‚ùå Chyba p≈ôi vol√°n√≠ N8N: ${error.message}`, 'error');
            }
        }

        async function testCORSProxy() {
            const resultDiv = document.getElementById('corsResult');
            resultDiv.innerHTML = '';
            
            try {
                logMessage('corsResult', 'üîÑ Testov√°n√≠ CORS-Anywhere proxy...', 'info');
                
                const response = await fetch('https://cors-anywhere.herokuapp.com/https://api.groupdocs.cloud/connect/token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: new URLSearchParams({
                        grant_type: 'client_credentials',
                        client_id: '022eaad9-af7c-446a-b94e-a3a75f6cc35e',
                        client_secret: '7cd5e2e58337595bffff974a29c0ecc6'
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    logMessage('corsResult', '‚úÖ CORS-Anywhere proxy funguje!', 'success');
                    logMessage('corsResult', `Token: ${data.access_token.substring(0, 20)}...`, 'info');
                } else {
                    logMessage('corsResult', `‚ùå Proxy chyba: ${response.status}`, 'error');
                }
            } catch (error) {
                logMessage('corsResult', `‚ùå CORS proxy chyba: ${error.message}`, 'error');
                logMessage('corsResult', 'üí° Zkuste aktivovat CORS-Anywhere na: https://cors-anywhere.herokuapp.com/corsdemo', 'info');
            }
        }

        function checkCORSDisabled() {
            const resultDiv = document.getElementById('corsStatus');
            resultDiv.innerHTML = '';
            
            logMessage('corsStatus', 'üîç Kontroluji CORS stav...', 'info');
            
            // Test zda je CORS vypnut√Ω
            const testUrl = 'https://httpbin.org/get';
            
            fetch(testUrl, { method: 'GET' })
                .then(response => {
                    if (response.ok) {
                        logMessage('corsStatus', '‚úÖ CORS test pro≈°el - mo≈æn√° je CORS vypnut√Ω', 'success');
                        logMessage('corsStatus', 'üí° M≈Ø≈æete zkusit testovat GroupDocs API', 'info');
                    } else {
                        logMessage('corsStatus', '‚ö†Ô∏è Test odpovƒõdƒõl, ale s chybou', 'info');
                    }
                })
                .catch(error => {
                    if (error.message.includes('CORS')) {
                        logMessage('corsStatus', '‚ùå CORS je st√°le aktivn√≠', 'error');
                        logMessage('corsStatus', 'üí° Spus≈•te Chrome s --disable-web-security', 'info');
                    } else {
                        logMessage('corsStatus', '‚ö†Ô∏è Jin√° chyba p≈ôi testu', 'info');
                    }
                });
        }

        // Automatick√Ω test p≈ôi naƒçten√≠
        window.addEventListener('load', function() {
            checkCORSDisabled();
        });
    </script>
</body>
</html>
