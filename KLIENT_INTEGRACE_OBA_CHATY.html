<!-- ========================================
     BEWIT INTELLIGENCE - OBA CHATBOTY
     Kompletn√≠ integrace pro Bewit web
     ======================================== -->

<!-- 1Ô∏è‚É£ Simulace user dat z backendu (PHP/Laravel) -->
<script>
// Na produkci by user data ≈°la z backendu
const CURRENT_USER = {
    id: '<?php echo $user->id; ?>',
    email: '<?php echo $user->email; ?>',
    firstName: '<?php echo $user->firstName; ?>',
    lastName: '<?php echo $user->lastName; ?>',
    position: '<?php echo $user->bbo?.bbo_position_id ? BBO_POSITIONS[$user->bbo->bbo_position_id] : ""; ?>',
    tokenEshop: '<?php echo $user->bewitToken; ?>'
};
console.log('üë§ Current user:', CURRENT_USER);
</script>

<!-- ========================================
     GLOB√ÅLN√ç IFRAME_READY LISTENER
     ‚ö†Ô∏è D≈ÆLE≈ΩIT√â: Tento k√≥d se vlo≈æ√≠ JEN JEDNOU na str√°nku
     ======================================== -->
<script>
(function() {
  const GR8_ORIGIN = 'https://gr8learn.eu';
  const sentTo = new WeakSet(); // Deduplikace - poslat jen 1√ó do ka≈æd√©ho iframe

  // Listener pro IFRAME_READY sign√°l z obou chat≈Ø
  window.addEventListener('message', function(event) {
    // Kontrola originu - p≈ôij√≠mej jen z gr8learn.eu
    if (event.origin !== GR8_ORIGIN) return;
    
    // Kontrola ≈æe je to IFRAME_READY zpr√°va
    if (!event.data || event.data.type !== 'IFRAME_READY') return;
    
    // Kontrola ≈æe m√°me event.source (okno iframe)
    if (!event.source) return;
    
    // Deduplikace - pokud u≈æ jsme do tohoto iframe pos√≠lali, ignoruj
    if (sentTo.has(event.source)) {
      console.log('‚ö†Ô∏è IFRAME_READY duplicitn√≠, ignoruji (chatId:', event.data.chatId, ')');
      return;
    }
    
    console.log('‚úÖ IFRAME_READY p≈ôijato z chatu:', event.data.chatId);
    
    // P≈ôiprav user data payload
    const userData = {
      type: 'USER_DATA',
      user: {
        id: CURRENT_USER.id || '',
        firstName: CURRENT_USER.firstName || '',
        lastName: CURRENT_USER.lastName || '',
        email: CURRENT_USER.email || '',
        position: CURRENT_USER.position || '',
        tokenEshop: CURRENT_USER.tokenEshop || ''
      }
    };
    
    // Po≈°li user data P≈òESNƒö do toho iframe, kter√© READY poslalo
    event.source.postMessage(userData, event.origin);
    
    // Zaznamenej, ≈æe jsme do tohoto iframe u≈æ pos√≠lali
    sentTo.add(event.source);
    
    console.log('üì§ User data posl√°na do', event.data.chatId, ':', userData.user);
  });
  
  console.log('‚úÖ Glob√°ln√≠ IFRAME_READY listener zaregistrov√°n');
})();
</script>

<!-- ========================================
     WANY CHAT (Poradce na ƒç√≠nsk√© wany)
     ======================================== -->

<!-- Dla≈ædice Wany Chat -->
<div id="wany-chat-tile" style="position:relative;background-image:url('https://modopafybeslbcqjxsve.supabase.co/storage/v1/object/public/web/ChatGPT%20Image%20Jan%2029,%202026,%2011_59_38%20AM.png');background-size:cover;background-position:center;border-radius:24px;padding:40px;box-shadow:0 4px 6px -1px rgb(0 0 0 / 0.1);max-width:420px;min-height:280px;margin:0 auto;text-align:center;overflow:hidden;">
  
  <div style="position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.65);z-index:1;"></div>
  
  <h2 style="position:relative;z-index:2;font-size:28px;color:#ffffff;margin:0 0 16px 0;text-shadow:0 2px 4px rgba(0,0,0,0.3);font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;">
    Poradce na ƒç√≠nsk√© wany
  </h2>
  
  <div style="position:relative;z-index:2;display:flex;flex-direction:column;align-items:center;gap:24px;">
    <p style="color:#e2e8f0;line-height:1.6;font-size:16px;margin:0;text-shadow:0 1px 3px rgba(0,0,0,0.3);font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;">
      N√°≈° asistent na wany dod√° informace a porad√≠ s v√Ωbƒõrem produktu
    </p>
    
    <button
      id="wany-chat-open-btn"
      onclick="openWanyChat()"
      style="width:180px;height:51px;border-radius:15px;cursor:pointer;transition:0.3s ease;background:linear-gradient(to bottom right,#2e8eff 0%,rgba(46,142,255,0) 30%);background-color:rgba(46,142,255,0.2);border:none;display:inline-flex;align-items:center;justify-content:center;flex-shrink:0;"
      onmouseover="this.style.backgroundColor='rgba(46,142,255,0.7)';this.style.boxShadow='0 0 10px rgba(46,142,255,0.5)'"
      onmouseout="this.style.backgroundColor='rgba(46,142,255,0.2)';this.style.boxShadow='none'"
    >
      <div style="width:176px;height:47px;border-radius:13px;background-color:#079854;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:600;font-size:16px;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;">
        Spustit Chat
      </div>
    </button>
  </div>
</div>

<!-- Overlay pozad√≠ Wany Chat -->
<div
  id="wany-chat-overlay"
  onclick="closeWanyChat()"
  style="position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:999998;visibility:hidden;opacity:0;transition:opacity 0.3s ease;backdrop-filter:blur(4px);"
></div>

<!-- Chat Modal Wrapper Wany Chat -->
<div
  id="wany-chat-wrapper"
  style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0.95);width:90%;max-width:1200px;height:85%;max-height:800px;z-index:999999;visibility:hidden;opacity:0;transition:all 0.3s ease;"
>
  <button
    id="wany-close-btn"
    onclick="closeWanyChat()"
    style="position:absolute;top:-48px;right:0;z-index:10;background:rgba(0,0,0,0.6);color:white;border:none;width:36px;height:36px;border-radius:8px;cursor:pointer;font-size:18px;font-family:sans-serif;transition:all 0.2s ease;display:flex;align-items:center;justify-content:center;"
    onmouseover="this.style.opacity='1';this.style.background='rgba(0,0,0,0.9)'"
    onmouseout="this.style.opacity='0.8';this.style.background='rgba(0,0,0,0.6)'"
  >‚úï</button>

  <div
    id="wany-chat-modal"
    style="width:100%;height:100%;border-radius:24px;box-shadow:0 25px 50px -12px rgba(0,0,0,0.5);overflow:hidden;"
  >
    <iframe
      id="wany-chat-iframe"
      src="https://gr8learn.eu/embed.html"
      style="width:100%;height:100%;border:0;border-radius:24px;background:#fff;"
      allow="clipboard-write"
      title="Wany Chat"
    ></iframe>
  </div>
</div>

<!-- Wany Chat JavaScript funkce -->
<script>
function openWanyChat() {
  const wrapper = document.getElementById('wany-chat-wrapper');
  const overlay = document.getElementById('wany-chat-overlay');
  
  overlay.style.visibility = 'visible';
  overlay.style.opacity = '1';
  
  wrapper.style.visibility = 'visible';
  setTimeout(() => {
    wrapper.style.opacity = '1';
    wrapper.style.transform = 'translate(-50%, -50%) scale(1)';
  }, 10);
  
  document.body.style.overflow = 'hidden';
  console.log('‚úÖ Wany Chat otev≈ôen');
}

function closeWanyChat() {
  const wrapper = document.getElementById('wany-chat-wrapper');
  const overlay = document.getElementById('wany-chat-overlay');
  
  wrapper.style.opacity = '0';
  wrapper.style.transform = 'translate(-50%, -50%) scale(0.95)';
  overlay.style.opacity = '0';
  
  setTimeout(() => {
    wrapper.style.visibility = 'hidden';
    overlay.style.visibility = 'hidden';
  }, 300);
  
  document.body.style.overflow = '';
  console.log('‚ùå Wany Chat zav≈ôen');
}

// ESC kl√°vesa pro Wany Chat
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    const wrapper = document.getElementById('wany-chat-wrapper');
    if (wrapper && wrapper.style.visibility === 'visible') {
      closeWanyChat();
    }
  }
});
</script>

<!-- ========================================
     EO SMƒöSI CHAT (Poradce na smƒõsi esenci√°ln√≠ch olej≈Ø)
     ======================================== -->

<!-- Dla≈ædice EO Smƒõsi Chat -->
<div id="eo-smesi-chat-tile" style="position:relative;background-image:url('https://modopafybeslbcqjxsve.supabase.co/storage/v1/object/public/web/ChatGPT%20Image%20Jan%2029,%202026,%2012_00_25%20PM.png');background-size:cover;background-position:center;border-radius:24px;padding:40px;box-shadow:0 4px 6px -1px rgb(0 0 0 / 0.1);max-width:420px;min-height:280px;margin:0 auto;text-align:center;overflow:hidden;">
  
  <div style="position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.65);z-index:1;"></div>
  
  <h2 style="position:relative;z-index:2;font-size:28px;color:#ffffff;margin:0 0 16px 0;text-shadow:0 2px 4px rgba(0,0,0,0.3);font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;">
    Poradce na smƒõsi esenci√°ln√≠ch olej≈Ø
  </h2>
  
  <div style="position:relative;z-index:2;display:flex;flex-direction:column;align-items:center;gap:24px;">
    <p style="color:#e2e8f0;line-height:1.6;font-size:16px;margin:0;text-shadow:0 1px 3px rgba(0,0,0,0.3);font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;">
      N√°≈° asistent na esenci√°ln√≠ oleje dod√° informace a porad√≠ s v√Ωbƒõrem produktu
    </p>
    
    <button
      id="eo-smesi-chat-open-btn"
      onclick="openEOSmesiChat()"
      style="width:180px;height:51px;border-radius:15px;cursor:pointer;transition:0.3s ease;background:linear-gradient(to bottom right,#2e8eff 0%,rgba(46,142,255,0) 30%);background-color:rgba(46,142,255,0.2);border:none;display:inline-flex;align-items:center;justify-content:center;flex-shrink:0;"
      onmouseover="this.style.backgroundColor='rgba(46,142,255,0.7)';this.style.boxShadow='0 0 10px rgba(46,142,255,0.5)'"
      onmouseout="this.style.backgroundColor='rgba(46,142,255,0.2)';this.style.boxShadow='none'"
    >
      <div style="width:176px;height:47px;border-radius:13px;background-color:#079854;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:600;font-size:16px;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;">
        Spustit Chat
      </div>
    </button>
  </div>
</div>

<!-- Overlay pozad√≠ EO Smƒõsi Chat -->
<div
  id="eo-smesi-chat-overlay"
  onclick="closeEOSmesiChat()"
  style="position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:999998;visibility:hidden;opacity:0;transition:opacity 0.3s ease;backdrop-filter:blur(4px);"
></div>

<!-- Chat Modal Wrapper EO Smƒõsi Chat -->
<div
  id="eo-smesi-chat-wrapper"
  style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0.95);width:90%;max-width:1200px;height:85%;max-height:800px;z-index:999999;visibility:hidden;opacity:0;transition:all 0.3s ease;"
>
  <button
    id="eo-smesi-close-btn"
    onclick="closeEOSmesiChat()"
    style="position:absolute;top:-48px;right:0;z-index:10;background:rgba(0,0,0,0.6);color:white;border:none;width:36px;height:36px;border-radius:8px;cursor:pointer;font-size:18px;font-family:sans-serif;transition:all 0.2s ease;display:flex;align-items:center;justify-content:center;"
    onmouseover="this.style.opacity='1';this.style.background='rgba(0,0,0,0.9)'"
    onmouseout="this.style.opacity='0.8';this.style.background='rgba(0,0,0,0.6)'"
  >‚úï</button>

  <div
    id="eo-smesi-chat-modal"
    style="width:100%;height:100%;border-radius:24px;box-shadow:0 25px 50px -12px rgba(0,0,0,0.5);overflow:hidden;"
  >
    <iframe
      id="eo-smesi-chat-iframe"
      src="https://gr8learn.eu/embed-eo-smesi.html"
      style="width:100%;height:100%;border:0;border-radius:24px;background:#fff;"
      allow="clipboard-write"
      title="EO Smƒõsi Chat"
    ></iframe>
  </div>
</div>

<!-- EO Smƒõsi Chat JavaScript funkce -->
<script>
function openEOSmesiChat() {
  const wrapper = document.getElementById('eo-smesi-chat-wrapper');
  const overlay = document.getElementById('eo-smesi-chat-overlay');
  
  overlay.style.visibility = 'visible';
  overlay.style.opacity = '1';
  
  wrapper.style.visibility = 'visible';
  setTimeout(() => {
    wrapper.style.opacity = '1';
    wrapper.style.transform = 'translate(-50%, -50%) scale(1)';
  }, 10);
  
  document.body.style.overflow = 'hidden';
  console.log('‚úÖ EO Smƒõsi Chat otev≈ôen');
}

function closeEOSmesiChat() {
  const wrapper = document.getElementById('eo-smesi-chat-wrapper');
  const overlay = document.getElementById('eo-smesi-chat-overlay');
  
  wrapper.style.opacity = '0';
  wrapper.style.transform = 'translate(-50%, -50%) scale(0.95)';
  overlay.style.opacity = '0';
  
  setTimeout(() => {
    wrapper.style.visibility = 'hidden';
    overlay.style.visibility = 'hidden';
  }, 300);
  
  document.body.style.overflow = '';
  console.log('‚ùå EO Smƒõsi Chat zav≈ôen');
}

// ESC kl√°vesa pro EO Smƒõsi Chat
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    const wrapper = document.getElementById('eo-smesi-chat-wrapper');
    if (wrapper && wrapper.style.visibility === 'visible') {
      closeEOSmesiChat();
    }
  }
});
</script>

<!-- ========================================
     KONEC INTEGRACE
     ======================================== -->
