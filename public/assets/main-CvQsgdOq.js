const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jszip.min-BkUhkW7u.js","assets/SanaChat-Bj63mdfm.js","assets/SanaChat-MPqx-1mk.css"])))=>i.map(i=>d[i]);
import"./modulepreload-polyfill-B5Qt9EMX.js";import{_ as To}from"./preload-helper-ckwbz45p.js";import{s as F,j as e,r as h,F as Lo,g as It,C as Mt,P as $o,W as No,L as Do,a as Wt,S as Bo,b as Oe,c as Fo,R as Oo,d as $e}from"./SanaChat-Bj63mdfm.js";import{l as Ro,g as Eo,i as dt,b as Ao,c as Io,a as Mo}from"./customAuthService-2eqph3FC.js";class Re{static async getAllChatbotSettings(){try{const{data:o,error:n}=await F.from("chatbot_settings").select("*").order("created_at",{ascending:!1});if(n)throw console.error("Chyba p≈ôi naƒç√≠t√°n√≠ nastaven√≠ chatbot≈Ø:",n),n;return o||[]}catch(o){throw console.error("Chyba p≈ôi naƒç√≠t√°n√≠ nastaven√≠ chatbot≈Ø:",o),o}}static async getChatbotSettings(o){try{const{data:n,error:a}=await F.from("chatbot_settings").select("*").eq("chatbot_id",o).single();return a?(console.error("Chyba p≈ôi naƒç√≠t√°n√≠ nastaven√≠ chatbota:",a),null):n}catch(n){return console.error("Chyba p≈ôi naƒç√≠t√°n√≠ nastaven√≠ chatbota:",n),null}}static async getChatbotSettingsWithDetails(o){return this.getChatbotSettings(o)}static async getDefaultWebChatbot(){try{const{data:o,error:n}=await F.from("chatbot_settings").select("*").eq("is_default_web_chatbot",!0).eq("is_active",!0).single();return n?(console.warn("‚ö†Ô∏è V√Ωchoz√≠ webov√Ω chatbot nenalezen, fallback na sana_chat:",n),this.getChatbotSettings("sana_chat")):o}catch(o){return console.error("‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ v√Ωchoz√≠ho webov√©ho chatbota:",o),this.getChatbotSettings("sana_chat")}}static async getActiveChatbots(){try{const{data:o,error:n}=await F.from("chatbot_settings").select("*").eq("is_active",!0).order("chatbot_name",{ascending:!0});if(n)throw console.error("‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ aktivn√≠ch chatbot≈Ø:",n),n;return console.log("‚úÖ Naƒçteno aktivn√≠ch chatbot≈Ø:",(o==null?void 0:o.length)||0),o||[]}catch(o){return console.error("‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ aktivn√≠ch chatbot≈Ø:",o),[]}}static async createChatbotSettings(o){try{const{data:n,error:a}=await F.from("chatbot_settings").insert([o]).select().single();if(a)throw console.error("Chyba p≈ôi vytv√°≈ôen√≠ chatbota:",a),a;return n}catch(n){throw console.error("Chyba p≈ôi vytv√°≈ôen√≠ chatbota:",n),n}}static async updateChatbotSettings(o,n){try{const{data:a,error:s}=await F.from("chatbot_settings").update(n).eq("chatbot_id",o).select().single();if(s)throw console.error("‚ùå Chyba p≈ôi UPDATE:",s),new Error(`UPDATE selhal: ${s.message}

üí° ≈òe≈°en√≠:
1. Zkontrolujte, zda jste p≈ôihl√°≈°eni
2. Spus≈•te SQL script pro opravu RLS politik (viz dokumentace)`);if(!a)throw new Error("UPDATE nevr√°til ≈æ√°dn√° data");return a}catch(a){throw console.error("‚ùå Chyba p≈ôi aktualizaci chatbota:",a),a}}static async deleteChatbotSettings(o){try{const{error:n}=await F.from("chatbot_settings").delete().eq("chatbot_id",o);if(n)throw console.error("Chyba p≈ôi maz√°n√≠ chatbota:",n),n}catch(n){throw console.error("Chyba p≈ôi maz√°n√≠ chatbota:",n),n}}static async getCategories(){try{const{data:o,error:n}=await F.from("categories").select("id, name").order("name",{ascending:!0});if(n)throw console.error("Chyba p≈ôi naƒç√≠t√°n√≠ kategori√≠:",n),n;return o||[]}catch(o){throw console.error("Chyba p≈ôi naƒç√≠t√°n√≠ kategori√≠:",o),o}}static async getPublicationTypes(){try{const{data:o,error:n}=await F.from("publication_types").select("id, name, description").order("name",{ascending:!0});if(n)throw console.error("Chyba p≈ôi naƒç√≠t√°n√≠ typ≈Ø publikac√≠:",n),n;return o||[]}catch(o){throw console.error("Chyba p≈ôi naƒç√≠t√°n√≠ typ≈Ø publikac√≠:",o),o}}static async getLabels(){try{const{data:o,error:n}=await F.from("labels").select("id, name").order("name",{ascending:!0});if(n)throw console.error("Chyba p≈ôi naƒç√≠t√°n√≠ ≈°t√≠tk≈Ø:",n),n;return o||[]}catch(o){throw console.error("Chyba p≈ôi naƒç√≠t√°n√≠ ≈°t√≠tk≈Ø:",o),o}}static async getChatbotFilters(o){try{const n=await this.getChatbotSettings(o);if(!n)throw new Error(`Chatbot s ID "${o}" nebyl nalezen`);const a=[];if(n.allowed_categories.length>0){const{data:l,error:g}=await F.from("categories").select("id, name").in("id",n.allowed_categories);g?console.error("Chyba p≈ôi naƒç√≠t√°n√≠ kategori√≠:",g):a.push(...l||[])}const s=[];if(n.allowed_publication_types.length>0){const{data:l,error:g}=await F.from("publication_types").select("id, name, description").in("id",n.allowed_publication_types);g?console.error("Chyba p≈ôi naƒç√≠t√°n√≠ typ≈Ø publikac√≠:",g):s.push(...l||[])}const c=[];if(n.allowed_labels.length>0){const{data:l,error:g}=await F.from("labels").select("id, name").in("id",n.allowed_labels);g?console.error("Chyba p≈ôi naƒç√≠t√°n√≠ ≈°t√≠tk≈Ø:",g):c.push(...l||[])}return{categories:a,publicationTypes:s,labels:c,productRecommendations:n.product_recommendations,productButtonRecommendations:n.product_button_recommendations,inlineProductLinks:n.inline_product_links||!1,bookDatabase:n.book_database,useFeed1:n.use_feed_1!==!1,useFeed2:n.use_feed_2!==!1,webhookUrl:n.webhook_url,enableProductRouter:n.enable_product_router!==!1,enableManualFunnel:n.enable_manual_funnel===!0}}catch(n){throw console.error("Chyba p≈ôi naƒç√≠t√°n√≠ filtr≈Ø chatbota:",n),n}}static async setActive(o,n){try{await this.updateChatbotSettings(o,{is_active:n})}catch(a){throw console.error("Chyba p≈ôi zmƒõnƒõ aktivace chatbota:",a),a}}}const Wo=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"}),e.jsx("circle",{cx:"9",cy:"10",r:"1"}),e.jsx("circle",{cx:"15",cy:"10",r:"1"})]}),Vo=t=>t==="wany_chat_local"?"#dc3545":"#2563eb",Uo=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),Zo=({chatbots:t,onSelect:o,onClose:n})=>e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 overflow-hidden",children:[e.jsxs("div",{className:"bg-bewit-blue text-white px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Vyberte chatbota"}),e.jsx("button",{onClick:n,className:"text-white hover:text-gray-200 transition-colors p-1 rounded-md hover:bg-white/10","aria-label":"Zav≈ô√≠t",children:e.jsx(Uo,{})})]}),e.jsx("div",{className:"p-4 max-h-[70vh] overflow-y-auto",children:t.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{className:"text-lg mb-2",children:"üòï"}),e.jsx("p",{children:"≈Ω√°dn√© aktivn√≠ chatboty nejsou k dispozici"})]}):e.jsx("div",{className:"space-y-3",children:t.map(a=>{const s=Vo(a.chatbot_id),c=a.chatbot_id==="wany_chat_local"?"hover:bg-red-50":"hover:bg-blue-50",l=a.chatbot_id==="wany_chat_local"?"hover:border-red-500":"hover:border-bewit-blue",g=a.chatbot_id==="wany_chat_local"?"group-hover:text-red-600":"group-hover:text-bewit-blue";return e.jsx("button",{onClick:()=>o(a.chatbot_id),className:`w-full text-left p-4 rounded-lg border-2 border-gray-200 ${l} ${c} transition-all duration-200 group`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center text-white group-hover:scale-110 transition-transform duration-200",style:{backgroundColor:s},children:e.jsx(Wo,{})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:`font-semibold text-gray-900 text-lg mb-1 ${g} transition-colors`,children:a.chatbot_name}),a.description&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:a.description})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:`w-5 h-5 text-gray-400 ${g} transition-colors`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})},a.id)})})}),e.jsx("div",{className:"bg-gray-50 px-6 py-3 border-t border-gray-200",children:e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Vyberte chatbota pro zah√°jen√≠ konverzace"})})]})}),Ho=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:e.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})}),Ko=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),Go=({currentUser:t,chatbotSettings:o})=>{const[n,a]=h.useState(!1),[s,c]=h.useState(!1),[l,g]=h.useState([]),[m,u]=h.useState(null),[y,x]=h.useState("sana_chat"),[i,f]=h.useState(!0);h.useEffect(()=>{(async()=>{if(o){u(o),f(!1);return}try{const W=await Re.getActiveChatbots();if(g(W),console.log("‚úÖ Naƒçteno aktivn√≠ch chatbot≈Ø:",W.length),W.length>0){const w=W[0];z(w.chatbot_id)}else x("sana_chat"),u({product_recommendations:!1,product_button_recommendations:!1,inline_product_links:!1,book_database:!0,use_feed_1:!0,use_feed_2:!0,allowed_categories:[],allowed_labels:[],allowed_publication_types:[],enable_product_router:!0,enable_manual_funnel:!1})}catch(W){console.error("‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ chatbot≈Ø:",W),u({product_recommendations:!1,product_button_recommendations:!1,book_database:!0,use_feed_1:!0,use_feed_2:!0,allowed_categories:[],allowed_labels:[],allowed_publication_types:[],enable_product_router:!0,enable_manual_funnel:!1})}finally{f(!1)}})()},[o]);const z=async N=>{var W,w,q;try{const O=await Re.getChatbotSettings(N);O&&(x(O.chatbot_id),u({product_recommendations:O.product_recommendations||!1,product_button_recommendations:O.product_button_recommendations||!1,inline_product_links:O.inline_product_links||!1,book_database:O.book_database!==void 0?O.book_database:!0,use_feed_1:O.use_feed_1!==void 0?O.use_feed_1:!0,use_feed_2:O.use_feed_2!==void 0?O.use_feed_2:!0,webhook_url:O.webhook_url,allowed_categories:O.allowed_categories||[],allowed_labels:O.allowed_labels||[],allowed_publication_types:O.allowed_publication_types||[],enable_product_router:O.enable_product_router!==!1,enable_manual_funnel:O.enable_manual_funnel===!0}),console.log(`‚úÖ Naƒçten chatbot: ${O.chatbot_name}`,{chatbot_id:O.chatbot_id,webhook_url:O.webhook_url,categories:((W=O.allowed_categories)==null?void 0:W.length)||0,labels:((w=O.allowed_labels)==null?void 0:w.length)||0,publicationTypes:((q=O.allowed_publication_types)==null?void 0:q.length)||0,enableProductRouter:O.enable_product_router!==!1,enableManualFunnel:O.enable_manual_funnel===!0}))}catch(O){console.error("‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ chatbota:",O)}},D=async N=>{console.log("ü§ñ U≈æivatel vybral chatbota:",N),c(!1),await z(N),a(!0)},Z=()=>{!n&&l.length>1?c(!0):a(!n)};return i||!m?null:e.jsxs(e.Fragment,{children:[s&&e.jsx(Zo,{chatbots:l,onSelect:D,onClose:()=>c(!1)}),n&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsx("div",{className:"w-[1200px] h-[700px] max-w-[95vw] max-h-[90vh] bg-white rounded-xl shadow-2xl flex flex-col transition-all duration-300 ease-in-out",children:e.jsx(Lo,{currentUser:t,chatbotId:y,chatbotSettings:m,onClose:()=>a(!1)})})}),e.jsx("div",{className:"fixed bottom-5 right-5 z-50",children:e.jsx("button",{onClick:Z,className:"w-16 h-16 bg-bewit-blue rounded-full text-white flex items-center justify-center shadow-lg hover:bg-blue-800 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-bewit-blue","aria-label":n?"Zav≈ô√≠t chat":"Otev≈ô√≠t chat",children:n?e.jsx(Ko,{className:"w-8 h-8"}):e.jsx(Ho,{className:"w-8 h-8"})})})]})},Yo=({onClose:t})=>{const[o,n]=h.useState([]),[a,s]=h.useState(new Set),[c,l]=h.useState(!0),[g,m]=h.useState(!1),[u,y]=h.useState(!1),[x,i]=h.useState(""),[f,z]=h.useState("all"),[D,Z]=h.useState({current:0,total:0,productName:""}),[N,W]=h.useState({current:0,total:0,productName:""}),[w,q]=h.useState(50),[O,X]=h.useState(1),H=h.useCallback(async()=>{l(!0),console.log("üîç Naƒç√≠t√°m produkty z products tabulky...");try{const{data:j,error:T}=await F.from("products").select("id, product_code, name, description, category, price, currency, product_url, image_url").order("name");if(console.log("üìä Products response:",{productsData:j,productsError:T}),T){console.error("‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ produkt≈Ø:",T),alert(`Chyba p≈ôi naƒç√≠t√°n√≠ produkt≈Ø: ${T.message}`);return}const{data:C,error:G}=await F.from("product_embeddings").select("product_code, embedding_status, embedding_generated_at");console.log("üìä Embeddings response:",{embeddingsData:C,embeddingsError:G}),G&&console.warn("‚ö†Ô∏è Chyba p≈ôi naƒç√≠t√°n√≠ embedding≈Ø (mo≈æn√° tabulka neexistuje):",G);const J=new Map;C&&C.forEach(pe=>{J.set(pe.product_code,pe)});const V=(j||[]).map(pe=>{const $=J.get(pe.product_code);return{id:pe.id,product_code:pe.product_code,name:pe.name,description:pe.description,category:pe.category,price:pe.price,currency:pe.currency,product_url:pe.product_url,image_url:pe.image_url,has_embedding:!!$,embedding_status:$?$.embedding_status:"none",embedding_generated_at:$?$.embedding_generated_at:null}});console.log(`‚úÖ Naƒçteno ${V.length} produkt≈Ø`),n(V)}catch(j){console.error("‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ produkt≈Ø:",j),alert(`Chyba p≈ôi naƒç√≠t√°n√≠ produkt≈Ø: ${j}`)}finally{l(!1)}},[]);h.useEffect(()=>{H()},[H]);const te=o.filter(j=>{const T=j.name.toLowerCase().includes(x.toLowerCase())||j.description&&j.description.toLowerCase().includes(x.toLowerCase())||j.category&&j.category.toLowerCase().includes(x.toLowerCase()),C=f==="all"||f==="no_embedding"&&!j.has_embedding||f==="has_embedding"&&j.has_embedding||j.embedding_status===f;return T&&C}),v=Math.ceil(te.length/w),ne=(O-1)*w,ie=ne+w,ae=te.slice(ne,ie);h.useEffect(()=>{X(1)},[x,f,w]);const ge={total:o.length,no_embedding:o.filter(j=>!j.has_embedding).length,pending:o.filter(j=>j.embedding_status==="pending").length,completed:o.filter(j=>j.embedding_status==="completed").length,error:o.filter(j=>j.embedding_status==="error").length},Se=()=>{const j=ae.map(G=>G.id),T=j.every(G=>a.has(G)),C=new Set(a);T?j.forEach(G=>C.delete(G)):j.forEach(G=>C.add(G)),s(C)},ye=j=>{const T=new Set(a);T.has(j)?T.delete(j):T.add(j),s(T)},ke=async()=>{const j=o.filter(C=>a.has(C.id));if(j.length===0){alert("Vyberte alespo≈à jeden produkt pro odesl√°n√≠ na N8N webhook.");return}y(!0),W({current:0,total:1,productName:"P≈ô√≠prava dat..."});const T="https://n8n.srv980546.hstgr.cloud/webhook/15210f31-7432-4002-aaa8-4026c462aa29";try{console.log(`üì§ Odes√≠l√°m ${j.length} produkt≈Ø na N8N webhook`);const C={products:j.map(V=>({id:V.id,product_code:V.product_code,name:V.name,description:V.description,category:V.category,price:V.price,currency:V.currency,product_url:V.product_url,image_url:V.image_url,has_embedding:V.has_embedding,embedding_status:V.embedding_status,embedding_generated_at:V.embedding_generated_at,full_content:`${V.name}
${V.description||""}
Kategorie: ${V.category||""}
Cena: ${V.price?`${V.price} ${V.currency}`:"Neuvedena"}
K√≥d produktu: ${V.product_code}`})),total_count:j.length,timestamp:new Date().toISOString(),batch_id:`batch_${Date.now()}`};W({current:1,total:2,productName:"Odes√≠l√°m data..."});const G=await fetch(T,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(C)});if(!G.ok)throw console.error("Chyba p≈ôi odes√≠l√°n√≠ produkt≈Ø:",G.status,G.statusText),new Error(`HTTP ${G.status}: ${G.statusText}`);W({current:2,total:2,productName:"Zpracov√°v√°m odpovƒõƒè..."});let J;try{J=await G.json(),console.log("üì• Odpovƒõƒè z N8N webhook:",J)}catch(V){console.warn("‚ö†Ô∏è Nepoda≈ôilo se parsovat odpovƒõƒè jako JSON:",V),J={success:!0,message:"Odpovƒõƒè p≈ôijata bez JSON form√°tu"}}if(J.success===!0||J.status==="success"||G.status===200){console.log(`‚úÖ √öspƒõ≈°nƒõ odesl√°no ${j.length} produkt≈Ø na N8N webhook`),s(new Set);let V=`‚úÖ √öspƒõ≈°nƒõ odesl√°no ${j.length} produkt≈Ø na N8N webhook`;J.message&&(V+=`

üìã Odpovƒõƒè webhoku: ${J.message}`),J.processed_count!==void 0&&(V+=`
üìä Zpracov√°no: ${J.processed_count} produkt≈Ø`),J.batch_id&&(V+=`
üÜî Batch ID: ${J.batch_id}`),J.processing_time&&(V+=`
‚è±Ô∏è Doba zpracov√°n√≠: ${J.processing_time}`),alert(V)}else{console.error("‚ùå Webhook vr√°til chybu:",J);let V="‚ùå Webhook vr√°til chybu";(J.message||J.error)&&(V+=`

üìã Chybov√° zpr√°va: ${J.message||J.error}`),J.failed_count!==void 0&&(V+=`
üìä Ne√∫spƒõ≈°n√Ωch: ${J.failed_count} produkt≈Ø`),J.batch_id&&(V+=`
üÜî Batch ID: ${J.batch_id}`),alert(V);return}}catch(C){console.error("‚ùå Chyba p≈ôi odes√≠l√°n√≠ na N8N webhook:",C),alert(`‚ùå Chyba p≈ôi komunikaci s N8N webhook:

${C}`)}finally{y(!1),W({current:0,total:0,productName:""})}},je=async()=>{const j=o.filter(T=>a.has(T.id));if(j.length===0){alert("Vyberte alespo≈à jeden produkt pro embedding.");return}m(!0),Z({current:0,total:j.length,productName:""});try{for(let T=0;T<j.length;T++){const C=j[T];Z({current:T+1,total:j.length,productName:C.name});try{console.log(`üîÑ Zpracov√°v√°m produkt: ${C.name}`);const{error:G}=await F.from("product_embeddings").upsert({product_code:C.product_code,product_name:C.name,description:C.description,category:C.category,price:C.price,product_url:C.product_url,image_url:C.image_url,currency:C.currency,search_text:`${C.name} ${C.description||""} ${C.category||""}`.trim(),embedding_status:"processing",synced_from_products_at:new Date().toISOString(),updated_at:new Date().toISOString()},{onConflict:"product_code"});if(G){console.error("Chyba p≈ôi vkl√°d√°n√≠ do product_embeddings:",G);continue}const J=`${C.name} ${C.description||""} ${C.category||""}`.trim();if(!J){await F.from("product_embeddings").update({embedding_status:"error"}).eq("product_code",C.product_code);continue}const V=await It(J);if(V.success&&V.embedding){const{error:pe}=await F.from("product_embeddings").update({embedding:`[${V.embedding.join(",")}]`,embedding_status:"completed",embedding_generated_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("product_code",C.product_code);pe?(console.error("Chyba p≈ôi ukl√°d√°n√≠ embeddingu:",pe),await F.from("product_embeddings").update({embedding_status:"error"}).eq("product_code",C.product_code)):console.log(`‚úÖ Embedding √∫spƒõ≈°nƒõ ulo≈æen pro: ${C.name}`)}else await F.from("product_embeddings").update({embedding_status:"error"}).eq("product_code",C.product_code);await new Promise(pe=>setTimeout(pe,200))}catch(G){console.error(`Chyba p≈ôi zpracov√°n√≠ produktu ${C.name}:`,G),await F.from("product_embeddings").update({embedding_status:"error"}).eq("product_code",C.product_code)}}s(new Set),await H()}catch(T){console.error("Chyba p≈ôi zpracov√°n√≠ embedding≈Ø:",T)}finally{m(!1),Z({current:0,total:0,productName:""})}},_e=()=>e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),_=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"23 4 23 10 17 10"}),e.jsx("path",{d:"m3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]}),I=(j,T)=>{if(!T)return e.jsx("span",{style:{...E.statusBadge,backgroundColor:"#f8f9fa",color:"#6c757d",border:"1px solid #dee2e6"},children:"Bez embeddingu"});const C={pending:{backgroundColor:"#fff3cd",color:"#856404",border:"1px solid #ffeaa7"},processing:{backgroundColor:"#cce5ff",color:"#004085",border:"1px solid #74b9ff"},completed:{backgroundColor:"#d1edff",color:"#155724",border:"1px solid #74b9ff"},error:{backgroundColor:"#f8d7da",color:"#721c24",border:"1px solid #fd79a8"}},G={pending:"ƒåek√°",processing:"Zpracov√°v√° se",completed:"Dokonƒçeno",error:"Chyba"};return e.jsx("span",{style:{...E.statusBadge,...C[j]},children:G[j]||j})};return e.jsx("div",{style:E.overlay,children:e.jsxs("div",{style:E.modal,children:[e.jsxs("div",{style:E.header,children:[e.jsx("h2",{style:E.title,children:"Produktov√Ω Feed - Embeddingy"}),e.jsx("button",{style:E.closeButton,onClick:t,children:e.jsx(_e,{})})]}),e.jsx("div",{style:E.statsSection,children:e.jsxs("div",{style:E.statsGrid,children:[e.jsxs("div",{style:E.statCard,children:[e.jsx("div",{style:E.statNumber,children:ge.total}),e.jsx("div",{style:E.statLabel,children:"Celkem"})]}),e.jsxs("div",{style:E.statCard,children:[e.jsx("div",{style:E.statNumber,children:ge.no_embedding}),e.jsx("div",{style:E.statLabel,children:"Bez embeddingu"})]}),e.jsxs("div",{style:E.statCard,children:[e.jsx("div",{style:E.statNumber,children:ge.pending}),e.jsx("div",{style:E.statLabel,children:"ƒåek√°"})]}),e.jsxs("div",{style:E.statCard,children:[e.jsx("div",{style:E.statNumber,children:ge.completed}),e.jsx("div",{style:E.statLabel,children:"Hotovo"})]}),e.jsxs("div",{style:E.statCard,children:[e.jsx("div",{style:E.statNumber,children:ge.error}),e.jsx("div",{style:E.statLabel,children:"Chyby"})]})]})}),e.jsxs("div",{style:E.controlsSection,children:[e.jsxs("div",{style:E.controlsRow,children:[e.jsx("input",{type:"text",placeholder:"Vyhledat produkty...",value:x,onChange:j=>i(j.target.value),style:E.searchInput}),e.jsxs("select",{value:f,onChange:j=>z(j.target.value),style:E.statusSelect,children:[e.jsx("option",{value:"all",children:"V≈°echny statusy"}),e.jsx("option",{value:"no_embedding",children:"Bez embeddingu"}),e.jsx("option",{value:"pending",children:"ƒåek√°"}),e.jsx("option",{value:"processing",children:"Zpracov√°v√° se"}),e.jsx("option",{value:"completed",children:"Dokonƒçeno"}),e.jsx("option",{value:"error",children:"Chyba"})]}),e.jsx("button",{style:E.refreshButton,onClick:H,children:e.jsx(_,{})})]}),e.jsxs("div",{style:E.actionRow,children:[e.jsxs("div",{style:E.selectionInfo,children:["Vybr√°no: ",a.size," z ",te.length]}),e.jsxs("div",{style:E.actionButtons,children:[e.jsx("button",{style:E.selectAllButton,onClick:Se,children:ae.length>0&&ae.every(j=>a.has(j.id))?"Zru≈°it v√Ωbƒõr str√°nky":"Vybrat str√°nku"}),e.jsx("button",{style:E.embeddingButton,onClick:je,disabled:a.size===0||g||u,children:g?"Zpracov√°v√° se...":`Spustit Embedding (${a.size})`}),e.jsx("button",{style:E.n8nButton,onClick:ke,disabled:a.size===0||g||u,children:u?"Odes√≠l√° se...":`N8N Embedding (${a.size})`})]})]}),e.jsxs("div",{style:E.paginationRow,children:[e.jsxs("div",{style:E.paginationInfo,children:["Zobrazeno: ",ne+1," - ",Math.min(ie,te.length)," z ",te.length]}),e.jsxs("div",{style:E.paginationControls,children:[e.jsxs("label",{style:E.paginationLabel,children:["Z√°znam≈Ø na str√°nku:",e.jsxs("select",{value:w,onChange:j=>q(Number(j.target.value)),style:E.paginationSelect,children:[e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"}),e.jsx("option",{value:500,children:"500"}),e.jsx("option",{value:1e3,children:"1000"})]})]}),e.jsxs("div",{style:E.paginationButtons,children:[e.jsx("button",{style:{...E.paginationButton,opacity:O===1?.5:1},onClick:()=>X(1),disabled:O===1,children:"<<"}),e.jsx("button",{style:{...E.paginationButton,opacity:O===1?.5:1},onClick:()=>X(j=>Math.max(1,j-1)),disabled:O===1,children:"<"}),e.jsxs("span",{style:E.pageNumber,children:["Str√°nka ",O," z ",v||1]}),e.jsx("button",{style:{...E.paginationButton,opacity:O===v?.5:1},onClick:()=>X(j=>Math.min(v,j+1)),disabled:O===v,children:">"}),e.jsx("button",{style:{...E.paginationButton,opacity:O===v?.5:1},onClick:()=>X(v),disabled:O===v,children:">>"})]})]})]})]}),g&&e.jsxs("div",{style:E.progressSection,children:[e.jsxs("div",{style:E.progressText,children:["Embedding: ",D.current," / ",D.total," - ",D.productName]}),e.jsx("div",{style:E.progressBar,children:e.jsx("div",{style:{...E.progressFill,width:`${D.current/D.total*100}%`}})})]}),u&&e.jsxs("div",{style:E.progressSection,children:[e.jsxs("div",{style:E.progressText,children:["N8N Webhook: ",N.current," / ",N.total," - ",N.productName]}),e.jsx("div",{style:E.progressBar,children:e.jsx("div",{style:{...E.progressFill,backgroundColor:"#28a745",width:`${N.current/N.total*100}%`}})})]}),e.jsx("div",{style:E.tableSection,children:c?e.jsx("div",{style:E.loading,children:"Naƒç√≠t√°m produkty..."}):e.jsxs("div",{style:E.tableContainer,children:[e.jsxs("table",{style:E.table,children:[e.jsx("thead",{children:e.jsxs("tr",{style:E.tableHeaderRow,children:[e.jsx("th",{style:E.tableHeaderCell,children:e.jsx("input",{type:"checkbox",checked:ae.length>0&&ae.every(j=>a.has(j.id)),onChange:Se,style:E.checkbox})}),e.jsx("th",{style:E.tableHeaderCell,children:"K√≥d"}),e.jsx("th",{style:E.tableHeaderCell,children:"N√°zev"}),e.jsx("th",{style:E.tableHeaderCell,children:"Kategorie"}),e.jsx("th",{style:E.tableHeaderCell,children:"Cena"}),e.jsx("th",{style:E.tableHeaderCell,children:"Status"}),e.jsx("th",{style:E.tableHeaderCell,children:"Embedding"})]})}),e.jsx("tbody",{children:ae.map(j=>e.jsxs("tr",{style:E.tableRow,children:[e.jsx("td",{style:E.tableCell,children:e.jsx("input",{type:"checkbox",checked:a.has(j.id),onChange:()=>ye(j.id),style:E.checkbox})}),e.jsx("td",{style:E.tableCell,children:e.jsx("div",{style:E.productCode,children:j.product_code})}),e.jsxs("td",{style:E.tableCell,children:[e.jsx("div",{style:E.productName,children:j.name}),j.description&&e.jsxs("div",{style:E.productDescription,children:[j.description.substring(0,100),"..."]})]}),e.jsx("td",{style:E.tableCell,children:j.category||"-"}),e.jsx("td",{style:E.tableCell,children:j.price?`${j.price} ${j.currency}`:"-"}),e.jsx("td",{style:E.tableCell,children:I(j.embedding_status,j.has_embedding)}),e.jsx("td",{style:E.tableCell,children:j.embedding_generated_at?new Date(j.embedding_generated_at).toLocaleDateString("cs-CZ"):"-"})]},j.id))})]}),ae.length===0&&e.jsx("div",{style:E.noResults,children:"≈Ω√°dn√© produkty nenalezeny."})]})})]})})},E={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",justifyContent:"center",alignItems:"flex-start",zIndex:1e3,padding:"20px",overflow:"auto"},modal:{backgroundColor:"white",borderRadius:"12px",width:"95%",maxWidth:"1200px",maxHeight:"90vh",overflow:"hidden",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.3)",display:"flex",flexDirection:"column"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",borderBottom:"1px solid #e0e0e0",backgroundColor:"#f8f9fa"},title:{margin:0,fontSize:"24px",fontWeight:"600",color:"#333"},closeButton:{background:"none",border:"none",cursor:"pointer",padding:"8px",borderRadius:"6px",color:"#666",transition:"all 0.2s"},statsSection:{padding:"16px 24px",borderBottom:"1px solid #e0e0e0"},statsGrid:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:"16px"},statCard:{textAlign:"center",padding:"12px",backgroundColor:"#f8f9fa",borderRadius:"8px"},statNumber:{fontSize:"20px",fontWeight:"bold",color:"#333"},statLabel:{fontSize:"12px",color:"#666",marginTop:"4px"},controlsSection:{padding:"16px 24px",borderBottom:"1px solid #e0e0e0",backgroundColor:"#f8f9fa"},controlsRow:{display:"flex",gap:"12px",alignItems:"center",marginBottom:"12px"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid #ddd",borderRadius:"6px",fontSize:"14px"},statusSelect:{padding:"8px 12px",border:"1px solid #ddd",borderRadius:"6px",fontSize:"14px",minWidth:"180px"},refreshButton:{padding:"8px",border:"1px solid #ddd",borderRadius:"6px",cursor:"pointer",backgroundColor:"white",color:"#666"},actionRow:{display:"flex",justifyContent:"space-between",alignItems:"center"},selectionInfo:{fontSize:"14px",color:"#666"},actionButtons:{display:"flex",gap:"8px"},selectAllButton:{padding:"8px 16px",border:"1px solid #007bff",borderRadius:"6px",cursor:"pointer",backgroundColor:"white",color:"#007bff",fontSize:"14px"},embeddingButton:{padding:"8px 16px",border:"none",borderRadius:"6px",cursor:"pointer",backgroundColor:"#007bff",color:"white",fontSize:"14px"},n8nButton:{padding:"8px 16px",border:"none",borderRadius:"6px",cursor:"pointer",backgroundColor:"#28a745",color:"white",fontSize:"14px",fontWeight:"500"},progressSection:{padding:"16px 24px",backgroundColor:"#f8f9fa",borderBottom:"1px solid #e0e0e0"},progressText:{fontSize:"14px",marginBottom:"8px",color:"#333"},progressBar:{width:"100%",height:"8px",backgroundColor:"#e9ecef",borderRadius:"4px",overflow:"hidden"},progressFill:{height:"100%",backgroundColor:"#007bff",transition:"width 0.3s ease"},tableSection:{flex:1,overflow:"auto"},loading:{textAlign:"center",padding:"40px",color:"#666"},tableContainer:{overflow:"auto",maxHeight:"100%"},table:{width:"100%",borderCollapse:"collapse",fontSize:"14px"},tableHeaderRow:{backgroundColor:"#f8f9fa",borderBottom:"2px solid #dee2e6"},tableHeaderCell:{padding:"12px 8px",textAlign:"left",fontWeight:"bold",color:"#333",borderBottom:"2px solid #dee2e6",position:"sticky",top:0,backgroundColor:"#f8f9fa",zIndex:10},tableRow:{borderBottom:"1px solid #e9ecef",transition:"background-color 0.2s"},tableCell:{padding:"12px 8px",verticalAlign:"top"},checkbox:{cursor:"pointer"},productCode:{fontFamily:"monospace",fontSize:"12px",color:"#666"},productName:{fontWeight:"bold",color:"#333",marginBottom:"4px"},productDescription:{fontSize:"12px",color:"#666",fontStyle:"italic"},statusBadge:{padding:"4px 8px",borderRadius:"4px",fontSize:"12px",fontWeight:"bold"},noResults:{textAlign:"center",padding:"40px",color:"666",fontStyle:"italic"},paginationRow:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"16px",paddingTop:"16px",borderTop:"1px solid #e0e0e0"},paginationInfo:{fontSize:"14px",color:"#666",fontWeight:"500"},paginationControls:{display:"flex",alignItems:"center",gap:"16px"},paginationLabel:{display:"flex",alignItems:"center",gap:"8px",fontSize:"14px",color:"#666"},paginationSelect:{padding:"6px 10px",border:"1px solid #ddd",borderRadius:"6px",fontSize:"14px",cursor:"pointer",backgroundColor:"white"},paginationButtons:{display:"flex",alignItems:"center",gap:"8px"},paginationButton:{padding:"6px 12px",border:"1px solid #ddd",borderRadius:"6px",cursor:"pointer",backgroundColor:"white",color:"#333",fontSize:"14px",fontWeight:"500",transition:"all 0.2s"},pageNumber:{fontSize:"14px",color:"#333",fontWeight:"500",padding:"0 8px"}},qo=({onClose:t})=>{const[o,n]=h.useState([]),[a,s]=h.useState(new Set),[c,l]=h.useState(!0),[g,m]=h.useState(!1),[u,y]=h.useState(!1),[x,i]=h.useState(""),[f,z]=h.useState("all"),[D,Z]=h.useState({current:0,total:0,productName:""}),[N,W]=h.useState({current:0,total:0,productName:""}),[w,q]=h.useState(50),[O,X]=h.useState(1),[H,te]=h.useState(1e3),[v,ne]=h.useState(0),[ie,ae]=h.useState(!1),ge=async($=!1)=>{$?ae(!0):l(!0);const ce=$?o.length:0,Y=$?w:1e3;console.log(`üîç Naƒç√≠t√°m produkty z product_feed_2 tabulky... (offset: ${ce}, limit: ${Y})`);try{if(!$){const{count:M,error:Pe}=await F.from("product_feed_2").select("*",{count:"exact",head:!0});!Pe&&M!==null&&(ne(M),console.log(`üìä Celkov√Ω poƒçet produkt≈Ø v datab√°zi: ${M}`))}const{data:re,error:Q}=await F.from("product_feed_2").select("id, product_code, product_name, description_short, description_long, category, price, currency, url, thumbnail, embedding_status, embedding_generated_at").order("product_name").range(ce,ce+Y-1);if(console.log("üìä Products Feed 2 response:",{productsData:re,productsError:Q}),Q){console.error("‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ produkt≈Ø Feed 2:",Q),alert(`Chyba p≈ôi naƒç√≠t√°n√≠ produkt≈Ø Feed 2: ${Q.message}`);return}const ve=(re||[]).map(M=>({id:M.id,product_code:M.product_code,product_name:M.product_name,description_short:M.description_short,description_long:M.description_long,category:M.category,price:M.price,currency:M.currency,url:M.url,thumbnail:M.thumbnail,has_embedding:M.embedding_status==="completed",embedding_status:M.embedding_status||"none",embedding_generated_at:M.embedding_generated_at}));$?(console.log(`‚úÖ Naƒçteno dal≈°√≠ch ${ve.length} produkt≈Ø z Feed 2`),n(M=>[...M,...ve]),te(M=>M+ve.length)):(console.log(`‚úÖ Naƒçteno ${ve.length} produkt≈Ø z Feed 2 (prvotn√≠ naƒçten√≠)`),n(ve),te(ve.length))}catch(re){console.error("‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ produkt≈Ø Feed 2:",re),alert(`Chyba p≈ôi naƒç√≠t√°n√≠ produkt≈Ø Feed 2: ${re}`)}finally{l(!1),ae(!1)}};h.useEffect(()=>{ge(!1)},[]);const Se=()=>{ge(!0)},ye=o.filter($=>{const ce=$.product_name.toLowerCase().includes(x.toLowerCase())||$.description_short&&$.description_short.toLowerCase().includes(x.toLowerCase())||$.description_long&&$.description_long.toLowerCase().includes(x.toLowerCase())||$.category&&$.category.toLowerCase().includes(x.toLowerCase()),Y=f==="all"||f==="no_embedding"&&!$.has_embedding||f==="has_embedding"&&$.has_embedding||$.embedding_status===f;return ce&&Y}),ke=Math.ceil(ye.length/w),je=(O-1)*w,_e=je+w,_=ye.slice(je,_e);h.useEffect(()=>{X(1)},[x,f,w]);const I={total:o.length,no_embedding:o.filter($=>!$.has_embedding).length,pending:o.filter($=>$.embedding_status==="pending").length,completed:o.filter($=>$.embedding_status==="completed").length,error:o.filter($=>$.embedding_status==="error").length},j=()=>{const $=_.map(re=>re.id),ce=$.every(re=>a.has(re)),Y=new Set(a);ce?$.forEach(re=>Y.delete(re)):$.forEach(re=>Y.add(re)),s(Y)},T=$=>{const ce=new Set(a);ce.has($)?ce.delete($):ce.add($),s(ce)},C=async()=>{const $=o.filter(Y=>a.has(Y.id));if($.length===0){alert("Vyberte alespo≈à jeden produkt pro odesl√°n√≠ na N8N webhook.");return}y(!0),W({current:0,total:1,productName:"P≈ô√≠prava dat..."});const ce="https://n8n.srv980546.hstgr.cloud/webhook/3890ccdd-d09f-461b-b409-660d477023a3";try{console.log(`üì§ Odes√≠l√°m ${$.length} produkt≈Ø Feed 2 na N8N webhook`);const Y={products:$.map(M=>({id:M.id,product_code:M.product_code,product_name:M.product_name,description_short:M.description_short,description_long:M.description_long,category:M.category,price:M.price,currency:M.currency,url:M.url,thumbnail:M.thumbnail,has_embedding:M.has_embedding,embedding_status:M.embedding_status,embedding_generated_at:M.embedding_generated_at,feed_source:"feed_2",full_content:`${M.product_name}
${M.description_short||""}
${M.description_long||""}
Kategorie: ${M.category||""}
Cena: ${M.price?`${M.price} ${M.currency}`:"Neuvedena"}
K√≥d produktu: ${M.product_code}`})),total_count:$.length,timestamp:new Date().toISOString(),batch_id:`feed2_batch_${Date.now()}`,feed_source:"feed_2"};W({current:1,total:2,productName:"Odes√≠l√°m data..."});const re=await fetch(ce,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Y)});if(!re.ok)throw console.error("Chyba p≈ôi odes√≠l√°n√≠ produkt≈Ø Feed 2:",re.status,re.statusText),new Error(`HTTP ${re.status}: ${re.statusText}`);W({current:2,total:2,productName:"Zpracov√°v√°m odpovƒõƒè..."});let Q;try{Q=await re.json(),console.log("üì• Odpovƒõƒè z N8N webhook Feed 2:",Q),console.log("üì• Response status:",re.status),console.log("üì• responseData.success:",Q.success),console.log("üì• responseData.status:",Q.status)}catch(M){console.warn("‚ö†Ô∏è Nepoda≈ôilo se parsovat odpovƒõƒè jako JSON:",M),Q={success:!0,message:"Odpovƒõƒè p≈ôijata bez JSON form√°tu"}}const ve=re.status===200||re.ok||Q.success===!0||Q.status==="success";if(console.log("üîç Vyhodnocen√≠ √∫spƒõchu:"),console.log("  - response.status:",re.status),console.log("  - response.ok:",re.ok),console.log("  - responseData.success:",Q.success),console.log("  - responseData.status:",Q.status),console.log("  - isSuccess:",ve),ve){console.log(`‚úÖ √öspƒõ≈°nƒõ odesl√°no ${$.length} produkt≈Ø Feed 2 na N8N webhook`),console.log("üîÑ Aktualizuji embedding_status pro √∫spƒõ≈°nƒõ odeslan√© produkty...");const M=$.map(P=>P.product_code);console.log("üìã Product codes k aktualizaci:",M),console.log("üìä Poƒçet produkt≈Ø k aktualizaci:",M.length);try{const{data:P,error:A}=await F.from("product_feed_2").update({embedding_status:"completed",embedding_generated_at:new Date().toISOString()}).in("product_code",M).select();A?(console.error("‚ùå Chyba p≈ôi aktualizaci embedding_status:",A),alert(`‚ùå Chyba p≈ôi aktualizaci statusu: ${A.message}`)):(console.log("‚úÖ Status aktualizov√°n v product_feed_2 tabulce"),console.log("‚úÖ Poƒçet aktualizovan√Ωch z√°znam≈Ø:",(P==null?void 0:P.length)||0),console.log("‚úÖ Aktualizovan√° data:",P))}catch(P){console.error("‚ùå Neoƒçek√°van√° chyba p≈ôi aktualizaci statusu:",P),alert(`‚ùå Neoƒçek√°van√° chyba: ${P}`)}await ge(),s(new Set);let Pe=`‚úÖ √öspƒõ≈°nƒõ odesl√°no ${$.length} produkt≈Ø Feed 2 na N8N webhook`;Q.message&&(Pe+=`

üìã Odpovƒõƒè webhoku: ${Q.message}`),Q.processed_count!==void 0&&(Pe+=`
üìä Zpracov√°no: ${Q.processed_count} produkt≈Ø`),Q.batch_id&&(Pe+=`
üÜî Batch ID: ${Q.batch_id}`),Q.processing_time&&(Pe+=`
‚è±Ô∏è Doba zpracov√°n√≠: ${Q.processing_time}`),Pe+=`

‚úÖ Status aktualizov√°n v datab√°zi`,alert(Pe)}else{console.error("‚ùå Webhook Feed 2 vr√°til chybu:",Q);let M="‚ùå Webhook Feed 2 vr√°til chybu";(Q.message||Q.error)&&(M+=`

üìã Chybov√° zpr√°va: ${Q.message||Q.error}`),Q.failed_count!==void 0&&(M+=`
üìä Ne√∫spƒõ≈°n√Ωch: ${Q.failed_count} produkt≈Ø`),Q.batch_id&&(M+=`
üÜî Batch ID: ${Q.batch_id}`),alert(M);return}}catch(Y){console.error("‚ùå Chyba p≈ôi odes√≠l√°n√≠ na N8N webhook Feed 2:",Y),alert(`‚ùå Chyba p≈ôi komunikaci s N8N webhook Feed 2:

${Y}`)}finally{y(!1),W({current:0,total:0,productName:""})}},G=async()=>{const $=o.filter(ce=>a.has(ce.id));if($.length===0){alert("Vyberte alespo≈à jeden produkt pro embedding.");return}m(!0),Z({current:0,total:$.length,productName:""});try{for(let ce=0;ce<$.length;ce++){const Y=$[ce];Z({current:ce+1,total:$.length,productName:Y.product_name});try{console.log(`üîÑ Zpracov√°v√°m produkt Feed 2: ${Y.product_name}`);const{error:re}=await F.from("product_embeddings").upsert({product_code:Y.product_code,product_name:Y.product_name,description:null,description_short:Y.description_short,description_long:Y.description_long,category:Y.category,price:Y.price,product_url:Y.url,image_url:Y.thumbnail,currency:Y.currency,feed_source:"feed_2",search_text:`${Y.product_name} ${Y.description_short||""} ${Y.description_long||""} ${Y.category||""}`.trim(),embedding_status:"processing",synced_from_products_at:new Date().toISOString(),updated_at:new Date().toISOString()},{onConflict:"product_code"});if(re){console.error("Chyba p≈ôi vkl√°d√°n√≠ do product_embeddings:",re);continue}const Q=`${Y.product_name} ${Y.description_short||""} ${Y.description_long||""} ${Y.category||""}`.trim();if(!Q){await F.from("product_embeddings").update({embedding_status:"error"}).eq("product_code",Y.product_code);continue}const ve=await It(Q);if(ve.success&&ve.embedding){const{error:M}=await F.from("product_embeddings").update({embedding:`[${ve.embedding.join(",")}]`,embedding_status:"completed",embedding_generated_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("product_code",Y.product_code);M?(console.error("Chyba p≈ôi ukl√°d√°n√≠ embeddingu:",M),await F.from("product_embeddings").update({embedding_status:"error"}).eq("product_code",Y.product_code)):console.log(`‚úÖ Embedding Feed 2 √∫spƒõ≈°nƒõ ulo≈æen pro: ${Y.product_name}`)}else await F.from("product_embeddings").update({embedding_status:"error"}).eq("product_code",Y.product_code);await new Promise(M=>setTimeout(M,200))}catch(re){console.error(`Chyba p≈ôi zpracov√°n√≠ produktu Feed 2 ${Y.product_name}:`,re),await F.from("product_embeddings").update({embedding_status:"error"}).eq("product_code",Y.product_code)}}s(new Set),await ge()}catch(ce){console.error("Chyba p≈ôi zpracov√°n√≠ embedding≈Ø Feed 2:",ce)}finally{m(!1),Z({current:0,total:0,productName:""})}},J=()=>e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),V=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"23 4 23 10 17 10"}),e.jsx("path",{d:"m3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]}),pe=($,ce)=>{if(!ce)return e.jsx("span",{style:{...R.statusBadge,backgroundColor:"#f8f9fa",color:"#6c757d",border:"1px solid #dee2e6"},children:"Bez embeddingu"});const Y={pending:{backgroundColor:"#fff3cd",color:"#856404",border:"1px solid #ffeaa7"},processing:{backgroundColor:"#cce5ff",color:"#004085",border:"1px solid #74b9ff"},completed:{backgroundColor:"#d1edff",color:"#155724",border:"1px solid #74b9ff"},error:{backgroundColor:"#f8d7da",color:"#721c24",border:"1px solid #fd79a8"}},re={pending:"ƒåek√°",processing:"Zpracov√°v√° se",completed:"Dokonƒçeno",error:"Chyba"};return e.jsx("span",{style:{...R.statusBadge,...Y[$]},children:re[$]||$})};return e.jsx("div",{style:R.overlay,children:e.jsxs("div",{style:R.modal,children:[e.jsxs("div",{style:R.header,children:[e.jsx("h2",{style:R.title,children:"Produktov√Ω Feed 2 - Embeddingy"}),e.jsx("button",{style:R.closeButton,onClick:t,children:e.jsx(J,{})})]}),e.jsxs("div",{style:R.statsSection,children:[e.jsxs("div",{style:R.loadInfoBanner,children:["üì¶ Naƒçteno: ",e.jsx("strong",{children:H})," z ",e.jsx("strong",{children:v})," produkt≈Ø",H<v&&e.jsxs("span",{style:{marginLeft:"16px",color:"#007bff"},children:["(Zb√Ωv√° naƒç√≠st: ",v-H,")"]})]}),e.jsxs("div",{style:R.statsGrid,children:[e.jsxs("div",{style:R.statCard,children:[e.jsx("div",{style:R.statNumber,children:I.total}),e.jsx("div",{style:R.statLabel,children:"V pamƒõti"})]}),e.jsxs("div",{style:R.statCard,children:[e.jsx("div",{style:R.statNumber,children:I.no_embedding}),e.jsx("div",{style:R.statLabel,children:"Bez embeddingu"})]}),e.jsxs("div",{style:R.statCard,children:[e.jsx("div",{style:R.statNumber,children:I.pending}),e.jsx("div",{style:R.statLabel,children:"ƒåek√°"})]}),e.jsxs("div",{style:R.statCard,children:[e.jsx("div",{style:R.statNumber,children:I.completed}),e.jsx("div",{style:R.statLabel,children:"Hotovo"})]}),e.jsxs("div",{style:R.statCard,children:[e.jsx("div",{style:R.statNumber,children:I.error}),e.jsx("div",{style:R.statLabel,children:"Chyby"})]})]})]}),e.jsxs("div",{style:R.controlsSection,children:[e.jsxs("div",{style:R.controlsRow,children:[e.jsx("input",{type:"text",placeholder:"Vyhledat produkty...",value:x,onChange:$=>i($.target.value),style:R.searchInput}),e.jsxs("select",{value:f,onChange:$=>z($.target.value),style:R.statusSelect,children:[e.jsx("option",{value:"all",children:"V≈°echny statusy"}),e.jsx("option",{value:"no_embedding",children:"Bez embeddingu"}),e.jsx("option",{value:"pending",children:"ƒåek√°"}),e.jsx("option",{value:"processing",children:"Zpracov√°v√° se"}),e.jsx("option",{value:"completed",children:"Dokonƒçeno"}),e.jsx("option",{value:"error",children:"Chyba"})]}),e.jsx("button",{style:R.refreshButton,onClick:ge,children:e.jsx(V,{})})]}),e.jsxs("div",{style:R.actionRow,children:[e.jsxs("div",{style:R.selectionInfo,children:["Vybr√°no: ",a.size," z ",ye.length]}),e.jsxs("div",{style:R.actionButtons,children:[e.jsx("button",{style:R.selectAllButton,onClick:j,children:_.length>0&&_.every($=>a.has($.id))?"Zru≈°it v√Ωbƒõr str√°nky":"Vybrat str√°nku"}),e.jsx("button",{style:R.embeddingButton,onClick:G,disabled:a.size===0||g||u,children:g?"Zpracov√°v√° se...":`Spustit Embedding (${a.size})`}),e.jsx("button",{style:R.n8nButton,onClick:C,disabled:a.size===0||g||u,children:u?"Odes√≠l√° se...":`N8N Embedding (${a.size})`})]})]}),e.jsxs("div",{style:R.paginationRow,children:[e.jsxs("div",{style:R.paginationInfo,children:["Zobrazeno: ",je+1," - ",Math.min(_e,ye.length)," z ",ye.length]}),e.jsxs("div",{style:R.paginationControls,children:[e.jsxs("label",{style:R.paginationLabel,children:["Naƒç√≠st po:",e.jsxs("select",{value:w,onChange:$=>q(Number($.target.value)),style:R.paginationSelect,children:[e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"}),e.jsx("option",{value:500,children:"500"}),e.jsx("option",{value:1e3,children:"1000"})]})]}),e.jsxs("div",{style:R.paginationButtons,children:[e.jsx("button",{style:{...R.paginationButton,opacity:O===1?.5:1},onClick:()=>X(1),disabled:O===1,children:"<<"}),e.jsx("button",{style:{...R.paginationButton,opacity:O===1?.5:1},onClick:()=>X($=>Math.max(1,$-1)),disabled:O===1,children:"<"}),e.jsxs("span",{style:R.pageNumber,children:["Str√°nka ",O," z ",ke||1]}),e.jsx("button",{style:{...R.paginationButton,opacity:O===ke?.5:1},onClick:()=>X($=>Math.min(ke,$+1)),disabled:O===ke,children:">"}),e.jsx("button",{style:{...R.paginationButton,opacity:O===ke?.5:1},onClick:()=>X(ke),disabled:O===ke,children:">>"})]})]})]}),H<v&&O===ke&&e.jsxs("div",{style:R.loadMoreRow,children:[e.jsx("button",{style:R.loadMoreButton,onClick:Se,disabled:ie,children:ie?e.jsxs(e.Fragment,{children:["‚è≥ Naƒç√≠t√°m dal≈°√≠ch ",w," polo≈æek..."]}):e.jsxs(e.Fragment,{children:["üì• Naƒç√≠st dal≈°√≠ch ",Math.min(w,v-H)," polo≈æek"]})}),e.jsxs("div",{style:R.loadMoreInfo,children:["Zb√Ωv√° naƒç√≠st: ",e.jsx("strong",{children:v-H})," produkt≈Ø"]})]})]}),g&&e.jsxs("div",{style:R.progressSection,children:[e.jsxs("div",{style:R.progressText,children:["Embedding: ",D.current," / ",D.total," - ",D.productName]}),e.jsx("div",{style:R.progressBar,children:e.jsx("div",{style:{...R.progressFill,width:`${D.current/D.total*100}%`}})})]}),u&&e.jsxs("div",{style:R.progressSection,children:[e.jsxs("div",{style:R.progressText,children:["N8N Webhook Feed 2: ",N.current," / ",N.total," - ",N.productName]}),e.jsx("div",{style:R.progressBar,children:e.jsx("div",{style:{...R.progressFill,backgroundColor:"#28a745",width:`${N.current/N.total*100}%`}})})]}),e.jsx("div",{style:R.tableSection,children:c?e.jsx("div",{style:R.loading,children:"Naƒç√≠t√°m produkty Feed 2..."}):e.jsxs("div",{style:R.tableContainer,children:[e.jsxs("table",{style:R.table,children:[e.jsx("thead",{children:e.jsxs("tr",{style:R.tableHeaderRow,children:[e.jsx("th",{style:R.tableHeaderCell,children:e.jsx("input",{type:"checkbox",checked:_.length>0&&_.every($=>a.has($.id)),onChange:j,style:R.checkbox})}),e.jsx("th",{style:R.tableHeaderCell,children:"K√≥d"}),e.jsx("th",{style:R.tableHeaderCell,children:"N√°zev"}),e.jsx("th",{style:R.tableHeaderCell,children:"Kategorie"}),e.jsx("th",{style:R.tableHeaderCell,children:"Cena"}),e.jsx("th",{style:R.tableHeaderCell,children:"Status"}),e.jsx("th",{style:R.tableHeaderCell,children:"Embedding"})]})}),e.jsx("tbody",{children:_.map($=>e.jsxs("tr",{style:R.tableRow,children:[e.jsx("td",{style:R.tableCell,children:e.jsx("input",{type:"checkbox",checked:a.has($.id),onChange:()=>T($.id),style:R.checkbox})}),e.jsx("td",{style:R.tableCell,children:e.jsx("div",{style:R.productCode,children:$.product_code})}),e.jsxs("td",{style:R.tableCell,children:[e.jsx("div",{style:R.productName,children:$.product_name}),$.description_short&&e.jsxs("div",{style:R.productDescription,children:[$.description_short.substring(0,100),"..."]})]}),e.jsx("td",{style:R.tableCell,children:$.category||"-"}),e.jsx("td",{style:R.tableCell,children:$.price?`${$.price} ${$.currency}`:"-"}),e.jsx("td",{style:R.tableCell,children:pe($.embedding_status,$.has_embedding)}),e.jsx("td",{style:R.tableCell,children:$.embedding_generated_at?new Date($.embedding_generated_at).toLocaleDateString("cs-CZ"):"-"})]},$.id))})]}),_.length===0&&e.jsx("div",{style:R.noResults,children:"≈Ω√°dn√© produkty Feed 2 nenalezeny."})]})})]})})},R={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",justifyContent:"center",alignItems:"flex-start",zIndex:1e3,padding:"20px",overflow:"auto"},modal:{backgroundColor:"white",borderRadius:"12px",width:"95%",maxWidth:"1200px",maxHeight:"90vh",overflow:"hidden",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.3)",display:"flex",flexDirection:"column"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",borderBottom:"1px solid #e0e0e0",backgroundColor:"#f8f9fa"},title:{margin:0,fontSize:"24px",fontWeight:"600",color:"#333"},closeButton:{background:"none",border:"none",cursor:"pointer",padding:"8px",borderRadius:"6px",color:"#666",transition:"all 0.2s"},statsSection:{padding:"16px 24px",borderBottom:"1px solid #e0e0e0"},statsGrid:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:"16px"},statCard:{textAlign:"center",padding:"12px",backgroundColor:"#f8f9fa",borderRadius:"8px"},statNumber:{fontSize:"20px",fontWeight:"bold",color:"#333"},statLabel:{fontSize:"12px",color:"#666",marginTop:"4px"},controlsSection:{padding:"16px 24px",borderBottom:"1px solid #e0e0e0",backgroundColor:"#f8f9fa"},controlsRow:{display:"flex",gap:"12px",alignItems:"center",marginBottom:"12px"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid #ddd",borderRadius:"6px",fontSize:"14px"},statusSelect:{padding:"8px 12px",border:"1px solid #ddd",borderRadius:"6px",fontSize:"14px",minWidth:"180px"},refreshButton:{padding:"8px",border:"1px solid #ddd",borderRadius:"6px",cursor:"pointer",backgroundColor:"white",color:"#666"},actionRow:{display:"flex",justifyContent:"space-between",alignItems:"center"},selectionInfo:{fontSize:"14px",color:"#666"},actionButtons:{display:"flex",gap:"8px"},selectAllButton:{padding:"8px 16px",border:"1px solid #007bff",borderRadius:"6px",cursor:"pointer",backgroundColor:"white",color:"#007bff",fontSize:"14px"},embeddingButton:{padding:"8px 16px",border:"none",borderRadius:"6px",cursor:"pointer",backgroundColor:"#007bff",color:"white",fontSize:"14px"},n8nButton:{padding:"8px 16px",border:"none",borderRadius:"6px",cursor:"pointer",backgroundColor:"#28a745",color:"white",fontSize:"14px",fontWeight:"500"},progressSection:{padding:"16px 24px",backgroundColor:"#f8f9fa",borderBottom:"1px solid #e0e0e0"},progressText:{fontSize:"14px",marginBottom:"8px",color:"#333"},progressBar:{width:"100%",height:"8px",backgroundColor:"#e9ecef",borderRadius:"4px",overflow:"hidden"},progressFill:{height:"100%",backgroundColor:"#007bff",transition:"width 0.3s ease"},tableSection:{flex:1,overflow:"auto"},loading:{textAlign:"center",padding:"40px",color:"#666"},tableContainer:{overflow:"auto",maxHeight:"100%"},table:{width:"100%",borderCollapse:"collapse",fontSize:"14px"},tableHeaderRow:{backgroundColor:"#f8f9fa",borderBottom:"2px solid #dee2e6"},tableHeaderCell:{padding:"12px 8px",textAlign:"left",fontWeight:"bold",color:"#333",borderBottom:"2px solid #dee2e6",position:"sticky",top:0,backgroundColor:"#f8f9fa",zIndex:10},tableRow:{borderBottom:"1px solid #e9ecef",transition:"background-color 0.2s"},tableCell:{padding:"12px 8px",verticalAlign:"top"},checkbox:{cursor:"pointer"},productCode:{fontFamily:"monospace",fontSize:"12px",color:"#666"},productName:{fontWeight:"bold",color:"#333",marginBottom:"4px"},productDescription:{fontSize:"12px",color:"#666",fontStyle:"italic"},statusBadge:{padding:"4px 8px",borderRadius:"4px",fontSize:"12px",fontWeight:"bold"},noResults:{textAlign:"center",padding:"40px",color:"#666",fontStyle:"italic"},paginationRow:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"16px",paddingTop:"16px",borderTop:"1px solid #e0e0e0"},paginationInfo:{fontSize:"14px",color:"#666",fontWeight:"500"},paginationControls:{display:"flex",alignItems:"center",gap:"16px"},paginationLabel:{display:"flex",alignItems:"center",gap:"8px",fontSize:"14px",color:"#666"},paginationSelect:{padding:"6px 10px",border:"1px solid #ddd",borderRadius:"6px",fontSize:"14px",cursor:"pointer",backgroundColor:"white"},paginationButtons:{display:"flex",alignItems:"center",gap:"8px"},paginationButton:{padding:"6px 12px",border:"1px solid #ddd",borderRadius:"6px",cursor:"pointer",backgroundColor:"white",color:"#333",fontSize:"14px",fontWeight:"500",transition:"all 0.2s"},pageNumber:{fontSize:"14px",color:"#333",fontWeight:"500",padding:"0 8px"},loadInfoBanner:{backgroundColor:"#e7f3ff",padding:"12px 16px",borderRadius:"8px",marginBottom:"16px",fontSize:"14px",color:"#333",border:"1px solid #b3d9ff"},loadMoreRow:{display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",marginTop:"16px",paddingTop:"16px",borderTop:"1px solid #e0e0e0"},loadMoreButton:{padding:"12px 24px",border:"none",borderRadius:"8px",cursor:"pointer",backgroundColor:"#007bff",color:"white",fontSize:"14px",fontWeight:"600",transition:"all 0.2s",boxShadow:"0 2px 4px rgba(0, 123, 255, 0.2)"},loadMoreInfo:{fontSize:"13px",color:"#666"}},Jo="https://n8n.srv980546.hstgr.cloud/webhook/cd6b668b-1e35-4018-9bf4-28d0926b023b";async function Xo(t,o){try{const n=await fetch(Jo,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chatInput:t,session_id:o,timestamp:new Date().toISOString()})});if(!n.ok){const c=await n.text();throw console.error("‚ùå N8N webhook error:",n.status,c),new Error(`N8N webhook failed: ${n.status} ${n.statusText}`)}let a=await n.json(),s=null;if(Array.isArray(a)&&a.length>0&&a[0].data)s=a[0].data;else if(a.data&&Array.isArray(a.data))s=a.data;else if(a.text&&Array.isArray(a.products))return a;if(s&&Array.isArray(s)){const c=s.map(l=>({product_code:l["ID produktu"]||l.product_code,recommendation:l.Doporuceni||l.recommendation}));a={text:`Na≈°el jsem pro v√°s ${c.length} doporuƒçen√Ωch produkt≈Ø:`,products:c}}if(!a.text||!Array.isArray(a.products))throw console.error("‚ùå Invalid N8N response format po konverzi:",JSON.stringify(a,null,2)),new Error("Invalid response format from N8N webhook - nelze konvertovat na standardn√≠ form√°t");return a}catch(n){throw console.error("‚ùå Chyba p≈ôi vol√°n√≠ N8N webhooku:",n),n}}async function Qo(t){try{if(t.length===0)return[];const o=t.map(c=>c.product_code),{data:n,error:a}=await F.from("product_feed_2").select("product_code, product_name, description_short, url, thumbnail, price, currency, availability").in("product_code",o);if(a)throw console.error("‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ metadat z product_feed_2:",a),a;return!n||n.length===0?(console.warn("‚ö†Ô∏è ≈Ω√°dn√° metadata nenalezena pro produkty:",o),t.map(c=>({product_code:c.product_code,product_name:"Produkt "+c.product_code,recommendation:c.recommendation,description:"",url:"",image_url:"",price:0,currency:"CZK",availability:0}))):t.map(c=>{const l=n.find(g=>g.product_code===c.product_code);return{product_code:c.product_code,product_name:(l==null?void 0:l.product_name)||"Produkt "+c.product_code,recommendation:c.recommendation,description:(l==null?void 0:l.description_short)||"",url:(l==null?void 0:l.url)||"",image_url:(l==null?void 0:l.thumbnail)||"",price:(l==null?void 0:l.price)||0,currency:(l==null?void 0:l.currency)||"CZK",availability:(l==null?void 0:l.availability)||0}})}catch(o){throw console.error("‚ùå Chyba p≈ôi obohacov√°n√≠ produkt≈Ø:",o),o}}async function en(t,o){try{const n=await Xo(t,o),a=await Qo(n.products);return{text:n.text,products:a}}catch(n){return console.error("‚ùå Kritick√° chyba p≈ôi z√≠sk√°v√°n√≠ produktov√Ωch doporuƒçen√≠:",n),{text:"‚ùå Omlouv√°me se, do≈°lo k chybƒõ p≈ôi zpracov√°n√≠ va≈°eho dotazu. Zkuste to pros√≠m znovu.",products:[]}}}const tn=()=>"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx".replace(/[x]/g,()=>(Math.random()*16|0).toString(16)),on=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("line",{x1:"22",y1:"2",x2:"11",y2:"13"}),e.jsx("polygon",{points:"22 2 15 22 11 13 2 9 22 2"})]}),nn=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),Rt=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("path",{d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"}),e.jsx("path",{d:"M12 2C6.477 2 2 6.477 2 12h10c5.523 0 10-4.477 10-10C17.523 2 12 2 12 2z"})]}),rn=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("path",{d:"M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"}),e.jsx("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),e.jsx("path",{d:"M16 10a4 4 0 0 1-8 0"})]}),an=({onClose:t})=>{const[o,n]=h.useState([]),[a,s]=h.useState(""),[c,l]=h.useState(!1),[g]=h.useState(()=>tn()),m=h.useRef(null),u=h.useRef(null);h.useEffect(()=>{var i;(i=u.current)==null||i.focus()},[]);const y=h.useCallback(async()=>{if(!a.trim()||c)return;const i=a.trim();s("");const f={id:Date.now().toString(),role:"user",text:i};n(z=>[...z,f]),l(!0);try{const{text:z,products:D}=await en(i,g),Z={id:(Date.now()+1).toString(),role:"bot",text:z,products:D.length>0?D:void 0};n(N=>[...N,Z])}catch(z){console.error("‚ùå Chyba v Product Chat:",z);const D={id:(Date.now()+1).toString(),role:"bot",text:"‚ùå Omlouv√°me se, do≈°lo k chybƒõ p≈ôi zpracov√°n√≠ va≈°eho dotazu. Zkuste to pros√≠m znovu."};n(Z=>[...Z,D])}finally{l(!1)}},[a,c,g]),x=i=>{i.key==="Enter"&&!i.shiftKey&&(i.preventDefault(),y())};return e.jsxs("div",{className:"flex flex-col h-full bg-bewit-gray",children:[e.jsx(Mt,{onClose:t,buttons:[]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[o.length===0&&e.jsxs("div",{className:"text-center text-slate-500 flex flex-col items-center justify-center min-h-96",children:[e.jsx(rn,{className:"h-16 w-16 text-bewit-blue opacity-20 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-bewit-blue mb-2",children:"V√≠tejte v Product Chat!"}),e.jsx("p",{children:"Zeptejte se na produkty BEWIT a dostanete personalizovan√° doporuƒçen√≠."}),e.jsx("p",{className:"text-sm mt-2",children:'Nap≈ô√≠klad: "Wany na bolest nohy" nebo "Produkty pro lep≈°√≠ sp√°nek"'})]}),o.map(i=>e.jsxs("div",{className:`flex items-start gap-3 ${i.role==="user"?"justify-end":"justify-start"}`,children:[i.role==="bot"&&e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-bewit-blue flex items-center justify-center text-white",children:e.jsx(Rt,{className:"w-5 h-5"})}),e.jsxs("div",{className:`flex flex-col ${i.role==="user"?"items-end":"items-start"} max-w-3xl`,children:[e.jsx("div",{className:`px-4 py-3 rounded-2xl ${i.role==="user"?"bg-bewit-blue text-white rounded-br-none":"bg-white text-bewit-dark border border-slate-200 rounded-bl-none shadow-sm"}`,children:e.jsx("div",{className:"whitespace-pre-wrap",children:i.text})}),i.products&&i.products.length>0&&e.jsx("div",{className:"mt-4 w-full",children:e.jsx($o,{products:i.products.slice(0,6).map(f=>({id:f.product_code,title:f.product_name,product_code:f.product_code,product_name:f.product_name,description:f.recommendation,product_url:f.url,image_url:f.image_url,price:f.price,currency:f.currency})),title:"Doporuƒçen√© produkty",showSimilarity:!1})})]}),i.role==="user"&&e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-slate-300 flex items-center justify-center text-slate-600",children:e.jsx(nn,{className:"w-5 h-5"})})]},i.id)),c&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-bewit-blue flex items-center justify-center text-white",children:e.jsx(Rt,{className:"w-5 h-5"})}),e.jsx("div",{className:"px-4 py-3 rounded-2xl bg-white border border-slate-200 rounded-bl-none shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(No,{}),e.jsx(Do,{changeInterval:7e3})]})})]}),e.jsx("div",{ref:m})]}),e.jsx("div",{className:"border-t border-slate-200 p-4 bg-white",children:e.jsxs("div",{className:"flex items-center bg-white border border-slate-300 rounded-xl shadow-sm focus-within:ring-2 focus-within:ring-bewit-blue transition-shadow duration-200 p-3",children:[e.jsx("textarea",{ref:u,value:a,onChange:i=>s(i.target.value),onKeyPress:x,placeholder:"Zeptejte se na produkty BEWIT...",className:"w-full flex-1 px-2 py-2 bg-transparent resize-none focus:outline-none text-bewit-dark placeholder-slate-400 leading-5",rows:1,style:{maxHeight:"120px",minHeight:"40px"},disabled:c}),e.jsx("button",{type:"button",onClick:y,disabled:c||!a.trim(),className:"ml-3 flex-shrink-0 w-10 h-10 rounded-lg bg-bewit-blue text-white flex items-center justify-center transition-colors duration-200 disabled:bg-slate-300 disabled:cursor-not-allowed hover:bg-blue-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-bewit-blue","aria-label":"Odeslat zpr√°vu",children:c?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(on,{className:"w-5 h-5"})})]})})]})},Et=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10z"}),e.jsx("circle",{cx:"9",cy:"10",r:"1"}),e.jsx("circle",{cx:"15",cy:"10",r:"1"})]}),gt=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M20 7h-9"}),e.jsx("path",{d:"M14 17H5"}),e.jsx("circle",{cx:"17",cy:"17",r:"3"}),e.jsx("circle",{cx:"7",cy:"7",r:"3"})]}),sn=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"3"}),e.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]}),ln=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),cn=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20"}),e.jsx("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"})]}),At=()=>e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})}),dn=()=>e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})}),un=({onClose:t,onOpenChat:o})=>{const[n,a]=h.useState("chatbots"),[s,c]=h.useState([]),[l,g]=h.useState([]),[m,u]=h.useState([]),[y,x]=h.useState(!0),[i,f]=h.useState(null),[z,D]=h.useState(null),[Z,N]=h.useState(new Set),[W,w]=h.useState({}),[q,O]=h.useState([{id:"sana_medbase",name:"Sana MedBase",description:"AI asistent pro spr√°vu a vyhled√°v√°n√≠ v knihovnƒõ l√©ka≈ôsk√© literatury",url:"https://bewit.love/sana-chat",features:{product_recommendations:!1,product_button_recommendations:!1,book_database:!0}},{id:"sana_kancelar",name:"Sana Kancel√°≈ô",description:"AI asistent pro intern√≠ firemn√≠ dokumenty a procesy",url:"https://bewit.love/sana-kancelar",features:{product_recommendations:!1,product_button_recommendations:!1,book_database:!1}}]),[X,H]=h.useState(!1),[te,v]=h.useState(!1),[ne,ie]=h.useState(!1);h.useEffect(()=>{(async()=>{try{x(!0),f(null),console.log("üîÑ Naƒç√≠t√°m data chatbot≈Ø z datab√°ze..."),console.log("üìã Tabulka chatbot_settings existuje v datab√°zi");const[I,j,T]=await Promise.all([Re.getAllChatbotSettings(),Re.getCategories(),Re.getPublicationTypes()]);if(console.log("üìä Naƒçten√° data:",{settings:I.length,categories:j.length,publicationTypes:T.length}),I.length===0){f("V datab√°zi nejsou ≈æ√°dn√© chatboti. Spus≈•te SQL script create_chatbot_settings_table.sql pro vytvo≈ôen√≠ v√Ωchoz√≠ch chatbot≈Ø.");return}console.log("ü§ñ Existuj√≠c√≠ chatboti v datab√°zi:"),I.forEach(C=>{console.log(`- ID: "${C.chatbot_id}", N√°zev: "${C.chatbot_name}"`),console.log(`  üéØ enable_product_router: ${C.enable_product_router}, enable_manual_funnel: ${C.enable_manual_funnel}`)}),c(I),g(j),u(T)}catch(I){console.error("‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ dat chatbot≈Ø:",I),f(`Nepoda≈ôilo se naƒç√≠st data chatbot≈Ø z datab√°ze: ${I instanceof Error?I.message:"Nezn√°m√° chyba"}`)}finally{x(!1)}})()},[]);const ae=(_,I)=>{c(j=>j.map(T=>T.chatbot_id===_?{...T,...I}:T)),N(j=>new Set(j).add(_)),w(j=>({...j,[_]:{...j[_],...I}}))},ge=(_,I)=>{const j=s.find(C=>C.chatbot_id===_);if(!j)return;const T=j.allowed_categories.includes(I)?j.allowed_categories.filter(C=>C!==I):[...j.allowed_categories,I];ae(_,{allowed_categories:T})},Se=(_,I)=>{const j=s.find(C=>C.chatbot_id===_);if(!j)return;const T=j.allowed_publication_types.includes(I)?j.allowed_publication_types.filter(C=>C!==I):[...j.allowed_publication_types,I];ae(_,{allowed_publication_types:T})},ye=(_,I)=>{const j=s.find(G=>G.chatbot_id===_);if(!j)return;const T=!j[I];let C={[I]:T};I==="book_database"&&!T&&(console.log("üìö Vyp√≠n√°m datab√°zi knih - resetuji tak√© v≈°echny filtrace"),C={...C,allowed_categories:[],allowed_publication_types:[]}),I==="is_default_web_chatbot"&&T&&(console.log("üåê Nastavuji jako v√Ωchoz√≠ webov√Ω chatbot - ru≈°√≠m oznaƒçen√≠ u ostatn√≠ch"),s.forEach(G=>{G.chatbot_id!==_&&G.is_default_web_chatbot&&ae(G.chatbot_id,{is_default_web_chatbot:!1})})),ae(_,C)},ke=async _=>{const I=W[_];if(I)try{D(_),f(null),console.log(`üíæ Ukl√°d√°m nastaven√≠ pro chatbota ${_}:`,I);const j=await Re.updateChatbotSettings(_,I);c(T=>T.map(C=>C.chatbot_id===_?j:C)),N(T=>{const C=new Set(T);return C.delete(_),C}),w(T=>{const C={...T};return delete C[_],C}),console.log("‚úÖ Nastaven√≠ √∫spƒõ≈°nƒõ ulo≈æeno"),alert("‚úÖ Nastaven√≠ chatbota bylo √∫spƒõ≈°nƒõ ulo≈æeno!")}catch(j){console.error("‚ùå Chyba p≈ôi ukl√°d√°n√≠ nastaven√≠:",j);const T=j instanceof Error?j.message:"Nepoda≈ôilo se ulo≈æit nastaven√≠ chatbota";f(`Chyba p≈ôi ukl√°d√°n√≠ nastaven√≠ chatbota "${_}": ${T}`),alert(`‚ùå ${T}`)}finally{D(null)}},je=async _=>{try{const I=await Re.getChatbotSettings(_);if(!I)return;c(j=>j.map(T=>T.chatbot_id===_?I:T)),N(j=>{const T=new Set(j);return T.delete(_),T}),w(j=>{const T={...j};return delete T[_],T}),console.log("üîÑ Nastaven√≠ resetov√°no na p≈Øvodn√≠ hodnoty")}catch(I){console.error("‚ùå Chyba p≈ôi resetov√°n√≠ nastaven√≠:",I),f("Nepoda≈ôilo se resetovat nastaven√≠ chatbota")}},_e=_=>{console.log(`üöÄ Spou≈°t√≠m chat "${_.name}" s nastaven√≠m:`,_.features);const I=[];_.features.product_recommendations&&I.push("Produktov√° doporuƒçen√≠"),_.features.product_button_recommendations&&I.push("Produktov√© doporuƒçen√≠ na tlaƒç√≠tko"),_.features.book_database&&I.push("Datab√°ze knih");const j=I.length>0?I.join(" + "):"≈Ω√°dn√© funkce nejsou povoleny";console.log(`üí¨ Otev√≠r√°m chat s nastaven√≠m: ${j}`),t(),o?o(_.id,_.features):alert(`ü§ñ ${_.name}

‚úÖ Aktivn√≠ funkce: ${j}

‚ö†Ô∏è Pozn√°mka: Nastaven√≠ se zat√≠m neukl√°daj√≠ a po obnoven√≠ str√°nky se resetuj√≠.`)};return e.jsx("div",{style:S.overlay,children:e.jsxs("div",{style:S.modal,children:[e.jsxs("div",{style:S.header,children:[e.jsx("h2",{style:S.title,children:"ü§ñ Spr√°va chatbot≈Ø"}),e.jsx("button",{style:S.closeButton,onClick:t,children:e.jsx(ln,{})})]}),e.jsxs("div",{style:S.tabs,children:[e.jsxs("button",{style:{...S.tabButton,...n==="chatbots"&&S.tabButtonActive},onClick:()=>a("chatbots"),children:[e.jsx(Et,{}),"Chatboty"]}),e.jsxs("button",{style:{...S.tabButton,...n==="product_feed"&&S.tabButtonActive},onClick:()=>a("product_feed"),children:[e.jsx(gt,{}),"Produktov√Ω feed"]}),e.jsxs("button",{style:{...S.tabButton,...n==="settings"&&S.tabButtonActive},onClick:()=>a("settings"),children:[e.jsx(sn,{}),"Nastaven√≠"]})]}),e.jsxs("div",{style:S.content,children:[n==="chatbots"&&e.jsxs("div",{style:S.tabContent,children:[e.jsx("h3",{style:S.sectionTitle,children:"Konfigurace chatbot≈Ø"}),e.jsx("p",{style:S.sectionDescription,children:"Nastavte funkce a filtrace pro jednotliv√© chatboty. V≈°echna nastaven√≠ se automaticky ukl√°daj√≠ do datab√°ze."}),i&&e.jsxs("div",{style:S.errorMessage,children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"8px"},children:"‚ùå Chyba"}),e.jsx("div",{style:{marginBottom:"8px"},children:i}),i.includes("nebyl nalezen v datab√°zi")&&e.jsxs("div",{style:S.errorHint,children:[e.jsx("strong",{children:"üí° ≈òe≈°en√≠:"}),e.jsxs("ol",{style:{margin:"8px 0",paddingLeft:"20px"},children:[e.jsx("li",{children:"Otev≈ôete Supabase SQL Editor"}),e.jsxs("li",{children:["Spus≈•te script ",e.jsx("code",{children:"fix_chatbot_settings.sql"})]}),e.jsx("li",{children:"Obnovte tuto str√°nku"})]})]})]}),y?e.jsx("div",{style:S.loadingMessage,children:"üîÑ Naƒç√≠t√°m nastaven√≠ chatbot≈Ø..."}):e.jsxs("div",{style:S.chatbotGrid,children:[s.map(_=>e.jsxs("div",{style:S.chatbotCard,children:[e.jsxs("div",{style:S.chatbotHeader,children:[e.jsxs("div",{style:S.chatbotIconName,children:[e.jsx(Et,{}),e.jsx("h3",{style:S.chatbotName,children:_.chatbot_name}),z===_.chatbot_id&&e.jsx("span",{style:S.savingIndicator,children:"üíæ Ukl√°d√°m..."}),Z.has(_.chatbot_id)&&e.jsx("span",{style:S.unsavedIndicator,children:"‚óè Neulo≈æen√© zmƒõny"})]}),e.jsx("div",{style:{...S.statusBadge,backgroundColor:_.is_active?"#28a745":"#dc3545"},children:_.is_active?"Aktivn√≠":"Neaktivn√≠"})]}),e.jsx("p",{style:S.chatbotDescription,children:_.description||"Bez popisu"}),e.jsxs("div",{style:S.chatbotId,children:["ID: ",_.chatbot_id]}),e.jsxs("div",{style:S.chatbotSettings,children:[e.jsx("h4",{style:S.sectionSubtitle,children:"‚ö° Viditelnost na webu"}),e.jsxs("div",{style:S.settingRow,children:[e.jsxs("label",{style:S.settingLabel,children:[e.jsx("input",{type:"checkbox",checked:_.is_active||!1,onChange:()=>ae(_.chatbot_id,{is_active:!_.is_active}),style:S.checkbox}),e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M12 6v6l4 2"})]}),"Chatbot je aktivn√≠"]}),e.jsx("div",{style:S.settingDescription,children:_.is_active?"‚úÖ Chatbot se zobraz√≠ v selectoru na webu MedBase a u≈æivatel√© si ho mohou vybrat":"‚ùå Chatbot je skryt√Ω a nebude dostupn√Ω pro v√Ωbƒõr na webu"})]})]}),e.jsxs("div",{style:S.chatbotSettings,children:[e.jsx("h4",{style:S.sectionSubtitle,children:"üîß Z√°kladn√≠ funkce"}),e.jsxs("div",{style:S.settingRow,children:[e.jsxs("label",{style:S.settingLabel,children:[e.jsx("input",{type:"checkbox",checked:_.product_recommendations||!1,onChange:()=>ye(_.chatbot_id,"product_recommendations"),style:S.checkbox}),e.jsx(gt,{}),"Produktov√° doporuƒçen√≠"]}),e.jsx("div",{style:S.settingDescription,children:"Zobrazovat relevantn√≠ produkty na z√°kladƒõ u≈æivatelsk√Ωch dotaz≈Ø"})]}),e.jsxs("div",{style:S.settingRow,children:[e.jsxs("label",{style:S.settingLabel,children:[e.jsx("input",{type:"checkbox",checked:_.product_button_recommendations||!1,onChange:()=>ye(_.chatbot_id,"product_button_recommendations"),style:S.checkbox}),e.jsx(gt,{}),"Produktov√© doporuƒçen√≠ na tlaƒç√≠tko"]}),e.jsx("div",{style:S.settingDescription,children:'Zobrazit tlaƒç√≠tko "Doporuƒçit produkty" na konci odpovƒõdi chatbota'})]}),e.jsxs("div",{style:S.settingRow,children:[e.jsxs("label",{style:S.settingLabel,children:[e.jsx("input",{type:"checkbox",checked:_.inline_product_links||!1,onChange:()=>ye(_.chatbot_id,"inline_product_links"),style:S.checkbox}),e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}),e.jsx("path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"})]}),"Inline produktov√© linky"]}),e.jsx("div",{style:S.settingDescription,children:"Zobrazovat produktov√© linky p≈ô√≠mo v textu odpovƒõdi chatbota (ChatGPT styl)"})]}),e.jsxs("div",{style:S.settingRow,children:[e.jsxs("label",{style:S.settingLabel,children:[e.jsx("input",{type:"checkbox",checked:_.book_database||!1,onChange:()=>ye(_.chatbot_id,"book_database"),style:S.checkbox}),e.jsx(cn,{}),"Datab√°ze knih"]}),e.jsx("div",{style:S.settingDescription,children:"Vyhled√°vat v datab√°zi l√©ka≈ôsk√© literatury a dokument≈Ø"})]}),e.jsxs("div",{style:S.settingRow,children:[e.jsxs("label",{style:S.settingLabel,children:[e.jsx("input",{type:"checkbox",checked:_.is_default_web_chatbot||!1,onChange:()=>ye(_.chatbot_id,"is_default_web_chatbot"),style:S.checkbox}),e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"2",y1:"12",x2:"22",y2:"12"}),e.jsx("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"})]}),"Zobrazit v bublinƒõ na webu"]}),e.jsx("div",{style:S.settingDescription,children:"Tento chatbot se zobraz√≠ v plovouc√≠ bublinƒõ na medbase.cz (pouze jeden m≈Ø≈æe b√Ωt vybr√°n)"})]})]}),e.jsxs("div",{style:S.chatbotSettings,children:[e.jsx("h4",{style:S.sectionSubtitle,children:"üéØ Produktov√Ω funnel"}),e.jsxs("div",{style:S.settingRow,children:[e.jsxs("label",{style:S.settingLabel,children:[e.jsx("input",{type:"checkbox",checked:_.enable_product_router!==!1,onChange:()=>ae(_.chatbot_id,{enable_product_router:_.enable_product_router===!1}),style:S.checkbox}),e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),"Aktivovat produktov√Ω router"]}),e.jsx("div",{style:S.settingDescription,children:"Automatick√© smƒõrov√°n√≠ dotaz≈Ø do produktov√©ho funnelu na z√°kladƒõ symptom≈Ø. Kdy≈æ je vypnuto, v≈°e jde jako standardn√≠ chat."})]}),e.jsxs("div",{style:S.settingRow,children:[e.jsxs("label",{style:S.settingLabel,children:[e.jsx("input",{type:"checkbox",checked:_.enable_manual_funnel===!0,onChange:()=>ae(_.chatbot_id,{enable_manual_funnel:_.enable_manual_funnel!==!0}),style:S.checkbox}),e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"16"}),e.jsx("line",{x1:"8",y1:"12",x2:"16",y2:"12"})]}),"Manu√°ln√≠ funnel spou≈°tƒõƒç"]}),e.jsx("div",{style:S.settingDescription,children:"M√≠sto ≈ælut√©ho calloutu zobraz√≠ tlaƒç√≠tko pro manu√°ln√≠ zad√°n√≠ symptom≈Ø. U≈æivatel s√°m rozhodne, kdy chce doporuƒçit produkty."})]})]}),e.jsxs("div",{style:S.filterSection,children:[e.jsxs("h4",{style:S.sectionSubtitle,children:[e.jsx(At,{}),"Povolen√© kategorie (",_.allowed_categories.length,"/",l.length,")",!_.book_database&&e.jsx("span",{style:S.disabledLabel,children:" (pouze s datab√°z√≠ knih)"})]}),_.book_database?e.jsx("div",{style:S.filterGrid,children:l.map(I=>e.jsxs("label",{style:S.filterItem,children:[e.jsx("input",{type:"checkbox",checked:_.allowed_categories.includes(I.id),onChange:()=>ge(_.chatbot_id,I.id),style:S.checkbox}),e.jsx("span",{style:S.filterLabel,children:I.name})]},I.id))}):e.jsx("div",{style:S.disabledSection,children:e.jsx("p",{style:S.disabledText,children:"üìö Filtrace kategori√≠ je dostupn√° pouze kdy≈æ je povolena datab√°ze knih."})})]}),e.jsxs("div",{style:S.filterSection,children:[e.jsxs("h4",{style:S.sectionSubtitle,children:[e.jsx(At,{}),"Povolen√© typy publikac√≠ (",_.allowed_publication_types.length,"/",m.length,")",!_.book_database&&e.jsx("span",{style:S.disabledLabel,children:" (pouze s datab√°z√≠ knih)"})]}),_.book_database?e.jsx("div",{style:S.filterGrid,children:m.map(I=>e.jsxs("label",{style:S.filterItemLarge,children:[e.jsx("input",{type:"checkbox",checked:_.allowed_publication_types.includes(I.id),onChange:()=>Se(_.chatbot_id,I.id),style:S.checkbox}),e.jsxs("div",{children:[e.jsx("div",{style:S.filterLabel,children:I.name}),I.description&&e.jsx("div",{style:S.filterDescription,children:I.description})]})]},I.id))}):e.jsx("div",{style:S.disabledSection,children:e.jsx("p",{style:S.disabledText,children:"üìÑ Filtrace typ≈Ø publikac√≠ je dostupn√° pouze kdy≈æ je povolena datab√°ze knih."})})]}),Z.has(_.chatbot_id)&&e.jsxs("div",{style:S.settingsActions,children:[e.jsxs("button",{style:S.saveButton,onClick:()=>ke(_.chatbot_id),disabled:z===_.chatbot_id,children:[e.jsx(dn,{}),z===_.chatbot_id?"Ukl√°d√°m...":"Ulo≈æit nastaven√≠"]}),e.jsx("button",{style:S.resetButton,onClick:()=>je(_.chatbot_id),disabled:z===_.chatbot_id,children:"Zru≈°it zmƒõny"})]}),e.jsx("div",{style:S.testChatSection,children:_.chatbot_id==="product_chat"?e.jsxs(e.Fragment,{children:[e.jsx("button",{style:{...S.testChatButton,backgroundColor:"#28a745",borderColor:"#28a745"},onClick:()=>ie(!0),children:"üí¨ Otev≈ô√≠t Product Chat"}),e.jsx("div",{style:S.testChatDescription,children:"Produktov√Ω chat s personalizovan√Ωmi doporuƒçen√≠mi p≈ôes N8N webhook"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{style:S.testChatButton,onClick:()=>_e({id:_.chatbot_id,name:_.chatbot_name,description:_.description||"",features:{product_recommendations:_.product_recommendations,product_button_recommendations:_.product_button_recommendations,inline_product_links:_.inline_product_links,book_database:_.book_database,use_feed_1:_.use_feed_1,use_feed_2:_.use_feed_2,webhook_url:_.webhook_url,enable_product_router:_.enable_product_router,enable_manual_funnel:_.enable_manual_funnel}}),children:"üí¨ Spustit chat s nastaven√≠m"}),e.jsxs("div",{style:S.testChatDescription,children:["Chat bude pou≈æ√≠vat pouze za≈°krtnut√© kategorie a typy publikac√≠",Z.has(_.chatbot_id)&&e.jsx("span",{style:{color:"#dc3545"},children:" (‚ö†Ô∏è Neulo≈æen√© zmƒõny se neprojev√≠)"})]})]})})]},_.id)),s.length===0&&e.jsxs("div",{style:S.emptyChatbots,children:[e.jsx("h4",{children:"≈Ω√°dn√© chatboty nenalezeny"}),e.jsx("p",{children:"Spus≈•te SQL script create_chatbot_settings_table.sql pro vytvo≈ôen√≠ v√Ωchoz√≠ch chatbot≈Ø."})]})]})]}),n==="product_feed"&&e.jsxs("div",{style:S.tabContent,children:[e.jsx("h3",{style:S.sectionTitle,children:"Produktov√Ω feed a embeddingy"}),e.jsx("p",{style:S.sectionDescription,children:"Glob√°ln√≠ spr√°va produktov√©ho feedu a AI embedding≈Ø pro v≈°echny chatboty"}),e.jsxs("div",{style:S.productActions,children:[e.jsxs("div",{style:S.actionCard,children:[e.jsx("h4",{children:"Synchronizace feedu"}),e.jsx("p",{children:"Automatick√° aktualizace produktov√Ωch dat z extern√≠ XML feed"}),e.jsx(Wt,{})]}),e.jsxs("div",{style:S.actionCard,children:[e.jsx("h4",{children:"AI Embeddingy"}),e.jsx("p",{children:"Vygenerujte embeddingy pro vylep≈°en√° produktov√° doporuƒçen√≠"}),e.jsx("button",{style:S.primaryButton,onClick:()=>H(!0),children:"üìã Spravovat Embeddingy"})]}),e.jsxs("div",{style:S.actionCard,children:[e.jsx("h4",{children:"AI Embeddingy Pro Feed 2"}),e.jsx("p",{children:"Vygenerujte embeddingy pro vylep≈°en√° produktov√° doporuƒçen√≠ z Feed 2"}),e.jsx("button",{style:S.primaryButton,onClick:()=>v(!0),children:"üìã Spravovat Embeddingy Pro Feed 2"})]})]})]}),n==="settings"&&e.jsxs("div",{style:S.tabContent,children:[e.jsx("h3",{style:S.sectionTitle,children:"Obecn√© nastaven√≠"}),e.jsx("p",{style:S.sectionDescription,children:"Budouc√≠ glob√°ln√≠ nastaven√≠ aplikace"}),e.jsxs("div",{style:S.settingsGrid,children:[e.jsxs("div",{style:S.settingCard,children:[e.jsx("h4",{children:"üîí Bezpeƒçnost"}),e.jsx("p",{children:"Spr√°va API kl√≠ƒç≈Ø a autentifikace"}),e.jsx("button",{style:S.secondaryButton,children:"P≈ôipravuje se..."})]}),e.jsxs("div",{style:S.settingCard,children:[e.jsx("h4",{children:"üìä Analytika"}),e.jsx("p",{children:"Sledov√°n√≠ vyu≈æit√≠ a v√Ωkonu chatbot≈Ø"}),e.jsx("button",{style:S.secondaryButton,children:"P≈ôipravuje se..."})]}),e.jsxs("div",{style:S.settingCard,children:[e.jsx("h4",{children:"üîî Notifikace"}),e.jsx("p",{children:"Upozornƒõn√≠ na aktualizace a chyby"}),e.jsx("button",{style:S.secondaryButton,children:"P≈ôipravuje se..."})]})]})]})]}),X&&e.jsx(Yo,{onClose:()=>H(!1)}),te&&e.jsx(qo,{onClose:()=>v(!1)}),ne&&e.jsx("div",{style:S.overlay,children:e.jsx("div",{style:{...S.container,width:"95vw",height:"90vh",maxWidth:"1400px",padding:0,display:"flex",flexDirection:"column"},children:e.jsx(an,{onClose:()=>ie(!1)})})})]})})},S={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3,padding:"20px"},modal:{backgroundColor:"white",borderRadius:"12px",width:"95%",maxWidth:"1200px",maxHeight:"90vh",overflow:"hidden",display:"flex",flexDirection:"column",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.3)"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",borderBottom:"1px solid #e0e0e0",backgroundColor:"#f8f9fa"},title:{margin:0,fontSize:"24px",fontWeight:"600",color:"#333"},closeButton:{background:"none",border:"none",cursor:"pointer",padding:"8px",borderRadius:"4px",color:"#666",transition:"all 0.2s"},tabs:{display:"flex",borderBottom:"1px solid #e0e0e0",backgroundColor:"#f8f9fa"},tabButton:{backgroundColor:"transparent",border:"none",padding:"16px 24px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",fontSize:"14px",fontWeight:"500",color:"#666",borderBottom:"3px solid transparent",transition:"all 0.2s"},tabButtonActive:{color:"#007bff",borderBottom:"3px solid #007bff",backgroundColor:"white"},content:{flex:1,overflow:"auto",padding:"24px"},tabContent:{maxWidth:"100%"},sectionTitle:{fontSize:"20px",fontWeight:"600",color:"#333",marginBottom:"8px"},sectionDescription:{fontSize:"14px",color:"#666",marginBottom:"24px",lineHeight:"1.5"},chatbotGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(400px, 1fr))",gap:"20px"},chatbotCard:{border:"1px solid #e0e0e0",borderRadius:"12px",padding:"20px",backgroundColor:"#f8f9fa"},chatbotHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},chatbotIconName:{display:"flex",alignItems:"center",gap:"8px"},chatbotName:{margin:0,fontSize:"18px",fontWeight:"600",color:"#333"},chatbotDescription:{fontSize:"14px",color:"#666",lineHeight:"1.4",marginBottom:"8px"},chatbotSettings:{display:"flex",flexDirection:"column",gap:"12px",paddingTop:"16px",borderTop:"1px solid #e0e0e0"},settingRow:{display:"flex",flexDirection:"column",gap:"4px"},settingLabel:{display:"flex",alignItems:"center",gap:"8px",fontSize:"14px",fontWeight:"500",color:"#333",cursor:"pointer"},settingDescription:{fontSize:"12px",color:"#666",paddingLeft:"24px"},checkbox:{cursor:"pointer"},productActions:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"20px"},actionCard:{border:"1px solid #e0e0e0",borderRadius:"12px",padding:"20px",backgroundColor:"#f8f9fa"},primaryButton:{backgroundColor:"#007bff",color:"white",border:"none",padding:"12px 16px",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"500",marginTop:"12px",transition:"all 0.2s"},secondaryButton:{backgroundColor:"#6c757d",color:"white",border:"none",padding:"8px 12px",borderRadius:"6px",cursor:"pointer",fontSize:"12px",marginTop:"8px",transition:"all 0.2s"},settingsGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"16px"},settingCard:{border:"1px solid #e0e0e0",borderRadius:"8px",padding:"16px",backgroundColor:"#f8f9fa",textAlign:"center"},testChatSection:{marginTop:"16px",paddingTop:"16px",borderTop:"1px solid #e0e0e0",textAlign:"center"},testChatButton:{backgroundColor:"#28a745",color:"white",border:"none",padding:"12px 20px",borderRadius:"8px",cursor:"pointer",fontSize:"14px",fontWeight:"600",transition:"all 0.2s",display:"flex",alignItems:"center",gap:"8px",margin:"0 auto",boxShadow:"0 2px 4px rgba(40, 167, 69, 0.2)"},testChatDescription:{fontSize:"12px",color:"#666",marginTop:"8px",fontStyle:"italic"},errorMessage:{backgroundColor:"#f8d7da",color:"#721c24",padding:"12px 16px",borderRadius:"8px",marginBottom:"16px",border:"1px solid #f5c6cb",fontSize:"14px",lineHeight:"1.5"},errorHint:{backgroundColor:"#fff3cd",color:"#856404",padding:"12px",borderRadius:"6px",marginTop:"12px",border:"1px solid #ffeaa7",fontSize:"13px"},loadingMessage:{textAlign:"center",padding:"40px",color:"#666",fontSize:"16px"},savingIndicator:{fontSize:"12px",color:"#007bff",fontWeight:"500",marginLeft:"8px"},statusBadge:{fontSize:"11px",color:"white",padding:"4px 8px",borderRadius:"12px",fontWeight:"600",textTransform:"uppercase"},chatbotId:{fontSize:"11px",color:"#007bff",fontFamily:"monospace",marginBottom:"16px",backgroundColor:"#f8f9fa",padding:"4px 8px",borderRadius:"4px",display:"inline-block"},sectionSubtitle:{fontSize:"14px",fontWeight:"600",color:"#333",marginBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},filterSection:{marginTop:"20px",paddingTop:"16px",borderTop:"1px solid #e0e0e0"},filterGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(160px, 1fr))",gap:"8px"},filterItem:{display:"flex",alignItems:"center",gap:"6px",fontSize:"12px",color:"#333",cursor:"pointer",padding:"4px",borderRadius:"4px",transition:"background-color 0.2s"},filterItemLarge:{display:"flex",alignItems:"flex-start",gap:"8px",fontSize:"12px",color:"#333",cursor:"pointer",padding:"8px",borderRadius:"6px",transition:"background-color 0.2s",border:"1px solid #e0e0e0",backgroundColor:"#f8f9fa"},filterLabel:{fontWeight:"500"},filterDescription:{fontSize:"10px",color:"#666",marginTop:"2px",lineHeight:"1.3"},emptyChatbots:{textAlign:"center",padding:"40px",color:"#666",backgroundColor:"#f8f9fa",borderRadius:"8px",border:"1px solid #e0e0e0"},unsavedIndicator:{fontSize:"11px",color:"#dc3545",fontWeight:"500",marginLeft:"8px"},settingsActions:{display:"flex",gap:"8px",marginTop:"16px",paddingTop:"16px",borderTop:"1px solid #e0e0e0"},saveButton:{backgroundColor:"#28a745",color:"white",border:"none",padding:"8px 16px",borderRadius:"6px",cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px",transition:"all 0.2s",flex:1},resetButton:{backgroundColor:"#6c757d",color:"white",border:"none",padding:"8px 16px",borderRadius:"6px",cursor:"pointer",fontSize:"13px",fontWeight:"500",transition:"all 0.2s",flex:1},disabledLabel:{fontSize:"11px",color:"#999",fontWeight:"400"},disabledSection:{backgroundColor:"#f8f9fa",padding:"16px",borderRadius:"6px",border:"1px solid #e0e0e0"},disabledText:{fontSize:"13px",color:"#666",margin:0,fontStyle:"italic"}},pn=t=>e.jsx("img",{src:"https://modopafybeslbcqjxsve.supabase.co/storage/v1/object/public/web/Generated_Image_September_08__2025_-_3_09PM-removebg-preview.png",alt:"Sana AI Logo",style:{objectFit:"contain"},...t}),hn=({chatbotId:t,chatbotName:o,onClose:n})=>{const[a,s]=h.useState([]),[c,l]=h.useState([]),[g,m]=h.useState([]),[u,y]=h.useState([]),[x,i]=h.useState([]),[f,z]=h.useState([]),[D,Z]=h.useState({product_recommendations:!1,product_button_recommendations:!1,inline_product_links:!1,book_database:!0,use_feed_1:!0,use_feed_2:!0,webhook_url:void 0,enable_product_router:!0,enable_manual_funnel:!1}),[N,W]=h.useState(!1),[w,q]=h.useState(!1),[O,X]=h.useState(!0),[H,te]=h.useState(null),[v,ne]=h.useState(o||t),[ie,ae]=h.useState("cs"),ge=[{code:"cs",label:"CZ"},{code:"sk",label:"SK"},{code:"de",label:"DE"},{code:"en",label:"UK"}];h.useEffect(()=>{(async()=>{try{X(!0),te(null);const C=await Re.getChatbotFilters(t);s(C.categories),m(C.publicationTypes),l(C.labels),y(C.categories.map(V=>V.name)),z(C.publicationTypes.map(V=>V.name)),i(C.labels.map(V=>V.name));const G={product_recommendations:C.productRecommendations,product_button_recommendations:C.productButtonRecommendations,inline_product_links:C.inlineProductLinks,book_database:C.bookDatabase,use_feed_1:C.useFeed1,use_feed_2:C.useFeed2,webhook_url:C.webhookUrl,enable_product_router:C.enableProductRouter,enable_manual_funnel:C.enableManualFunnel};console.log("üîó Webhook URL naƒçten z datab√°ze:",C.webhookUrl),Z(G);const J=await Re.getChatbotSettingsWithDetails(t);J&&ne(J.chatbot_name)}catch{te("Nepoda≈ôilo se naƒç√≠st nastaven√≠ chatbota");const G=[{id:"1",name:"Aromaterapie"},{id:"2",name:"Mas√°≈æe"},{id:"3",name:"Akupunktura"},{id:"4",name:"Diagnostika"}],J=[{id:"1",name:"public",description:"Ve≈ôejnƒõ dostupn√© publikace"}],V=[];s(G),m(J),l(V),y(G.map(pe=>pe.name)),z(J.map(pe=>pe.name)),i([]),Z({product_recommendations:!1,product_button_recommendations:!1,inline_product_links:!1,book_database:!0,use_feed_1:!0,use_feed_2:!0,enable_product_router:!0,enable_manual_funnel:!1})}finally{X(!1)}})()},[t,o]);const Se=(T,C,G)=>{if(C.includes(T)){const J=C.filter(V=>V!==T);G(J)}else{const J=[...C,T];G(J)}},ye=()=>{y([]),i([]),z([])},ke=()=>{y(a.map(T=>T.name)),i(c.map(T=>T.name)),z(g.map(T=>T.name))},je=()=>{W(!N)},_e=()=>{q(!w)},_=()=>{window.location.reload()},I=()=>{alert("Export do PDF bude implementov√°n pozdƒõji")};if(O)return e.jsx("div",{className:"flex items-center justify-center h-full bg-bewit-gray",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl text-gray-600 mb-2",children:"Naƒç√≠t√°m nastaven√≠ chatbota..."}),e.jsx("div",{className:"text-sm text-gray-500",children:v})]})});if(H)return e.jsx("div",{className:"flex items-center justify-center h-full bg-bewit-gray",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl text-red-600 mb-2",children:"Chyba p≈ôi naƒç√≠t√°n√≠"}),e.jsx("div",{className:"text-sm text-gray-500",children:H}),e.jsxs("div",{className:"text-xs text-gray-400 mt-2",children:["Chatbot: ",v]})]})});const j=a.length>0||g.length>0;return e.jsxs("div",{className:"flex h-full w-full bg-bewit-gray m-0 p-0",children:[e.jsx("div",{className:`${N?"w-80":"w-0"} bg-white overflow-hidden transition-all duration-300 ease-in-out`,children:e.jsxs("div",{className:"w-80 p-6 overflow-y-auto h-full",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-bewit-dark mb-2",children:"Filtrace obsahu"}),e.jsx("p",{className:"text-sm text-gray-600",children:v}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:j?"Vyberte kategorie pro p≈ôesnƒõj≈°√≠ v√Ωsledky":"≈Ω√°dn√© filtrace nejsou k dispozici"})]}),j&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsx("button",{onClick:ke,className:"flex-1 px-3 py-2 text-xs font-medium text-bewit-blue bg-bewit-lightBlue rounded-md hover:bg-blue-100 transition-colors",children:"Vybrat v≈°e"}),e.jsx("button",{onClick:ye,className:"flex-1 px-3 py-2 text-xs font-medium text-slate-600 bg-slate-100 rounded-md hover:bg-slate-200 transition-colors",children:"Filter Reset"})]})}),a.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-bewit-dark mb-4 text-center",children:"Kategorie l√©ƒçby"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:a.map(T=>e.jsx("button",{onClick:()=>Se(T.name,u,y),className:`p-2 rounded-lg text-xs sm:text-sm font-medium transition-all duration-200 text-center ${u.includes(T.name)?"bg-bewit-blue text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:T.name},T.id))})]}),g.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-bewit-dark mb-4 text-center",children:"Typy publikac√≠"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:g.map(T=>e.jsx("button",{onClick:()=>Se(T.name,f,z),className:`p-2 rounded-lg text-xs sm:text-sm font-medium transition-all duration-200 text-center ${f.includes(T.name)?"bg-bewit-blue text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,title:T.description,children:T.name==="public"?"Ve≈ôejn√©":T.name==="students"?"Pro studenty":T.name==="internal_bewit"?"Intern√≠":T.name},T.id))})]}),c.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-bewit-dark mb-4 text-center",children:"≈†t√≠tky"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:c.map(T=>e.jsx("button",{onClick:()=>Se(T.name,x,i),className:`p-2 rounded-lg text-xs sm:text-sm font-medium transition-all duration-200 text-center ${x.includes(T.name)?"bg-bewit-blue text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:T.name},T.id))})]}),!j&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-500 mb-2",children:"≈Ω√°dn√© filtrace nejsou povoleny"}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Chatbot ",v," nem√° p≈ô√≠stup k ≈æ√°dn√Ωm kategori√≠m nebo typ≈Øm publikac√≠."]})]})]})}),e.jsxs("div",{className:"flex-1 flex flex-col w-full",children:[e.jsx(Mt,{onClose:n,languages:ge,selectedLanguage:ie,onLanguageChange:ae,leftContent:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:N,onChange:je,className:"sr-only peer","aria-label":"Zobrazit/skr√Ωt filtry"}),e.jsx("div",{className:"relative w-11 h-6 bg-white/20 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-white/30 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-white/40"})]}),e.jsx("div",{className:"h-6 w-px bg-white/20"}),e.jsx(pn,{className:"h-10 w-auto object-contain"})]}),buttons:[...D.product_recommendations?[{icon:"product",onClick:_e,label:w?"Skr√Ωt produkty":"Spravovat produkty",tooltip:w?"Skr√Ωt produkty":"Spravovat produkty BEWIT",isActive:w}]:[],{icon:"plus",onClick:_,label:"Nov√Ω chat",tooltip:"Nov√Ω chat"},{icon:"download",onClick:I,label:"Export do PDF",tooltip:"Export do PDF"}]}),e.jsx("div",{className:"flex-1 bg-bewit-gray flex flex-col min-h-0",children:w&&D.product_recommendations?e.jsx("div",{className:"w-full h-full flex-1 overflow-y-auto p-6",children:e.jsx(Wt,{})}):e.jsx(Bo,{selectedCategories:u,selectedLabels:x,selectedPublicationTypes:f,chatbotSettings:D,chatbotId:t})})]})]})};class Ee{static async checkAPIStatus(){return{available:!1,message:"ILovePDF slu≈æba nen√≠ nakonfigurov√°na"}}static getAvailableLanguages(){return[{code:"ces",name:"ƒåe≈°tina"},{code:"eng",name:"Angliƒçtina"},{code:"deu",name:"Nƒõmƒçina"},{code:"fra",name:"Francouz≈°tina"},{code:"spa",name:"≈†panƒõl≈°tina"},{code:"ita",name:"Ital≈°tina"},{code:"pol",name:"Pol≈°tina"},{code:"rus",name:"Ru≈°tina"}]}static getBestLanguageMatch(o){const n={cs:"ces",czech:"ces",ƒçe≈°tina:"ces",en:"eng",english:"eng",de:"deu",german:"deu",fr:"fra",french:"fra",es:"spa",spanish:"spa",it:"ita",italian:"ita",pl:"pol",polish:"pol",ru:"rus",russian:"rus"},a=o.toLowerCase().trim();return n[a]||"eng"}static async performOCR(o,n="ces"){return console.warn("‚ö†Ô∏è ILovePDF OCR nen√≠ implementov√°no, vrac√≠ se p≈Øvodn√≠ soubor"),o}static async compressPDF(o,n="recommended"){return console.warn("‚ö†Ô∏è ILovePDF komprese nen√≠ implementov√°na, vrac√≠ se p≈Øvodn√≠ soubor"),o}static async processWithOCRThenCompression(o,n="ces",a="recommended"){return console.warn("‚ö†Ô∏è ILovePDF OCR + komprese nen√≠ implementov√°no, vrac√≠ se p≈Øvodn√≠ soubor"),o}}async function gn(t,o=10){try{const n=window.pdfjsLib;if(!n)throw new Error("PDF.js nen√≠ naƒçten. Zkuste obnovit str√°nku.");const s=await n.getDocument({data:t}).promise,c=Math.min(s.numPages,o);let l="";for(let g=1;g<=c;g++)try{const y=(await(await s.getPage(g)).getTextContent()).items.map(x=>x.str!==void 0?String(x.str):x.text!==void 0?String(x.text):x.chars!==void 0?String(x.chars):typeof x=="string"?x:"").join(" ");l+=y+`
`}catch(m){console.warn(`Chyba p≈ôi zpracov√°n√≠ PDF str√°nky ${g}:`,m)}return l.trim()}catch(n){return console.error("‚ùå Chyba p≈ôi extrakci textu z PDF:",n),""}}async function xn(t,o=10,n=2){try{const a=window.pdfjsLib;if(!a)throw new Error("PDF.js nen√≠ naƒçten. Zkuste obnovit str√°nku.");const c=await a.getDocument({data:t}).promise,l=Math.min(c.numPages,o),g=[];for(let m=1;m<=l;m++)try{const u=await c.getPage(m),y=u.getViewport({scale:n}),x=document.createElement("canvas"),i=x.getContext("2d");if(!i){console.error("‚ùå Nepoda≈ôilo se z√≠skat 2D kontext canvasu");continue}x.width=y.width,x.height=y.height;const f={canvasContext:i,viewport:y};await u.render(f).promise;const z=x.toDataURL("image/png").split(",")[1];g.push(z)}catch(u){console.error(`‚ùå Chyba p≈ôi konverzi str√°nky ${m}:`,u)}return g}catch(a){return console.error("‚ùå Chyba p≈ôi konverzi PDF na obr√°zky:",a),[]}}async function mn(t,o,n,a){try{const s=await fetch(t);if(!s.ok)throw new Error(`Nepoda≈ôilo se st√°hnout PDF: ${s.status}`);const l=await(await s.blob()).arrayBuffer(),g=await gn(l,10);let m,u;if(g.length>500)u="text",m={type:"text",content:g,fileName:o};else{const f=await xn(l,10,2);if(f.length===0)throw new Error("Nepoda≈ôilo se p≈ôev√©st PDF na obr√°zky");u="images",m={type:"images",content:f,fileName:o}}const y=`${n}/functions/v1/extract-metadata-ai`,x=await fetch(y,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(m)});if(!x.ok){const f=await x.text();throw new Error(`Edge Function chyba: ${x.status} - ${f}`)}const i=await x.json();if(!i.success)throw new Error(i.error||"Edge Function vr√°tila chybu");return{success:!0,metadata:{...i.metadata,hasOCR:u==="text"},type:u,model:i.model}}catch(s){return console.error("‚ùå Chyba p≈ôi inteligentn√≠ extrakci metadat:",s),{success:!1,error:s instanceof Error?s.message:String(s)}}}async function fn(t,o,n,a){try{const s=n||void 0,c=a||void 0,l=`${s}/functions/v1/extract-metadata-ai`,g={type:"text",content:t,fileName:o};console.log("üì§ Odes√≠l√°m text na Edge Function:",{url:l,contentLength:t.length,fileName:o});const m=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify(g)});if(!m.ok){const y=await m.text();throw new Error(`Edge Function chyba: ${m.status} - ${y}`)}const u=await m.json();if(!u.success)throw new Error(u.error||"Edge Function vr√°tila chybu");return{success:!0,metadata:{...u.metadata,hasOCR:!0},type:"text",model:u.model}}catch(s){return console.error("‚ùå Chyba p≈ôi extrakci metadat z textu:",s),{success:!1,error:s instanceof Error?s.message:String(s)}}}const bn=({onLoginSuccess:t})=>{const[o,n]=h.useState(""),[a,s]=h.useState(""),[c,l]=h.useState(!1),[g,m]=h.useState(null),[u,y]=h.useState(!1),x=async i=>{i.preventDefault(),m(null),y(!0);try{const{user:f,error:z}=await Ro(o,a);if(z||!f){m(z||"P≈ôihl√°≈°en√≠ se nezda≈ôilo"),y(!1);return}t()}catch{m("Neoƒçek√°van√° chyba p≈ôi p≈ôihl√°≈°en√≠"),y(!1)}};return e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#fdfaf6",padding:"20px"},children:e.jsxs("div",{style:{background:"#ffffff",borderRadius:"12px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",padding:"48px",width:"100%",maxWidth:"420px",border:"1px solid #eaddd7"},children:[e.jsx("div",{style:{textAlign:"center",marginBottom:"40px"},children:e.jsx("img",{src:"https://modopafybeslbcqjxsve.supabase.co/storage/v1/object/public/web/image-removebg-preview%20(1).png",alt:"MedBase Logo",style:{height:"80px",width:"auto",objectFit:"contain",margin:"0 auto"}})}),e.jsxs("form",{onSubmit:x,children:[e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",color:"#4a4a4a",marginBottom:"8px",fontFamily:"Inter, sans-serif"},children:"Email"}),e.jsx("input",{type:"email",value:o,onChange:i=>n(i.target.value),required:!0,disabled:u,placeholder:"vas.email@example.com",autoComplete:"email",name:"email",style:{width:"100%",padding:"12px 16px",fontSize:"14px",border:"1px solid #eaddd7",borderRadius:"8px",outline:"none",transition:"all 0.2s",boxSizing:"border-box",fontFamily:"Inter, sans-serif",backgroundColor:"#ffffff"},onFocus:i=>{i.target.style.borderColor="#5d7fa3",i.target.style.boxShadow="0 0 0 3px rgba(93, 127, 163, 0.1)"},onBlur:i=>{i.target.style.borderColor="#eaddd7",i.target.style.boxShadow="none"}})]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",color:"#4a4a4a",marginBottom:"8px",fontFamily:"Inter, sans-serif"},children:"Heslo"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:c?"text":"password",value:a,onChange:i=>s(i.target.value),required:!0,disabled:u,placeholder:"Va≈°e heslo",autoComplete:"current-password",name:"password",style:{width:"100%",padding:"12px 48px 12px 16px",fontSize:"14px",border:"1px solid #eaddd7",borderRadius:"8px",outline:"none",transition:"all 0.2s",boxSizing:"border-box",fontFamily:"Inter, sans-serif",backgroundColor:"#ffffff"},onFocus:i=>{i.target.style.borderColor="#5d7fa3",i.target.style.boxShadow="0 0 0 3px rgba(93, 127, 163, 0.1)"},onBlur:i=>{i.target.style.borderColor="#eaddd7",i.target.style.boxShadow="none"}}),e.jsx("button",{type:"button",onClick:()=>l(!c),style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center",color:"#7a7a7a"},children:c?"üëÅÔ∏è":"üëÅÔ∏è‚Äçüó®Ô∏è"})]})]}),g&&e.jsx("div",{style:{padding:"12px 16px",marginBottom:"20px",background:"#fee2e2",border:"1px solid #fecaca",borderRadius:"8px",fontSize:"14px",color:"#991b1b",fontFamily:"Inter, sans-serif"},children:g}),e.jsx("button",{type:"submit",disabled:u,style:{width:"100%",padding:"14px 24px",fontSize:"16px",fontWeight:"600",color:"white",backgroundColor:u?"#9ca3af":"#5d7fa3",border:"none",borderRadius:"8px",cursor:u?"not-allowed":"pointer",transition:"all 0.2s",boxShadow:u?"none":"0 1px 2px rgba(0, 0, 0, 0.05)",fontFamily:"Inter, sans-serif"},onMouseEnter:i=>{u||(i.currentTarget.style.backgroundColor="#4a6582",i.currentTarget.style.transform="translateY(-1px)",i.currentTarget.style.boxShadow="0 4px 6px rgba(0, 0, 0, 0.1)")},onMouseLeave:i=>{u||(i.currentTarget.style.backgroundColor="#5d7fa3",i.currentTarget.style.transform="translateY(0)",i.currentTarget.style.boxShadow="0 1px 2px rgba(0, 0, 0, 0.05)")},children:u?"P≈ôihla≈°ov√°n√≠...":"P≈ôihl√°sit se"})]}),e.jsx("div",{style:{marginTop:"24px",paddingTop:"24px",borderTop:"1px solid #eaddd7",fontSize:"12px",color:"#7a7a7a",textAlign:"center",fontFamily:"Inter, sans-serif"},children:"Pro vytvo≈ôen√≠ nov√©ho √∫ƒçtu kontaktujte spr√°vce syst√©mu"})]})})},yn=({children:t})=>{const[o,n]=h.useState(null),[a,s]=h.useState(!0),[c,l]=h.useState(!0),g=async()=>{try{const{user:u,error:y}=await Eo();n(y?null:u||null)}catch(u){console.error("‚ùå Neoƒçek√°van√° chyba p≈ôi ovƒõ≈ôov√°n√≠:",u),n(null)}finally{s(!1),l(!1)}};h.useEffect(()=>{g()},[]);const m=()=>{g()};return a&&c?e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},children:e.jsxs("div",{style:{background:"white",borderRadius:"12px",boxShadow:"0 20px 60px rgba(0,0,0,0.3)",padding:"40px",textAlign:"center"},children:[e.jsx("div",{style:{width:"48px",height:"48px",border:"4px solid #e5e7eb",borderTopColor:"#667eea",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 20px"}}),e.jsx("p",{style:{color:"#374151",fontSize:"16px",fontWeight:"500",margin:0},children:"Naƒç√≠t√°n√≠ session..."}),e.jsx("style",{children:`
                        @keyframes spin {
                            to { transform: rotate(360deg); }
                        }
                    `})]})}):o?e.jsx(e.Fragment,{children:t(o)}):e.jsx(bn,{onLoginSuccess:m})};function vn(t){const o=t.substring(0,4).toLowerCase(),n=Math.floor(1e3+Math.random()*9e3).toString();return o+n}async function kn(t,o,n,a,s){try{if(!await dt())return{success:!1,error:"Pouze spr√°vce m≈Ø≈æe vytv√°≈ôet u≈æivatele"};const{data:l}=await F.from("users").select("id").eq("email",t.toLowerCase()).single();if(l)return{success:!1,error:"U≈æivatel s t√≠mto emailem ji≈æ existuje"};const g=s||vn(n),m=await Ao.hash(g,10),{data:u,error:y}=await F.from("users").insert({email:t.toLowerCase(),password_hash:m,first_name:o,last_name:n,role:a}).select().single();if(y||!u)return console.error("‚ùå Chyba p≈ôi vytv√°≈ôen√≠ u≈æivatele:",y),{success:!1,error:"Nepoda≈ôilo se vytvo≈ôit u≈æivatele"};const x={id:u.id,email:u.email,firstName:u.first_name,lastName:u.last_name,role:u.role,created_at:u.created_at,updated_at:u.updated_at};return{success:!0,error:null,password:g,user:x}}catch(c){return console.error("‚ùå Chyba p≈ôi vytv√°≈ôen√≠ u≈æivatele:",c),{success:!1,error:"Neoƒçek√°van√° chyba p≈ôi vytv√°≈ôen√≠ u≈æivatele"}}}async function jn(){try{if(!await dt())return{users:null,error:"Pouze spr√°vce m≈Ø≈æe zobrazit seznam u≈æivatel≈Ø"};const{data:o,error:n}=await F.from("users").select("*").order("created_at",{ascending:!1});return n?(console.error("‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ u≈æivatel≈Ø:",n),{users:null,error:"Nepoda≈ôilo se naƒç√≠st seznam u≈æivatel≈Ø"}):{users:(o||[]).map(s=>({id:s.id,email:s.email,firstName:s.first_name,lastName:s.last_name,role:s.role,created_at:s.created_at,updated_at:s.updated_at})),error:null}}catch(t){return console.error("‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ u≈æivatel≈Ø:",t),{users:null,error:"Neoƒçek√°van√° chyba p≈ôi naƒç√≠t√°n√≠ u≈æivatel≈Ø"}}}async function wn(t){try{if(!await dt())return{success:!1,error:"Pouze spr√°vce m≈Ø≈æe mazat u≈æivatele"};await F.from("user_sessions").delete().eq("user_id",t);const{error:n}=await F.from("users").delete().eq("id",t);return n?(console.error("‚ùå Chyba p≈ôi maz√°n√≠ u≈æivatele:",n),{success:!1,error:"Nepoda≈ôilo se smazat u≈æivatele"}):{success:!0,error:null}}catch(o){return console.error("‚ùå Chyba p≈ôi maz√°n√≠ u≈æivatele:",o),{success:!1,error:"Neoƒçek√°van√° chyba p≈ôi maz√°n√≠ u≈æivatele"}}}async function Cn(t,o){try{if(!await dt())return{success:!1,error:"Pouze spr√°vce m≈Ø≈æe mƒõnit role u≈æivatel≈Ø"};const{error:a}=await F.from("users").update({role:o}).eq("id",t);return a?(console.error("‚ùå Chyba p≈ôi zmƒõnƒõ role:",a),{success:!1,error:"Nepoda≈ôilo se zmƒõnit roli"}):{success:!0,error:null}}catch(n){return console.error("‚ùå Chyba p≈ôi zmƒõnƒõ role:",n),{success:!1,error:"Neoƒçek√°van√° chyba p≈ôi zmƒõnƒõ role"}}}const zn=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),e.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]}),Sn=({email:t,password:o,onClose:n})=>{const[a,s]=h.useState(!1),c=async()=>{try{await navigator.clipboard.writeText(o),s(!0),setTimeout(()=>s(!1),2e3)}catch(l){console.error("Chyba p≈ôi kop√≠rov√°n√≠:",l)}};return e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999,padding:"20px"},children:e.jsxs("div",{style:{background:"white",borderRadius:"16px",padding:"40px",maxWidth:"500px",width:"100%",boxShadow:"0 20px 60px rgba(0,0,0,0.3)",textAlign:"center"},children:[e.jsx("div",{style:{width:"80px",height:"80px",background:"#22c55e",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 24px"},children:e.jsx("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"white",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}),e.jsx("h2",{style:{margin:"0 0 16px 0",fontSize:"28px",fontWeight:"700",color:"#1a1a1a",fontFamily:"Inter, sans-serif"},children:"U≈æivatel vytvo≈ôen!"}),e.jsx("p",{style:{margin:"0 0 32px 0",fontSize:"16px",color:"#666",fontFamily:"Inter, sans-serif"},children:"Zkop√≠rujte heslo a p≈ôedejte ho u≈æivateli"}),e.jsxs("div",{style:{background:"#f8f9fa",borderRadius:"12px",padding:"20px",marginBottom:"16px",textAlign:"left"},children:[e.jsx("div",{style:{fontSize:"12px",color:"#888",marginBottom:"8px",fontWeight:"600",textTransform:"uppercase",letterSpacing:"0.5px",fontFamily:"Inter, sans-serif"},children:"Email"}),e.jsx("div",{style:{fontSize:"18px",color:"#1a1a1a",fontFamily:"monospace",fontWeight:"600"},children:t})]}),e.jsxs("div",{style:{background:"#fff3cd",border:"2px solid #ffc107",borderRadius:"12px",padding:"20px",marginBottom:"32px",textAlign:"left"},children:[e.jsx("div",{style:{fontSize:"12px",color:"#856404",marginBottom:"12px",fontWeight:"600",textTransform:"uppercase",letterSpacing:"0.5px",fontFamily:"Inter, sans-serif"},children:"Heslo"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[e.jsx("div",{style:{fontSize:"32px",color:"#1a1a1a",fontFamily:"monospace",fontWeight:"700",letterSpacing:"3px",flex:1},children:o}),e.jsxs("button",{type:"button",onClick:c,style:{padding:"14px 20px",background:a?"#22c55e":"#5d7fa3",color:"white",border:"none",borderRadius:"10px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",fontSize:"16px",fontFamily:"Inter, sans-serif",fontWeight:"700",transition:"all 0.2s",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},onMouseEnter:l=>{a||(l.currentTarget.style.transform="translateY(-2px)",l.currentTarget.style.boxShadow="0 6px 16px rgba(0,0,0,0.2)")},onMouseLeave:l=>{a||(l.currentTarget.style.transform="translateY(0)",l.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.15)")},children:[e.jsx(zn,{}),a?"Zkop√≠rov√°no!":"Kop√≠rovat"]})]})]}),e.jsx("button",{type:"button",onClick:n,style:{padding:"16px 48px",fontSize:"18px",fontWeight:"700",color:"white",background:"#22c55e",border:"none",borderRadius:"12px",cursor:"pointer",fontFamily:"Inter, sans-serif",transition:"all 0.2s",boxShadow:"0 4px 12px rgba(34, 197, 94, 0.3)"},onMouseEnter:l=>{l.currentTarget.style.background="#16a34a",l.currentTarget.style.transform="translateY(-2px)",l.currentTarget.style.boxShadow="0 6px 16px rgba(34, 197, 94, 0.4)"},onMouseLeave:l=>{l.currentTarget.style.background="#22c55e",l.currentTarget.style.transform="translateY(0)",l.currentTarget.style.boxShadow="0 4px 12px rgba(34, 197, 94, 0.3)"},children:"Hotovo"})]})})},_n=()=>e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),Pn=({onClose:t,onUserAdded:o})=>{const[n,a]=h.useState(""),[s,c]=h.useState(""),[l,g]=h.useState(""),[m,u]=h.useState("admin"),[y,x]=h.useState(!1),[i,f]=h.useState(null),[z,D]=h.useState(""),[Z,N]=h.useState(""),[W,w]=h.useState(!1),[q,O]=h.useState(!1),X=v=>{c(v)},H=v=>{if(g(v),v.length>=4){const ne=v.substring(0,4).toLowerCase();N(ne+"XXXX")}else v.length>0?N(v.toLowerCase()+"XXXX"):N("")},te=async v=>{if(v.preventDefault(),f(null),x(!0),!n.trim()){f("Vypl≈àte email"),x(!1);return}if(!s.trim()||s.trim().length<2){f("Jm√©no mus√≠ m√≠t alespo≈à 2 znaky"),x(!1);return}if(!l.trim()||l.trim().length<2){f("P≈ô√≠jmen√≠ mus√≠ m√≠t alespo≈à 2 znaky"),x(!1);return}const{success:ne,error:ie,password:ae}=await kn(n.trim(),s.trim(),l.trim(),m,void 0);if(x(!1),ie){f(ie);return}ne&&ae?(D(ae),O(!0)):f("Nepoda≈ôilo se vytvo≈ôit u≈æivatele")};return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1001,padding:"20px"},children:e.jsxs("div",{style:{background:"#ffffff",borderRadius:"12px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",width:"100%",maxWidth:"500px",maxHeight:"90vh",overflow:"auto",border:"1px solid #eaddd7",fontFamily:"Inter, sans-serif"},children:[e.jsxs("div",{style:{padding:"24px",borderBottom:"1px solid #eaddd7",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("h3",{style:{margin:0,fontSize:"18px",fontWeight:"600",color:"#4a4a4a",fontFamily:"Inter, sans-serif"},children:"Pozvat nov√©ho u≈æivatele"}),e.jsx("button",{onClick:t,style:{background:"none",border:"none",cursor:"pointer",padding:"8px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"6px",color:"#6b7280"},onMouseEnter:v=>{v.currentTarget.style.background="#f3eee8"},onMouseLeave:v=>{v.currentTarget.style.background="none"},children:e.jsx(_n,{})})]}),e.jsx("div",{style:{padding:"24px"},children:e.jsxs("form",{onSubmit:te,children:[e.jsxs("div",{style:{padding:"16px",background:"#e6f2f9",border:"1px solid #C8A97E",borderRadius:"8px",marginBottom:"24px",fontSize:"13px",color:"#4a4a4a",lineHeight:"1.6",fontFamily:"Inter, sans-serif"},children:[e.jsx("strong",{children:"Pozn√°mka:"})," Heslo bude automaticky vygenerov√°no z p≈ô√≠jmen√≠ (4 p√≠smena) + 4 n√°hodn√© ƒç√≠slice (nap≈ô. ",e.jsx("strong",{children:"haj d2847"}),"). U≈æivatel se m≈Ø≈æe p≈ôihl√°sit s t√≠mto heslem a n√°slednƒõ si ho zmƒõnit v nastaven√≠."]}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsxs("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",color:"#4a4a4a",marginBottom:"8px",fontFamily:"Inter, sans-serif"},children:["Email",e.jsx("span",{style:{color:"#d9534f",marginLeft:"4px"},children:"*"})]}),e.jsx("input",{type:"email",value:n,onChange:v=>a(v.target.value),required:!0,disabled:y,placeholder:"uzivatel@example.com",style:{width:"100%",padding:"12px 16px",fontSize:"14px",border:"1px solid #eaddd7",borderRadius:"8px",outline:"none",transition:"all 0.2s",boxSizing:"border-box",fontFamily:"Inter, sans-serif",backgroundColor:"#ffffff"},onFocus:v=>{v.target.style.borderColor="#5d7fa3",v.target.style.boxShadow="0 0 0 3px rgba(93, 127, 163, 0.1)"},onBlur:v=>{v.target.style.borderColor="#eaddd7",v.target.style.boxShadow="none"}})]}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsxs("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",color:"#4a4a4a",marginBottom:"8px",fontFamily:"Inter, sans-serif"},children:["Jm√©no",e.jsx("span",{style:{color:"#d9534f",marginLeft:"4px"},children:"*"})]}),e.jsx("input",{type:"text",value:s,onChange:v=>X(v.target.value),required:!0,disabled:y,placeholder:"Jm√©no u≈æivatele",minLength:2,style:{width:"100%",padding:"12px 16px",fontSize:"14px",border:"1px solid #eaddd7",borderRadius:"8px",outline:"none",transition:"all 0.2s",boxSizing:"border-box",fontFamily:"Inter, sans-serif",backgroundColor:"#ffffff"},onFocus:v=>{v.target.style.borderColor="#5d7fa3",v.target.style.boxShadow="0 0 0 3px rgba(93, 127, 163, 0.1)"},onBlur:v=>{v.target.style.borderColor="#eaddd7",v.target.style.boxShadow="none"}}),s.length>0&&s.length<2&&e.jsx("div",{style:{fontSize:"12px",color:"#dc2626",marginTop:"4px",fontFamily:"Inter, sans-serif"},children:"Jm√©no mus√≠ m√≠t alespo≈à 2 znaky"})]}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsxs("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",color:"#4a4a4a",marginBottom:"8px",fontFamily:"Inter, sans-serif"},children:["P≈ô√≠jmen√≠",e.jsx("span",{style:{color:"#d9534f",marginLeft:"4px"},children:"*"})]}),e.jsx("input",{type:"text",value:l,onChange:v=>H(v.target.value),required:!0,disabled:y,placeholder:"P≈ô√≠jmen√≠ u≈æivatele",minLength:2,style:{width:"100%",padding:"12px 16px",fontSize:"14px",border:"1px solid #eaddd7",borderRadius:"8px",outline:"none",transition:"all 0.2s",boxSizing:"border-box",fontFamily:"Inter, sans-serif",backgroundColor:"#ffffff"},onFocus:v=>{v.target.style.borderColor="#5d7fa3",v.target.style.boxShadow="0 0 0 3px rgba(93, 127, 163, 0.1)"},onBlur:v=>{v.target.style.borderColor="#eaddd7",v.target.style.boxShadow="none"}}),l.length>0&&l.length<2&&e.jsx("div",{style:{fontSize:"12px",color:"#dc2626",marginTop:"4px",fontFamily:"Inter, sans-serif"},children:"P≈ô√≠jmen√≠ mus√≠ m√≠t alespo≈à 2 znaky"}),Z&&e.jsxs("div",{style:{fontSize:"12px",color:"#6b7280",marginTop:"4px",fontFamily:"Inter, sans-serif"},children:["N√°hled hesla: ",e.jsx("span",{style:{fontFamily:"monospace",fontWeight:"600"},children:Z})]})]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",color:"#4a4a4a",marginBottom:"8px",fontFamily:"Inter, sans-serif"},children:["Role",e.jsx("span",{style:{color:"#d9534f",marginLeft:"4px"},children:"*"})]}),e.jsxs("select",{value:m,onChange:v=>u(v.target.value),disabled:y,style:{width:"100%",padding:"12px 16px",fontSize:"14px",border:"1px solid #eaddd7",borderRadius:"8px",outline:"none",transition:"all 0.2s",boxSizing:"border-box",background:"#ffffff",cursor:"pointer",fontFamily:"Inter, sans-serif",color:"#4a4a4a"},onFocus:v=>{v.target.style.borderColor="#5d7fa3",v.target.style.boxShadow="0 0 0 3px rgba(93, 127, 163, 0.1)"},onBlur:v=>{v.target.style.borderColor="#eaddd7",v.target.style.boxShadow="none"},children:[e.jsx("option",{value:"admin",children:"Admin (m≈Ø≈æe p≈ôid√°vat/upravovat knihy)"}),e.jsx("option",{value:"spravce",children:"Spr√°vce (pln√Ω p≈ô√≠stup k syst√©mu)"})]})]}),i&&e.jsx("div",{style:{padding:"12px 16px",marginBottom:"20px",background:"#fee2e2",border:"1px solid #fecaca",borderRadius:"8px",fontSize:"14px",color:"#991b1b",fontFamily:"Inter, sans-serif"},children:i}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",onClick:t,disabled:y,style:{padding:"10px 20px",fontSize:"14px",fontWeight:"600",color:"#4a4a4a",background:"#f3eee8",border:"1px solid #eaddd7",borderRadius:"8px",cursor:y?"not-allowed":"pointer",opacity:y?.5:1,fontFamily:"Inter, sans-serif",transition:"all 0.2s"},onMouseEnter:v=>{y||(v.currentTarget.style.background="#eaddd7")},onMouseLeave:v=>{y||(v.currentTarget.style.background="#f3eee8")},children:"Zru≈°it"}),e.jsx("button",{type:"submit",disabled:y,style:{padding:"10px 20px",fontSize:"14px",fontWeight:"600",color:"white",backgroundColor:y?"#9ca3af":"#5d7fa3",border:"none",borderRadius:"8px",cursor:y?"not-allowed":"pointer",boxShadow:y?"none":"0 1px 2px rgba(0, 0, 0, 0.05)",fontFamily:"Inter, sans-serif",transition:"all 0.2s"},onMouseEnter:v=>{y||(v.currentTarget.style.backgroundColor="#4a6582",v.currentTarget.style.transform="translateY(-1px)",v.currentTarget.style.boxShadow="0 4px 6px rgba(0, 0, 0, 0.1)")},onMouseLeave:v=>{y||(v.currentTarget.style.backgroundColor="#5d7fa3",v.currentTarget.style.transform="translateY(0)",v.currentTarget.style.boxShadow="0 1px 2px rgba(0, 0, 0, 0.05)")},children:y?"Vytv√°≈ôen√≠...":"Vytvo≈ôit u≈æivatele"})]})]})})]})}),q&&z&&e.jsx(Sn,{email:n,password:z,onClose:()=>{O(!1),o()}})]})},Tn=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),Ln=()=>e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),$n=()=>e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),e.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),e.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]}),Nn=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),Dn=({currentUserId:t,onClose:o})=>{const[n,a]=h.useState([]),[s,c]=h.useState(!0),[l,g]=h.useState(null),[m,u]=h.useState(!1),[y,x]=h.useState(null),i=async()=>{c(!0),g(null);const{users:N,error:W}=await jn();if(W){g(W),c(!1);return}a(N||[]),c(!1)};h.useEffect(()=>{i()},[]);const f=async(N,W)=>{if(N===t){alert("Nem≈Ø≈æete smazat sv≈Øj vlastn√≠ √∫ƒçet");return}if(!confirm(`Opravdu chcete smazat u≈æivatele ${W}?`))return;x(N);const{success:w,error:q}=await wn(N);if(q){alert(`Chyba p≈ôi maz√°n√≠ u≈æivatele: ${q}`),x(null);return}w&&await i(),x(null)},z=async(N,W)=>{if(N===t){alert("Nem≈Ø≈æete zmƒõnit svou vlastn√≠ roli");return}const w=W==="admin"?"spravce":"admin";if(!confirm(`Opravdu chcete zmƒõnit roli na "${w}"?`))return;const{success:q,error:O}=await Cn(N,w);if(O){alert(`Chyba p≈ôi zmƒõnƒõ role: ${O}`);return}q&&await i()},D=N=>N==="spravce"?{bg:"#dbeafe",text:"#1e40af",border:"#bfdbfe"}:{bg:"#e0e7ff",text:"#4338ca",border:"#c7d2fe"},Z=N=>N==="spravce"?"Spr√°vce":"Admin";return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"20px"},children:e.jsxs("div",{style:{background:"white",borderRadius:"12px",boxShadow:"0 20px 60px rgba(0,0,0,0.3)",width:"100%",maxWidth:"800px",maxHeight:"90vh",display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{padding:"24px",borderBottom:"1px solid #e5e7eb",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx(Tn,{}),e.jsx("h2",{style:{margin:0,fontSize:"20px",fontWeight:"600",color:"#1a202c"},children:"Spr√°va u≈æivatel≈Ø"})]}),e.jsx("button",{onClick:o,style:{background:"none",border:"none",cursor:"pointer",padding:"8px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"6px",color:"#6b7280"},onMouseEnter:N=>{N.currentTarget.style.background="#f3f4f6"},onMouseLeave:N=>{N.currentTarget.style.background="none"},children:e.jsx(Ln,{})})]}),e.jsx("div",{style:{flex:1,overflow:"auto",padding:"24px"},children:s?e.jsxs("div",{style:{textAlign:"center",padding:"40px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",border:"4px solid #e5e7eb",borderTopColor:"#667eea",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto"}}),e.jsx("p",{style:{marginTop:"16px",color:"#6b7280"},children:"Naƒç√≠t√°n√≠ u≈æivatel≈Ø..."})]}):l?e.jsx("div",{style:{padding:"16px",background:"#fee2e2",border:"1px solid #fecaca",borderRadius:"8px",color:"#991b1b"},children:l}):e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:"20px"},children:e.jsxs("button",{onClick:()=>u(!0),style:{padding:"10px 20px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"14px",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px"},onMouseEnter:N=>{N.currentTarget.style.transform="translateY(-2px)",N.currentTarget.style.boxShadow="0 4px 12px rgba(102, 126, 234, 0.4)"},onMouseLeave:N=>{N.currentTarget.style.transform="translateY(0)",N.currentTarget.style.boxShadow="none"},children:[e.jsx(Nn,{}),"P≈ôidat u≈æivatele"]})}),e.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:"8px",overflow:"hidden"},children:[e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#f9fafb"},children:[e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:"#6b7280",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Email"}),e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:"#6b7280",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Role"}),e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:"#6b7280",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Vytvo≈ôeno"}),e.jsx("th",{style:{padding:"12px 16px",textAlign:"right",fontSize:"12px",fontWeight:"600",color:"#6b7280",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Akce"})]})}),e.jsx("tbody",{children:n.map(N=>{const W=D(N.role),w=N.id===t;return e.jsxs("tr",{style:{borderTop:"1px solid #e5e7eb",background:w?"#f0fdf4":"white"},children:[e.jsx("td",{style:{padding:"16px"},children:e.jsxs("div",{style:{fontSize:"14px",color:"#1a202c",fontWeight:w?"600":"400"},children:[N.email,w&&e.jsx("span",{style:{marginLeft:"8px",fontSize:"12px",color:"#059669",fontWeight:"500"},children:"(Vy)"})]})}),e.jsx("td",{style:{padding:"16px"},children:e.jsx("span",{style:{display:"inline-block",padding:"4px 12px",fontSize:"12px",fontWeight:"600",color:W.text,background:W.bg,border:`1px solid ${W.border}`,borderRadius:"12px"},children:Z(N.role)})}),e.jsx("td",{style:{padding:"16px"},children:e.jsx("span",{style:{fontSize:"14px",color:"#6b7280"},children:new Date(N.created_at).toLocaleDateString("cs-CZ")})}),e.jsx("td",{style:{padding:"16px",textAlign:"right"},children:e.jsx("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:!w&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>z(N.id,N.role),style:{padding:"6px 12px",fontSize:"12px",fontWeight:"500",color:"#4338ca",background:"#e0e7ff",border:"1px solid #c7d2fe",borderRadius:"6px",cursor:"pointer"},onMouseEnter:q=>{q.currentTarget.style.background="#c7d2fe"},onMouseLeave:q=>{q.currentTarget.style.background="#e0e7ff"},children:"Zmƒõnit roli"}),e.jsxs("button",{onClick:()=>f(N.id,N.email),disabled:y===N.id,style:{padding:"6px 12px",fontSize:"12px",fontWeight:"500",color:"#991b1b",background:"#fee2e2",border:"1px solid #fecaca",borderRadius:"6px",cursor:y===N.id?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"6px",opacity:y===N.id?.5:1},onMouseEnter:q=>{y!==N.id&&(q.currentTarget.style.background="#fecaca")},onMouseLeave:q=>{y!==N.id&&(q.currentTarget.style.background="#fee2e2")},children:[e.jsx($n,{}),"Smazat"]})]})})})]},N.id)})})]}),n.length===0&&e.jsx("div",{style:{padding:"40px",textAlign:"center",color:"#6b7280"},children:"Nebyli nalezeni ≈æ√°dn√≠ u≈æivatel√©"})]})]})})]})}),m&&e.jsx(Pn,{onClose:()=>u(!1),onUserAdded:()=>{u(!1),i()}}),e.jsx("style",{children:`
                @keyframes spin {
                    to { transform: rotate(360deg); }
                }
            `})]})},Bn=({currentUser:t,onClose:o})=>{const[n,a]=h.useState(""),[s,c]=h.useState(""),[l,g]=h.useState(!1),[m,u]=h.useState(null),[y,x]=h.useState(!1),i=async f=>{if(f.preventDefault(),u(null),x(!1),!n||!s){u("Vypl≈àte v≈°echna pole");return}if(n.length<6){u("Nov√© heslo mus√≠ m√≠t alespo≈à 6 znak≈Ø");return}if(n!==s){u("Nov√° hesla se neshoduj√≠");return}g(!0);try{const z=await Io(n);z.error?u(z.error):(x(!0),a(""),c(""),setTimeout(()=>{o()},2e3))}catch{u("Neoƒçek√°van√° chyba p≈ôi zmƒõnƒõ hesla")}finally{g(!1)}};return e.jsxs("div",{style:fe.container,children:[e.jsxs("div",{style:fe.header,children:[e.jsx("h2",{style:fe.title,children:"Nastaven√≠ profilu"}),e.jsx("button",{onClick:o,style:fe.closeButton,"aria-label":"Zav≈ô√≠t",children:"‚úï"})]}),e.jsxs("div",{style:fe.userInfo,children:[e.jsxs("div",{style:fe.userInfoRow,children:[e.jsx("span",{style:fe.label,children:"Email:"}),e.jsx("span",{style:fe.value,children:t.email})]}),e.jsxs("div",{style:fe.userInfoRow,children:[e.jsx("span",{style:fe.label,children:"Role:"}),e.jsx("span",{style:fe.value,children:t.role==="spravce"?"Spr√°vce":"Admin"})]})]}),e.jsx("div",{style:fe.divider}),e.jsx("h3",{style:fe.subtitle,children:"Zmƒõna hesla"}),m&&e.jsx("div",{style:fe.errorMessage,children:m}),y&&e.jsx("div",{style:fe.successMessage,children:"‚úì Heslo bylo √∫spƒõ≈°nƒõ zmƒõnƒõno"}),e.jsxs("form",{onSubmit:i,style:fe.form,children:[e.jsxs("div",{style:fe.formGroup,children:[e.jsx("label",{style:fe.formLabel,htmlFor:"newPassword",children:"Nov√© heslo"}),e.jsx("input",{id:"newPassword",type:"password",value:n,onChange:f=>a(f.target.value),style:fe.input,disabled:l,autoComplete:"new-password",minLength:6}),e.jsx("span",{style:fe.hint,children:"Minim√°lnƒõ 6 znak≈Ø"})]}),e.jsxs("div",{style:fe.formGroup,children:[e.jsx("label",{style:fe.formLabel,htmlFor:"confirmPassword",children:"Potvrdit nov√© heslo"}),e.jsx("input",{id:"confirmPassword",type:"password",value:s,onChange:f=>c(f.target.value),style:fe.input,disabled:l,autoComplete:"new-password"})]}),e.jsxs("div",{style:fe.buttonGroup,children:[e.jsx("button",{type:"button",onClick:o,style:fe.cancelButton,disabled:l,children:"Zru≈°it"}),e.jsx("button",{type:"submit",style:fe.submitButton,disabled:l,children:l?"Ukl√°d√°m...":"Zmƒõnit heslo"})]})]})]})},fe={container:{display:"flex",flexDirection:"column",gap:"1.5rem",minWidth:"400px",maxWidth:"500px"},header:{display:"flex",justifyContent:"space-between",alignItems:"center"},title:{margin:0,fontSize:"1.5rem",fontWeight:"600",color:"var(--text-primary)"},closeButton:{background:"none",border:"none",fontSize:"1.5rem",cursor:"pointer",padding:"0.25rem",color:"var(--text-secondary)",transition:"color 0.2s"},userInfo:{display:"flex",flexDirection:"column",gap:"0.75rem",padding:"1rem",background:"var(--bg-secondary)",borderRadius:"8px"},userInfoRow:{display:"flex",justifyContent:"space-between",alignItems:"center"},label:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"500"},value:{color:"var(--text-primary)",fontSize:"0.9rem",fontWeight:"600"},divider:{height:"1px",background:"var(--border-color)",margin:"0.5rem 0"},subtitle:{margin:0,fontSize:"1.1rem",fontWeight:"600",color:"var(--text-primary)"},errorMessage:{padding:"0.75rem 1rem",background:"#fee",border:"1px solid #fcc",borderRadius:"6px",color:"#c33",fontSize:"0.9rem"},successMessage:{padding:"0.75rem 1rem",background:"#efe",border:"1px solid #cfc",borderRadius:"6px",color:"#3c3",fontSize:"0.9rem",fontWeight:"500"},form:{display:"flex",flexDirection:"column",gap:"1.25rem"},formGroup:{display:"flex",flexDirection:"column",gap:"0.5rem"},formLabel:{fontSize:"0.9rem",fontWeight:"500",color:"var(--text-primary)"},input:{padding:"0.75rem",fontSize:"1rem",border:"1px solid var(--border-color)",borderRadius:"6px",outline:"none",transition:"border-color 0.2s"},hint:{fontSize:"0.8rem",color:"var(--text-secondary)",fontStyle:"italic"},buttonGroup:{display:"flex",gap:"0.75rem",justifyContent:"flex-end",marginTop:"0.5rem"},cancelButton:{padding:"0.75rem 1.5rem",fontSize:"0.95rem",fontWeight:"500",border:"1px solid var(--border-color)",borderRadius:"6px",background:"white",color:"var(--text-primary)",cursor:"pointer",transition:"all 0.2s"},submitButton:{padding:"0.75rem 1.5rem",fontSize:"0.95rem",fontWeight:"500",border:"none",borderRadius:"6px",background:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",color:"white",cursor:"pointer",transition:"all 0.2s",boxShadow:"0 2px 8px rgba(59, 130, 246, 0.3)"}};function Fn(){return typeof window<"u"&&window.pdfjsLib?window.pdfjsLib:(console.warn("‚ö†Ô∏è pdfjsLib je≈°tƒõ nen√≠ dostupn√Ω na window"),null)}const On=["Leden","√önor","B≈ôezen","Duben","Kvƒõten","ƒåerven","ƒåervenec","Srpen","Z√°≈ô√≠","≈ò√≠jen","Listopad","Prosinec"],Vt=()=>e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M12 2L9 9l-7 3 7 3 3 7 3-7 7-3-7-3L12 2z"}),e.jsx("path",{d:"M22 12l-3 3-3-3"}),e.jsx("path",{d:"M12 22l3-3 3 3"})]}),Rn=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"3",width:"7",height:"7"}),e.jsx("rect",{x:"14",y:"3",width:"7",height:"7"}),e.jsx("rect",{x:"14",y:"14",width:"7",height:"7"}),e.jsx("rect",{x:"3",y:"14",width:"7",height:"7"})]}),En=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"8",y1:"6",x2:"21",y2:"6"}),e.jsx("line",{x1:"8",y1:"12",x2:"21",y2:"12"}),e.jsx("line",{x1:"8",y1:"18",x2:"21",y2:"18"}),e.jsx("line",{x1:"3",y1:"6",x2:"3.01",y2:"6"}),e.jsx("line",{x1:"3",y1:"12",x2:"3.01",y2:"12"}),e.jsx("line",{x1:"3",y1:"18",x2:"3.01",y2:"18"})]}),An=()=>e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"17 8 12 3 7 8"}),e.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),Ut=()=>e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"7 10 12 15 17 10"}),e.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),Ae=({size:t=16})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),e.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),e.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]}),Zt=({size:t=16})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"#3b82f6",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),e.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),e.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"}),e.jsx("circle",{cx:"18",cy:"18",r:"3",fill:"#3b82f6"}),e.jsx("path",{d:"M16.5 18l1 1 2-2",stroke:"white",strokeWidth:"1.5",fill:"none"})]}),In=()=>e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),Mn=()=>e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M19 21H5a2 2 0 0 1-2 2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"}),e.jsx("polyline",{points:"17 21 17 13 7 13 7 21"}),e.jsx("polyline",{points:"7 3 7 8 15 8"})]}),Wn=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"1"}),e.jsx("circle",{cx:"12",cy:"5",r:"1"}),e.jsx("circle",{cx:"12",cy:"19",r:"1"})]}),Vn=()=>e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"var(--warning-color)",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M12 9v2m0 4h.01"}),e.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"})]}),Un=()=>e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),Zn=()=>e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e.jsx("polyline",{points:"10 9 9 9 8 9"})]}),Ye=()=>e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),Hn=()=>e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10z"}),e.jsx("circle",{cx:"9",cy:"10",r:"1"}),e.jsx("circle",{cx:"15",cy:"10",r:"1"})]}),Kn=()=>e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polygon",{points:"23 7 16 12 23 17 23 7"}),e.jsx("rect",{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"})]}),Gn=()=>e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),Yn=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"3"}),e.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]}),qn=()=>e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),e.jsx("polyline",{points:"16 17 21 12 16 7"}),e.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]}),He=({status:t="pending",isLoading:o=!1})=>{const n=()=>{if(o)return"#3b82f6";switch(t){case"success":return"#22c55e";case"error":return"#ef4444";case"pending":default:return"#6b7280"}},a=o?{animation:"spin 2s linear infinite",transformOrigin:"center"}:{};return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
                @keyframes spin {
                    from { transform: rotate(0deg); }
                    to { transform: rotate(360deg); }
                }
            `}),e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:n(),strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:a,children:[e.jsx("ellipse",{cx:"12",cy:"5",rx:"9",ry:"3"}),e.jsx("path",{d:"M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"}),e.jsx("path",{d:"M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"})]})]})},ct=t=>{if(!t)return"üè≥Ô∏è";const o=t.toLowerCase(),n={ƒçe≈°tina:"üá®üáø",sloven≈°tina:"üá∏üá∞",nƒõmƒçina:"üá©üá™",angliƒçtina:"üá¨üáß",francouz≈°tina:"üá´üá∑",≈°panƒõl≈°tina:"üá™üá∏",ital≈°tina:"üáÆüáπ",portugal≈°tina:"üáµüáπ",ru≈°tina:"üá∑üá∫",pol≈°tina:"üáµüá±",holand≈°tina:"üá≥üá±",≈°v√©d≈°tina:"üá∏üá™",nor≈°tina:"üá≥üá¥",d√°n≈°tina:"üá©üá∞",fin≈°tina:"üá´üáÆ",ƒç√≠n≈°tina:"üá®üá≥",japon≈°tina:"üáØüáµ",korej≈°tina:"üá∞üá∑",thaj≈°tina:"üáπüá≠",vietnam≈°tina:"üáªüá≥",hind≈°tina:"üáÆüá≥",arab≈°tina:"üá∏üá¶",hebrej≈°tina:"üáÆüá±",tureƒçtina:"üáπüá∑",per≈°tina:"üáÆüá∑",indon√©≈°tina:"üáÆüá©",beng√°l≈°tina:"üáßüá©",mongol≈°tina:"üá≤üá≥",nep√°l≈°tina:"üá≥üáµ",maƒèar≈°tina:"üá≠üá∫",rumun≈°tina:"üá∑üá¥",bulhar≈°tina:"üáßüá¨",chorvat≈°tina:"üá≠üá∑",srb≈°tina:"üá∑üá∏",slovin≈°tina:"üá∏üáÆ",bosen≈°tina:"üáßüá¶",makedon≈°tina:"üá≤üá∞",alb√°n≈°tina:"üá¶üá±",≈ôeƒçtina:"üá¨üá∑",loty≈°tina:"üá±üáª",litev≈°tina:"üá±üáπ",eston≈°tina:"üá™üá™",island≈°tina:"üáÆüá∏",ir≈°tina:"üáÆüá™",vel≈°tina:"üè¥Û†ÅßÛ†Å¢Û†Å∑Û†Å¨Û†Å≥Û†Åø",malt≈°tina:"üá≤üáπ",lucembur≈°tina:"üá±üá∫",ukrajin≈°tina:"üá∫üá¶",bƒõloru≈°tina:"üáßüáæ",moldav≈°tina:"üá≤üá©",gruz√≠n≈°tina:"üá¨üá™",arm√©n≈°tina:"üá¶üá≤",√°zerb√°jd≈æ√°n≈°tina:"üá¶üáø",kaza≈°tina:"üá∞üáø",kyrgyz≈°tina:"üá∞üá¨",uzbeƒçtina:"üá∫üáø",t√°d≈æiƒçtina:"üáπüáØ",tatar≈°tina:"üá∑üá∫",katal√°n≈°tina:"üá™üá∏",baskiƒçtina:"üá™üá∏",galicij≈°tina:"üá™üá∏",breton≈°tina:"üá´üá∑",sard√≠n≈°tina:"üáÆüáπ",latinƒçina:"üáªüá¶",jidi≈°:"üáÆüá±"};if(n[o])return n[o];for(const[a,s]of Object.entries(n))if(o.includes(a.substring(0,4))||a.includes(o.substring(0,4)))return s;return"üè≥Ô∏è"},Jn=t=>t?new Date(t).toLocaleDateString("cs-CZ"):"N/A",Xn=t=>t?t<1024?`${t} KB`:`${(t/1024).toFixed(2)} MB`:"0 KB",Qn=t=>t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w.-]/g,"_").replace(/_{2,}/g,"_");console.log("‚úÖ Pou≈æ√≠v√°m centr√°ln√≠ Supabase klient z /src/lib/supabase.ts");console.log("‚úÖ Supabase client inicializov√°n");(async()=>{try{console.log("üß™ Testov√°n√≠ p≈ôipojen√≠ k Supabase...");const{data:t,error:o}=await F.from("books").select("count").limit(1);o?console.error("‚ùå Supabase p≈ôipojen√≠ selhalo:",o):console.log("‚úÖ Supabase p≈ôipojen√≠ √∫spƒõ≈°n√©!")}catch(t){console.error("‚ùå Supabase test exception:",t)}})();const lt=t=>{if(!t)return[];if(Array.isArray(t))return t;if(typeof t=="string"){const o=t.trim();if(o.startsWith("[")&&o.endsWith("]"))try{const n=JSON.parse(o);return Array.isArray(n)?n:[]}catch(n){return console.error("Failed to parse JSON array string:",t,n),[]}if(o.startsWith("{")&&o.endsWith("}")){const n=o.slice(1,-1);return n===""?[]:n.split(",").map(a=>a.trim().replace(/^"|"$/g,""))}}return[]},Ge=t=>(console.log("üîÑ mapSupabaseToBook - OCR z DB:",t.OCR,"pro knihu:",t.title),{id:t.id,title:t.title,author:t.author||"Nezn√°m√Ω",publicationYear:t.publication_year,publisher:t.publisher||"",summary:t.summary||"",keywords:lt(t.keywords),language:t.language||"ƒçe≈°tina",format:t.format,fileSize:t.file_size,coverImageUrl:t.cover_image_url,publicationTypes:lt(t.publication_types),labels:lt(t.labels),categories:lt(t.categories),releaseVersion:t.releaseVersion||"",dateAdded:t.created_at,filePath:t.file_path,content:"",vectorStatus:t.Vdtb||"pending",hasOCR:t.OCR||!1,vectorAddedAt:t.vector_added_at||void 0,metadataSnapshot:t.metadata_snapshot||void 0,qdrantLocalStatus:t.qdrant_local_status||"none",qdrantCloudStatus:t.qdrant_cloud_status||"none",supabaseVectorStatus:t.supabase_vector_status||"none",vectorUploadDetails:t.vector_upload_details||void 0,lastVectorUploadAt:t.last_vector_upload_at||void 0}),oe={async getBooks(){var o;const t=Math.random().toString(36).substring(7);console.log(`üìö [${t}] Naƒç√≠t√°m knihy z datab√°ze...`);try{console.log(`[${t}] üîç Metoda 1: Zkou≈°√≠m Supabase client...`);const n=Date.now(),a=await fetch(`${Oe}/rest/v1/books?select=*&order=created_at.desc`,{headers:{apikey:$e,Authorization:`Bearer ${$e}`,"Content-Type":"application/json"}}),s=Date.now();if(console.log(`[${t}] ‚úÖ REST API odpovƒõƒè za ${s-n}ms, status: ${a.status}`),!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const c=await a.json();console.log(`[${t}] ‚úÖ Naƒçteno ${c.length} knih z datab√°ze`),c.length>0&&console.log(`[${t}] Prvn√≠ kniha:`,{id:c[0].id,title:c[0].title});const l=c.map(Ge);return console.log(`[${t}] üìã Mapov√°no ${l.length} knih`),console.log(`[${t}] üéâ getBooks √∫spƒõ≈°nƒõ dokonƒçen`),l}catch(n){throw console.error(`[${t}] ‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ knih:`,{name:n.name,message:n.message,stack:(o=n.stack)==null?void 0:o.substring(0,200)}),n}},async callDeleteWebhook(t){const o="https://n8n.srv980546.hstgr.cloud/webhook/e871e7d6-ca10-4b9d-adc4-3b58ee2f8279";try{console.log(`üîó Vol√°m N8N webhook pro smaz√°n√≠ knihy: ${t}`);const n=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_id:t})});if(!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);const a=await n.text();return console.log("‚úÖ N8N webhook √∫spƒõ≈°nƒõ zavol√°n:",a),{success:!0,message:"N8N webhook √∫spƒõ≈°nƒõ zavol√°n"}}catch(n){return console.error("‚ùå Chyba p≈ôi vol√°n√≠ N8N webhook≈Ø:",n),{success:!1,message:`Chyba p≈ôi vol√°n√≠ N8N webhook≈Ø: ${n instanceof Error?n.message:"Nezn√°m√° chyba"}`}}},async callBulkDeleteWebhooks(t){const o="https://n8n.srv980546.hstgr.cloud/webhook/ae6f98d7-53a8-40b2-9d24-ca2ddf7c82de";console.log(`üîó Vol√°m N8N webhooky pro hromadn√© smaz√°n√≠ ${t.length} knih`);const n=t.map(async a=>{try{const s=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a,action:"delete",timestamp:new Date().toISOString()})});if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);return console.log(`‚úÖ N8N webhook √∫spƒõ≈°nƒõ zavol√°n pro knihu: ${a}`),{bookId:a,success:!0,error:null}}catch(s){return console.error(`‚ùå Chyba p≈ôi vol√°n√≠ N8N webhook≈Ø pro knihu ${a}:`,s),{bookId:a,success:!1,error:s instanceof Error?s.message:"Nezn√°m√° chyba"}}});try{const a=await Promise.allSettled(n);let s=0,c=0;a.forEach(g=>{g.status==="fulfilled"&&g.value.success?s++:c++});const l=`Hromadn√© vol√°n√≠ webhook≈Ø dokonƒçeno: ${s} √∫spƒõ≈°n√Ωch, ${c} ne√∫spƒõ≈°n√Ωch`;return console.log(`üîó ${l}`),{success:c===0,message:l,successCount:s,failureCount:c}}catch(a){return console.error("‚ùå Neoƒçek√°van√° chyba p≈ôi hromadn√©m vol√°n√≠ webhook≈Ø:",a),{success:!1,message:`Neoƒçek√°van√° chyba p≈ôi hromadn√©m vol√°n√≠ webhook≈Ø: ${a instanceof Error?a.message:"Nezn√°m√° chyba"}`,successCount:0,failureCount:t.length}}},async updateBook(t){const o={title:t.title,author:t.author,publication_year:t.publicationYear,publisher:t.publisher,summary:t.summary,keywords:t.keywords,language:t.language,format:t.format,file_size:t.fileSize,cover_image_url:t.coverImageUrl,publication_types:t.publicationTypes,labels:t.labels,categories:t.categories,file_path:t.filePath,OCR:t.hasOCR,Vdtb:t.vectorStatus,...t.releaseVersion&&{releaseVersion:t.releaseVersion},...t.vectorAddedAt!==void 0&&{vector_added_at:t.vectorAddedAt},...t.metadataSnapshot!==void 0&&{metadata_snapshot:t.metadataSnapshot}},{data:n,error:a}=await F.from("books").update(o).eq("id",t.id).select().single();if(a)throw console.error("Error updating book:",a.message,a),a;if(!n)throw new Error("Book not found after update.");return Ge(n)},async deleteBook(t,o,n,a){const s=[];if(o)try{console.log(`üñºÔ∏è Maz√°n√≠ cover obr√°zku pro knihu: ${t}`),console.log(`File path: ${o}`);const g=`covers/covers/${o.replace(/\.[^/.]+$/,"")}.jpg`;console.log(`Attempting to delete cover: ${g} from Books bucket`);const{error:m}=await F.storage.from("Books").remove([g]);m?(console.error("COVER DELETE FAILED:",m),s.push(`Nepoda≈ôilo se smazat cover obr√°zek: ${m.message}`)):console.log(`‚úÖ Cover deleted successfully from Books bucket: ${g}`)}catch(l){console.error("Could not delete cover image:",l),s.push(`Chyba p≈ôi maz√°n√≠ cover obr√°zku: ${l}`)}if(o)try{const{error:l}=await F.storage.from("Books").remove([o]);l&&(console.error("STORAGE DELETE FAILED:",l),s.push(`Nepoda≈ôilo se smazat soubor z √∫lo≈æi≈°tƒõ: ${l.message}`))}catch(l){console.error("STORAGE DELETE ERROR:",l),s.push(`Chyba p≈ôi maz√°n√≠ souboru: ${l}`)}try{console.log("üóëÔ∏è Maz√°n√≠ z Supabase vektorov√© datab√°ze public.documents pro knihu:",t);const{error:l}=await F.rpc("delete_documents_by_file_id",{file_id:t});l?(console.error("SUPABASE DOCUMENTS DELETE FAILED:",l),s.push(`Nepoda≈ôilo se smazat z public.documents: ${l.message}`)):console.log("‚úÖ √öspƒõ≈°nƒõ smaz√°no z Supabase public.documents")}catch(l){console.error("SUPABASE DOCUMENTS DELETE ERROR:",l),s.push(`Chyba p≈ôi maz√°n√≠ z Supabase documents: ${l}`)}try{console.log(`üñºÔ∏è Maz√°n√≠ obr√°zk≈Ø pro knihu: ${t}`);const l=`main/production/${t}`;console.log(`üóÇÔ∏è Attempting to delete image folder: ${l} from images bucket`);try{const{data:g,error:m}=await F.storage.from("images").list(l,{limit:1e3});if(console.log(`üìã List result - Error: ${(m==null?void 0:m.message)||"none"}, Files found: ${(g==null?void 0:g.length)||0}`),!m&&g&&g.length>0){const u=g.map(x=>`${l}/${x.name}`);console.log(`üóëÔ∏è Found ${u.length} files to delete:`,u);const{error:y}=await F.storage.from("images").remove(u);y?(console.error("‚ùå IMAGE FILES DELETE FAILED:",y),s.push(`Nepoda≈ôilo se smazat obr√°zky: ${y.message}`)):console.log(`‚úÖ Successfully deleted ${u.length} images from ${l}`)}else console.log(m?`üìÅ Folder not found or error: ${l} - ${m.message}`:`üìÅ No images found in folder: ${l}`)}catch(g){console.error(`üìÅ Error accessing folder ${l}:`,g),s.push(`Chyba p≈ôi p≈ô√≠stupu ke slo≈æce obr√°zk≈Ø: ${g}`)}}catch(l){console.error("Could not delete image folder:",l),s.push(`Chyba p≈ôi maz√°n√≠ slo≈æky obr√°zk≈Ø: ${l}`)}let c=!1;try{const{error:l}=await F.from("books").delete().eq("id",t);l?(console.error("DATABASE DELETE FAILED:",l),s.push(`Nepoda≈ôilo se smazat z√°znam z datab√°ze: ${l.message}`)):(console.log("Book record deleted successfully from database"),c=!0)}catch(l){console.error("DATABASE DELETE ERROR:",l),s.push(`Chyba p≈ôi maz√°n√≠ z√°znamu z datab√°ze: ${l}`)}if(c)try{const l=await oe.callDeleteWebhook(t);l.success?console.log("‚úÖ N8N webhook √∫spƒõ≈°nƒõ zavol√°n"):(console.warn("N8N webhook se nepoda≈ôilo zavolat:",l.message),s.push(`Varov√°n√≠ - N8N webhook: ${l.message}`))}catch(l){console.error("N8N WEBHOOK ERROR:",l),s.push(`Chyba p≈ôi vol√°n√≠ N8N webhook≈Ø: ${l}`)}s.length>0&&console.warn("Delete operation completed with warnings:",s)},async uploadFile(t,o="Books"){const n=Qn(t.name),a=`${Date.now()}-${n}`,{error:s}=await F.storage.from(o).upload(a,t,{upsert:!0});if(s)throw console.error(`Error uploading file to bucket ${o}:`,s.message,s),s.message.includes("Unauthorized")||s.message.includes("row-level security")?new Error(`Probl√©m s opr√°vnƒõn√≠mi pro nahr√°v√°n√≠ do ${o}. Kontaktujte administr√°tora.`):s;const c=Math.max(1,Math.round(t.size/1024));return{filePath:a,fileSize:c}},async uploadFileWithId(t,o,n){const a=t.name.split(".").pop()||"";let s;o==="covers"?s=`${n}.jpg`:o==="Books"&&t.type.startsWith("image/")?s=`covers/${n}.jpg`:n.startsWith("covers/")?s=`covers/${n.replace("covers/","")}.jpg`:s=`${n}.${a}`,console.log(`Uploading to bucket '${o}' with path: ${s}`);const{error:c}=await F.storage.from(o).upload(s,t,{upsert:!0});if(c)throw console.error(`Error uploading file to bucket ${o}:`,c.message,c),c.message.includes("Unauthorized")||c.message.includes("row-level security")?new Error(`Probl√©m s opr√°vnƒõn√≠mi pro nahr√°v√°n√≠ do ${o}. Kontaktujte administr√°tora.`):c;console.log(`Successfully uploaded to ${o}/${s}`);const l=Math.max(1,Math.round(t.size/1024));return{filePath:s,fileSize:l}},async createBook(t){console.log("üíæ API createBook - vstupn√≠ OCR stav:",t.hasOCR);const o={title:t.title,author:t.author,publication_year:t.publicationYear,publisher:t.publisher,summary:t.summary,keywords:t.keywords,language:t.language,format:t.format,file_size:t.fileSize,cover_image_url:t.coverImageUrl,publication_types:t.publicationTypes,labels:t.labels,categories:t.categories,file_path:t.filePath,OCR:t.hasOCR,Vdtb:t.vectorStatus||"pending",...t.releaseVersion&&{releaseVersion:t.releaseVersion},...t.vectorAddedAt&&{vector_added_at:t.vectorAddedAt},...t.metadataSnapshot&&{metadata_snapshot:t.metadataSnapshot}};console.log("üíæ Ukl√°d√°m do Supabase s OCR:",o.OCR);const{data:n,error:a}=await F.from("books").insert(o).select().single();if(a)throw console.error("Error creating book:",a.message,a),a.message.includes("row-level security")||a.message.includes("violates")?new Error("Probl√©m s datab√°zov√Ωmi opr√°vnƒõn√≠mi. Aplikace pot≈ôebuje spr√°vn√© nastaven√≠ RLS politik v Supabase."):a;if(!n)throw new Error("Failed to create book.");return Ge(n)},async getFileContent(t){if(!t)return"Soubor pro tuto knihu nebyl nalezen.";try{const{data:o,error:n}=await F.storage.from("Books").download(t);if(n)throw console.error("Error downloading file content:",n.message,n),n;return o?t.toLowerCase().split(".").pop()==="pdf"?(console.log("üîç Detekov√°n PDF soubor - spou≈°t√≠m inteligentn√≠ anal√Ωzu..."),await this.extractPdfTextContent(o)):await o.text():"Nepoda≈ôilo se naƒç√≠st obsah souboru: soubor je pr√°zdn√Ω."}catch(o){return console.error("Failed to read file content:",o.message,o),`Nepoda≈ôilo se zpracovat obsah souboru: ${o.message}`}},async detectOCRFromStorage(t){if(!t)return!1;try{console.log("üîç Detekuji OCR ze storage pro soubor:",t);const{data:o,error:n}=await F.storage.from("Books").download(t);if(n)return console.error("‚ùå Chyba p≈ôi stahov√°n√≠ souboru pro OCR detekci:",n),!1;if(!o)return console.error("‚ùå Soubor je pr√°zdn√Ω"),!1;const a=t.toLowerCase().split(".").pop();return a==="pdf"?(console.log("üìÑ Analyzuji PDF soubor pro OCR..."),await this.detectOCRFromPDF(o)):a==="epub"?(console.log("üìö EPUB soubory obvykle obsahuj√≠ text"),!0):["txt","doc","docx","rtf"].includes(a||"")?(console.log("üìù Textov√© soubory obsahuj√≠ text"),!0):(console.log("‚ùì Nezn√°m√Ω form√°t, p≈ôedpokl√°d√°m ≈æe neobsahuje OCR"),!1)}catch(o){return console.error("‚ùå Chyba p≈ôi detekci OCR:",o.message),!1}},async detectOCRFromPDF(t){try{const o=await t.arrayBuffer(),a=await pdfjsLib.getDocument(o).promise;console.log(`üìÑ PDF m√° ${a.numPages} str√°nek, kontroluji OCR...`);const s=Math.min(a.numPages,3);let c=0,l="";for(let u=1;u<=s;u++)try{const x=await(await a.getPage(u)).getTextContent();console.log(`üìÑ Str√°nka ${u}: Nalezeno ${x.items.length} textov√Ωch objekt≈Ø`);let i="";x.items.forEach((f,z)=>{let D="";f.str!==void 0?D=String(f.str):f.text!==void 0?D=String(f.text):f.chars!==void 0?D=String(f.chars):typeof f=="string"&&(D=f),D&&D.trim().length>0&&(i+=D+" ",console.log(`   Polo≈æka ${z+1}: "${D.substring(0,50)}${D.length>50?"...":""}"`))}),i=i.trim(),l+=i+" ",c+=i.length,console.log(`üìù Str√°nka ${u} celkem: ${i.length} znak≈Ø`),i.length>0&&console.log(`üìù Text str√°nky ${u}: "${i.substring(0,200)}${i.length>200?"...":""}"`)}catch(y){console.warn(`‚ö†Ô∏è Chyba p≈ôi zpracov√°n√≠ str√°nky ${u}:`,y)}if(c===0){console.log("üîÑ ≈Ω√°dn√Ω text nenalezen standardn√≠ metodou, zkou≈°√≠m alternativn√≠ p≈ô√≠stup...");try{for(let u=1;u<=Math.min(a.numPages,2);u++){const x=await(await a.getPage(u)).getOperatorList();console.log(`üìÑ Str√°nka ${u}: Nalezeno ${x.fnArray.length} operac√≠`);for(let i=0;i<x.fnArray.length;i++){const f=x.fnArray[i],z=x.argsArray[i];(f===84||f===85||f===82)&&z&&z.length>0&&typeof z[0]=="string"&&(console.log(`üî§ Nalezen text oper√°torem: "${z[0].substring(0,50)}"`),l+=z[0]+" ",c+=z[0].length)}}}catch(u){console.warn("‚ö†Ô∏è Alternativn√≠ metoda selhala:",u)}}const g=l.trim(),m=g.length>10;return console.log(`‚úÖ OCR detekce dokonƒçena: ${m?"NALEZEN":"NENALEZEN"}`),console.log(`üìä Celkem extrahov√°no: ${c} znak≈Ø`),g.length>0&&console.log(`üìù Uk√°zka extrahovan√©ho textu: "${g.substring(0,300)}${g.length>300?"...":""}"`),m}catch(o){return console.error("‚ùå Chyba p≈ôi anal√Ωze PDF pro OCR:",o),!1}},async extractPdfTextContent(t){console.log("üöÄ SPOU≈†T√çM NOV√ù OCR PROCES...");try{const o=await t.arrayBuffer();console.log("üì¶ PDF naƒçten, velikost:",Math.round(o.byteLength/1024),"KB");const a=await pdfjsLib.getDocument(o).promise;console.log(`üìÑ PDF √∫spƒõ≈°nƒõ naƒçten - ${a.numPages} str√°nek`);const s=50,c=15e4,l=Math.min(a.numPages,s);let g="",m=0;console.log(`üîÑ Zaƒç√≠n√°m extrakci textu z ${l} str√°nek...`);for(let y=1;y<=l;y++)try{const z=(await(await a.getPage(y)).getTextContent()).items.filter(D=>"str"in D&&D.str.trim().length>0).map(D=>D.str).join(" ").trim();if(z.length>0){if(g+=`

=== STR√ÅNKA ${y} ===
${z}`,m+=z.length,console.log(`üìÉ Str√°nka ${y}: ${z.length} znak≈Ø (celkem: ${m})`),m>c){g=g.substring(0,c)+`

... [TEXT ZKR√ÅCEN] ...`,console.log(`‚úÇÔ∏è Text zkr√°cen na ${c} znak≈Ø na str√°nce ${y}`);break}}else console.log(`üìÉ Str√°nka ${y}: pr√°zdn√° nebo bez textu`)}catch(x){console.error(`‚ùå Chyba p≈ôi zpracov√°n√≠ str√°nky ${y}:`,x);continue}const u=g.trim();return u.length>50?(console.log(`‚úÖ √öSPƒöCH! Extrahov√°no ${u.length} znak≈Ø z ${l} str√°nek`),console.log(`üìä Prvn√≠ 200 znak≈Ø: "${u.substring(0,200)}..."`),u):(console.log(`‚ùå NE√öSPƒöCH! Extrahov√°no pouze ${u.length} znak≈Ø`),this.createNoTextResponse(a,u.length))}catch(o){return console.error("üí• KRITICK√Å CHYBA p≈ôi OCR:",o),`CHYBA p≈ôi zpracov√°n√≠ PDF: ${o instanceof Error?o.message:String(o)}`}},createNoTextResponse(t,o){return console.log("üìã Vytv√°≈ô√≠m struktur√°ln√≠ odpovƒõƒè - PDF neobsahuje dostatek textu"),`‚ùå PDF NEOBSAHUJE DOSTATEƒåN√ù TEXT PRO AI ANAL√ùZU

üìä Informace o dokumentu:
‚Ä¢ Poƒçet str√°nek: ${t.numPages}
‚Ä¢ Nalezeno znak≈Ø: ${o}
‚Ä¢ Po≈æadov√°no: minim√°lnƒõ 50 znak≈Ø

üîß Mo≈æn√° ≈ôe≈°en√≠:
1. PDF je naskenovan√Ω obr√°zek bez OCR vrstvy
2. Pou≈æijte OCR n√°stroj pro p≈ôevod obr√°zk≈Ø na text
3. Nahrajte PDF s textovou vrstvou
4. Zkontrolujte kvalitu skenov√°n√≠

‚ö†Ô∏è Bez ƒçiteln√©ho textu nelze prov√©st AI anal√Ωzu obsahu.`},async sendToVectorDatabase(t,o=!1,n=!1){var s,c;const a="https://n8n.srv980546.hstgr.cloud/webhook/10f5ed9e-e0b1-465d-8bc8-b2ba9a37bc58";try{await oe.updateBook({...t,vectorStatus:"pending"}),console.log("üì§ Stahuji soubor z Supabase storage...");const{data:l,error:g}=await F.storage.from("Books").download(t.filePath);if(g||!l)throw new Error(`Nepoda≈ôilo se st√°hnout soubor: ${g==null?void 0:g.message}`);if(console.log("‚úÖ Soubor st√°≈æen, velikost:",l.size,"bytes"),t.format.toLowerCase()==="pdf"&&!n){console.log("üìÑ Kontroluji poƒçet str√°nek PDF p≈ôed odesl√°n√≠m do VDB...");try{const u=Fn();if(!u)console.warn("‚ö†Ô∏è PDF.js nen√≠ dostupn√Ω, p≈ôeskakuji kontrolu poƒçtu str√°nek");else{const y=await l.arrayBuffer(),f=(await u.getDocument(y).promise).numPages;if(console.log(`üìä PDF m√° ${f} str√°nek`),f>1e3){console.warn(`‚ö†Ô∏è PDF m√° ${f} str√°nek, co≈æ je v√≠ce ne≈æ doporuƒçen√Ω limit 1000 str√°nek!`),await oe.updateBook({...t,vectorStatus:"none"});const z=new Error("LARGE_PDF_WARNING");throw z.pageCount=f,z.book=t,z}}}catch(u){if(u.message==="LARGE_PDF_WARNING")throw u;console.warn("‚ö†Ô∏è Nepoda≈ôilo se zkontrolovat poƒçet str√°nek PDF:",u)}}const m=new FormData;if(m.append("file",l,t.filePath.split("/").pop()||"unknown.pdf"),m.append("bookId",t.id),m.append("fileName",t.filePath.split("/").pop()||"unknown.pdf"),m.append("fileType",t.format.toLowerCase()),m.append("id",t.id),m.append("title",t.title),m.append("author",t.author),m.append("publicationYear",((s=t.publicationYear)==null?void 0:s.toString())||""),m.append("publisher",t.publisher||""),m.append("summary",t.summary||""),m.append("language",t.language||""),m.append("releaseVersion",t.releaseVersion||""),m.append("format",t.format),m.append("fileSize",((c=t.fileSize)==null?void 0:c.toString())||"0"),t.keywords&&t.keywords.length>0&&t.keywords.forEach(u=>{m.append("keywords[]",u)}),t.categories&&t.categories.length>0&&t.categories.forEach(u=>{m.append("categories[]",u)}),t.labels&&t.labels.length>0&&t.labels.forEach(u=>{m.append("labels[]",u)}),t.publicationTypes&&t.publicationTypes.length>0&&t.publicationTypes.forEach(u=>{m.append("publicationTypes[]",u)}),console.log("üì¶ FormData p≈ôipraven s bin√°rn√≠m souborem a strukturovan√Ωmi metadaty:",{bookId:t.id,fileName:t.filePath.split("/").pop(),fileType:t.format.toLowerCase(),fileSize:l.size,title:t.title,author:t.author,"keywords[]":t.keywords,"categories[]":t.categories,"labels[]":t.labels,"publicationTypes[]":t.publicationTypes}),o){console.log("‚è≥ Odes√≠l√°m webhook a ƒçek√°m na odpovƒõƒè (timeout 5 minut)...");const u=new AbortController,y=setTimeout(()=>{u.abort()},300*1e3);try{const x=await fetch(a,{method:"POST",body:m,signal:u.signal});if(clearTimeout(y),!x.ok){const H=await x.text();throw new Error(`HTTP ${x.status}: ${H||x.statusText}`)}let i=null;const f=await x.text();if(console.log("üì• Webhook raw odpovƒõƒè:",f),f&&f.trim().length>0)try{i=JSON.parse(f),console.log("‚úÖ Webhook odpovƒõƒè parsov√°na:",i),console.log("üìä Typ odpovƒõdi:",typeof i,"Array?",Array.isArray(i),"D√©lka:",i==null?void 0:i.length)}catch(H){console.warn("‚ö†Ô∏è Nepoda≈ôilo se parsovat JSON odpovƒõƒè:",H),console.warn("‚ö†Ô∏è Raw text:",f)}else console.log("‚ö†Ô∏è Webhook vr√°til pr√°zdnou odpovƒõƒè");let z="none",D="none",Z="none",N="",W="",w="",q="error",O="";if(!i||f.trim().length===0)q="error",O="‚ùå Webhook vr√°til pr√°zdnou odpovƒõƒè. Zkontrolujte n8n workflow a ujistƒõte se, ≈æe vrac√≠ validn√≠ JSON odpovƒõƒè.";else if(Array.isArray(i)&&i.length>=2){console.log("üîç Parsov√°n√≠ pole objekt≈Ø z N8N...");const H=i.filter(ne=>ne.hasOwnProperty("qdrant_ok")),te=i.find(ne=>ne.hasOwnProperty("supabase_ok"));console.log("üóÑÔ∏è Qdrant results:",H),console.log("üóÑÔ∏è Supabase result:",te),H.length>=1&&(z=H[0].qdrant_ok===!0?"success":"error",N=H[0].qdrant_error||"",console.log("‚úÖ Qdrant Local status:",z,"Error:",N)),H.length>=2&&(D=H[1].qdrant_ok===!0?"success":"error",W=H[1].qdrant_error||"",console.log("‚úÖ Qdrant Cloud status:",D,"Error:",W)),te&&(Z=te.supabase_ok===!0?"success":"error",w=te.supabase_error||"",console.log("‚úÖ Supabase Vector status:",Z,"Error:",w));const v=z==="success"&&D==="success";q=v?"success":"error",console.log("üîç Vyhodnocen√≠ celkov√©ho statusu:"),console.log("  - Qdrant Local:",z),console.log("  - Qdrant Cloud:",D),console.log("  - Supabase Vector:",Z),console.log("  - Obƒõ Qdranty OK:",v),console.log("  - Celkov√Ω vectorStatus:",q),v?O="‚úÖ Soubor √∫spƒõ≈°nƒõ nahr√°n do obou Qdrant≈Ø":(O=`‚ùå Nahr√°n√≠ do nƒõkter√© datab√°ze selhalo:
`,z==="error"&&(O+=`- Qdrant Local: ${N||"Chyba"}
`),D==="error"&&(O+=`- Qdrant Cloud: ${W||"Chyba"}
`))}else console.log("‚ö†Ô∏è Neoƒçek√°van√Ω form√°t odpovƒõdi, pou≈æ√≠v√°m fallback. result.success:",i.success),q=i.success?"success":"error",O=i.message||(i.success?"√öspƒõ≈°nƒõ nahr√°no do vektorov√© datab√°ze":"Chyba p≈ôi nahr√°v√°n√≠ do vektorov√© datab√°ze");let X={...t,vectorStatus:q};if(q==="success"){const H={title:t.title,author:t.author,publicationYear:t.publicationYear,publisher:t.publisher,summary:t.summary,keywords:t.keywords,language:t.language,format:t.format,fileSize:t.fileSize,coverImageUrl:t.coverImageUrl,publicationTypes:t.publicationTypes,labels:t.labels,categories:t.categories,releaseVersion:t.releaseVersion},te=JSON.stringify(H);X={...X,vectorAddedAt:new Date().toISOString(),metadataSnapshot:te},console.log("üì∏ Vytvo≈ôen snapshot metadat pro detekci zmƒõn:",H),console.log("üì∏ Snapshot JSON:",te)}try{console.log("üîÑ Aktualizuji statusy jednotliv√Ωch datab√°z√≠ v books tabulce...");const H={Vdtb:q,qdrant_local_status:z,qdrant_cloud_status:D,supabase_vector_status:Z,vector_upload_details:i,last_vector_upload_at:new Date().toISOString()};if(q==="success"){const ne={title:t.title,author:t.author,publicationYear:t.publicationYear,publisher:t.publisher,summary:t.summary,keywords:t.keywords,language:t.language,format:t.format,fileSize:t.fileSize,coverImageUrl:t.coverImageUrl,publicationTypes:t.publicationTypes,labels:t.labels,categories:t.categories,releaseVersion:t.releaseVersion};H.vector_added_at=new Date().toISOString(),H.metadata_snapshot=JSON.stringify(ne),console.log("üì∏ Vytvo≈ôen snapshot metadat pro detekci zmƒõn")}const{data:te,error:v}=await F.from("books").update(H).eq("id",t.id).select().single();if(v)throw console.error("‚ùå Chyba p≈ôi aktualizaci status≈Ø v datab√°zi:",v),v;console.log("‚úÖ Statusy √∫spƒõ≈°nƒõ aktualizov√°ny v datab√°zi"),console.log("‚úÖ Aktualizovan√° data:",te),X=Ge(te)}catch(H){console.warn("‚ö†Ô∏è Webhook byl √∫spƒõ≈°n√Ω, ale nepoda≈ôilo se aktualizovat status v datab√°zi:",H)}return{success:q==="success",message:O,details:i}}catch(x){throw clearTimeout(y),x instanceof Error&&x.name==="AbortError"?new Error("‚è∞ Timeout: Webhook neodpovƒõdƒõl do 5 minut. Zkuste to pozdƒõji nebo kontaktujte administr√°tora."):x}}else return console.log("üöÄ Odes√≠l√°m webhook bez ƒçek√°n√≠ na odpovƒõƒè (fire-and-forget)..."),fetch(a,{method:"POST",body:m}).catch(u=>{console.error("‚ö†Ô∏è Chyba p≈ôi odes√≠l√°n√≠ fire-and-forget webhoku (ignorov√°no):",u)}),{success:!0,message:"Po≈æadavek odesl√°n do fronty na zpracov√°n√≠"}}catch(l){if(l.message==="LARGE_PDF_WARNING")throw l;console.error("Chyba p≈ôi odes√≠l√°n√≠ do vektorov√© datab√°ze:",l);try{await oe.updateBook({...t,vectorStatus:"error"})}catch(g){console.error("Chyba p≈ôi aktualizaci statusu:",g)}return{success:!1,message:`Chyba: ${l instanceof Error?l.message:"Nezn√°m√° chyba"}`}}},async sendTextOnlyToVectorDatabase(t,o=!1){var a,s;const n="https://n8n.srv980546.hstgr.cloud/webhook/10f5ed9e-e0b1-465d-8bc8-b2ba9a37bc58";try{await oe.updateBook({...t,vectorStatus:"pending"}),console.log("üìÑ P≈ôipravuji text-only data pro vektorovou datab√°zi...");const c=`extracted_text_${t.id}`;let l=localStorage.getItem(c);if(!l||l.trim().length===0){console.log("üì• Text nen√≠ v mezipamƒõti, spou≈°t√≠m LOK√ÅLN√ç extrakci z PDF...");try{const{data:x,error:i}=await F.storage.from("Books").download(t.filePath);if(i||!x)throw new Error(`Nepoda≈ôilo se st√°hnout soubor: ${i==null?void 0:i.message}`);console.log("üìÑ PDF sta≈æeno, velikost:",x.size,"bytes"),console.log("üîç DEBUG fileData:",{size:x.size,type:x.type,constructor:x.constructor.name});const f=new File([x],t.filePath.split("/").pop()||"document.pdf",{type:"application/pdf"});console.log("üîç DEBUG pdfFile p≈ôed extrakc√≠:",{name:f.name,size:f.size,type:f.type});const z=await Kt(f);console.log("üîç DEBUG txtFile po extrakci:",{name:z.name,size:z.size,type:z.type}),l=await z.text(),console.log("‚úÖ Text extrahov√°n lok√°lnƒõ:",l.length,"znak≈Ø"),console.log("üîç DEBUG prvn√≠ch 500 znak≈Ø textu:"),console.log(l.substring(0,500)),localStorage.setItem(c,l),localStorage.setItem(`${c}_timestamp`,Date.now().toString()),console.log("üíæ Text ulo≈æen do mezipamƒõti")}catch(x){throw new Error(`Nepoda≈ôilo se extrahovat text: ${x instanceof Error?x.message:"Nezn√°m√° chyba"}`)}}else console.log("‚úÖ Pou≈æ√≠v√°m text z mezipamƒõti:",l.length,"znak≈Ø");if(!l||l.trim().length===0)throw new Error("Extrahovan√Ω text je pr√°zdn√Ω. PDF pravdƒõpodobnƒõ neobsahuje ƒçiteln√Ω text.");const g=new Blob([l],{type:"text/plain; charset=utf-8"}),m=((a=t.filePath.split("/").pop())==null?void 0:a.replace(/\.(pdf|PDF)$/i,".txt"))||`${t.title}.txt`;console.log("üìÑ Vytvo≈ôen TXT soubor:",m,"Velikost:",g.size,"bytes"),console.log("üîç DEBUG txtBlob:",{size:g.size,type:g.type});const u=await g.slice(0,200).text();console.log("üîç DEBUG prvn√≠ch 200 bajt≈Ø txtBlob:"),console.log(u);const y=new FormData;if(y.append("file",g,m),y.append("bookId",t.id),y.append("fileName",m),y.append("fileType","txt"),y.append("contentType","text"),y.append("id",t.id),y.append("title",t.title),y.append("author",t.author),y.append("publicationYear",((s=t.publicationYear)==null?void 0:s.toString())||""),y.append("publisher",t.publisher||""),y.append("summary",t.summary||""),y.append("language",t.language||""),y.append("releaseVersion",t.releaseVersion||""),y.append("format","TXT"),y.append("fileSize",g.size.toString()),t.keywords&&t.keywords.length>0&&t.keywords.forEach(x=>{y.append("keywords[]",x)}),t.categories&&t.categories.length>0&&t.categories.forEach(x=>{y.append("categories[]",x)}),t.labels&&t.labels.length>0&&t.labels.forEach(x=>{y.append("labels[]",x)}),t.publicationTypes&&t.publicationTypes.length>0&&t.publicationTypes.forEach(x=>{y.append("publicationTypes[]",x)}),console.log("üì¶ FormData p≈ôipraven s TXT souborem a metadaty:",{bookId:t.id,fileName:m,fileType:"txt",contentType:"text",fileSize:g.size,title:t.title,author:t.author}),o){console.log("‚è≥ Odes√≠l√°m webhook (text-only) a ƒçek√°m na odpovƒõƒè (timeout 5 minut)...");const x=new AbortController,i=setTimeout(()=>{x.abort()},300*1e3);try{const f=await fetch(n,{method:"POST",body:y,signal:x.signal});if(clearTimeout(i),!f.ok){const v=await f.text();throw new Error(`HTTP ${f.status}: ${v||f.statusText}`)}let z=null;const D=await f.text();if(console.log("üì• Webhook raw odpovƒõƒè (text-only):",D),D&&D.trim().length>0)try{z=JSON.parse(D),console.log("‚úÖ Webhook odpovƒõƒè parsov√°na:",z)}catch(v){console.warn("‚ö†Ô∏è Nepoda≈ôilo se parsovat JSON odpovƒõƒè:",v)}else console.log("‚ö†Ô∏è Webhook vr√°til pr√°zdnou odpovƒõƒè");let Z="none",N="none",W="none",w="",q="",O="",X="error",H="";if(!z||D.trim().length===0)X="error",H="‚ùå Webhook vr√°til pr√°zdnou odpovƒõƒè. Zkontrolujte n8n workflow a ujistƒõte se, ≈æe vrac√≠ validn√≠ JSON odpovƒõƒè.";else if(Array.isArray(z)&&z.length>=2){console.log("üîç Parsov√°n√≠ pole objekt≈Ø z N8N...");const v=z.filter(ae=>ae.hasOwnProperty("qdrant_ok")),ne=z.find(ae=>ae.hasOwnProperty("supabase_ok"));v.length>=1&&(Z=v[0].qdrant_ok===!0?"success":"error",w=v[0].qdrant_error||""),v.length>=2&&(N=v[1].qdrant_ok===!0?"success":"error",q=v[1].qdrant_error||""),ne&&(W=ne.supabase_ok===!0?"success":"error",O=ne.supabase_error||"");const ie=Z==="success"&&N==="success";X=ie?"success":"error",ie?H="‚úÖ Text √∫spƒõ≈°nƒõ nahr√°n do obou Qdrant≈Ø":(H=`‚ùå Nahr√°n√≠ do nƒõkter√© datab√°ze selhalo:
`,Z==="error"&&(H+=`- Qdrant Local: ${w||"Chyba"}
`),N==="error"&&(H+=`- Qdrant Cloud: ${q||"Chyba"}
`))}else console.log("‚ö†Ô∏è Neoƒçek√°van√Ω form√°t odpovƒõdi, pou≈æ√≠v√°m fallback. result.success:",z.success),X=z.success?"success":"error",H=z.message||(z.success?"√öspƒõ≈°nƒõ nahr√°no do vektorov√© datab√°ze (text-only)":"Chyba p≈ôi nahr√°v√°n√≠ do vektorov√© datab√°ze");let te={...t,vectorStatus:X};if(X==="success"){const v={title:t.title,author:t.author,publicationYear:t.publicationYear,publisher:t.publisher,summary:t.summary,keywords:t.keywords,language:t.language,format:t.format,fileSize:t.fileSize,coverImageUrl:t.coverImageUrl,publicationTypes:t.publicationTypes,labels:t.labels,categories:t.categories,releaseVersion:t.releaseVersion},ne=JSON.stringify(v);te={...te,vectorAddedAt:new Date().toISOString(),metadataSnapshot:ne},console.log("üì∏ Vytvo≈ôen snapshot metadat pro detekci zmƒõn")}try{console.log("üîÑ Aktualizuji statusy jednotliv√Ωch datab√°z√≠ v books tabulce...");const v={Vdtb:X,qdrant_local_status:Z,qdrant_cloud_status:N,supabase_vector_status:W,vector_upload_details:z,last_vector_upload_at:new Date().toISOString()};if(X==="success"){const ae={title:t.title,author:t.author,publicationYear:t.publicationYear,publisher:t.publisher,summary:t.summary,keywords:t.keywords,language:t.language,format:t.format,fileSize:t.fileSize,coverImageUrl:t.coverImageUrl,publicationTypes:t.publicationTypes,labels:t.labels,categories:t.categories,releaseVersion:t.releaseVersion};v.vector_added_at=new Date().toISOString(),v.metadata_snapshot=JSON.stringify(ae)}const{data:ne,error:ie}=await F.from("books").update(v).eq("id",t.id).select().single();if(ie)throw console.error("‚ùå Chyba p≈ôi aktualizaci status≈Ø v datab√°zi:",ie),ie;console.log("‚úÖ Statusy √∫spƒõ≈°nƒõ aktualizov√°ny v datab√°zi"),te=Ge(ne)}catch(v){console.warn("‚ö†Ô∏è Webhook byl √∫spƒõ≈°n√Ω, ale nepoda≈ôilo se aktualizovat status v datab√°zi:",v)}return{success:X==="success",message:H,details:z}}catch(f){throw clearTimeout(i),f instanceof Error&&f.name==="AbortError"?new Error("‚è∞ Timeout: Webhook neodpovƒõdƒõl do 5 minut. Zkuste to pozdƒõji nebo kontaktujte administr√°tora."):f}}else return console.log("üöÄ Odes√≠l√°m webhook (text-only) bez ƒçek√°n√≠ na odpovƒõƒè (fire-and-forget)..."),fetch(n,{method:"POST",body:y}).catch(x=>{console.error("‚ö†Ô∏è Chyba p≈ôi odes√≠l√°n√≠ fire-and-forget webhoku (ignorov√°no):",x)}),{success:!0,message:"Po≈æadavek odesl√°n do fronty na zpracov√°n√≠ (text-only)"}}catch(c){console.error("Chyba p≈ôi odes√≠l√°n√≠ text-only dat do vektorov√© datab√°ze:",c);try{await oe.updateBook({...t,vectorStatus:"error"})}catch(l){console.error("Chyba p≈ôi aktualizaci statusu:",l)}return{success:!1,message:`Chyba: ${c instanceof Error?c.message:"Nezn√°m√° chyba"}`}}},async deleteFromSupabaseVectorDB(t){try{console.log("üóëÔ∏è Maz√°n√≠ z Supabase vektorov√© datab√°ze, bookId:",t);const o=await fetch(`${Oe}/rest/v1/documents?metadata->>file_id=eq.${t}`,{method:"DELETE",headers:{"Content-Type":"application/json",apikey:$e,Authorization:`Bearer ${$e}`,Prefer:"return=minimal"}});if(!o.ok){const n=await o.text();return console.error("‚ùå Chyba p≈ôi maz√°n√≠ z Supabase vektorov√© DB:",o.status,n),{success:!1,message:`Chyba p≈ôi maz√°n√≠ z Supabase vektorov√© datab√°ze: ${o.status} ${n}`}}return console.log("‚úÖ √öspƒõ≈°nƒõ smaz√°no z Supabase vektorov√© datab√°ze"),{success:!0,message:"√öspƒõ≈°nƒõ smaz√°no z Supabase vektorov√© datab√°ze"}}catch(o){return console.error("‚ùå Chyba p≈ôi maz√°n√≠ z Supabase vektorov√© DB:",o),{success:!1,message:`Neoƒçek√°van√° chyba p≈ôi maz√°n√≠ z Supabase: ${o instanceof Error?o.message:"Nezn√°m√° chyba"}`}}},async deleteFromQdrantVectorDB(t){const o=["https://9aaad106-c442-4dba-b072-3fb8ad4da051.us-west-2-0.aws.cloud.qdrant.io:6333","https://9aaad106-c442-4dba-b072-3fb8ad4da051.us-west-2-0.aws.cloud.qdrant.io","https://9aaad106-c442-4dba-b072-3fb8ad4da051.us-west-2-0.aws.cloud.qdrant.io/api"],n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhY2Nlc3MiOiJtIn0.ls9vPmwrlvxTco80TUsQBMPg0utIzNTYgk25x9__Vbo";for(const a of o)try{console.log(`üóëÔ∏è Zkou≈°√≠m maz√°n√≠ z Qdrant s URL: ${a}, bookId:`,t);const s=await fetch(`${a}/collections/documents/points/delete`,{method:"POST",headers:{"Content-Type":"application/json","Api-Key":n},body:JSON.stringify({filter:{must:[{key:"file_id",match:{value:t}}]}})});if(!s.ok){const l=await s.text();console.warn(`‚ùå Chyba s URL ${a}:`,s.status,l);continue}const c=await s.json();return console.log("‚úÖ √öspƒõ≈°n√° odpovƒõƒè z Qdrant s URL",a,":",c),{success:!0,message:"√öspƒõ≈°nƒõ smaz√°no z Qdrant vektorov√© datab√°ze"}}catch(s){console.warn(`‚ùå Chyba s URL ${a}:`,s instanceof Error?s.message:"Nezn√°m√° chyba");continue}return{success:!1,message:"Neoƒçek√°van√° chyba p≈ôi maz√°n√≠ z Qdrant: V≈°echny URL varianty selhaly (CORS nebo nedostupnost)"}},async deleteFromVectorDatabases(t){console.log("üóëÔ∏è Zahajuji maz√°n√≠ z obou vektorov√Ωch datab√°z√≠ pro knihu:",t);const o={supabase:{success:!1,message:""},qdrant:{success:!1,message:""}},[n,a]=await Promise.allSettled([this.deleteFromSupabaseVectorDB(t),this.deleteFromQdrantVectorDB(t)]);n.status==="fulfilled"?o.supabase=n.value:o.supabase={success:!1,message:`Chyba p≈ôi maz√°n√≠ z Supabase: ${n.reason}`},a.status==="fulfilled"?o.qdrant=a.value:o.qdrant={success:!1,message:`Chyba p≈ôi maz√°n√≠ z Qdrant: ${a.reason}`};const s=o.supabase.success&&o.qdrant.success,c=o.supabase.success||o.qdrant.success;let l="";return s?l="‚úÖ √öspƒõ≈°nƒõ smaz√°no z obou vektorov√Ωch datab√°z√≠ (Supabase + Qdrant)":c?o.supabase.success?l=`‚ö†Ô∏è Smaz√°no pouze z Supabase. Qdrant chyba: ${o.qdrant.message}`:l=`‚ö†Ô∏è Smaz√°no pouze z Qdrant. Supabase chyba: ${o.supabase.message}`:l=`‚ùå Nepoda≈ôilo se smazat z ≈æ√°dn√© vektorov√© datab√°ze.
Supabase: ${o.supabase.message}
Qdrant: ${o.qdrant.message}`,console.log("üìä Celkov√Ω v√Ωsledek maz√°n√≠ z vektorov√Ωch datab√°z√≠:",l),{success:s,message:l,details:o}},async getLabels(){try{const t=await fetch(`${Oe}/rest/v1/labels?select=name&order=name.asc`,{headers:{apikey:$e,Authorization:`Bearer ${$e}`}});return t.ok?(await t.json()).map(n=>n.name):[]}catch(t){return console.error("Error fetching labels:",t),[]}},async addLabel(t){if(!t||t.trim()==="")return!1;const{error:o}=await F.from("labels").insert({name:t.trim()});return o?(console.error("Error adding label:",o.message,o),!1):!0},async deleteLabel(t){if(!t||t.trim()==="")return!1;const{error:o}=await F.from("labels").delete().eq("name",t.trim());return o?(console.error("Error deleting label:",o.message,o),!1):!0},async getCategories(){try{const t=await fetch(`${Oe}/rest/v1/categories?select=name&order=name.asc`,{headers:{apikey:$e,Authorization:`Bearer ${$e}`}});return t.ok?(await t.json()).map(n=>n.name):[]}catch(t){return console.error("Error fetching categories:",t),[]}},async addCategory(t){if(!t||t.trim()==="")return!1;const{error:o}=await F.from("categories").insert({name:t.trim()});return o?(console.error("Error adding category:",o.message,o),!1):!0},async deleteCategory(t){if(!t||t.trim()==="")return!1;const{error:o}=await F.from("categories").delete().eq("name",t.trim());return o?(console.error("Error deleting category:",o.message,o),!1):!0},async getLanguages(){try{const t=await fetch(`${Oe}/rest/v1/languages?select=name&order=name.asc`,{headers:{apikey:$e,Authorization:`Bearer ${$e}`}});return t.ok?(await t.json()).map(n=>n.name):[]}catch(t){return console.error("Error fetching languages:",t),[]}},async addLanguage(t,o){if(!t||t.trim()==="")return!1;const{error:n}=await F.from("languages").insert({name:t.trim(),code:(o==null?void 0:o.trim())||null});return n?(console.error("Error adding language:",n.message,n),!1):!0},async deleteLanguage(t){if(!t||t.trim()==="")return!1;const{error:o}=await F.from("languages").delete().eq("name",t.trim());return o?(console.error("Error deleting language:",o.message,o),!1):!0},async getPublicationTypes(){try{const t=await fetch(`${Oe}/rest/v1/publication_types?select=name&order=name.asc`,{headers:{apikey:$e,Authorization:`Bearer ${$e}`}});return t.ok?(await t.json()).map(n=>n.name):[]}catch(t){return console.error("Error fetching publication types:",t),[]}},async addPublicationType(t,o){if(!t||t.trim()==="")return!1;const{error:n}=await F.from("publication_types").insert({name:t.trim(),description:(o==null?void 0:o.trim())||null});return n?(console.error("Error adding publication type:",n.message,n),!1):!0},async deletePublicationType(t){if(!t||t.trim()==="")return!1;const{error:o}=await F.from("publication_types").delete().eq("name",t.trim());return o?(console.error("Error deleting publication type:",o.message,o),!1):!0},async updateQdrantMetadata(t,o,n,a){const s="https://n8n.srv980546.hstgr.cloud/webhook/822e584e-0836-4d1d-aef1-5c4dce6573c0";try{console.log("üîÑ Odes√≠l√°m po≈æadavek na aktualizaci Qdrant metadata p≈ôes n8n webhook"),console.log("üìÇ Kniha ID:",t),console.log("üìÇ Nov√© categories:",o),console.log("üìÇ Nov√© labels:",n),console.log("üìÇ Nov√© publicationTypes:",a);const l=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"update_metadata",bookId:t,metadata:{categories:o,labels:n,publicationTypes:a}})});if(!l.ok){const m=await l.text();return console.error("‚ùå Chyba p≈ôi vol√°n√≠ n8n webhook:",l.status,m),{success:!1,message:`Chyba p≈ôi vol√°n√≠ webhook: ${l.status} ${m}`}}const g=await l.json();if(console.log("‚úÖ Odpovƒõƒè z n8n webhook:",g),g.status==="ok")return{success:!0,message:"‚úÖ Metadata √∫spƒõ≈°nƒõ aktualizov√°na v datab√°zi"};if(Array.isArray(g)){const m=g.find(u=>u.hasOwnProperty("qdrant_ok"));return(m==null?void 0:m.qdrant_ok)===!0?{success:!0,message:"‚úÖ Metadata v Qdrant √∫spƒõ≈°nƒõ aktualizov√°na"}:{success:!1,message:`‚ùå Chyba p≈ôi aktualizaci Qdrant: ${(m==null?void 0:m.qdrant_error)||"Nezn√°m√° chyba"}`}}else return g.success?{success:!0,message:g.message||"‚úÖ Metadata v Qdrant √∫spƒõ≈°nƒõ aktualizov√°na"}:{success:!1,message:g.message||"‚ùå Chyba p≈ôi aktualizaci metadata"}}catch(c){return console.error("‚ùå Neoƒçek√°van√° chyba p≈ôi vol√°n√≠ n8n webhook:",c),{success:!1,message:`Neoƒçek√°van√° chyba p≈ôi aktualizaci metadata: ${c instanceof Error?c.message:"Nezn√°m√° chyba"}`}}}},er=async(t,o)=>(alert("AI generov√°n√≠ bylo odstranƒõno. Pou≈æijte pros√≠m automatickou extrakci metadat p≈ôi nahr√°v√°n√≠ souboru."),"AI nen√≠ k dispozici."),tr=async t=>{console.log("ü§ñ Generuji metadata pomoc√≠ inteligentn√≠ extrakce (auto-detekce OCR)..."),console.log("üìÅ FilePath:",t.filePath),console.log("üìñ Kniha:",t.title,"od",t.author),console.log("üìÑ Form√°t:",t.format);try{const o=t.format.toLowerCase();if(o==="txt"){console.log("üìù Zpracov√°v√°m TXT soubor..."),console.log("üì• Stahuji TXT soubor...");const{data:l,error:g}=await F.storage.from("Books").download(t.filePath);if(g||!l)throw console.error("‚ùå Chyba p≈ôi stahov√°n√≠ TXT souboru:",g),new Error(`Nepoda≈ôilo se st√°hnout TXT soubor: ${(g==null?void 0:g.message)||"Nezn√°m√° chyba"}`);const m=await l.text();console.log("üìä Celkov√° d√©lka textu:",m.length,"znak≈Ø");const u=m.split(/\s+/),y=u.slice(0,5e3).join(" ");console.log("üìä Vybran√Ωch slov:",Math.min(u.length,5e3),"z",u.length),console.log("üìä D√©lka vzorku:",y.length,"znak≈Ø"),console.log("ü§ñ Vol√°m AI pro anal√Ωzu TXT obsahu...");const x=await fn(y,t.title||"dokument.txt",Oe,$e);if(!x.success)throw new Error(x.error||"Extrakce metadat z textu selhala bez zpr√°vy");if(!x.metadata)throw new Error("Extrakce metadat nevr√°tila metadata");console.log("‚úÖ Metadata √∫spƒõ≈°nƒõ extrahov√°na z TXT:",x.metadata);const i={};return x.metadata.title&&(i.title=x.metadata.title),x.metadata.author&&(i.author=x.metadata.author),x.metadata.publicationYear&&(i.publicationYear=x.metadata.publicationYear),x.metadata.publisher&&(i.publisher=x.metadata.publisher),x.metadata.language&&(i.language=x.metadata.language),x.metadata.summary&&(i.summary=x.metadata.summary),x.metadata.keywords&&x.metadata.keywords.length>0&&(i.keywords=x.metadata.keywords),x.metadata.releaseVersion&&(i.releaseVersion=x.metadata.releaseVersion),console.log("‚úÖ Metadata p≈ôipravena k naplnƒõn√≠ pol√≠:",i),i}if(o!=="pdf")throw new Error("Inteligentn√≠ extrakce metadat je podporov√°na pouze pro PDF a TXT soubory");console.log("üì• Vytv√°≈ô√≠m signed URL pro PDF...");const{data:n,error:a}=await F.storage.from("Books").createSignedUrl(t.filePath,60);if(a||!n||!n.signedUrl)throw console.error("‚ùå Chyba p≈ôi vytv√°≈ôen√≠ signed URL:",a),new Error(`Nepoda≈ôilo se z√≠skat signed URL: ${(a==null?void 0:a.message)||"Nezn√°m√° chyba"}`);console.log("‚úÖ Signed URL vytvo≈ôena:",n.signedUrl),console.log("ü§ñ Vol√°m inteligentn√≠ extrakƒçn√≠ slu≈æbu...");const s=await mn(n.signedUrl,t.title||"dokument.pdf",Oe,$e);if(!s.success)throw new Error(s.error||"Inteligentn√≠ extrakce selhala bez zpr√°vy");if(!s.metadata)throw new Error("Inteligentn√≠ extrakce nevr√°tila metadata");console.log("‚úÖ Metadata √∫spƒõ≈°nƒõ extrahov√°na:",s.metadata),console.log(`üìä Pou≈æit√Ω vstup: ${s.type} | Model: ${s.model}`);const c={};return s.metadata.title&&(c.title=s.metadata.title),s.metadata.author&&(c.author=s.metadata.author),s.metadata.publicationYear&&(c.publicationYear=s.metadata.publicationYear),s.metadata.publisher&&(c.publisher=s.metadata.publisher),s.metadata.language&&(c.language=s.metadata.language),s.metadata.summary&&(c.summary=s.metadata.summary),s.metadata.keywords&&s.metadata.keywords.length>0&&(c.keywords=s.metadata.keywords),s.metadata.releaseVersion&&(c.releaseVersion=s.metadata.releaseVersion),console.log("‚úÖ Metadata p≈ôipravena k naplnƒõn√≠ pol√≠:",c),c}catch(o){throw console.error("‚ùå Chyba p≈ôi inteligentn√≠ extrakci metadat:",o),console.error("‚ùå Error details:",{message:o instanceof Error?o.message:String(o),stack:o instanceof Error?o.stack:"N/A"}),o}},or=(t,o,n)=>{const a=document.createElement("a"),s=new Blob([t],{type:n});a.href=URL.createObjectURL(s),a.download=o,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(a.href)},Ht=async t=>{try{if(console.log("Loading PDF document, size:",t.byteLength,"bytes"),!pdfjsLib||!pdfjsLib.getDocument)return console.error("PDF.js library is not properly loaded"),null;const o=pdfjsLib.getDocument(t);console.log("PDF loading task created");const n=await o.promise;if(console.log("PDF loaded successfully, pages:",n.numPages),n.numPages===0)return console.error("PDF has no pages"),null;const a=await n.getPage(1);console.log("First page loaded successfully");const s=a.getViewport({scale:1.5});console.log("Viewport created:",{width:s.width,height:s.height});const c=document.createElement("canvas"),l=c.getContext("2d");return c.height=s.height,c.width=s.width,l?(console.log("Starting page render..."),await a.render({canvasContext:l,viewport:s}).promise,console.log("Page rendered successfully to canvas"),new Promise(g=>{c.toBlob(m=>{if(m){console.log("Canvas converted to blob, size:",m.size,"bytes");const u=`cover-${Date.now()}.jpg`;g(new File([m],u,{type:"image/jpeg"}))}else console.error("Failed to convert canvas to blob"),g(null)},"image/jpeg",.9)})):(console.error("Could not get canvas context"),null)}catch(o){return console.error("Error generating cover from PDF:",o),console.error("Error details:",{name:o.name,message:o.message,stack:o.stack}),null}};window.testPdfCoverGeneration=async t=>{if(!t||t.type!=="application/pdf"){console.error("Please provide a valid PDF file");return}console.log("Testing PDF cover generation with file:",t.name);const o=await t.arrayBuffer(),n=await Ht(o);if(n){console.log("‚úÖ Success! Generated cover:",{name:n.name,type:n.type,size:n.size});const a=URL.createObjectURL(n);console.log("Preview URL:",a);const s=document.createElement("img");return s.src=a,s.style.maxWidth="200px",s.style.border="1px solid #ccc",s.style.margin="10px",s.title="Generated PDF Cover",document.body.appendChild(s),{success:!0,file:n,previewUrl:a}}else return console.error("‚ùå Failed to generate cover"),{success:!1}};window.testBucketStructure=()=>{console.log("üìÅ Expected bucket structure:"),console.log("Books bucket: book_[timestamp]_[id].pdf"),console.log("Covers bucket: book_[timestamp]_[id].jpg"),console.log(""),console.log("Example:"),console.log("Books/book_1735234567890_abc123def.pdf"),console.log("Covers/book_1735234567890_abc123def.jpg"),console.log(""),console.log("Both files share the same ID for easy pairing!")};window.testSupabaseConnection=async()=>{var t;console.log("üß™ Testov√°n√≠ p≈ôipojen√≠ k Supabase..."),console.log("URL:",Oe),console.log("Client:",!!F);try{console.log("üîç Zaƒç√≠n√°m jednoduch√Ω test dotaz...");const{data:o,error:n,count:a}=await F.from("books").select("id",{count:"exact"}).limit(1);return console.log("üîç Test dotaz dokonƒçen:",{data:!!o,error:!!n,count:a}),n?(console.error("‚ùå Supabase connection failed:",{message:n.message,details:n.details,hint:n.hint,code:n.code}),{success:!1,error:n,details:"Query returned error"}):(console.log("‚úÖ Supabase connection successful! Poƒçet knih:",a),{success:!0,data:o,count:a,details:"Connection OK"})}catch(o){return console.error("‚ùå Supabase connection exception:",{name:o.name,message:o.message,stack:((t=o.stack)==null?void 0:t.substring(0,200))+"..."}),{success:!1,error:o,details:o.message||"Unknown error"}}};window.refreshBooks=async()=>{console.log("üîÑ Ruƒçnƒõ obnovuji seznam knih...");try{const t=await oe.getBooks();return console.log(`‚úÖ Naƒçteno ${t.length} knih:`),t.length>0&&console.log("Prvn√≠ch 3 knihy:",t.slice(0,3).map(o=>({id:o.id,title:o.title}))),t}catch(t){return console.error("‚ùå Chyba p≈ôi obnovov√°n√≠ knih:",t),null}};window.loadBooksSlowly=async()=>{console.log("üêå Postupn√© naƒç√≠t√°n√≠ knih...");try{console.log("1. Z√≠sk√°v√°m poƒçet knih...");const{count:t}=await F.from("books").select("*",{count:"exact",head:!0});if(console.log(`Poƒçet knih v datab√°zi: ${t}`),!t||t===0)return console.log("‚ö†Ô∏è Datab√°ze je pr√°zdn√°!"),[];console.log("2. Naƒç√≠t√°m knihy po d√°vk√°ch...");const o=10,n=[];for(let a=0;a<t;a+=o){console.log(`Naƒç√≠t√°m knihy ${a+1}-${Math.min(a+o,t)}...`);const{data:s,error:c}=await F.from("books").select("*").order("created_at",{ascending:!1}).range(a,a+o-1);if(c){console.error(`Chyba p≈ôi naƒç√≠t√°n√≠ d√°vky ${a}:`,c);break}s&&(n.push(...s),console.log(`‚úÖ Naƒçteno ${s.length} knih (celkem: ${n.length})`))}return console.log(`üìã Celkem naƒçteno: ${n.length} knih`),n.map(Ge)}catch(t){return console.error("‚ùå Chyba p≈ôi postupn√©m naƒç√≠t√°n√≠:",t),null}};window.testCoversBucketAccess=async()=>{console.log('üß™ Testing access to "covers" bucket...');const t="test",o=new Blob([t],{type:"text/plain"}),n=new File([o],"test.txt",{type:"text/plain"});try{console.log("1. Testing upload to covers bucket...");const{error:a}=await F.storage.from("covers").upload("test-file.txt",n,{upsert:!0});if(a)return console.error("‚ùå Upload to covers bucket failed:",a.message),console.error("Full error:",a),{success:!1,error:a.message};{console.log("‚úÖ Upload to covers bucket successful!"),console.log("2. Testing public URL from covers bucket...");const{data:s}=F.storage.from("covers").getPublicUrl("test-file.txt");return console.log("Public URL:",s.publicUrl),console.log("3. Cleaning up test file..."),await F.storage.from("covers").remove(["test-file.txt"]),console.log("‚úÖ Test completed successfully!"),{success:!0,publicUrl:s.publicUrl}}}catch(a){return console.error("‚ùå Unexpected error during covers bucket test:",a),{success:!1,error:a.message}}};const xt=t=>{const o=`extracted_text_${t}`,n=`${o}_timestamp`,a=localStorage.getItem(o),s=localStorage.getItem(n);if(a&&s){const c=Date.now()-parseInt(s),l=1440*60*1e3;if(c<l)return console.log("üíæ Text naƒçten z mezipamƒõti (vƒõk:",Math.round(c/1e3/60),"minut)"),a;console.log("‚è∞ Mezipamƒõ≈• vypr≈°ela, maz√°n√≠..."),localStorage.removeItem(o),localStorage.removeItem(n)}return null},Le=t=>{const o=`extracted_text_${t}`,n=`${o}_timestamp`,a=localStorage.getItem(o),s=localStorage.getItem(n);if(a&&s){const c=Date.now()-parseInt(s),l=1440*60*1e3;if(c<l){const g=Math.round(c/1e3/60),m=g<60?`${g} min`:`${Math.round(g/60)} hod`;return{hasCache:!0,size:a.length,age:m}}}return{hasCache:!1,size:0,age:""}},mt=t=>{const o=`extracted_text_${t}`,n=`${o}_timestamp`;localStorage.removeItem(o),localStorage.removeItem(n),console.log("üóëÔ∏è Mezipamƒõ≈• pro knihu",t,"vyƒçi≈°tƒõna")};window.showTextCache=()=>{console.log("üîç STAV MEZIPAMƒöTI TEXTU:"),console.log("‚îÄ".repeat(50));const o=Object.keys(localStorage).filter(n=>n.startsWith("extracted_text_"));if(o.length===0){console.log("üì≠ ≈Ω√°dn√© texty v mezipamƒõti");return}o.forEach(n=>{const a=n.replace("extracted_text_",""),s=`${n}_timestamp`,c=localStorage.getItem(s);if(c){const l=Date.now()-parseInt(c),g=Math.round(l/1e3/60),m=g<60?`${g} min`:`${Math.round(g/60)} hod`,u=localStorage.getItem(n),y=u?u.length:0;console.log(`üìñ ${a}: ${y} znak≈Ø (vƒõk: ${m})`)}}),console.log("‚îÄ".repeat(50))};const it=async t=>{const o="https://n8n.srv980546.hstgr.cloud/webhook/79522dec-53ac-4f64-9253-1c5759aa8b45";try{console.log("üöÄ Odes√≠l√°m dokument na webhook pro extrakci textu..."),console.log("üìñ Kniha:",t.title),console.log("üìÅ FilePath:",t.filePath);const{data:n,error:a}=await F.storage.from("Books").download(t.filePath);if(a||!n)throw new Error(`Nepoda≈ôilo se st√°hnout soubor: ${a==null?void 0:a.message}`);console.log("üì§ Odes√≠l√°m bin√°rn√≠ soubor na webhook..."),console.log("üìä Velikost souboru:",n.size,"bajt≈Ø");const s=new FormData;s.append("file",n,t.filePath.split("/").pop()||"document.pdf"),s.append("bookId",t.id),s.append("fileName",t.filePath.split("/").pop()||"unknown.pdf"),s.append("fileType",t.format.toLowerCase()),s.append("metadata",JSON.stringify({title:t.title,author:t.author,publicationYear:t.publicationYear,language:t.language,releaseVersion:t.releaseVersion}));const c=await fetch(o,{method:"POST",body:s});if(!c.ok){const u=await c.text();throw console.error("‚ùå Webhook chyba:",u),c.status===404?new Error(`Webhook nen√≠ dostupn√Ω (404). Zkontrolujte, zda je n8n workflow aktivn√≠ a webhook zaregistrovan√Ω. Chyba: ${u}`):new Error(`HTTP error! status: ${c.status} - ${u}`)}let l;const g=await c.text();try{const u=JSON.parse(g);console.log("‚úÖ Webhook JSON odpovƒõƒè:",u),u.success&&u.extractedText||u.extractedText?l=u.extractedText:l=g}catch{console.log("‚úÖ Webhook vr√°til ƒçist√Ω text (ne JSON):",g.substring(0,200)+"..."),l=g}if(!l||l.trim().length===0)throw new Error("Webhook vr√°til pr√°zdn√Ω text");const m=`extracted_text_${t.id}`;return localStorage.setItem(m,l),localStorage.setItem(`${m}_timestamp`,Date.now().toString()),console.log("üíæ Text ulo≈æen do mezipamƒõti:",l.length,"znak≈Ø"),l}catch(n){throw console.error("‚ùå Chyba p≈ôi extrakci textu p≈ôes webhook:",n),n}},Kt=async t=>{try{console.log("üìÑ Spou≈°t√≠m lok√°ln√≠ extrakci textu z PDF..."),console.log("üìÑ Soubor:",t.name,"Velikost:",(t.size/1024).toFixed(2),"KB");const o=await t.arrayBuffer(),n=window.pdfjsLib;if(!n)throw new Error("PDF.js nen√≠ naƒçten. Zkuste obnovit str√°nku.");console.log("üìö Naƒç√≠t√°m PDF dokument...");const s=await n.getDocument({data:o}).promise;console.log(`üìÑ PDF m√° ${s.numPages} str√°nek`);let c="";for(let u=1;u<=s.numPages;u++){const i=(await(await s.getPage(u)).getTextContent()).items.map(f=>f.str).join(" ");c+=`

--- Str√°nka ${u} ---

${i}`,u%10===0&&console.log(`üìÑ Zpracov√°no ${u}/${s.numPages} str√°nek`)}console.log("‚úÖ Extrakce textu dokonƒçena"),console.log("üìä Celkov√° d√©lka textu:",c.length,"znak≈Ø");const l=t.name.replace(/\.pdf$/i,".txt"),g=new Blob([c],{type:"text/plain; charset=utf-8"}),m=new File([g],l,{type:"text/plain"});return console.log("‚úÖ Vytvo≈ôen textov√Ω soubor:",{name:l,size:m.size,sizeKB:(m.size/1024).toFixed(2),type:m.type}),m}catch(o){throw console.error("‚ùå Chyba p≈ôi lok√°ln√≠ extrakci textu z PDF:",o),o}},nr=async t=>{const o="https://n8n.srv980546.hstgr.cloud/webhook/3fac3a7f-9e76-4441-901b-1c69e339fe97";try{console.log("üì§ Odes√≠l√°m PDF na N8N webhook pro extrakci textu..."),console.log("üìÑ Soubor:",t.name,"Velikost:",(t.size/1024).toFixed(2),"KB");const n=new FormData;n.append("data",t,t.name),console.log("üì§ POST request na:",o);const a=await fetch(o,{method:"POST",body:n});if(console.log("‚úÖ Response status:",a.status),console.log("‚úÖ Response ok:",a.ok),console.log("üìã Response headers:",{contentType:a.headers.get("content-type"),contentLength:a.headers.get("content-length")}),!a.ok){const u=await a.text();throw console.error("‚ùå Response error:",u),new Error(`Webhook vr√°til chybu (${a.status}): ${u}`)}const s=await a.blob();if(console.log("‚úÖ P≈ôijat blob:",{size:s.size,sizeKB:(s.size/1024).toFixed(2),type:s.type}),s.size===0)throw new Error("Webhook vr√°til pr√°zdn√Ω soubor (0 bajt≈Ø). Zkontrolujte konfiguraci N8N workflow.");const c=Math.min(100,s.size),l=await s.slice(0,c).text();console.log("üìù Preview prvn√≠ch znak≈Ø:",l.substring(0,Math.min(100,l.length)));const g=t.name.replace(/\.pdf$/i,".txt"),m=new File([s],g,{type:"text/plain"});return console.log("‚úÖ Vytvo≈ôen textov√Ω soubor:",{name:g,size:m.size,sizeKB:(m.size/1024).toFixed(2),type:m.type}),m}catch(n){throw console.error("‚ùå Chyba p≈ôi vol√°n√≠ N8N webhook:",n),n}},rr=async t=>{const o="https://n8n.srv980546.hstgr.cloud/webhook/c2d2f94f-1be3-4d68-a2ec-12f23b3580e1";try{console.log("üöÄ Odes√≠l√°m dokument na LLM kontext webhook s limitem",50,"str√°nek..."),console.log("üìñ Kniha:",t.title),console.log("üìÅ FilePath:",t.filePath),console.log("üîç Testov√°n√≠ PDFLib dostupnosti:",{windowPDFLib:!!window.PDFLib,PDFDocument:!!(window.PDFLib&&window.PDFLib.PDFDocument)});const{data:a,error:s}=await F.storage.from("Books").download(t.filePath);if(s||!a)throw new Error(`Nepoda≈ôilo se st√°hnout soubor: ${s==null?void 0:s.message}`);let c=a;if(t.format.toLowerCase()==="pdf"){console.log("üìÑ Kontroluji poƒçet str√°nek PDF...");const f=await a.arrayBuffer(),D=await pdfjsLib.getDocument(f).promise;if(console.log(`üìä PDF m√° ${D.numPages} str√°nek`),D.numPages>50){console.log("‚úÇÔ∏è PDF m√° v√≠ce ne≈æ 50 str√°nek, o≈ôez√°v√°m na prvn√≠ch 50 str√°nek...");try{let Z=null;if(window.PDFLib&&window.PDFLib.PDFDocument?(Z=window.PDFLib.PDFDocument,console.log("üìö Pou≈æ√≠v√°m window.PDFLib.PDFDocument")):window.PDFLib&&window.PDFLib.PDFDocument?(Z=window.PDFLib.PDFDocument,console.log("üìö Pou≈æ√≠v√°m (window as any).PDFLib.PDFDocument")):globalThis.PDFLib&&globalThis.PDFLib.PDFDocument&&(Z=globalThis.PDFLib.PDFDocument,console.log("üìö Pou≈æ√≠v√°m globalThis.PDFLib.PDFDocument")),!Z)console.warn("‚ö†Ô∏è PDFLib nen√≠ dostupn√©, pos√≠l√°m cel√© PDF s upozornƒõn√≠m"),console.warn("üîç Dostupn√© objekty:",Object.keys(window).filter(N=>N.includes("PDF"))),console.log(`üì§ Pos√≠l√°m cel√© PDF (${D.numPages} str√°nek) - webhook mus√≠ o≈ôezat na 50 str√°nek`);else{console.log("üìù Vytv√°≈ô√≠m nov√© PDF s prvn√≠mi",50,"str√°nkami...");const N=await Z.load(f),W=await Z.create(),w=Array.from({length:Math.min(50,D.numPages)},(X,H)=>H);(await W.copyPages(N,w)).forEach(X=>W.addPage(X));const O=await W.save();c=new Blob([O],{type:"application/pdf"}),console.log(`‚úÖ PDF √∫spƒõ≈°nƒõ o≈ôez√°no z ${D.numPages} na 50 str√°nek`),console.log(`üì¶ Nov√° velikost: ${Math.round(c.size/1024)} KB (p≈Øvodn√≠: ${Math.round(a.size/1024)} KB)`)}}catch(Z){console.error("‚ùå Chyba p≈ôi o≈ôez√°v√°n√≠ PDF pomoc√≠ PDFLib:",Z),console.log("‚ö†Ô∏è Pokus√≠m se o alternativn√≠ ≈ôe≈°en√≠..."),console.log("‚ö†Ô∏è Pos√≠l√°m cel√© PDF s explicitn√≠ instrukc√≠ pro o≈ôez√°n√≠ na 50 str√°nek"),c.__needsTrimming=!0,c.__originalPages=D.numPages}}else console.log(`‚úÖ PDF m√° ${D.numPages} str√°nek, co≈æ je v limitu 50 str√°nek`)}let l=50;if(t.format.toLowerCase()==="pdf")try{const f=await c.arrayBuffer();l=(await pdfjsLib.getDocument(f).promise).numPages,console.log(`üìã Skuteƒçn√Ω poƒçet str√°nek v odes√≠lan√©m PDF: ${l}`)}catch{console.warn("‚ö†Ô∏è Nepoda≈ôilo se zjistit poƒçet str√°nek o≈ôezan√©ho PDF, pou≈æ√≠v√°m MAX_PAGES")}console.log("üì§ Odes√≠l√°m soubor na LLM kontext webhook..."),console.log("üìä Velikost souboru:",c.size,"bajt≈Ø"),console.log("üåê Webhook URL:",o);const g=new FormData;g.append("file",c,t.filePath.split("/").pop()||"document.pdf"),g.append("bookId",t.id),g.append("fileName",t.filePath.split("/").pop()||"unknown.pdf"),g.append("fileType",t.format.toLowerCase()),g.append("maxPages","50"),g.append("actualPages",l.toString()),g.append("isLLMContext","true");const m=c.__needsTrimming||!1,u=c.__originalPages||l;g.append("needsTrimming",m.toString()),g.append("originalPages",u.toString()),g.append("metadata",JSON.stringify({title:t.title,author:t.author,publicationYear:t.publicationYear,language:t.language,releaseVersion:t.releaseVersion,requestedMaxPages:50,actualPages:l})),console.log("üìã FormData obsahuje:",{fileName:t.filePath.split("/").pop(),bookId:t.id,fileType:t.format.toLowerCase(),maxPages:50,actualPages:l,needsTrimming:m,originalPages:u,isLLMContext:!0});const y=await fetch(o,{method:"POST",body:g});if(!y.ok){const f=await y.text();throw console.error("‚ùå LLM kontext webhook chyba:",f),y.status===404?new Error(`LLM kontext webhook nen√≠ dostupn√Ω (404). Zkontrolujte, zda je n8n workflow aktivn√≠ a webhook zaregistrovan√Ω. Chyba: ${f}`):new Error(`HTTP error! status: ${y.status} - ${f}`)}const x=await y.text();console.log("‚úÖ LLM kontext webhook odpovƒõƒè:",x.length,"znak≈Ø");const i=`extracted_text_${t.id}`;return localStorage.setItem(i,x),localStorage.setItem(`${i}_timestamp`,Date.now().toString()),console.log("üíæ LLM kontext text ulo≈æen do mezipamƒõti a p≈ôepsal st√°vaj√≠c√≠ OCR:",x.length,"znak≈Ø"),x}catch(a){throw console.error("‚ùå Chyba p≈ôi odes√≠l√°n√≠ na LLM kontext webhook:",a),a}},Ne=({isOpen:t,onClose:o,title:n,children:a})=>t?e.jsx("div",{style:d.modalOverlay,onClick:o,children:e.jsxs("div",{style:d.modalContent,onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{style:d.modalHeader,children:[e.jsx("h3",{children:n}),e.jsx("button",{style:d.modalCloseButton,onClick:o,children:e.jsx(Un,{})})]}),e.jsx("div",{style:d.modalBody,children:a})]})}):null,ft=({selectedTags:t,allTags:o,onChange:n,onAddNewTag:a,onDeleteTag:s,promptText:c,creationText:l})=>{const[g,m]=h.useState(!1),[u,y]=h.useState(!1),[x,i]=h.useState(!1),[f,z]=h.useState(""),[D,Z]=h.useState({isOpen:!1,tag:null}),N=o.filter(v=>!t.includes(v)),W=h.useRef(null),w=v=>{n(t.filter(ne=>ne!==v))},q=v=>{t.includes(v)||n([...t,v]),m(!1)},O=()=>{m(!1),z(""),y(!0)},X=()=>{const v=f.trim();v&&(a(v),t.includes(v)||n([...t,v])),y(!1),z("")},H=v=>{Z({isOpen:!0,tag:v}),m(!1),i(!1)},te=()=>{D.tag&&s&&s(D.tag),Z({isOpen:!1,tag:null})};return h.useEffect(()=>{const v=ne=>{W.current&&!W.current.contains(ne.target)&&m(!1)};return document.addEventListener("mousedown",v),()=>document.removeEventListener("mousedown",v)},[W]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{position:"relative"},ref:W,children:[e.jsxs("div",{style:d.tagInputContainer,children:[t.map(v=>e.jsxs("span",{style:{...d.tag,display:"flex",alignItems:"center"},children:[v,e.jsx("button",{onClick:()=>w(v),style:d.tagRemoveButton,children:"√ó"})]},v)),e.jsxs("button",{onClick:()=>m(v=>!v),style:d.tagInputAddButton,children:[e.jsx(Ye,{})," P≈ôidat"]})]}),g&&e.jsxs("div",{style:d.tagDropdown,children:[N.map(v=>e.jsx("a",{onClick:()=>q(v),style:d.dropdownMenuLink,children:v},v)),e.jsx("div",{style:{borderTop:"1px solid var(--border)",margin:"4px 0"}}),e.jsxs("a",{onClick:O,style:{...d.dropdownMenuLink,...d.addNewTagLink},children:[e.jsx(Ye,{})," ",l]}),s&&o.length>0&&e.jsxs("a",{onClick:()=>{m(!1),i(!0)},style:{...d.dropdownMenuLink,color:"var(--danger-color)"},children:[e.jsx(Ae,{size:14})," Spravovat polo≈æky"]})]})]}),e.jsx(Ne,{isOpen:u,onClose:()=>y(!1),title:c,children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsx("input",{type:"text",value:f,onChange:v=>z(v.target.value),style:d.input,placeholder:"Zadejte n√°zev...",onKeyDown:v=>{v.key==="Enter"&&X()},autoFocus:!0}),e.jsxs("button",{onClick:X,style:{...d.button,alignSelf:"flex-end"},children:[e.jsx(Ye,{})," P≈ôidat"]})]})}),e.jsx(Ne,{isOpen:x,onClose:()=>i(!1),title:"Spravovat polo≈æky",children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",maxHeight:"400px",overflowY:"auto"},children:[e.jsx("p",{style:{fontSize:"0.9em",color:"var(--text-secondary)",margin:0},children:"Kliknut√≠m na polo≈æku ji smaz√°te ze syst√©mu. Tato akce je nevratn√°."}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[o.map(v=>e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 12px",borderRadius:"6px",border:"1px solid var(--border)",backgroundColor:"var(--surface)"},children:[e.jsx("span",{style:{flex:1},children:v}),e.jsxs("button",{onClick:()=>H(v),style:{background:"var(--danger-color)",color:"white",border:"none",borderRadius:"4px",padding:"4px 8px",cursor:"pointer",fontSize:"12px",display:"flex",alignItems:"center",gap:"4px"},title:`Smazat ${v}`,children:[e.jsx(Ae,{size:12})," Smazat"]})]},v)),o.length===0&&e.jsx("p",{style:{textAlign:"center",color:"var(--text-secondary)",margin:"20px 0"},children:"≈Ω√°dn√© polo≈æky k zobrazen√≠."})]})]})}),e.jsx(Ne,{isOpen:D.isOpen,onClose:()=>Z({isOpen:!1,tag:null}),title:"Potvrzen√≠ smaz√°n√≠",children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsxs("p",{children:['Opravdu chcete smazat polo≈æku "',D.tag,'"?']}),e.jsx("p",{style:{fontSize:"0.9em",color:"var(--text-secondary)"},children:"Tato akce je nevratn√°. Polo≈æka bude odebr√°na ze v≈°ech knih."}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>Z({isOpen:!1,tag:null}),style:{...d.button,background:"var(--surface)",color:"var(--text)"},children:"Zru≈°it"}),e.jsxs("button",{onClick:te,style:{...d.button,background:"var(--danger-color)",color:"white"},children:[e.jsx(Ae,{size:16})," Smazat"]})]})]})})]})},ar=({currentUser:t})=>{var Nt,Dt,Bt,Ft,Ot;const[o,n]=h.useState([]),[a,s]=h.useState(null),[c,l]=h.useState(new Set),[g,m]=h.useState("list"),[u,y]=h.useState(!1),[x,i]=h.useState(!1),[f,z]=h.useState(""),[D,Z]=h.useState([]),[N,W]=h.useState([]),[w,q]=h.useState([]),[O,X]=h.useState([]),[H,te]=h.useState([]),[v,ne]=h.useState("all"),[ie,ae]=h.useState({from:null,to:null}),[ge,Se]=h.useState({from:0,to:0}),[ye,ke]=h.useState(!1),[je,_e]=h.useState({isOpen:!1,book:null}),[_,I]=h.useState(!1),[j,T]=h.useState({isOpen:!1,book:null,missingFields:[]}),[C,G]=h.useState({isOpen:!1,book:null,pageCount:0}),[J,V]=h.useState(new Set),[pe,$]=h.useState(!1),[ce,Y]=h.useState(null),[re,Q]=h.useState(!1),[ve,M]=h.useState(""),[Pe,P]=h.useState(!1),[A,ee]=h.useState(!1),[K,se]=h.useState({performOCR:!1,performCompression:!1,textOnly:!1,textOnly2:!1}),[be,we]=h.useState(null),[ze,Ie]=h.useState("Angliƒçtina"),[Me,ut]=h.useState("recommended"),[Xe,Qe]=h.useState([]),[et,tt]=h.useState(["Aromaterapie","Mas√°≈æe","Akupunktura","Diagnostika"]),[ot,nt]=h.useState(["public","students","internal_bewit"]),[Gt,Yt]=h.useState([]),[qt,Jt]=h.useState([]),[Xt,Qt]=h.useState([]),[yt,rt]=h.useState(!0),Ke=h.useRef(null);h.useEffect(()=>{console.log("üöÄ useEffect - Zaƒç√≠n√°m naƒç√≠t√°n√≠ dat...");let r=!0;return rt(!0),Promise.all([oe.getBooks(),oe.getLabels(),oe.getCategories(),oe.getLanguages(),oe.getPublicationTypes()]).then(([p,b,k,L,B])=>{if(console.log("‚úÖ Promise.all dokonƒçen!"),!r){console.log("‚ö†Ô∏è Komponenta ji≈æ nen√≠ namountovan√°, p≈ôeskakuji aktualizaci stavu");return}console.log("üìä Naƒçten√° metadata z datab√°ze:"),console.log("- Knihy:",p.length),console.log("- ≈†t√≠tky:",b.length),console.log("- Kategorie:",k.length),console.log("- V≈°echny jazyky z DB:",L.length),console.log("- Typy publikac√≠:",B.length),n(p),Qe(b),tt(k),Qt(L),nt(B);const U=new Set,he=new Set;p.forEach(ue=>{ue.language&&U.add(ue.language),ue.releaseVersion&&ue.releaseVersion.trim()!==""&&he.add(ue.releaseVersion.trim())});const de=Array.from(U).sort(),xe=Array.from(he).sort();console.log("üìù Jazyky pou≈æ√≠van√© v knih√°ch pro filtraci:",de),console.log("üìù Verze vyd√°n√≠ pou≈æ√≠van√© v knih√°ch pro filtraci:",xe),Jt(de),Yt(xe),p.length>0&&!a&&s(p[0].id)}).catch(p=>{if(!r){console.log("‚ö†Ô∏è Chyba v odmountovan√© komponentƒõ, ignoruji");return}console.error("‚ùå KRITICK√Å CHYBA - Failed to fetch data:",p.message,p),console.error("üîç Detaily chyby:",{name:p.name,message:p.message,stack:p.stack,supabaseUrl:Oe,timestamp:new Date().toISOString()}),console.log("üß™ Testuji p≈ôipojen√≠ k Supabase..."),F.from("books").select("count").then(b=>{console.log("‚úÖ Test p≈ôipojen√≠ √∫spƒõ≈°n√Ω:",b)},b=>{console.error("‚ùå Test p≈ôipojen√≠ selhal:",b)}),alert(`Nepoda≈ôilo se naƒç√≠st data z datab√°ze: ${p.message}

Zkontrolujte konzoli pro v√≠ce detail≈Ø.`)}).finally(()=>{r&&(console.log("üèÅ Naƒç√≠t√°n√≠ dokonƒçeno, nastavuji isLoading na false"),rt(!1))}),()=>{console.log("üßπ useEffect cleanup - komponenta se odpojuje"),r=!1}},[]);const Ue=h.useMemo(()=>{if(o.length===0)return[];const r=new Set;return o.forEach(p=>{const b=new Date(p.dateAdded);r.add(`${b.getFullYear()}-${String(b.getMonth()+1).padStart(2,"0")}`)}),Array.from(r).sort()},[o]);h.useEffect(()=>{Ue.length>0&&Se({from:0,to:Ue.length-1})},[Ue]);const vt=async r=>{var p,b;console.log("üîç extractMetadataFromFile - typ souboru:",r.type,"n√°zev:",r.name);try{if(r.type==="application/pdf"){console.log("üìÑ Zpracov√°v√°m PDF soubor...");const k=await eo(r);return console.log("üìÑ PDF metadata extrahov√°na"),k}else if(r.name.toLowerCase().endsWith(".epub")){console.log("üìö Zpracov√°v√°m EPUB soubor...");const k=await to(r);return console.log("üìö EPUB metadata extrahov√°na"),k}return console.log("üìù Zpracov√°v√°m textov√Ω form√°t"),{title:r.name.replace(/\.[^/.]+$/,""),releaseVersion:"",format:((p=r.name.split(".").pop())==null?void 0:p.toUpperCase())||"N/A"}}catch(k){return console.error("‚ùå Chyba p≈ôi extrakci metadat:",k),{title:r.name.replace(/\.[^/.]+$/,""),releaseVersion:"",format:((b=r.name.split(".").pop())==null?void 0:b.toUpperCase())||"N/A"}}},eo=async r=>{try{const p=await r.arrayBuffer(),B=(await(await pdfjsLib.getDocument(p).promise).getMetadata()).info,U=r.name.replace(/\.[^/.]+$/,""),he=de=>{if(!de||de.trim()==="")return"";const xe=de.toLowerCase();return["encoding software","pdf creator","microsoft word","libreoffice","openoffice","adobe acrobat","pdfmaker","ghostscript","latex","tex","pdflatex","xelatex","pandoc","prince xml","weasyprint"].some(Te=>xe.includes(Te))?"":de.trim()};return{title:U,author:B!=null&&B.Author&&B.Author.trim()!==""?B.Author:"Nezn√°m√Ω",publisher:he((B==null?void 0:B.Producer)||""),publicationYear:B!=null&&B.CreationDate?oo(B.CreationDate):null,language:no(B==null?void 0:B.Language)||"Nezn√°m√Ω",releaseVersion:"",format:"PDF"}}catch(p){return console.error("Failed to extract PDF metadata:",p),{title:r.name.replace(/\.[^/.]+$/,""),author:"Nezn√°m√Ω",language:"Nezn√°m√Ω",releaseVersion:"",format:"PDF"}}},to=async r=>({title:r.name.replace(/\.[^/.]+$/,""),author:"Nezn√°m√Ω",language:"Nezn√°m√Ω",releaseVersion:"",format:"EPUB"}),oo=r=>{try{const b=new Date(r).getFullYear();return b>1900&&b<=new Date().getFullYear()?b:null}catch{return null}},no=r=>{if(!r||r.trim()==="")return"Nezn√°m√Ω";const p=r.toLowerCase();return p.includes("cs")||p.includes("czech")||p.includes("ƒçe≈°tina")?"ƒåe≈°tina":p.includes("en")||p.includes("english")||p.includes("angliƒçtina")?"Angliƒçtina":p.includes("sk")||p.includes("slovak")||p.includes("sloven≈°tina")?"Sloven≈°tina":p.includes("de")||p.includes("german")||p.includes("nƒõmƒçina")?"Nƒõmƒçina":p.includes("fr")||p.includes("french")||p.includes("francouz≈°tina")?"Francouz≈°tina":p.includes("es")||p.includes("spanish")||p.includes("≈°panƒõl≈°tina")?"≈†panƒõl≈°tina":r},ro=async r=>{var b;const p=(b=r.target.files)==null?void 0:b[0];if(p){if(p.type==="application/pdf"){we(p),se({performOCR:!1,performCompression:!1,textOnly:!1,textOnly2:!1});const L=(await vt(p)).language||"Nezn√°m√Ω",B=Ee.getBestLanguageMatch(L);Ie(B),ee(!0);return}await kt(p,{performOCR:!1,performCompression:!1,textOnly:!1,textOnly2:!1},"Angliƒçtina")}},kt=async(r,p,b,k="recommended")=>{var L;rt(!0);try{const B=await vt(r);console.log("üìä Extrahovan√° metadata:",{title:B.title,hasOCR:B.hasOCR,format:B.format});let U=r,he=B.hasOCR;if(r.type==="application/pdf"&&p.textOnly){console.log("üìÑ Spou≈°t√≠m text-only extrakci p≈ôes N8N webhook...");try{U=await nr(r),he=!0,console.log("‚úÖ Text-only extrakce dokonƒçena:",U.name)}catch(le){console.error("‚ùå Text-only extrakce selhala:",le.message);const me=["Extrakce textu pomoc√≠ N8N webhook se nezda≈ôila:","",`${le.message}`,"","M≈Ø≈æete:","‚Ä¢ ZRU≈†IT nahr√°n√≠ a zkusit to pozdƒõji","‚Ä¢ POKRAƒåOVAT a nahr√°t p≈Øvodn√≠ PDF bez extrakce","","Chcete pokraƒçovat s nahr√°n√≠m PDF bez extrakce textu?"].join(`
`);if(!confirm(me))throw new Error(`Upload zru≈°en u≈æivatelem. P≈Øvodn√≠ chyba: ${le.message}`);console.log("üìÅ Pokraƒçuji s nahr√°v√°n√≠m p≈Øvodn√≠ho PDF..."),alert(`‚úÖ Pokraƒçuji s nahr√°n√≠m PDF

Soubor bude nahr√°n jako PDF bez extrakce textu.
Extrakci m≈Ø≈æete zkusit pozdƒõji.`),he=B.hasOCR}}else if(r.type==="application/pdf"&&p.textOnly2){console.log("üìÑ Spou≈°t√≠m lok√°ln√≠ text-only 2 extrakci...");try{U=await Kt(r),he=!0,console.log("‚úÖ Text-only 2 extrakce dokonƒçena:",U.name)}catch(le){console.error("‚ùå Text-only 2 extrakce selhala:",le.message);const me=["Lok√°ln√≠ extrakce textu se nezda≈ôila:","",`${le.message}`,"","M≈Ø≈æete:","‚Ä¢ ZRU≈†IT nahr√°n√≠ a zkusit to pozdƒõji","‚Ä¢ POKRAƒåOVAT a nahr√°t p≈Øvodn√≠ PDF bez extrakce","","Chcete pokraƒçovat s nahr√°n√≠m PDF bez extrakce textu?"].join(`
`);if(!confirm(me))throw new Error(`Upload zru≈°en u≈æivatelem. P≈Øvodn√≠ chyba: ${le.message}`);console.log("üìÅ Pokraƒçuji s nahr√°v√°n√≠m p≈Øvodn√≠ho PDF..."),alert(`‚úÖ Pokraƒçuji s nahr√°n√≠m PDF

Soubor bude nahr√°n jako PDF bez extrakce textu.
Extrakci m≈Ø≈æete zkusit pozdƒõji.`),he=B.hasOCR}}else if(r.type==="application/pdf"&&(p.performOCR||p.performCompression)){const le=[];p.performOCR&&le.push("OCR"),p.performCompression&&le.push("komprese"),console.log(`üîÑ Spou≈°t√≠m zpracov√°n√≠ pomoc√≠ iLovePDF (${le.join(" + ")})...`);try{p.performOCR&&p.performCompression?(console.log("üîÑ Spou≈°t√≠m dvoustup≈àov√© zpracov√°n√≠: OCR ‚Üí Komprese..."),U=(await Ee.processWithOCRThenCompression(r,b,k,(Ce,De)=>{console.log(`üìä ${Ce} (${De}%)`)})).compressedFile,he=!0,console.log("‚úÖ Dvoustup≈àov√© zpracov√°n√≠ dokonƒçeno (OCR + komprese)")):p.performOCR?(U=await Ee.performOCR(r,b),he=!0,console.log("‚úÖ OCR zpracov√°n√≠ dokonƒçeno")):p.performCompression&&(U=await Ee.compressPDF(r,k),console.log(`‚úÖ Komprese (${k}) dokonƒçena`)),U=new File([U],r.name,{type:r.type})}catch(me){console.error("‚ùå iLovePDF zpracov√°n√≠ selhalo:",me.message);const Ce=[];p.performOCR&&Ce.push("OCR rozpozn√°n√≠ textu"),p.performCompression&&Ce.push("komprese souboru");const De=["Zpracov√°n√≠ pomoc√≠ iLovePDF se nezda≈ôilo:","",`${me.message}`,"",`Zvolen√© operace: ${Ce.join(" a ")}`,"","M≈Ø≈æete:","‚Ä¢ ZRU≈†IT nahr√°n√≠ a zkusit to pozdƒõji","‚Ä¢ POKRAƒåOVAT a nahr√°t soubor bez zpracov√°n√≠","","Chcete pokraƒçovat s nahr√°n√≠m bez zpracov√°n√≠?"].join(`
`);if(!confirm(De))throw new Error(`Upload zru≈°en u≈æivatelem. P≈Øvodn√≠ chyba: ${me.message}`);console.log("üìÅ Pokraƒçuji s nahr√°v√°n√≠m bez iLovePDF zpracov√°n√≠..."),console.log(`‚ÑπÔ∏è  Soubor bude nahr√°n s p≈Øvodn√≠mi metadaty bez ${Ce.join(" a ")}`),alert(`‚úÖ Pokraƒçuji s nahr√°n√≠m bez zpracov√°n√≠

Soubor bude nahr√°n s p≈Øvodn√≠mi metadaty.
Zpracov√°n√≠ ${Ce.join(" a ")} m≈Ø≈æete zkusit pozdƒõji.`),p.performOCR||(he=B.hasOCR)}}const de=`book_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;console.log(`üìä Velikost souboru p≈ôed nahr√°n√≠m: ${(U.size/1024/1024).toFixed(2)} MB`),console.log(`üìÑ N√°zev souboru: ${U.name}`),console.log(`üìã Typ souboru: ${U.type}`);const{filePath:xe,fileSize:ue}=await oe.uploadFileWithId(U,"Books",de),Te=(p.textOnly||p.textOnly2)&&U.name.endsWith(".txt")?"TXT":B.format||((L=r.name.split(".").pop())==null?void 0:L.toUpperCase())||"N/A";let Be=`https://placehold.co/150x225/f3eee8/4a4a4a?text=${Te}`;if(U.type==="application/pdf")try{console.log("Starting PDF cover generation...");const le=await U.arrayBuffer();console.log("PDF file buffer created, size:",le.byteLength);const me=await Ht(le);if(console.log("Cover generation result:",me?"Success":"Failed"),me){console.log("Generated cover file:",{name:me.name,type:me.type,size:me.size}),console.log('üöÄ Attempting to upload cover to "covers" bucket...'),console.log("Cover file details:",{name:me.name,type:me.type,size:me.size,bookId:de});try{const Ce=await oe.uploadFileWithId(me,"covers",de);console.log("‚úÖ Successfully uploaded to covers bucket:",Ce.filePath);const{data:De}=F.storage.from("covers").getPublicUrl(Ce.filePath);De&&De.publicUrl?(Be=De.publicUrl,console.log("‚úÖ Successfully got public URL from covers bucket:",Be)):console.warn(`‚ùå Cover was uploaded to ${Ce.filePath}, but could not get a public URL.`)}catch(Ce){console.error("‚ùå FAILED to upload to covers bucket:",Ce.message),console.error("Full upload error:",Ce),console.log("üîÑ Trying fallback: uploading to Books bucket in covers/ subfolder...");try{const De=await oe.uploadFileWithId(me,"Books",`covers/${de}`);console.log("‚úÖ Fallback successful - uploaded to Books/covers/:",De.filePath);const{data:st}=F.storage.from("Books").getPublicUrl(De.filePath);st&&st.publicUrl?(Be=st.publicUrl,console.log("‚úÖ Successfully got public URL from Books bucket:",Be)):console.warn(`‚ùå Cover was uploaded to ${De.filePath}, but could not get a public URL.`)}catch(De){console.error("‚ùå FALLBACK ALSO FAILED:",De.message),console.error("Proceeding with placeholder image")}}}else console.error("generateCoverFromPdf returned null")}catch(le){console.error("Failed to process cover image, proceeding with placeholder. Error:",le.message),console.error("Full error:",le)}const qe={title:B.title||r.name.replace(/\.[^/.]+$/,""),author:B.author||"Nezn√°m√Ω",publicationYear:B.publicationYear||null,publisher:B.publisher||"",summary:B.summary||"",keywords:B.keywords||[],language:B.language||"Nezn√°m√Ω",format:Te,fileSize:ue,coverImageUrl:Be,publicationTypes:B.publicationTypes||[],labels:B.labels||[],categories:B.categories||[],releaseVersion:B.releaseVersion||"",filePath:xe,vectorStatus:"pending",hasOCR:he||!1};console.log("üìö Vytv√°≈ô√≠m knihu s p≈ôedbƒõ≈æn√Ωm OCR stavem:",qe.hasOCR);const We=await oe.createBook(qe);if(console.log("‚úÖ Kniha vytvo≈ôena, nyn√≠ detekuji skuteƒçn√Ω OCR stav..."),!p.performOCR&&!p.textOnly&&!p.textOnly2)try{const le=await oe.detectOCRFromStorage(xe);if(console.log("üîç Skuteƒçn√Ω OCR stav:",le),le!==We.hasOCR){console.log("üìù Aktualizuji OCR stav v datab√°zi...");const me=await oe.updateBook({...We,hasOCR:le});console.log("‚úÖ OCR stav aktualizov√°n:",me.hasOCR);const Ce=[me,...o];n(Ce)}else{const me=[We,...o];n(me)}}catch(le){console.error("‚ùå Chyba p≈ôi detekci OCR:",le);const me=[We,...o];n(me)}else{const le=[We,...o];n(le)}z(""),Z([]),W([]),q([]),X([]),ne("all"),ae({from:null,to:null}),s(We.id)}catch(B){console.error("Failed to upload book:",B.message,B),alert(`Nahr√°n√≠ knihy se nezda≈ôilo: ${B.message}`)}finally{rt(!1),Ke.current&&(Ke.current.value="")}},ao=async()=>{be&&(ee(!1),await kt(be,K,ze,Me),we(null))},jt=()=>{ee(!1),we(null),Ke.current&&(Ke.current.value="")},so=r=>{const p=[...o];n(B=>B.map(U=>U.id===r.id?r:U));const b=new Set(Xe);r.labels.forEach(B=>b.add(B)),Qe(Array.from(b).sort());const k=new Set(et);r.categories.forEach(B=>k.add(B)),tt(Array.from(k).sort());const L=new Set(ot);r.publicationTypes.forEach(B=>L.add(B)),nt(Array.from(L).sort()),oe.updateBook(r).catch(B=>{console.error("Failed to update book:",B.message,B),alert(`Ulo≈æen√≠ zmƒõn se nezda≈ôilo: ${B.message}`),n(p)})},wt=r=>{const p=o.find(b=>b.id===r);p&&_e({isOpen:!0,book:p})},Ct=async r=>{const p=o.find(b=>b.id===r);if(!p){alert("‚ùå Kniha nebyla nalezena");return}try{console.log("üì• Stahov√°n√≠ knihy:",p.title);const{data:b,error:k}=await F.storage.from("Books").download(p.filePath);if(k||!b)throw new Error(`Nepoda≈ôilo se st√°hnout soubor: ${k==null?void 0:k.message}`);const L=URL.createObjectURL(b),B=p.filePath.split("/").pop()||`${p.title.replace(/[^a-zA-Z0-9]/g,"_")}.${p.format.toLowerCase()}`,U=document.createElement("a");U.href=L,U.download=B,document.body.appendChild(U),U.click(),document.body.removeChild(U),URL.revokeObjectURL(L),console.log("‚úÖ Soubor byl √∫spƒõ≈°nƒõ sta≈æen:",B)}catch(b){console.error("Chyba p≈ôi stahov√°n√≠ knihy:",b),alert(`‚ùå Chyba p≈ôi stahov√°n√≠ knihy: ${b.message}`)}},lo=async()=>{const r=o.filter(p=>c.has(p.id));if(r.length===0){alert("‚ùå Nejsou vybran√© ≈æ√°dn√© knihy pro sta≈æen√≠");return}if(r.length===1){await Ct(r[0].id);return}try{console.log(`üì• Stahov√°n√≠ ${r.length} knih...`);const p=(await To(async()=>{const{default:xe}=await import("./jszip.min-BkUhkW7u.js").then(ue=>ue.j);return{default:xe}},__vite__mapDeps([0,1,2]))).default,b=new p;let k=0,L=0;const B=r.map(async xe=>{try{console.log(`üì• Stahov√°n√≠: ${xe.title}`);const{data:ue,error:Te}=await F.storage.from("Books").download(xe.filePath);if(Te||!ue)return console.error(`‚ùå Chyba p≈ôi stahov√°n√≠ ${xe.title}:`,Te==null?void 0:Te.message),L++,null;const Be=xe.filePath.split("/").pop()||`${xe.title.replace(/[^a-zA-Z0-9]/g,"_")}.${xe.format.toLowerCase()}`;return b.file(Be,ue),k++,console.log(`‚úÖ √öspƒõ≈°nƒõ p≈ôid√°no do ZIP: ${Be}`),Be}catch(ue){return console.error(`‚ùå Chyba p≈ôi zpracov√°n√≠ ${xe.title}:`,ue),L++,null}});if(await Promise.all(B),k===0){alert("‚ùå Nepoda≈ôilo se st√°hnout ≈æ√°dnou knihu");return}console.log(`üì¶ Vytv√°≈ôen√≠ ZIP archivu s ${k} soubory...`);const U=await b.generateAsync({type:"blob"}),he=URL.createObjectURL(U),de=document.createElement("a");de.href=he,de.download=`knihy_${r.length}_souboru.zip`,document.body.appendChild(de),de.click(),document.body.removeChild(de),URL.revokeObjectURL(he),alert(L===0?`‚úÖ √öspƒõ≈°nƒõ sta≈æeno ${k} knih do ZIP archivu`:`‚ö†Ô∏è Sta≈æeno ${k} knih, ${L} se nepoda≈ôilo st√°hnout`),console.log("‚úÖ Hromadn√© stahov√°n√≠ dokonƒçeno")}catch(p){console.error("Chyba p≈ôi hromadn√©m stahov√°n√≠:",p),alert(`‚ùå Chyba p≈ôi vytv√°≈ôen√≠ ZIP archivu: ${p.message}`)}},io=async()=>{if(!je.book)return;const r=je.book;try{await oe.deleteBook(r.id,r.filePath,r.coverImageUrl,r.title);const p=o.findIndex(k=>k.id===r.id),b=o.filter(k=>k.id!==r.id);if(n(b),a===r.id){let k=null;if(b.length>0){const L=Math.min(p,b.length-1);k=b[L].id}s(k)}if(c.has(r.id)){const k=new Set(c);k.delete(r.id),l(k)}console.log(`Kniha "${r.title}" byla √∫spƒõ≈°nƒõ smaz√°na`)}catch(p){console.error("Failed to delete book:",p.message,p),alert(`Smaz√°n√≠ knihy se nezda≈ôilo: ${p.message}`)}finally{_e({isOpen:!1,book:null})}},co=async(r,p)=>{console.log(`üîç DIAGNOSTIKA STORAGE pro knihu: ${p} (ID: ${r})`);const b=o.find(L=>L.id===r),k=b==null?void 0:b.filePath;if(console.log(`üìÑ File path: ${k}`),!k){console.error("‚ùå Nelze naj√≠t filePath pro knihu");return}try{console.log("üìÅ Kontrola Books/covers/covers/...");const{data:L}=await F.storage.from("Books").list("covers/covers",{limit:100});console.log("Books/covers/covers/ obsahuje:",(L==null?void 0:L.map(ue=>ue.name))||[]);const U=`${k.replace(/\.[^/.]+$/,"")}.jpg`;console.log(`üñºÔ∏è Hled√°m cover: ${U}`);const he=L==null?void 0:L.some(ue=>ue.name===U);console.log(`Cover existuje: ${he?"‚úÖ":"‚ùå"}`),console.log("üìÅ Kontrola images/main/production/...");const{data:de}=await F.storage.from("images").list("main/production",{limit:100});console.log("images/main/production/ obsahuje slo≈æky:",(de==null?void 0:de.map(ue=>ue.name))||[]),console.log(`üìÅ Hled√°m slo≈æku podle UUID: ${r}`);const xe=de==null?void 0:de.some(ue=>ue.name===r);if(console.log(`Slo≈æka existuje: ${xe?"‚úÖ":"‚ùå"}`),xe){const{data:ue}=await F.storage.from("images").list(`main/production/${r}`,{limit:100});console.log(`üìÅ images/main/production/${r}/ obsahuje:`,(ue==null?void 0:ue.map(Te=>Te.name))||[])}}catch(L){console.error("Chyba p≈ôi diagnostice storage:",L)}},uo=async r=>{const p=o.find(b=>b.id===r);if(!p){alert("‚ùå Kniha nenalezena");return}console.log(`üß™ TESTOV√ÅN√ç MAZ√ÅN√ç IMAGES pro knihu: ${p.title} (ID: ${r})`);try{const b=`main/production/${r}`;console.log(`üóÇÔ∏è Pokus o smaz√°n√≠: ${b}`);const{data:k,error:L}=await F.storage.from("images").list(b,{limit:1e3});if(console.log("üìã Seznam soubor≈Ø:",{imageFiles:k,listError:L}),!L&&k&&k.length>0){const B=k.map(he=>`${b}/${he.name}`);console.log("üóëÔ∏è Soubory k smaz√°n√≠:",B);const{error:U}=await F.storage.from("images").remove(B);U?(alert(`‚ùå Test ne√∫spƒõ≈°n√Ω! Chyba: ${U.message}`),console.error("Delete error:",U)):alert(`‚úÖ Test √∫spƒõ≈°n√Ω! Smaz√°no ${B.length} soubor≈Ø ze slo≈æky ${b}`)}else alert(`‚ö†Ô∏è Slo≈æka ${b} neexistuje nebo je pr√°zdn√°`)}catch(b){console.error("Test error:",b),alert(`‚ùå Chyba p≈ôi testu: ${b}`)}},zt=async r=>{try{console.log(`üß™ Testov√°n√≠ webhook pro knihu: ${r}`);const p=await oe.callDeleteWebhook(r);p.success?alert(`‚úÖ Webhook test √∫spƒõ≈°n√Ω!

Zavol√°n webhook pro knihu ID: ${r}
Odpovƒõƒè: ${p.message}`):alert(`‚ùå Webhook test ne√∫spƒõ≈°n√Ω!

Chyba: ${p.message}`)}catch(p){console.error("Chyba p≈ôi testov√°n√≠ webhook≈Ø:",p),alert(`‚ùå Chyba p≈ôi testov√°n√≠ webhook≈Ø: ${p.message}`)}},po=r=>{const p=[];return(!r.author||r.author.trim()===""||r.author==="Nezn√°m√Ω")&&p.push("Autor"),r.publicationYear||p.push("Rok vyd√°n√≠"),(!r.publisher||r.publisher.trim()==="")&&p.push("Nakladatelstv√≠"),(!r.summary||r.summary.trim()==="")&&p.push("Sumarizace"),(!r.keywords||r.keywords.length===0)&&p.push("Kl√≠ƒçov√° slova"),(!r.categories||r.categories.length===0)&&p.push("Kategorie"),p},ho=r=>{const p=po(r);T({isOpen:!0,book:r,missingFields:p})},go=async()=>{const{book:r,missingFields:p}=j;if(r&&(T({isOpen:!1,book:null,missingFields:[]}),!(p.length>0))){V(b=>new Set([...b,r.id]));try{console.log("üì§ Odes√≠l√°n√≠ knihy do vektorov√© datab√°ze:",r.title),console.log("‚è≥ ƒåek√°m na webhook odpovƒõƒè (m≈Ø≈æe trvat a≈æ 5 minut)...");const b=await oe.sendToVectorDatabase(r,!0);b.success?(console.log("‚úÖ Webhook √∫spƒõ≈°nƒõ zpracov√°n"),alert(`‚úÖ ${b.message}`),n(k=>k.map(L=>L.id===r.id?{...L,vectorStatus:"success"}:L))):(console.error("‚ùå Webhook selhal:",b.message),alert(`‚ùå ${b.message}`),n(k=>k.map(L=>L.id===r.id?{...L,vectorStatus:"error"}:L)))}catch(b){if(b.message==="LARGE_PDF_WARNING"){console.log("üìä Otev√≠r√°m modal s varov√°n√≠m o velk√©m PDF..."),console.log("üìä Poƒçet str√°nek:",b.pageCount),G({isOpen:!0,book:b.book,pageCount:b.pageCount}),V(k=>{const L=new Set(k);return L.delete(r.id),L});return}console.error("‚ùå Chyba p≈ôi komunikaci s webhookem:",b),alert(`‚ùå Chyba: ${b instanceof Error?b.message:"Nezn√°m√° chyba"}`),n(k=>k.map(L=>L.id===r.id?{...L,vectorStatus:"error"}:L))}finally{V(b=>{const k=new Set(b);return k.delete(r.id),k})}}},xo=async()=>{const{book:r}=C;if(r){G({isOpen:!1,book:null,pageCount:0}),V(p=>new Set([...p,r.id]));try{console.log("‚ö†Ô∏è U≈æivatel potvrdil odesl√°n√≠ velk√©ho PDF, pokraƒçuji..."),console.log("üì§ Odes√≠l√°n√≠ knihy do vektorov√© datab√°ze:",r.title),console.log("‚è≥ ƒåek√°m na webhook odpovƒõƒè (m≈Ø≈æe trvat a≈æ 5 minut)..."),await oe.updateBook({...r,vectorStatus:"pending"}),n(b=>b.map(k=>k.id===r.id?{...k,vectorStatus:"pending"}:k));const p=await oe.sendToVectorDatabase(r,!0,!0);p.success?(console.log("‚úÖ Webhook √∫spƒõ≈°nƒõ zpracov√°n"),alert(`‚úÖ ${p.message}`),n(b=>b.map(k=>k.id===r.id?{...k,vectorStatus:"success"}:k))):(console.error("‚ùå Webhook selhal:",p.message),alert(`‚ùå ${p.message}`),n(b=>b.map(k=>k.id===r.id?{...k,vectorStatus:"error"}:k)))}catch(p){console.error("‚ùå Chyba p≈ôi komunikaci s webhookem:",p),alert(`‚ùå Chyba: ${p instanceof Error?p.message:"Nezn√°m√° chyba"}`),n(b=>b.map(k=>k.id===r.id?{...k,vectorStatus:"error"}:k))}finally{V(p=>{const b=new Set(p);return b.delete(r.id),b})}}},mo=async()=>{const{book:r}=C;if(r){G({isOpen:!1,book:null,pageCount:0}),V(p=>new Set([...p,r.id]));try{console.log("üìÑ U≈æivatel zvolil odeslat pouze text m√≠sto PDF"),console.log("üìÑ Odes√≠l√°n√≠ pouze textu knihy do vektorov√© datab√°ze:",r.title),console.log("‚è≥ ƒåek√°m na webhook odpovƒõƒè (m≈Ø≈æe trvat a≈æ 5 minut)...");const p=await oe.sendTextOnlyToVectorDatabase(r,!0);p.success?(console.log("‚úÖ Webhook √∫spƒõ≈°nƒõ zpracov√°n (text-only)"),alert(`‚úÖ ${p.message}

üìÑ Odesl√°n pouze extrahovan√Ω text.`),n(b=>b.map(k=>k.id===r.id?{...k,vectorStatus:"success"}:k))):(console.error("‚ùå Webhook selhal:",p.message),alert(`‚ùå ${p.message}`),n(b=>b.map(k=>k.id===r.id?{...k,vectorStatus:"error"}:k)))}catch(p){console.error("‚ùå Chyba p≈ôi komunikaci s webhookem (text-only):",p),alert(`‚ùå Chyba: ${p instanceof Error?p.message:"Nezn√°m√° chyba"}`),n(b=>b.map(k=>k.id===r.id?{...k,vectorStatus:"error"}:k))}finally{V(p=>{const b=new Set(p);return b.delete(r.id),b})}}},fo=async()=>{const{book:r,missingFields:p}=j;if(r&&(T({isOpen:!1,book:null,missingFields:[]}),!(p.length>0))){V(b=>new Set([...b,r.id]));try{console.log("üìÑ Odes√≠l√°n√≠ pouze textu knihy do vektorov√© datab√°ze:",r.title),console.log("‚è≥ ƒåek√°m na webhook odpovƒõƒè (m≈Ø≈æe trvat a≈æ 5 minut)...");const b=await oe.sendTextOnlyToVectorDatabase(r,!0);b.success?(console.log("‚úÖ Webhook √∫spƒõ≈°nƒõ zpracov√°n (text-only)"),alert(`‚úÖ ${b.message}

üìÑ Odesl√°n pouze extrahovan√Ω text (bez PDF bin√°rn√≠ch dat).`),n(k=>k.map(L=>L.id===r.id?{...L,vectorStatus:"success"}:L))):(console.error("‚ùå Webhook selhal:",b.message),alert(`‚ùå ${b.message}`),n(k=>k.map(L=>L.id===r.id?{...L,vectorStatus:"error"}:L)))}catch(b){console.error("‚ùå Chyba p≈ôi komunikaci s webhookem (text-only):",b),n(k=>k.map(L=>L.id===r.id?{...L,vectorStatus:"error"}:L))}finally{V(b=>{const k=new Set(b);return k.delete(r.id),k})}}},bo=r=>{if(!r.metadataSnapshot||!r.vectorAddedAt)return console.log("‚ö†Ô∏è ≈Ω√°dn√Ω snapshot metadat nebo datum VDB - pos√≠l√°m v≈°echna data"),{id:r.id,title:r.title,author:r.author,publicationYear:r.publicationYear,publisher:r.publisher,summary:r.summary,keywords:r.keywords,language:r.language,format:r.format,fileSize:r.fileSize,coverImageUrl:r.coverImageUrl,publicationTypes:r.publicationTypes,labels:r.labels,categories:r.categories,releaseVersion:r.releaseVersion};try{const p=JSON.parse(r.metadataSnapshot);console.log("üì∏ Snapshot data:",p);const b={title:r.title,author:r.author,publicationYear:r.publicationYear,publisher:r.publisher,summary:r.summary,keywords:r.keywords,language:r.language,format:r.format,fileSize:r.fileSize,coverImageUrl:r.coverImageUrl,publicationTypes:r.publicationTypes,labels:r.labels,categories:r.categories,releaseVersion:r.releaseVersion};console.log("üìä Current data:",b);const k={id:r.id};let L=!1;return Object.keys(b).forEach(B=>{const U=b[B],he=p[B];console.log(`üîç Porovn√°v√°m pole '${B}':`),console.log("  - Snapshot:",he),console.log("  - Current:",U);const de=Array.isArray(U)?JSON.stringify(U.sort()):String(U||""),xe=Array.isArray(he)?JSON.stringify(he.sort()):String(he||"");console.log("  - Snapshot str:",xe),console.log("  - Current str:",de),console.log("  - Jsou stejn√©:",de===xe),de!==xe&&(k[B]=U,L=!0,console.log(`üîÑ Zmƒõna v poli '${B}':`,{p≈ôed:he,nyn√≠:U}))}),L?(console.log("üìù Detekovan√© zmƒõny:",Object.keys(k).filter(B=>B!=="id")),k):(console.log("‚úÖ ≈Ω√°dn√© zmƒõny v metadatech od p≈ôid√°n√≠ do VDB"),null)}catch(p){return console.error("‚ùå Chyba p≈ôi parsov√°n√≠ snapshot metadat:",p),{id:r.id,title:r.title,author:r.author,publicationYear:r.publicationYear,publisher:r.publisher,summary:r.summary,keywords:r.keywords,language:r.language,format:r.format,fileSize:r.fileSize,coverImageUrl:r.coverImageUrl,publicationTypes:r.publicationTypes,labels:r.labels,categories:r.categories,releaseVersion:r.releaseVersion}}},yo=async r=>{try{console.log("Vol√°n√≠ webhook pro aktualizaci metadat:",r.title);const p=bo(r);if(!p){alert("‚ÑπÔ∏è ≈Ω√°dn√© zmƒõny v metadatech od p≈ôid√°n√≠ do vektorov√© datab√°ze");return}console.log("üì§ Odes√≠l√°m pouze zmƒõnƒõn√° metadata:",p);const b={action:"update_metadata",bookId:r.id,metadata:{...Object.fromEntries(Object.entries(p).filter(([L])=>L!=="id"))}};console.log("üì§ Webhook payload:",b);const k=await fetch("https://n8n.srv980546.hstgr.cloud/webhook/822e584e-0836-4d1d-aef1-5c4dce6573c0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(k.ok){const L=await k.json().catch(()=>({})),B=Object.keys(p).filter(U=>U!=="id").length;alert(`‚úÖ Metadata √∫spƒõ≈°nƒõ aktualizov√°na (${B} zmƒõn)`)}else alert("‚ùå Chyba p≈ôi aktualizaci metadat")}catch(p){console.error("Chyba p≈ôi vol√°n√≠ webhooku:",p),alert("‚ùå Chyba p≈ôi aktualizaci metadat")}},vo=async()=>{if(!ve.trim()){alert("Pros√≠m, zadejte URL videa");return}P(!0);try{const r=await fetch("https://n8n.srv980546.hstgr.cloud/webhook-test/stt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({videoUrl:ve,timestamp:new Date().toISOString()})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const p=await r.json();console.log("Video √∫spƒõ≈°nƒõ odesl√°no:",p),alert("Video bylo √∫spƒõ≈°nƒõ odesl√°no ke zpracov√°n√≠!"),M(""),Q(!1)}catch(r){console.error("Chyba p≈ôi odes√≠l√°n√≠ videa:",r),alert(`Chyba p≈ôi odes√≠l√°n√≠ videa: ${r.message}`)}finally{P(!1)}},ko=()=>{c.size>0&&I(!0)},jo=async()=>{if(c.size===0)return;const p=o.filter(b=>c.has(b.id)).map(b=>oe.deleteBook(b.id,b.filePath,b.coverImageUrl,b.title));try{const b=await Promise.allSettled(p),k=b.filter(U=>U.status==="fulfilled").length,L=b.filter(U=>U.status==="rejected").length,B=o.filter(U=>!c.has(U.id));n(B),a&&c.has(a)&&s(B.length>0?B[0].id:null),l(new Set),L>0?(console.warn(`Bulk delete completed: ${k} √∫spƒõ≈°n√Ωch, ${L} ne√∫spƒõ≈°n√Ωch`),alert(`Hromadn√© maz√°n√≠ dokonƒçeno: ${k} knih smaz√°no, ${L} se nepoda≈ôilo smazat. Zkontrolujte konzoli pro detaily.`)):console.log(`V≈°ech ${k} knih bylo √∫spƒõ≈°nƒõ smaz√°no`)}catch(b){console.error("Failed to bulk delete books:",b.message,b),alert(`Chyba p≈ôi hromadn√©m maz√°n√≠: ${b.message}`)}finally{I(!1)}},wo=()=>{const r=o.filter(b=>c.has(b.id));if(r.length===0)return;let p=`<?xml version="1.0" encoding="UTF-8"?>
<books>
`;r.forEach(b=>{p+=`  <book id="${b.id}">
`,p+=`    <title><![CDATA[${b.title}]]></title>
`,p+=`    <author><![CDATA[${b.author}]]></author>
`,p+=`    <publicationYear>${b.publicationYear||""}</publicationYear>
`,p+=`  </book>
`}),p+="</books>",or(p,"export.xml","application/xml")},Co=r=>{const p=new Set(c);p.has(r)?p.delete(r):p.add(r),l(p)},zo=r=>{l(r?new Set(pt.map(p=>p.id)):new Set)},St=async r=>{r&&!Xe.includes(r)&&(await oe.addLabel(r)?(Qe(b=>[...b,r].sort()),console.log("‚úÖ ≈†t√≠tek p≈ôid√°n do datab√°ze:",r)):alert(`Nepoda≈ôilo se p≈ôidat ≈°t√≠tek "${r}" do datab√°ze.`))},_t=async r=>{r&&!et.includes(r)&&(await oe.addCategory(r)?(tt(b=>[...b,r].sort()),console.log("‚úÖ Kategorie p≈ôid√°na do datab√°ze:",r)):alert(`Nepoda≈ôilo se p≈ôidat kategorii "${r}" do datab√°ze.`))},Pt=async r=>{r&&!ot.includes(r)&&(await oe.addPublicationType(r)?(nt(b=>[...b,r].sort()),console.log("‚úÖ Typ publikace p≈ôid√°n do datab√°ze:",r)):alert(`Nepoda≈ôilo se p≈ôidat typ publikace "${r}" do datab√°ze.`))},Tt=async r=>{if(!await oe.deleteLabel(r)){alert(`Nepoda≈ôilo se smazat ≈°t√≠tek "${r}" z datab√°ze.`);return}const b=o.map(k=>({...k,labels:k.labels.filter(L=>L!==r)}));n(b),Qe(k=>k.filter(L=>L!==r)),Z(k=>k.filter(L=>L!==r)),b.forEach(k=>{k.labels.some(L=>{var B;return!((B=o.find(U=>U.id===k.id))!=null&&B.labels.includes(L))})&&oe.updateBook(k).catch(L=>{console.error("Failed to update book after label deletion:",L)})}),console.log("‚úÖ ≈†t√≠tek smaz√°n z datab√°ze a v≈°ech knih:",r)},Lt=async r=>{if(!await oe.deleteCategory(r)){alert(`Nepoda≈ôilo se smazat kategorii "${r}" z datab√°ze.`);return}const b=o.map(k=>({...k,categories:k.categories.filter(L=>L!==r)}));n(b),tt(k=>k.filter(L=>L!==r)),W(k=>k.filter(L=>L!==r)),b.forEach(k=>{k.categories.some(L=>{var B;return!((B=o.find(U=>U.id===k.id))!=null&&B.categories.includes(L))})&&oe.updateBook(k).catch(L=>{console.error("Failed to update book after category deletion:",L)})}),console.log("‚úÖ Kategorie smaz√°na z datab√°ze a v≈°ech knih:",r)},$t=async r=>{if(!await oe.deletePublicationType(r)){alert(`Nepoda≈ôilo se smazat typ publikace "${r}" z datab√°ze.`);return}const b=o.map(k=>({...k,publicationTypes:k.publicationTypes.filter(L=>L!==r)}));n(b),nt(k=>k.filter(L=>L!==r)),q(k=>k.filter(L=>L!==r)),b.forEach(k=>{k.publicationTypes.some(L=>{var B;return!((B=o.find(U=>U.id===k.id))!=null&&B.publicationTypes.includes(L))})&&oe.updateBook(k).catch(L=>{console.error("Failed to update book after publication type deletion:",L)})}),console.log("‚úÖ Typ publikace smaz√°n z datab√°ze a v≈°ech knih:",r)},at=r=>{alert(`Konverze pro ${c.size} ${c.size===1?"knihu":c.size>1&&c.size<5?"knihy":"knih"} do form√°tu ${r} byla spu≈°tƒõna.`),ke(!1),l(new Set)},So=r=>{if(!r||!r.filePath){alert("K t√©to knize nen√≠ p≈ôi≈ôazen ≈æ√°dn√Ω soubor.");return}const{data:p}=F.storage.from("Books").getPublicUrl(r.filePath);p&&p.publicUrl?window.open(p.publicUrl,"_blank","noopener,noreferrer"):alert("Nepoda≈ôilo se z√≠skat ve≈ôejnou URL adresu souboru.")},pt=h.useMemo(()=>o.filter(r=>{const p=f.toLowerCase(),b=p===""||r.title.toLowerCase().includes(p)||r.author.toLowerCase().includes(p)||r.keywords.some(le=>le.toLowerCase().includes(p)),k=D.length===0||D.every(le=>r.labels.includes(le)),L=N.length===0||N.every(le=>r.categories.includes(le)),B=w.length===0||w.some(le=>r.publicationTypes.includes(le)),U=H.length===0||H.includes(r.releaseVersion),he=O.length===0||O.includes(r.language),de=v==="all"||r.vectorStatus===v,xe=(!ie.from||r.publicationYear&&r.publicationYear>=ie.from)&&(!ie.to||r.publicationYear&&r.publicationYear<=ie.to),ue=Ue[ge.from],Te=Ue[ge.to];if(!ue||!Te)return!0;const Be=new Date(r.dateAdded),qe=`${Be.getFullYear()}-${String(Be.getMonth()+1).padStart(2,"0")}`,We=qe>=ue&&qe<=Te;return b&&k&&L&&B&&U&&he&&de&&xe&&We}),[o,f,D,N,w,H,O,v,ie,ge,Ue]),ht=h.useMemo(()=>o.find(r=>r.id===a),[o,a]),[_o,Po]=h.useMemo(()=>{const r=o.map(p=>p.publicationYear).filter(p=>p!==null&&p>1e3);return r.length===0?[new Date().getFullYear()-20,new Date().getFullYear()]:[Math.min(...r),Math.max(...r)]},[o]);return e.jsxs("div",{style:d.appContainer,children:[e.jsx("input",{type:"file",ref:Ke,onChange:ro,style:{display:"none"},accept:".pdf,.epub,.mobi,.txt"}),e.jsx(sr,{onUploadClick:()=>{var r;return(r=Ke.current)==null?void 0:r.click()},viewMode:g,onViewModeChange:m,selectedCount:c.size,onBulkDelete:ko,onBulkDownload:lo,onExportXml:wo,onConvertClick:()=>ke(!0),isAnyBookSelected:c.size>0,onChatbotManagementClick:()=>$(!0),onAddVideoClick:()=>Q(!0),currentUser:t,onUserManagementClick:()=>y(!0),onProfileSettingsClick:()=>i(!0),onLogoutClick:async()=>{const{error:r}=await Mo();r?alert(`Chyba p≈ôi odhl√°≈°en√≠: ${r}`):window.location.reload()}}),e.jsxs("div",{style:d.mainContent,children:[e.jsx(ir,{filter:f,onFilterChange:z,allLabels:Xe,selectedLabels:D,onLabelFilterChange:Z,onAddLabel:St,onDeleteLabel:Tt,allCategories:et,selectedCategories:N,onCategoryFilterChange:W,onAddCategory:_t,onDeleteCategory:Lt,allTypes:ot,selectedTypes:w,onTypeFilterChange:q,onAddType:Pt,onDeleteType:$t,allVersions:Gt,selectedVersions:H,onVersionFilterChange:te,allLanguages:qt,selectedLanguages:O,onLanguageFilterChange:X,vdbFilter:v,onVdbFilterChange:ne,yearRange:ie,onYearRangeChange:ae,minYear:_o,maxYear:Po,availableMonths:Ue,dateAddedRange:ge,onDateAddedRangeChange:Se}),e.jsx("main",{style:d.bookListContainer,children:yt?e.jsx("p",{children:"Naƒç√≠t√°n√≠ knih..."}):g==="list"?e.jsx(cr,{books:pt,selectedBookId:a,selectedBookIds:c,onSelectBook:r=>{s(r)},onToggleSelection:Co,onSelectAll:zo,onDeleteBook:wt,onDownloadBook:Ct,onTestWebhook:zt,onVectorDatabaseAction:ho,vectorProcessingBooks:J}):e.jsx(dr,{books:pt,selectedBookId:a,onSelectBook:s})}),ht?e.jsx("aside",{style:d.detailPanel,children:e.jsx(ur,{book:ht,onUpdate:so,onDelete:wt,onTestWebhook:zt,onDebugStorage:co,onTestDeleteImages:uo,onReadClick:()=>So(ht),allLabels:Xe,onAddNewLabel:St,onDeleteLabel:Tt,allCategories:et,onAddNewCategory:_t,onDeleteCategory:Lt,allPublicationTypes:ot,onAddNewPublicationType:Pt,onDeletePublicationType:$t,allAvailableLanguages:Xt})}):!yt&&o.length>0&&e.jsx("aside",{style:d.detailPanel,children:e.jsx("div",{style:{...d.detailContent,justifyContent:"center",alignItems:"center",height:"100%"},children:e.jsx("p",{style:{color:"var(--text-secondary)"},children:"Vyberte knihu ze seznamu."})})})]}),e.jsxs(Ne,{isOpen:ye,onClose:()=>ke(!1),title:"Konvertovat knihu",children:[e.jsxs("p",{children:["Vyberte form√°t pro konverzi vybran√Ωch knih (",c.size,")."]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:[e.jsx("button",{style:d.button,onClick:()=>at("EPUB"),children:"EPUB"}),e.jsx("button",{style:d.button,onClick:()=>at("MOBI"),children:"MOBI"}),e.jsx("button",{style:d.button,onClick:()=>at("PDF"),children:"PDF"}),e.jsx("button",{style:d.button,onClick:()=>at("TXT"),children:"TXT"})]})]}),e.jsxs(Ne,{isOpen:je.isOpen,onClose:()=>_e({isOpen:!1,book:null}),title:"Potvrdit smaz√°n√≠",children:[e.jsxs("p",{children:['Opravdu chcete smazat knihu "',(Nt=je.book)==null?void 0:Nt.title,'"?']}),e.jsxs("div",{style:{display:"flex",gap:"1rem",marginTop:"1.5rem",justifyContent:"flex-end"},children:[e.jsx("button",{style:d.button,onClick:()=>_e({isOpen:!1,book:null}),children:"Zru≈°it"}),e.jsx("button",{style:{...d.button,...d.buttonDanger},onClick:io,children:"Smazat"})]})]}),e.jsxs(Ne,{isOpen:_,onClose:()=>I(!1),title:"Potvrdit hromadn√© smaz√°n√≠",children:[e.jsxs("p",{children:["Opravdu chcete smazat ",c.size," ",c.size===1?"knihu":c.size>1&&c.size<5?"knihy":"knih","?"]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",marginTop:"1.5rem",justifyContent:"flex-end"},children:[e.jsx("button",{style:d.button,onClick:()=>I(!1),children:"Zru≈°it"}),e.jsx("button",{style:{...d.button,...d.buttonDanger},onClick:jo,children:"Smazat"})]})]}),e.jsx(Ne,{isOpen:j.isOpen,onClose:()=>T({isOpen:!1,book:null,missingFields:[]}),title:j.missingFields.length>0?"Chyb√≠ povinn√° metadata":"Potvrdit odesl√°n√≠ do vektorov√© datab√°ze",children:j.missingFields.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:['‚ùå Nelze odeslat knihu "',(Dt=j.book)==null?void 0:Dt.title,'" do vektorov√© datab√°ze.']}),e.jsx("p",{children:e.jsx("strong",{children:"Chyb√≠ n√°sleduj√≠c√≠ povinn√° metadata:"})}),e.jsx("ul",{style:{margin:"1rem 0",paddingLeft:"1.5rem"},children:j.missingFields.map(r=>e.jsx("li",{style:{margin:"0.5rem 0",color:"var(--danger-color)"},children:r},r))}),e.jsx("p",{style:{fontSize:"0.9em",color:"var(--text-secondary)"},children:"Pros√≠m dopl≈àte tato metadata v detailu knihy a zkuste to znovu."}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginTop:"1.5rem"},children:[e.jsx("button",{style:{...d.button,border:"2px solid var(--primary-color)",backgroundColor:"transparent",color:"var(--primary-color)",fontWeight:"500",padding:"0.75rem 1.25rem",transition:"all 0.2s ease"},onClick:()=>{T({isOpen:!1,book:null,missingFields:[]}),j.book&&s(j.book.id)},onMouseEnter:r=>{r.currentTarget.style.backgroundColor="rgba(var(--primary-color-rgb), 0.1)"},onMouseLeave:r=>{r.currentTarget.style.backgroundColor="transparent"},children:"Upravit knihu"}),e.jsx("button",{style:{...d.button,border:"2px solid var(--border-color)",backgroundColor:"transparent",color:"var(--text-primary)",fontWeight:"500",padding:"0.75rem 1.25rem",transition:"all 0.2s ease"},onClick:()=>T({isOpen:!1,book:null,missingFields:[]}),onMouseEnter:r=>{r.currentTarget.style.backgroundColor="var(--bg-secondary)"},onMouseLeave:r=>{r.currentTarget.style.backgroundColor="transparent"},children:"Zav≈ô√≠t"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"1rem"},children:[e.jsx(He,{status:"pending"}),e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Kniha:"})," ",(Bt=j.book)==null?void 0:Bt.title]}),e.jsxs("p",{style:{fontSize:"0.9em",color:"var(--text-secondary)"},children:["Autor: ",(Ft=j.book)==null?void 0:Ft.author," ‚Ä¢ ",(Ot=j.book)==null?void 0:Ot.publicationYear]})]})]}),e.jsx("p",{children:"Opravdu chcete odeslat tuto knihu do vektorov√© datab√°ze?"}),e.jsx("div",{style:{margin:"1.5rem 0",padding:"1rem",backgroundColor:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border-color)"},children:e.jsxs("div",{style:{fontSize:"0.95em"},children:[e.jsx("div",{style:{fontWeight:"500",marginBottom:"8px"},children:"‚è≥ ƒåek√°n√≠ na zpracov√°n√≠"}),e.jsx("div",{style:{fontSize:"0.85em",color:"var(--text-secondary)",lineHeight:"1.5"},children:"Aplikace bude ƒçekat na webhook odpovƒõƒè a≈æ 5 minut a zobraz√≠ v√Ωsledek zpracov√°n√≠. Ikona se bude ot√°ƒçet bƒõhem cel√©ho procesu."})]})}),e.jsx("div",{style:{margin:"1.5rem 0",padding:"1rem",backgroundColor:"#fff3cd",borderRadius:"8px",border:"1px solid #ffc107"},children:e.jsxs("div",{style:{fontSize:"0.95em"},children:[e.jsx("div",{style:{fontWeight:"500",marginBottom:"8px",color:"#856404"},children:"üí° Doporuƒçen√≠ pro velk√© PDF"}),e.jsxs("div",{style:{fontSize:"0.85em",color:"#856404",lineHeight:"1.5"},children:[e.jsx("strong",{children:"PDF s v√≠ce ne≈æ 1000 str√°nkami:"})," Doporuƒçujeme pou≈æ√≠t tlaƒç√≠tko ",e.jsx("strong",{children:'"Odeslat pouze text do VDB"'}),"pro rychlej≈°√≠ zpracov√°n√≠ a ni≈æ≈°√≠ n√°klady. Syst√©m automaticky varuje p≈ôi detekci velk√Ωch soubor≈Ø."]}),e.jsxs("div",{style:{fontSize:"0.85em",color:"#856404",lineHeight:"1.5",marginTop:"8px"},children:[e.jsx("strong",{children:"Text-only v√Ωhody:"})," ‚ö° Rychlej≈°√≠ ‚Ä¢ üí∞ Ni≈æ≈°√≠ n√°klady ‚Ä¢ ‚úÖ Spolehlivƒõj≈°√≠ pro velk√© soubory"]})]})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginTop:"1.5rem"},children:[e.jsx("button",{style:{...d.button,border:"2px solid #6c757d",backgroundColor:"transparent",color:"#6c757d",fontWeight:"500",padding:"0.75rem 1.25rem",transition:"all 0.2s ease"},onClick:()=>{j.book&&yo(j.book)},onMouseEnter:r=>{r.currentTarget.style.backgroundColor="rgba(108, 117, 125, 0.1)"},onMouseLeave:r=>{r.currentTarget.style.backgroundColor="transparent"},children:"üîÑ Aktualizovat metadata"}),e.jsx("button",{style:{...d.button,border:"2px solid #28a745",backgroundColor:"transparent",color:"#28a745",fontWeight:"500",padding:"0.75rem 1.25rem",transition:"all 0.2s ease"},onClick:fo,title:"Ode≈°le pouze extrahovan√Ω text do VDB (rychlej≈°√≠, men≈°√≠ velikost)",onMouseEnter:r=>{r.currentTarget.style.backgroundColor="rgba(40, 167, 69, 0.1)"},onMouseLeave:r=>{r.currentTarget.style.backgroundColor="transparent"},children:"üìÑ Odeslat pouze text do VDB"}),e.jsx("button",{style:{...d.button,border:"2px solid #007bff",backgroundColor:"transparent",color:"#007bff",fontWeight:"500",padding:"0.75rem 1.25rem",transition:"all 0.2s ease"},onClick:go,title:"Ode≈°le cel√© PDF vƒçetnƒõ bin√°rn√≠ch dat do VDB",onMouseEnter:r=>{r.currentTarget.style.backgroundColor="rgba(0, 123, 255, 0.1)"},onMouseLeave:r=>{r.currentTarget.style.backgroundColor="transparent"},children:"üìò Odeslat PDF do VDB"}),e.jsx("button",{style:{...d.button,border:"2px solid var(--border-color)",backgroundColor:"transparent",color:"var(--text-primary)",fontWeight:"500",padding:"0.75rem 1.25rem",marginTop:"0.5rem",transition:"all 0.2s ease"},onClick:()=>T({isOpen:!1,book:null,missingFields:[]}),onMouseEnter:r=>{r.currentTarget.style.backgroundColor="var(--bg-secondary)"},onMouseLeave:r=>{r.currentTarget.style.backgroundColor="transparent"},children:"Zru≈°it"})]})]})}),e.jsx(Ne,{isOpen:C.isOpen,onClose:()=>G({isOpen:!1,book:null,pageCount:0}),title:"Velk√Ω PDF soubor",children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:{fontSize:"3rem"},children:"‚ö†Ô∏è"}),e.jsxs("div",{children:[e.jsxs("p",{style:{margin:0,fontSize:"1.1em",fontWeight:"500"},children:["Tento PDF m√° ",e.jsxs("strong",{children:[C.pageCount," str√°nek"]})]}),e.jsx("p",{style:{margin:"8px 0 0 0",fontSize:"0.95em",color:"var(--text-secondary)"},children:"Zpracov√°n√≠ m≈Ø≈æe trvat nƒõkolik minut"})]})]}),e.jsx("div",{style:{padding:"1rem",backgroundColor:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border-color)"},children:e.jsxs("p",{style:{margin:0,fontSize:"0.95em",lineHeight:"1.6"},children:[e.jsx("strong",{children:"üí° Doporuƒçen√≠:"})," Pro rychlej≈°√≠ zpracov√°n√≠ doporuƒçujeme odeslat pouze extrahovan√Ω text m√≠sto cel√©ho PDF souboru."]})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[e.jsx("button",{style:{...d.button,border:"2px solid #28a745",backgroundColor:"transparent",color:"#28a745",fontWeight:"500",padding:"0.75rem 1.25rem",justifyContent:"center",transition:"all 0.2s ease"},onClick:mo,onMouseEnter:r=>{r.currentTarget.style.backgroundColor="rgba(40, 167, 69, 0.1)"},onMouseLeave:r=>{r.currentTarget.style.backgroundColor="transparent"},children:"üìÑ Odeslat jako text (doporuƒçeno)"}),e.jsx("button",{style:{...d.button,border:"2px solid #6c757d",backgroundColor:"transparent",color:"#6c757d",fontWeight:"500",padding:"0.75rem 1.25rem",justifyContent:"center",transition:"all 0.2s ease"},onClick:xo,onMouseEnter:r=>{r.currentTarget.style.backgroundColor="rgba(108, 117, 125, 0.1)"},onMouseLeave:r=>{r.currentTarget.style.backgroundColor="transparent"},children:"üìò Pokraƒçovat s PDF"}),e.jsx("button",{style:{...d.button,border:"2px solid var(--border-color)",backgroundColor:"transparent",color:"var(--text-primary)",fontWeight:"500",padding:"0.75rem 1.25rem",justifyContent:"center",marginTop:"0.5rem",transition:"all 0.2s ease"},onClick:()=>G({isOpen:!1,book:null,pageCount:0}),onMouseEnter:r=>{r.currentTarget.style.backgroundColor="var(--bg-secondary)"},onMouseLeave:r=>{r.currentTarget.style.backgroundColor="transparent"},children:"Zru≈°it"})]})]})}),e.jsx(Ne,{isOpen:A,onClose:jt,title:"Zpracov√°n√≠ PDF souboru",children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[e.jsx("p",{style:{margin:0,color:"var(--text-secondary)"},children:"Vyberte, kter√© operace chcete prov√©st s nahr√°van√Ωm PDF souborem:"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:K.performOCR,onChange:r=>se(p=>({...p,performOCR:r.target.checked,textOnly:!1,textOnly2:!1})),style:{marginRight:"0.5rem"}}),e.jsx("strong",{children:"Prov√©st OCR"}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9em"},children:"- Rozpozn√°n√≠ textu v naskenovan√Ωch dokumentech"})]}),K.performOCR&&e.jsx("div",{style:{marginLeft:"1.5rem",padding:"1rem",backgroundColor:"var(--background-tertiary)",borderRadius:"8px",border:"1px solid var(--border-color)"},children:e.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("strong",{style:{fontSize:"0.9em"},children:"Jazyk dokumentu pro OCR:"}),e.jsx("select",{value:ze,onChange:r=>Ie(r.target.value),style:{padding:"0.5rem",borderRadius:"4px",border:"1px solid var(--border-color)",backgroundColor:"var(--background-primary)",color:"var(--text-primary)",fontSize:"0.9em"},children:Ee.getAvailableLanguages().map(r=>e.jsx("option",{value:r.label,children:r.label},r.code))})]})}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:K.performCompression,onChange:r=>se(p=>({...p,performCompression:r.target.checked,textOnly:!1,textOnly2:!1})),style:{marginRight:"0.5rem"}}),e.jsx("strong",{children:"Prov√©st kompresi"}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9em"},children:"- Zmen≈°en√≠ velikosti souboru"})]}),K.performCompression&&e.jsxs("div",{style:{marginLeft:"1.5rem",padding:"1rem",backgroundColor:"var(--background-tertiary)",borderRadius:"8px",border:"1px solid var(--border-color)"},children:[e.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("strong",{style:{fontSize:"0.9em"},children:"√örove≈à komprese:"}),e.jsxs("select",{value:Me,onChange:r=>ut(r.target.value),style:{padding:"0.5rem",borderRadius:"4px",border:"1px solid var(--border-color)",backgroundColor:"var(--background-primary)",color:"var(--text-primary)",fontSize:"0.9em"},children:[e.jsx("option",{value:"low",children:"Low - Minim√°ln√≠ komprese (zachov√° kvalitu)"}),e.jsx("option",{value:"recommended",children:"Recommended - Optim√°ln√≠ pomƒõr velikost/kvalita"}),e.jsx("option",{value:"extreme",children:"Extreme - Maxim√°ln√≠ komprese (m≈Ø≈æe sn√≠≈æit kvalitu)"})]})]}),e.jsxs("div",{style:{marginTop:"0.5rem",fontSize:"0.8em",color:"var(--text-secondary)",lineHeight:"1.4"},children:[Me==="low"&&e.jsxs(e.Fragment,{children:["üîπ ",e.jsx("strong",{children:"Low:"})," Minim√°ln√≠ komprese pro zachov√°n√≠ kvality bez ztr√°ty dat"]}),Me==="recommended"&&e.jsxs(e.Fragment,{children:["üîπ ",e.jsx("strong",{children:"Recommended:"})," Nejlep≈°√≠ mix komprese a kvality pro bƒõ≈æn√© pou≈æit√≠"]}),Me==="extreme"&&e.jsxs(e.Fragment,{children:["üîπ ",e.jsx("strong",{children:"Extreme:"})," Maxim√°ln√≠ komprese, m≈Ø≈æe sn√≠≈æit kvalitu obr√°zk≈Ø"]})]})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:K.textOnly,onChange:r=>{const p=r.target.checked;se(p?{performOCR:!1,performCompression:!1,textOnly:!0,textOnly2:!1}:b=>({...b,textOnly:!1}))},style:{marginRight:"0.5rem"}}),e.jsx("strong",{children:"Nahr√°t pouze text"}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9em"},children:"- Extrahuje text z PDF p≈ôes webhook a ulo≈æ√≠ jako .txt soubor"})]}),K.textOnly&&e.jsx("div",{style:{marginLeft:"1.5rem",padding:"1rem",backgroundColor:"#fff3cd",borderRadius:"8px",border:"1px solid #ffc107"},children:e.jsxs("p",{style:{margin:0,fontSize:"0.9em",color:"#856404"},children:["‚ÑπÔ∏è ",e.jsx("strong",{children:"Re≈æim pouze text:"}),e.jsx("br",{}),"PDF bude zpracov√°no p≈ôes N8N webhook, text bude extrahov√°n a ulo≈æen jako .txt soubor. Tato mo≈ænost je exkluzivn√≠ - nelze kombinovat s OCR nebo kompres√≠."]})}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:K.textOnly2,onChange:r=>{const p=r.target.checked;se(p?{performOCR:!1,performCompression:!1,textOnly:!1,textOnly2:!0}:b=>({...b,textOnly2:!1}))},style:{marginRight:"0.5rem"}}),e.jsx("strong",{children:"Nahr√°t pouze text 2"}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9em"},children:"- Lok√°ln√≠ extrakce textu z PDF a ulo≈æen√≠ jako .txt soubor"})]}),K.textOnly2&&e.jsx("div",{style:{marginLeft:"1.5rem",padding:"1rem",backgroundColor:"#d1ecf1",borderRadius:"8px",border:"1px solid #0dcaf0"},children:e.jsxs("p",{style:{margin:0,fontSize:"0.9em",color:"#055160"},children:["‚ÑπÔ∏è ",e.jsx("strong",{children:"Re≈æim pouze text 2:"}),e.jsx("br",{}),"Text bude extrahov√°n lok√°lnƒõ z PDF bez pou≈æit√≠ webhooku a ulo≈æen jako samostatn√Ω .txt soubor. V aplikaci bude ulo≈æen textov√Ω soubor m√≠sto PDF. Tato mo≈ænost je exkluzivn√≠ - nelze kombinovat s OCR nebo kompres√≠."]})})]}),(K.performOCR||K.performCompression||K.textOnly||K.textOnly2)&&e.jsx("div",{style:{backgroundColor:"var(--background-tertiary)",padding:"1rem",borderRadius:"8px",border:"1px solid var(--border-color)"},children:e.jsxs("p",{style:{margin:0,fontSize:"0.9em",color:"var(--text-secondary)"},children:[K.textOnly?e.jsx(e.Fragment,{children:"‚è±Ô∏è Zpracov√°n√≠ pomoc√≠ N8N workflow m≈Ø≈æe trvat nƒõkolik sekund a≈æ minut v z√°vislosti na velikosti souboru."}):K.textOnly2?e.jsx(e.Fragment,{children:"‚è±Ô∏è Lok√°ln√≠ extrakce textu m≈Ø≈æe trvat nƒõkolik sekund v z√°vislosti na velikosti souboru."}):e.jsx(e.Fragment,{children:"‚è±Ô∏è Zpracov√°n√≠ pomoc√≠ iLovePDF API m≈Ø≈æe trvat nƒõkolik sekund a≈æ minut v z√°vislosti na velikosti souboru."}),K.performOCR&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),"üîç OCR bude provedeno v jazyce: ",e.jsx("strong",{children:ze})]}),K.performCompression&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),"üóúÔ∏è Komprese: ",e.jsx("strong",{children:Me})]}),K.textOnly&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),"üìÑ Text bude extrahov√°n p≈ôes webhook a ulo≈æen jako .txt soubor"]}),K.textOnly2&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),"üìÑ Text bude extrahov√°n lok√°lnƒõ a ulo≈æen jako .txt soubor"]})]})}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1rem"},children:[e.jsx("button",{style:d.button,onClick:jt,children:"Zru≈°it"}),e.jsx("button",{style:{...d.button,backgroundColor:"var(--accent-primary)",color:"white"},onClick:ao,children:K.textOnly?"Extrahovat text (webhook) a nahr√°t":K.textOnly2?"Extrahovat text (lok√°lnƒõ) a nahr√°t":K.performOCR||K.performCompression?"Zpracovat a nahr√°t":"Nahr√°t bez zpracov√°n√≠"})]})]})}),pe&&e.jsx(un,{onClose:()=>$(!1),onOpenChat:(r,p)=>{console.log(`üöÄ Otev√≠r√°m chat: ${r}`,p),Y({id:r,features:p})}}),e.jsx(Ne,{isOpen:re,onClose:()=>Q(!1),title:"P≈ôidat video",children:e.jsxs("div",{style:{padding:"1rem 0"},children:[e.jsxs("div",{style:d.fieldGroup,children:[e.jsx("label",{style:d.label,children:"URL videa"}),e.jsx("input",{type:"text",value:ve,onChange:r=>M(r.target.value),placeholder:"https://example.com/video.mp4",style:{...d.input,width:"100%",padding:"0.75rem",fontSize:"1rem"},disabled:Pe}),e.jsx("div",{style:{marginTop:"0.5rem",fontSize:"0.875rem",color:"var(--text-secondary)"},children:"Vlo≈æte URL videa, kter√© chcete odeslat ke zpracov√°n√≠"})]}),e.jsxs("div",{style:{marginTop:"2rem",display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[e.jsx("button",{style:{...d.button,backgroundColor:"var(--background-tertiary)",color:"var(--text-primary)"},onClick:()=>Q(!1),disabled:Pe,children:"Zru≈°it"}),e.jsx("button",{style:{...d.button,backgroundColor:"var(--accent-primary)",color:"white"},onClick:vo,disabled:Pe||!ve.trim(),children:Pe?"Odes√≠l√°m...":"Odeslat"})]})]})}),ce&&e.jsx("div",{style:d.chatOverlay,children:e.jsx("div",{style:d.chatContainer,children:e.jsx("div",{style:d.chatContent,children:e.jsxs("div",{style:{height:"100%",display:"flex",flexDirection:"column"},children:[console.log("üìã P≈ôed√°v√°m chatbotId do FilteredSanaChatWithSettings:",ce.id),e.jsx(hn,{chatbotId:ce.id,onClose:()=>Y(null)})]})})})}),u&&e.jsx(Dn,{currentUserId:t.id,onClose:()=>y(!1)}),x&&e.jsx(Ne,{isOpen:x,onClose:()=>i(!1),title:"",children:e.jsx(Bn,{currentUser:t,onClose:()=>i(!1)})})]})},sr=({onUploadClick:t,viewMode:o,onViewModeChange:n,selectedCount:a,onBulkDelete:s,onBulkDownload:c,onExportXml:l,onConvertClick:g,isAnyBookSelected:m,onChatbotManagementClick:u,onAddVideoClick:y,currentUser:x,onUserManagementClick:i,onProfileSettingsClick:f,onLogoutClick:z})=>{const[D,Z]=h.useState(!1),N=x.role==="spravce";return e.jsxs("header",{style:d.header,children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"2rem"},children:[e.jsx("img",{src:"https://modopafybeslbcqjxsve.supabase.co/storage/v1/object/public/web/image-removebg-preview%20(1).png ",alt:"MedBase Logo",style:{height:"60px",width:"auto",objectFit:"contain"}}),e.jsxs("div",{style:d.headerActions,className:"header-actions-responsive",children:[e.jsxs("button",{style:d.button,onClick:t,children:[e.jsx(An,{})," ",e.jsx("span",{className:"button-text",children:"P≈ôidat knihu"})]}),e.jsxs("button",{style:d.button,onClick:y,children:[e.jsx(Kn,{})," ",e.jsx("span",{className:"button-text",children:"P≈ôidat video"})]}),e.jsx("button",{style:d.button,onClick:g,disabled:!m,children:e.jsx("span",{className:"button-text",children:"Konvertovat knihu"})}),N&&e.jsxs("button",{style:d.button,onClick:u,children:[e.jsx(Hn,{})," ",e.jsx("span",{className:"button-text",children:"Spr√°va chatbot≈Ø"})]}),N&&e.jsxs("button",{style:d.button,onClick:i,children:[e.jsx(Gn,{})," ",e.jsx("span",{className:"button-text",children:"Spr√°va u≈æivatel≈Ø"})]}),a>0&&e.jsxs("div",{style:{position:"relative"},children:[e.jsxs("button",{style:d.button,onClick:()=>Z(W=>!W),onBlur:()=>setTimeout(()=>Z(!1),200),children:["Hromadn√© akce (",a,") ",e.jsx(Wn,{})]}),D&&e.jsxs("div",{style:d.dropdownMenu,children:[e.jsxs("a",{style:d.dropdownMenuLink,onClick:()=>{s(),Z(!1)},children:[e.jsx(Ae,{size:14})," Smazat vybran√©"]}),e.jsxs("a",{style:d.dropdownMenuLink,onClick:()=>{c(),Z(!1)},children:[e.jsx(Ut,{})," St√°hnout vybran√©"]}),e.jsxs("a",{style:d.dropdownMenuLink,onClick:()=>{l(),Z(!1)},children:[e.jsx(Zn,{})," Exportovat do XML"]})]})]})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"nowrap"},children:[e.jsxs("button",{className:"user-info-button",onClick:f,style:{display:"flex",alignItems:"center",gap:"8px",padding:"6px 12px",background:"var(--background-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",cursor:"pointer",transition:"all 0.2s",fontSize:"12px",color:"var(--text-primary)",whiteSpace:"nowrap"},title:x.email,children:[e.jsx("span",{className:"user-email-text",style:{fontWeight:"500",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"150px"},children:x.firstName}),e.jsx("span",{className:"user-role-badge",style:{fontSize:"10px",padding:"2px 6px",background:N?"#e0e7ff":"#f3e8ff",color:N?"#1e40af":"#6b21a8",borderRadius:"6px",fontWeight:"500"},children:N?"Spr√°vce":"Admin"})]}),e.jsxs("div",{style:d.viewToggle,children:[e.jsx("button",{style:{...d.iconButton,...o==="list"?d.iconButtonActive:{}},onClick:()=>n("list"),"aria-label":"List view",children:e.jsx(En,{})}),e.jsx("button",{style:{...d.iconButton,...o==="grid"?d.iconButtonActive:{}},onClick:()=>n("grid"),"aria-label":"Grid view",children:e.jsx(Rn,{})})]}),e.jsx("button",{style:{...d.iconButton,padding:"0.5rem"},onClick:f,title:"Nastaven√≠ profilu",children:e.jsx(Yn,{})}),e.jsxs("button",{className:"logout-button",style:{...d.button,background:"var(--background-secondary)",color:"var(--text-primary)",border:"1px solid var(--border-color)"},onClick:z,title:"Odhl√°sit se",children:[e.jsx(qn,{})," ",e.jsx("span",{className:"logout-text",children:"Odhl√°sit"})]})]})]})},Je=({items:t,selectedItems:o,onItemClick:n,maxVisible:a=10,renderItem:s})=>{const[c,l]=h.useState(!1);if(t.length===0)return e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"0.9em",fontStyle:"italic"},children:"≈Ω√°dn√© polo≈æky"});const g=c?t:t.slice(0,a),m=t.length>a;return e.jsxs("div",{style:d.tagList,children:[g.map(u=>{const y=o.includes(u);return e.jsx("span",{onClick:()=>n(u),children:s?s(u,y):e.jsx("span",{style:{...d.tag,...y?d.tagSelected:{}},children:u})},u)}),m&&e.jsx("div",{style:{width:"100%",textAlign:"center",marginTop:"8px"},children:e.jsx("button",{onClick:()=>l(!c),style:{background:"none",border:"1px solid var(--border)",color:"var(--primary-color)",cursor:"pointer",fontSize:"0.8em",padding:"4px 12px",borderRadius:"12px",backgroundColor:"var(--surface)"},children:c?"‚Üê Zobrazit m√©nƒõ":`Zobrazit v√≠ce (+${t.length-a})`})})]})},lr=({title:t,options:o,selectedValue:n,onChange:a})=>e.jsxs("div",{style:d.fieldGroup,children:[e.jsx("label",{style:d.label,children:t}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:o.map(s=>e.jsxs("button",{onClick:()=>a(s.value),style:{backgroundColor:n===s.value?"var(--accent-primary)":"transparent",color:n===s.value?"white":"var(--text-secondary)",border:`1px solid ${n===s.value?"var(--accent-primary)":"var(--border-color)"}`,borderRadius:"4px",padding:"4px 8px",fontSize:"0.75rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",transition:"all 0.2s ease",minWidth:"auto"},title:s.label,children:[s.icon&&e.jsx("span",{style:{display:"flex",alignItems:"center",fontSize:"12px"},children:s.icon}),e.jsx("span",{style:{fontSize:"0.75rem"},children:s.label})]},s.value))})]}),Ve=({title:t,children:o,onAdd:n,onDelete:a,allItems:s})=>{const[c,l]=h.useState(!1),[g,m]=h.useState(!1),[u,y]=h.useState({isOpen:!1,item:null}),x=h.useRef(null),i=z=>{y({isOpen:!0,item:z}),l(!1),m(!1)},f=()=>{u.item&&a&&a(u.item),y({isOpen:!1,item:null})};return h.useEffect(()=>{const z=D=>{x.current&&!x.current.contains(D.target)&&l(!1)};return document.addEventListener("mousedown",z),()=>document.removeEventListener("mousedown",z)},[]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:d.fieldGroup,children:[e.jsxs("div",{style:d.filterGroupHeader,children:[e.jsx("label",{style:d.label,children:t}),n&&e.jsxs("div",{style:{position:"relative"},ref:x,children:[e.jsx("button",{onClick:()=>l(!c),style:d.addTagButton,title:`Spravovat ${t.toLowerCase()}`,children:e.jsx(Ye,{})}),c&&e.jsxs("div",{style:{...d.tagDropdown,right:0,left:"auto",minWidth:"200px"},children:[e.jsxs("a",{onClick:()=>{l(!1),n()},style:{...d.dropdownMenuLink,...d.addNewTagLink},children:[e.jsx(Ye,{})," Vytvo≈ôit nov√Ω"]}),a&&s&&s.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{borderTop:"1px solid var(--border)",margin:"4px 0"}}),e.jsxs("a",{onClick:()=>{l(!1),m(!0)},style:{...d.dropdownMenuLink,color:"var(--danger-color)"},children:[e.jsx(Ae,{size:14})," Spravovat polo≈æky"]})]})]})]})]}),o]}),g&&e.jsx(Ne,{isOpen:g,onClose:()=>m(!1),title:`Spravovat ${t.toLowerCase()}`,children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",maxHeight:"400px",overflowY:"auto"},children:[e.jsx("p",{style:{fontSize:"0.9em",color:"var(--text-secondary)",margin:0},children:'Kliknut√≠m na tlaƒç√≠tko "Smazat" odstran√≠te polo≈æku ze syst√©mu. Tato akce je nevratn√°.'}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[s==null?void 0:s.map(z=>e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 12px",borderRadius:"6px",border:"1px solid var(--border)",backgroundColor:"var(--surface)"},children:[e.jsx("span",{style:{flex:1},children:z.replace("_"," ")}),e.jsxs("button",{onClick:()=>i(z),style:{background:"var(--danger-color)",color:"white",border:"none",borderRadius:"4px",padding:"4px 8px",cursor:"pointer",fontSize:"12px",display:"flex",alignItems:"center",gap:"4px"},title:`Smazat ${z}`,children:[e.jsx(Ae,{size:12})," Smazat"]})]},z)),(!s||s.length===0)&&e.jsx("p",{style:{textAlign:"center",color:"var(--text-secondary)",margin:"20px 0"},children:"≈Ω√°dn√© polo≈æky k zobrazen√≠."})]})]})}),u.isOpen&&e.jsx(Ne,{isOpen:u.isOpen,onClose:()=>y({isOpen:!1,item:null}),title:"Potvrzen√≠ smaz√°n√≠",children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsxs("p",{children:['Opravdu chcete smazat polo≈æku "',u.item,'"?']}),e.jsx("p",{style:{fontSize:"0.9em",color:"var(--text-secondary)"},children:"Tato akce je nevratn√°. Polo≈æka bude odebr√°na ze v≈°ech knih."}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>y({isOpen:!1,item:null}),style:{...d.button,background:"var(--surface)",color:"var(--text)"},children:"Zru≈°it"}),e.jsxs("button",{onClick:f,style:{...d.button,background:"var(--danger-color)",color:"white"},children:[e.jsx(Ae,{size:16})," Smazat"]})]})]})})]})},ir=t=>{const[o,n]=h.useState(!1),[a,s]=h.useState(null),[c,l]=h.useState(""),g=(i,f)=>{s({title:i,onAdd:f}),l(""),n(!0)},m=()=>{c.trim()&&a&&a.onAdd(c.trim()),n(!1)},u=(i,f,z)=>{const D=new Set(f);D.has(i)?D.delete(i):D.add(i),z(Array.from(D))},y=(i,f)=>{const z=parseInt(f,10),D={...t.dateAddedRange};i==="from"?D.from=Math.min(z,D.to):D.to=Math.max(z,D.from),t.onDateAddedRangeChange(D)},x=i=>{if(!i)return"";const[f,z]=i.split("-");return`${On[parseInt(z,10)-1]} ${f}`};return e.jsxs(e.Fragment,{children:[e.jsxs("aside",{style:d.leftPanel,children:[e.jsx(Ve,{title:"Hledat",children:e.jsx("input",{type:"text",placeholder:"N√°zev, autor, kl√≠ƒçov√© slovo...",style:d.input,value:t.filter,onChange:i=>t.onFilterChange(i.target.value)})}),e.jsx(Ve,{title:"Rok vyd√°n√≠",children:e.jsxs("div",{style:d.rangeSliderContainer,children:[e.jsxs("div",{style:d.rangeSliderRowSimple,children:[e.jsx("span",{style:d.rangeLabel,children:"Od"}),e.jsx("input",{type:"range",min:t.minYear,max:t.maxYear,value:t.yearRange.from||t.minYear,onChange:i=>t.onYearRangeChange({...t.yearRange,from:parseInt(i.target.value)})}),e.jsx("span",{style:d.rangeValue,children:t.yearRange.from||t.minYear})]}),e.jsxs("div",{style:d.rangeSliderRowSimple,children:[e.jsx("span",{style:d.rangeLabel,children:"Do"}),e.jsx("input",{type:"range",min:t.minYear,max:t.maxYear,value:t.yearRange.to||t.maxYear,onChange:i=>t.onYearRangeChange({...t.yearRange,to:parseInt(i.target.value)})}),e.jsx("span",{style:d.rangeValue,children:t.yearRange.to||t.maxYear})]})]})}),e.jsx(Ve,{title:"Datum p≈ôid√°n√≠",children:e.jsxs("div",{style:d.rangeSliderContainer,children:[e.jsxs("div",{style:d.rangeSliderRowSimple,children:[e.jsx("span",{style:d.rangeLabel,children:"Od"}),e.jsx("input",{type:"range",min:0,max:t.availableMonths.length>0?t.availableMonths.length-1:0,value:t.dateAddedRange.from,disabled:t.availableMonths.length===0,onChange:i=>y("from",i.target.value)}),e.jsx("span",{style:d.rangeValue,children:x(t.availableMonths[t.dateAddedRange.from])})]}),e.jsxs("div",{style:d.rangeSliderRowSimple,children:[e.jsx("span",{style:d.rangeLabel,children:"Do"}),e.jsx("input",{type:"range",min:0,max:t.availableMonths.length>0?t.availableMonths.length-1:0,value:t.dateAddedRange.to,disabled:t.availableMonths.length===0,onChange:i=>y("to",i.target.value)}),e.jsx("span",{style:d.rangeValue,children:x(t.availableMonths[t.dateAddedRange.to])})]})]})}),e.jsx(Ve,{title:"Typy publikac√≠",onAdd:()=>g("Zadejte n√°zev nov√©ho typu publikace",t.onAddType),onDelete:t.onDeleteType,allItems:t.allTypes,children:e.jsx(Je,{items:t.allTypes,selectedItems:t.selectedTypes,onItemClick:i=>u(i,t.selectedTypes,t.onTypeFilterChange),renderItem:(i,f)=>e.jsx("span",{style:{...d.tag,...f?d.tagSelected:{}},children:i.replace("_"," ")})})}),e.jsx(Ve,{title:"Kategorie",onAdd:()=>g("Zadejte n√°zev nov√© kategorie",t.onAddCategory),onDelete:t.onDeleteCategory,allItems:t.allCategories,children:e.jsx(Je,{items:t.allCategories,selectedItems:t.selectedCategories,onItemClick:i=>u(i,t.selectedCategories,t.onCategoryFilterChange)})}),e.jsx(Ve,{title:"≈†t√≠tky",onAdd:()=>g("Zadejte n√°zev nov√©ho ≈°t√≠tku",t.onAddLabel),onDelete:t.onDeleteLabel,allItems:t.allLabels,children:e.jsx(Je,{items:t.allLabels,selectedItems:t.selectedLabels,onItemClick:i=>u(i,t.selectedLabels,t.onLabelFilterChange)})}),e.jsx(Ve,{title:"Jazyky",children:e.jsx(Je,{items:t.allLanguages,selectedItems:t.selectedLanguages,onItemClick:i=>u(i,t.selectedLanguages,t.onLanguageFilterChange),renderItem:(i,f)=>e.jsxs("span",{style:{...d.tag,...f?d.tagSelected:{}},children:[ct(i)," ",i]})})}),e.jsx(Ve,{title:"Verze vyd√°n√≠",children:e.jsx(Je,{items:t.allVersions,selectedItems:t.selectedVersions,onItemClick:i=>u(i,t.selectedVersions,t.onVersionFilterChange),renderItem:(i,f)=>e.jsxs("span",{style:{...d.tag,...f?d.tagSelected:{}},children:["üìñ ",i]})})}),e.jsx(lr,{title:"VDB",selectedValue:t.vdbFilter,onChange:t.onVdbFilterChange,options:[{value:"all",label:"V≈°e"},{value:"success",label:"OK",icon:e.jsx(He,{status:"success"})},{value:"error",label:"Err",icon:e.jsx(He,{status:"error"})},{value:"pending",label:"...",icon:e.jsx(He,{status:"pending"})}]})]}),e.jsx(Ne,{isOpen:o,onClose:()=>n(!1),title:(a==null?void 0:a.title)||"P≈ôidat polo≈æku",children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsx("input",{type:"text",value:c,onChange:i=>l(i.target.value),style:d.input,placeholder:"Zadejte n√°zev...",onKeyDown:i=>{i.key==="Enter"&&m()},autoFocus:!0}),e.jsxs("button",{onClick:m,style:{...d.button,alignSelf:"flex-end"},children:[e.jsx(Ye,{})," P≈ôidat"]})]})})]})},cr=({books:t,selectedBookId:o,selectedBookIds:n,onSelectBook:a,onToggleSelection:s,onSelectAll:c,onDeleteBook:l,onDownloadBook:g,onTestWebhook:m,onVectorDatabaseAction:u,vectorProcessingBooks:y})=>{const x=t.length>0&&n.size===t.length;return e.jsx("div",{style:d.bookTableWrapper,children:e.jsxs("table",{style:d.bookTable,className:"book-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{...d.th,width:"40px"},children:e.jsx("input",{type:"checkbox",checked:x,onChange:i=>c(i.target.checked)})}),e.jsx("th",{style:{...d.th,width:"40px"}}),e.jsx("th",{style:d.th,children:"N√°zev"}),e.jsx("th",{style:d.th,children:"Autor"}),e.jsx("th",{style:d.th,children:"Kategorie"}),e.jsx("th",{style:d.th,children:"≈†t√≠tky"}),e.jsx("th",{style:d.th,children:"Rok vyd√°n√≠"}),e.jsx("th",{style:d.th,children:"Verze vyd√°n√≠"}),e.jsx("th",{style:d.th,children:"Typ publikace"}),e.jsx("th",{style:d.th,children:"Jazyk"}),e.jsx("th",{style:d.th,children:"Form√°t"}),e.jsx("th",{style:d.th,children:"Velikost"}),e.jsx("th",{style:d.th,children:"Datum p≈ôid√°n√≠"}),e.jsx("th",{style:d.th,children:"Akce"})]})}),e.jsx("tbody",{children:t.map(i=>e.jsxs("tr",{style:{...d.tr,...i.id===o?d.trSelected:{}},className:i.id===o?"selected":"",children:[e.jsx("td",{style:d.td,onClick:f=>f.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:n.has(i.id),onChange:()=>s(i.id)})}),e.jsx("td",{style:{...d.td,textAlign:"center",cursor:"pointer"},onClick:f=>{f.stopPropagation(),u(i)},title:`Stav vektorov√© datab√°ze: ${i.vectorStatus==="pending"?"ƒçek√° na nahr√°n√≠":i.vectorStatus==="success"?"√∫spƒõ≈°nƒõ nahr√°no":"chyba p≈ôi nahr√°v√°n√≠"}

Kliknƒõte pro odesl√°n√≠ do vektorov√© datab√°ze.
${y.has(i.id)?"‚è≥ Zpracov√°v√° se... (m≈Ø≈æe trvat a≈æ 5 minut)":"P≈ôed odesl√°n√≠m budou zkontrolov√°na povinn√° metadata."}`,children:e.jsx(He,{status:i.vectorStatus,isLoading:y.has(i.id)})}),e.jsx("td",{style:{...d.td,...d.tdTitle},onClick:()=>a(i.id),children:i.title}),e.jsx("td",{style:d.td,onClick:()=>a(i.id),children:i.author}),e.jsx("td",{style:{...d.td,minWidth:"150px"},onClick:()=>a(i.id),children:e.jsx(bt,{items:i.categories,maxVisible:3,tableMode:!0,renderTag:f=>e.jsx("span",{className:"tag",style:{...d.tag,fontSize:"0.7rem",padding:"2px 6px"},children:f})})}),e.jsx("td",{style:{...d.td,minWidth:"150px"},onClick:()=>a(i.id),children:e.jsx(bt,{items:i.labels,maxVisible:3,tableMode:!0,renderTag:f=>e.jsx("span",{className:"tag",style:{...d.tag,fontSize:"0.7rem",padding:"2px 6px"},children:f})})}),e.jsx("td",{style:d.td,onClick:()=>a(i.id),children:i.publicationYear||"‚Äì"}),e.jsx("td",{style:d.td,onClick:()=>a(i.id),children:i.releaseVersion||"‚Äì"}),e.jsx("td",{style:d.td,onClick:()=>a(i.id),children:e.jsx(bt,{items:i.publicationTypes,maxVisible:3,tableMode:!0,renderTag:f=>e.jsx("span",{className:"tag",style:{...d.tag,fontSize:"0.7rem",padding:"2px 6px"},children:f.replace("_"," ")})})}),e.jsx("td",{style:d.td,onClick:()=>a(i.id),children:ct(i.language)}),e.jsx("td",{style:d.td,onClick:()=>a(i.id),children:i.format}),e.jsx("td",{style:d.td,onClick:()=>a(i.id),children:Xn(i.fileSize)}),e.jsx("td",{style:d.td,onClick:()=>a(i.id),children:Jn(i.dateAdded)}),e.jsxs("td",{style:{...d.td,...d.tdActions},onClick:f=>f.stopPropagation(),children:[e.jsx("button",{style:d.iconButton,onClick:()=>g(i.id),"aria-label":"St√°hnout knihu",children:e.jsx(Ut,{})}),e.jsx("button",{style:{...d.iconButton,color:"#3b82f6"},onClick:()=>m(i.id),"aria-label":"Testovat webhook",title:"Testovat webhook (pouze zavol√° webhook bez maz√°n√≠ knihy)",children:e.jsx(Zt,{})}),e.jsx("button",{style:{...d.iconButton,color:"var(--danger-color)"},onClick:()=>l(i.id),"aria-label":"Smazat knihu",children:e.jsx(Ae,{})})]})]},i.id))})]})})},dr=({books:t,selectedBookId:o,onSelectBook:n})=>e.jsx("div",{style:d.gridContainer,children:t.map(a=>e.jsxs("div",{style:{...d.gridCard,...a.id===o?d.gridCardSelected:{}},onClick:()=>n(a.id),children:[e.jsx("img",{src:a.coverImageUrl,alt:`Cover of ${a.title}`,style:d.gridCardCover}),e.jsx("h3",{style:d.gridCardTitle,children:a.title}),e.jsx("p",{style:d.gridCardAuthor,children:a.author})]},a.id))}),ur=({book:t,onUpdate:o,onDelete:n,onTestWebhook:a,onDebugStorage:s,onTestDeleteImages:c,onReadClick:l,allLabels:g,onAddNewLabel:m,onDeleteLabel:u,allCategories:y,onAddNewCategory:x,onDeleteCategory:i,allPublicationTypes:f,onAddNewPublicationType:z,onDeletePublicationType:D,allAvailableLanguages:Z})=>{const[N,W]=h.useState(!1),[w,q]=h.useState(t),[O,X]=h.useState({}),[H,te]=h.useState(!1),[v,ne]=h.useState(!1),[ie,ae]=h.useState(!1),[ge,Se]=h.useState("Angliƒçtina"),[ye,ke]=h.useState(!1),[je,_e]=h.useState("recommended"),[_,I]=h.useState(!1),[j,T]=h.useState(!1),C=h.useCallback(P=>{q(P)},[]);h.useEffect(()=>{(!w.id||w.id!==t.id)&&(q(t),W(!1))},[t.id,w.id]);const G=()=>{if(!t.filePath||t.format!=="PDF"){alert("OCR lze aplikovat pouze na PDF soubory");return}I(!0)},J=async()=>{I(!1),ne(!0);try{console.log(`üß™ OCR zpracov√°n√≠ pro knihu: ${t.title}`),console.log(`üìÑ Soubor: ${t.filePath}`),console.log(`üåê Jazyk: ${ge}`);const{data:P,error:A}=await F.storage.from("Books").download(t.filePath);if(A)throw A;const ee=new File([P],`${t.title}.pdf`,{type:"application/pdf"});console.log(`üìä Velikost souboru: ${(ee.size/1024/1024).toFixed(2)} MB`);const K=await Ee.performOCR(ee,ge);console.log(`‚úÖ OCR dokonƒçeno. Nov√° velikost: ${(K.size/1024/1024).toFixed(2)} MB`);const{error:se}=await F.storage.from("Books").update(t.filePath,K,{cacheControl:"3600",upsert:!0});if(se)throw se;const be=Math.round(K.size/1024),we={...t,hasOCR:!0,fileSize:be};await F.from("books").update({OCR:!0,file_size:be}).eq("id",t.id),o(we);const ze=ee.size/1024/1024,Ie=K.size/1024/1024,Me=Ie>ze?"zvƒõt≈°il":"zmen≈°il",ut=Math.abs((Ie-ze)/ze*100);alert(`‚úÖ OCR √∫spƒõ≈°n√©!

Soubor byl zpracov√°n s OCR (${ge})
P≈Øvodn√≠ velikost: ${ze.toFixed(2)} MB
Nov√° velikost: ${Ie.toFixed(2)} MB
Soubor se ${Me} o ${ut.toFixed(1)}%

P≈Øvodn√≠ soubor byl nahrazen OCR verz√≠.
Cesta: ${t.filePath}`)}catch(P){console.error("‚ùå OCR zpracov√°n√≠ selhalo:",P);let A=`‚ùå OCR zpracov√°n√≠ selhalo:

${P.message}`;P.message.includes("HTTP 500")||P.message.includes("ServerError")?A=`‚ùå OCR selhalo - iLovePDF API m√° probl√©my

üîß Co m≈Ø≈æete zkusit:
‚Ä¢ Zkuste to za 5-10 minut
‚Ä¢ Zkontrolujte velikost souboru (max ~50MB)
‚Ä¢ Ovƒõ≈ôte, ≈æe PDF nen√≠ po≈°kozen√©

Technick√° chyba: ${P.message}`:(P.message.includes("network")||P.message.includes("fetch"))&&(A=`‚ùå OCR selhalo - probl√©m s p≈ôipojen√≠m

üåê Zkontrolujte internetov√© p≈ôipojen√≠ a zkuste znovu.

Chyba: ${P.message}`),alert(A)}finally{ne(!1)}},V=()=>{if(!t.filePath||t.format!=="PDF"){alert("Kompresi lze aplikovat pouze na PDF soubory");return}T(!0)},pe=async()=>{T(!1),ae(!0);try{console.log(`üß™ Komprese pro knihu: ${t.title}`),console.log(`üìÑ Soubor: ${t.filePath}`),console.log(`üóúÔ∏è √örove≈à: ${je}`);const{data:P,error:A}=await F.storage.from("Books").download(t.filePath);if(A)throw A;const ee=new File([P],`${t.title}.pdf`,{type:"application/pdf"}),K=ee.size/1024/1024;console.log(`üìä P≈Øvodn√≠ velikost: ${K.toFixed(2)} MB`);const se=await Ee.compressPDF(ee,je),be=se.size/1024/1024,we=(K-be)/K*100;console.log(`‚úÖ Komprese dokonƒçena. Nov√° velikost: ${be.toFixed(2)} MB`),console.log(`üíæ U≈°et≈ôeno: ${we.toFixed(1)}%`);const{error:ze}=await F.storage.from("Books").update(t.filePath,se,{cacheControl:"3600",upsert:!0});if(ze)throw ze;const Ie={...t,fileSize:Math.round(se.size/1024)};await F.from("books").update({file_size:Math.round(se.size/1024)}).eq("id",t.id),o(Ie),alert(`‚úÖ Komprese √∫spƒõ≈°n√°!

P≈Øvodn√≠ velikost: ${K.toFixed(2)} MB
Nov√° velikost: ${be.toFixed(2)} MB
U≈°et≈ôeno: ${we.toFixed(1)}% (${je})

P≈Øvodn√≠ soubor byl nahrazen komprimovanou verz√≠.
Cesta: ${t.filePath}`)}catch(P){console.error("‚ùå Komprese selhala:",P),alert(`‚ùå Komprese selhala:

${P.message}`)}finally{ae(!1)}},$=h.useCallback(async P=>{X(A=>({...A,[P]:!0}));try{console.log("ü§ñ AI generov√°n√≠ spu≈°tƒõno pro pole:",P);const A=Le(w.id);if(A.hasCache)console.log("üíæ Text u≈æ je v mezipamƒõti z p≈ôedchoz√≠ OCR extrakce:",A.size,"znak≈Ø,",A.age,"star√Ω");else{console.log("üì• Text nen√≠ v mezipamƒõti, spou≈°t√≠m automatickou OCR extrakci p≈ôes webhook...");try{const se=await it(w);console.log("‚úÖ Text automaticky extrahov√°n p≈ôes OCR webhook do mezipamƒõti:",se.length,"znak≈Ø"),C(be=>({...be}))}catch(se){console.warn("‚ö†Ô∏è Automatick√° OCR extrakce selhala, pokraƒçuji s AI generov√°n√≠m bez textu:",se),alert("‚ö†Ô∏è Nepoda≈ôilo se extrahovat text p≈ôes OCR webhook. AI bude generovat metadata pouze z n√°zvu knihy.")}}const ee=await er(P,w);let K=ee;P==="keywords"?K=ee.split(",").map(se=>se.trim()):P==="publicationYear"&&(K=parseInt(ee,10)||w.publicationYear),C(se=>({...se,[P]:K}))}catch(A){console.error("‚ùå Chyba p≈ôi AI generov√°n√≠:",A),alert(`Chyba p≈ôi generov√°n√≠ ${P}: ${A instanceof Error?A.message:String(A)}`)}finally{X(A=>({...A,[P]:!1}))}},[C,w.id,Le,it]),ce=async()=>{te(!0);try{const P=w.format.toLowerCase();if(P!=="pdf"&&P!=="txt"){alert("‚ö†Ô∏è Inteligentn√≠ extrakce metadat je podporov√°na pouze pro PDF a TXT soubory!"),te(!1);return}console.log("ü§ñ Spou≈°t√≠m inteligentn√≠ extrakci metadat...");const A=await tr(w);console.log("üìù Aplikuji extrahovan√° metadata:",A),C(ee=>{const K={...ee,...A};return console.log("üìö Aktualizovan√° kniha:",K),K}),console.log("‚úÖ Inteligentn√≠ metadata √∫spƒõ≈°nƒõ aplikov√°na na knihu")}catch(P){console.error("‚ùå Chyba p≈ôi inteligentn√≠ extrakci metadat:",P),alert(`‚ùå Chyba p≈ôi inteligentn√≠ extrakci metadat:

${P instanceof Error?P.message:String(P)}

Zkuste to pros√≠m znovu nebo pou≈æijte jinou metodu.`)}finally{te(!1)}},Y=()=>{o(w),W(!1)},re=()=>{C(t),W(!1)},Q=async()=>{try{console.log("üîÑ Aktualizuji Qdrant metadata pro knihu:",t.id),console.log("üìÇ Aktu√°ln√≠ categories:",w.categories),console.log("üìÇ Aktu√°ln√≠ labels:",w.labels),console.log("üìÇ Aktu√°ln√≠ publicationTypes:",w.publicationTypes),o(w);const P=await oe.updateQdrantMetadata(t.id,w.categories,w.labels,w.publicationTypes);P.success?(alert(P.message),W(!1)):alert(`‚ùå ${P.message}`)}catch(P){console.error("‚ùå Chyba p≈ôi aktualizaci Qdrant metadata:",P),alert(`‚ùå Neoƒçek√°van√° chyba p≈ôi aktualizaci metadata: ${P instanceof Error?P.message:"Nezn√°m√° chyba"}`)}},ve=async P=>{var ee;const A=(ee=P.target.files)==null?void 0:ee[0];if(A){if(!A.type.startsWith("image/")){alert("‚ùå Pros√≠m vyberte pouze obr√°zkov√© soubory (JPG, PNG, GIF, atd.)");return}if(A.size>10*1024*1024){alert("‚ùå Soubor je p≈ô√≠li≈° velk√Ω. Maxim√°ln√≠ velikost je 10MB.");return}try{console.log("üì∑ Nahr√°v√°m cover obr√°zek:",A.name,A.size,"bytes");const{filePath:K}=await oe.uploadFileWithId(A,"Books",w.id),{data:se}=F.storage.from("Books").getPublicUrl(K),be=se.publicUrl;console.log("‚úÖ Cover √∫spƒõ≈°nƒõ nahr√°n:",be);const we={...w,coverImageUrl:be};C(ze=>({...ze,coverImageUrl:be})),o(we),alert(`‚úÖ Cover obr√°zek byl √∫spƒõ≈°nƒõ nahr√°n!

Nov√Ω cover: ${A.name}
Velikost: ${Math.round(A.size/1024)} KB`),P.target.value=""}catch(K){console.error("‚ùå Chyba p≈ôi nahr√°v√°n√≠ cover:",K),alert(`‚ùå Chyba p≈ôi nahr√°v√°n√≠ cover obr√°zku: ${K instanceof Error?K.message:String(K)}`)}}},M=()=>e.jsxs(e.Fragment,{children:[Fe("Autor",w.author),Fe("Rok vyd√°n√≠",w.publicationYear),Fe("Verze vyd√°n√≠",w.releaseVersion),Fe("Nakladatelstv√≠",w.publisher),Fe("Jazyk",w.language),Fe("Typ publikace",w.publicationTypes.length>0?w.publicationTypes.map(P=>e.jsx("span",{style:d.tag,children:P.replace("_"," ")},P)):null),Fe("Sumarizace",w.summary,!0),Fe("Kl√≠ƒçov√° slova",w.keywords.length>0?w.keywords.map(P=>e.jsx("span",{style:d.tag,children:P},P)):null),Fe("Kategorie",w.categories.length>0?w.categories.map(P=>e.jsx("span",{style:d.tag,children:P},P)):null),Fe("≈†t√≠tky",w.labels.length>0?w.labels.map(P=>e.jsx("span",{style:d.tag,children:P},P)):null),Fe("Stav vektorov√© DB",e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(He,{status:w.vectorStatus}),e.jsx("span",{style:{color:w.vectorStatus==="success"?"#22c55e":w.vectorStatus==="error"?"#ef4444":"#6b7280"},children:w.vectorStatus==="pending"?"ƒåek√° na nahr√°n√≠":w.vectorStatus==="success"?"√öspƒõ≈°nƒõ nahr√°no":"Chyba p≈ôi nahr√°v√°n√≠"})]})),Fe("OCR extrakce textu",e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap"},children:[Le(w.id).hasCache&&e.jsxs("span",{style:{color:"#22c55e"},children:["‚úÖ Text extrahov√°n (",Le(w.id).size," znak≈Ø, ",Le(w.id).age," star√Ω)"]}),Le(w.id).hasCache&&e.jsxs(e.Fragment,{children:[e.jsx("button",{style:{...d.button,fontSize:"0.8em",padding:"4px 8px",background:"var(--accent-primary)",color:"white"},onClick:()=>{const P=xt(w.id);if(P){const A=document.createElement("div");A.style.cssText=`
                                            position: fixed; top: 0; left: 0; right: 0; bottom: 0; 
                                            background: rgba(0,0,0,0.8); z-index: 10000; 
                                            display: flex; justify-content: center; align-items: center; padding: 20px;
                                        `;const ee=document.createElement("div");ee.style.cssText=`
                                            background: white; border-radius: 8px; padding: 20px; 
                                            max-width: 80%; max-height: 80%; overflow: auto;
                                            position: relative;
                                        `;const K=document.createElement("button");K.innerHTML="‚úï",K.style.cssText=`
                                            position: absolute; top: 10px; right: 10px; 
                                            background: #ef4444; color: white; border: none; 
                                            border-radius: 50%; width: 30px; height: 30px; 
                                            cursor: pointer; font-size: 16px;
                                        `,K.onclick=()=>document.body.removeChild(A);const se=document.createElement("h3");se.textContent=`Extrahovan√Ω text z: ${w.title}`,se.style.cssText="margin: 0 0 15px 0; color: #333;";const be=document.createElement("div");be.style.cssText="white-space: pre-wrap; font-family: monospace; font-size: 12px; line-height: 1.4; color: #333;",be.textContent=P;const we=document.createElement("div");we.style.cssText="margin-top: 15px; padding: 10px; background: #f3f4f6; border-radius: 4px; font-size: 12px; color: #666;",we.innerHTML=`üìä Velikost: ${P.length} znak≈Ø | üìÖ Sta≈æeno: ${new Date().toLocaleString("cs-CZ")}`,ee.appendChild(K),ee.appendChild(se),ee.appendChild(be),ee.appendChild(we),A.appendChild(ee),document.body.appendChild(A),A.onclick=ze=>{ze.target===A&&document.body.removeChild(A)}}},title:"Zobrazit text z mezipamƒõti",children:"üëÅÔ∏è Zobrazit text"}),e.jsx("button",{style:{...d.button,fontSize:"0.8em",padding:"4px 8px",background:"var(--danger-color)",color:"white"},onClick:()=>{confirm("Opravdu chcete smazat text z mezipamƒõti?")&&(mt(w.id),C({...w}),alert("üóëÔ∏è Text z mezipamƒõti smaz√°n"))},title:"Smazat text z mezipamƒõti",children:"üóëÔ∏è Smazat"})]})]}))]}),Pe=h.useMemo(()=>e.jsxs(e.Fragment,{children:[e.jsx(Ze,{label:"N√°zev publikace",name:"title",value:w.title,setLocalBook:C,onAIGenerate:$,isGenerating:O.title||!1,type:"text"}),e.jsx(Ze,{label:"Autor",name:"author",value:w.author,setLocalBook:C,onAIGenerate:$,isGenerating:O.author||!1,type:"text"}),e.jsx(Ze,{label:"Rok vyd√°n√≠",name:"publicationYear",value:String(w.publicationYear||""),setLocalBook:C,onAIGenerate:$,isGenerating:O.publicationYear||!1,type:"number"}),e.jsx(Ze,{label:"Verze vyd√°n√≠",name:"releaseVersion",value:w.releaseVersion||"",setLocalBook:C,onAIGenerate:$,isGenerating:O.releaseVersion||!1,type:"text"}),e.jsx(Ze,{label:"Nakladatelstv√≠",name:"publisher",value:w.publisher,setLocalBook:C,onAIGenerate:$,isGenerating:O.publisher||!1,type:"text"}),e.jsx(pr,{value:w.language,onChange:P=>q(A=>({...A,language:P})),onAIGenerate:$?()=>$("language"):null,isGenerating:O.language||!1,allLanguages:Z}),e.jsx(Ze,{label:"Sumarizace",name:"summary",value:w.summary,setLocalBook:C,onAIGenerate:$,isGenerating:O.summary||!1,type:"textarea"}),e.jsx(Ze,{label:"Kl√≠ƒçov√° slova (ƒç√°rkou)",name:"keywords",value:w.keywords.join(", "),setLocalBook:C,onAIGenerate:$,isGenerating:O.keywords||!1,type:"text"}),e.jsxs("div",{style:d.fieldGroup,children:[e.jsx("label",{style:d.label,children:"Kategorie"}),e.jsx(ft,{selectedTags:w.categories,allTags:y,onChange:P=>C(A=>({...A,categories:P})),onAddNewTag:x,onDeleteTag:i,promptText:"P≈ôidat novou kategorii",creationText:"Vytvo≈ôit novou kategorii"})]}),e.jsxs("div",{style:d.fieldGroup,children:[e.jsx("label",{style:d.label,children:"≈†t√≠tky"}),e.jsx(ft,{selectedTags:w.labels,allTags:g,onChange:P=>C(A=>({...A,labels:P})),onAddNewTag:m,onDeleteTag:u,promptText:"P≈ôidat nov√Ω ≈°t√≠tek",creationText:"Vytvo≈ôit nov√Ω ≈°t√≠tek"})]}),e.jsxs("div",{style:d.fieldGroup,children:[e.jsx("label",{style:d.label,children:"Typ publikace"}),e.jsx(ft,{selectedTags:w.publicationTypes,allTags:f,onChange:P=>C(A=>({...A,publicationTypes:P})),onAddNewTag:z,onDeleteTag:D,promptText:"P≈ôidat nov√Ω typ publikace",creationText:"Vytvo≈ôit nov√Ω typ"})]}),e.jsxs("div",{style:d.fieldGroup,children:[e.jsx("label",{style:d.label,children:"Stav vektorov√© datab√°ze"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(He,{status:w.vectorStatus}),e.jsxs("select",{value:w.vectorStatus,onChange:P=>C(A=>({...A,vectorStatus:P.target.value})),style:d.input,children:[e.jsx("option",{value:"pending",children:"ƒåek√° na nahr√°n√≠"}),e.jsx("option",{value:"success",children:"√öspƒõ≈°nƒõ nahr√°no"}),e.jsx("option",{value:"error",children:"Chyba p≈ôi nahr√°v√°n√≠"})]})]})]}),e.jsxs("div",{style:d.fieldGroup,children:[e.jsx("label",{style:d.label,children:"Extrakce textu"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap"},children:[e.jsx("span",{style:{color:Le(w.id).hasCache?"#22c55e":"#6b7280",fontSize:"0.9em"},children:Le(w.id).hasCache?`Text v mezipamƒõti (${Le(w.id).size} znak≈Ø, ${Le(w.id).age} star√Ω)`:"Text nen√≠ v mezipamƒõti"}),e.jsx("button",{style:{...d.button,fontSize:"0.8em",padding:"4px 8px",background:"var(--accent-primary)",color:"white"},onClick:async()=>{try{if(!confirm(`üìÑ ODESL√ÅN√ç BIN√ÅRN√çHO SOUBORU

‚ö†Ô∏è D≈ÆLE≈ΩIT√â: P≈ôed kliknut√≠m na OK:
1. P≈ôejdƒõte do n8n workflow
2. Kliknƒõte "Execute workflow" nebo "Listen for test event"
3. Hned pot√© kliknƒõte OK

Ode≈°le se bin√°rn√≠ soubor knihy na webhook

Pokraƒçovat?`))return;console.log("üìÑ Odes√≠l√°m bin√°rn√≠ soubor na webhook...");const A=Le(w.id);if(A.hasCache&&!confirm(`Text u≈æ je v mezipamƒõti (${A.size} znak≈Ø, ${A.age} star√Ω). Chcete ho p≈ôepsat p≈ôes webhook?`)){console.log("‚ùå U≈æivatel zru≈°il p≈ôeps√°n√≠ mezipamƒõti");return}const ee=await it(w);alert(`‚úÖ Text √∫spƒõ≈°nƒõ extrahov√°n p≈ôes webhook a ulo≈æen do mezipamƒõti!

Velikost: ${ee.length} znak≈Ø

Prvn√≠ch 100 znak≈Ø:
${ee.substring(0,100)}...`),C({...w})}catch(P){console.error("‚ùå Chyba p≈ôi extrakci textu p≈ôes webhook:",P),alert(`‚ùå Chyba p≈ôi extrakci textu p≈ôes webhook: ${P instanceof Error?P.message:String(P)}`)}},title:"Extrahovat text p≈ôes n8n webhook (bin√°rn√≠ soubor) - POZOR: Nejd≈ô√≠ve spus≈•te listening v n8n!",children:"üåê Webhook OCR"}),e.jsx("button",{style:{...d.button,fontSize:"0.8em",padding:"4px 8px",background:"#007bff",color:"white"},onClick:async()=>{try{if(!confirm(`KONTEXT PRO LLM

‚ö†Ô∏è D≈ÆLE≈ΩIT√â:
‚Ä¢ Dokument bude omezen na max 50 str√°nek
‚Ä¢ V√Ωsledek p≈ôep√≠≈°e st√°vaj√≠c√≠ OCR text v mezipamƒõti
‚Ä¢ Speci√°ln√≠ webhook pro pokroƒçilou OCR extrakci

Pokraƒçovat?`))return;console.log("üß† Odes√≠l√°m dokument na LLM kontext webhook...");const A=Le(w.id);A.hasCache&&console.log(`üíæ P≈ôep√≠≈°√≠m existuj√≠c√≠ OCR text v mezipamƒõti (${A.size} znak≈Ø, ${A.age} star√Ω)`);const ee=await rr(w);alert(`‚úÖ LLM kontext √∫spƒõ≈°nƒõ extrahov√°n a ulo≈æen do mezipamƒõti!

Velikost: ${ee.length} znak≈Ø
(Max 50 str√°nek)

Prvn√≠ch 100 znak≈Ø:
${ee.substring(0,100)}...`),C({...w})}catch(P){console.error("‚ùå Chyba p≈ôi LLM kontext extrakci:",P),alert(`‚ùå Chyba p≈ôi LLM kontext extrakci: ${P instanceof Error?P.message:String(P)}`)}},title:"Extrahovat obsah pro LLM kontext - max 50 str√°nek (p≈ôep√≠≈°e st√°vaj√≠c√≠ OCR text)",children:"Kontext pro LLM"}),Le(w.id).hasCache&&e.jsxs(e.Fragment,{children:[e.jsx("button",{style:{...d.button,fontSize:"0.8em",padding:"4px 8px",background:"var(--accent-primary)",color:"white"},onClick:()=>{const P=xt(w.id);if(P){const A=document.createElement("div");A.style.cssText=`
                                            position: fixed; top: 0; left: 0; right: 0; bottom: 0; 
                                            background: rgba(0,0,0,0.8); z-index: 10000; 
                                            display: flex; justify-content: center; align-items: center; padding: 20px;
                                        `;const ee=document.createElement("div");ee.style.cssText=`
                                            background: white; border-radius: 8px; padding: 20px; 
                                            max-width: 80%; max-height: 80%; overflow: auto;
                                            position: relative;
                                        `;const K=document.createElement("button");K.innerHTML="‚úï",K.style.cssText=`
                                            position: absolute; top: 10px; right: 10px; 
                                            background: #ef4444; color: white; border: none; 
                                            border-radius: 50%; width: 30px; height: 30px; 
                                            cursor: pointer; font-size: 16px;
                                        `,K.onclick=()=>document.body.removeChild(A);const se=document.createElement("h3");se.textContent=`Extrahovan√Ω text z: ${w.title}`,se.style.cssText="margin: 0 0 15px 0; color: #333;";const be=document.createElement("div");be.style.cssText="white-space: pre-wrap; font-family: monospace; font-size: 12px; line-height: 1.4; color: #333;",be.textContent=P;const we=document.createElement("div");we.style.cssText="margin-top: 15px; padding: 10px; background: #f3f4f6; border-radius: 4px; font-size: 12px; color: #666;",we.innerHTML=`üìä Velikost: ${P.length} znak≈Ø | üìÖ Sta≈æeno: ${new Date().toLocaleString("cs-CZ")}`,ee.appendChild(K),ee.appendChild(se),ee.appendChild(be),ee.appendChild(we),A.appendChild(ee),document.body.appendChild(A),A.onclick=ze=>{ze.target===A&&document.body.removeChild(A)}}},title:"Zobrazit text z mezipamƒõti",children:"üëÅÔ∏è Zobrazit text"}),e.jsx("button",{style:{...d.button,fontSize:"0.8em",padding:"4px 8px",background:"var(--danger-color)",color:"white"},onClick:()=>{confirm("Opravdu chcete smazat text z mezipamƒõti?")&&(mt(w.id),C({...w}),alert("üóëÔ∏è Text z mezipamƒõti smaz√°n"))},title:"Smazat text z mezipamƒõti",children:"üóëÔ∏è Smazat"})]})]})]})]}),[w,C,$,O,y,x,i,g,m,u,f,z,D,Le,mt,xt,it,ve]);return e.jsxs("div",{style:d.detailContent,children:[e.jsx("img",{src:w.coverImageUrl,alt:`Ob√°lka: ${w.title}`,style:d.detailCover}),e.jsx("h2",{style:d.detailTitle,children:w.title||"Bez n√°zvu"}),e.jsx("div",{style:{...d.detailActions,flexDirection:"column",gap:"0.5rem"},children:N?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"center"},children:[e.jsx("button",{style:d.button,onClick:l,children:"ƒå√≠st knihu"}),e.jsx("input",{type:"file",accept:"image/*",id:"cover-upload",style:{display:"none"},onChange:ve}),e.jsx("button",{style:d.button,onClick:()=>{var P;return(P=document.getElementById("cover-upload"))==null?void 0:P.click()},title:"Nahr√°t nov√Ω cover obr√°zek",children:"Nahr√°t cover"})]}),e.jsx("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"center"},children:e.jsx("button",{style:{...d.button,background:"var(--accent-secondary)",color:"var(--text-primary)",border:"1px solid var(--accent-secondary)"},onClick:Q,children:"Aktualizovat metadata"})}),t.format==="PDF"&&e.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"center"},children:[e.jsx("button",{style:{...d.button,backgroundColor:v?"#6c757d":"#007cba",color:"white",border:"none"},onClick:G,disabled:v,title:`OCR zpracov√°n√≠ (${ge}) - nahrad√≠ p≈Øvodn√≠ soubor`,children:v?"üîÑ OCR...":"üîç OCR"}),e.jsx("button",{style:{...d.button,backgroundColor:ie?"#6c757d":"#ffc107",color:"white",border:"none"},onClick:V,disabled:ie,title:`Komprese (${je}) - nahrad√≠ p≈Øvodn√≠ soubor`,children:ie?"üîÑ Komprese...":"üóúÔ∏è Komprese"})]}),e.jsx("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"center",flexWrap:"wrap"},children:e.jsx("button",{style:d.button,onClick:ce,disabled:H||w.format.toLowerCase()!=="pdf"&&w.format.toLowerCase()!=="txt",title:"Inteligentn√≠ extrakce metadat - automaticky detekuje OCR a vol√° optim√°ln√≠ AI model (podporuje PDF a TXT)",children:H?"Generuji...":e.jsxs(e.Fragment,{children:[e.jsx(Vt,{})," Vyplnit metadata"]})})}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"center"},children:[e.jsx("button",{style:{...d.button,color:"var(--danger-color)",background:"transparent",border:"1px solid var(--danger-color)"},onClick:re,children:"Zru≈°it"}),e.jsx("button",{style:{...d.button,background:"transparent",border:"1px solid var(--accent-primary)"},onClick:Y,children:e.jsx(Mn,{})})]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"center"},children:[e.jsx("button",{style:d.button,onClick:l,children:"ƒå√≠st knihu"}),e.jsx("button",{style:d.iconButton,onClick:()=>W(!0),"aria-label":"Upravit metadata",children:e.jsx(In,{})}),e.jsx("button",{style:{...d.iconButton,color:"var(--danger-color)"},onClick:()=>n(t.id),"aria-label":"Smazat knihu",children:e.jsx(Ae,{size:18})})]})})}),e.jsx("div",{style:d.detailMeta,children:N?Pe:e.jsx(M,{})}),_&&e.jsx("div",{style:d.modalOverlay,children:e.jsxs("div",{style:d.modalContent,children:[e.jsxs("div",{style:d.modalHeader,children:[e.jsx("h3",{style:{margin:0},children:"üîç OCR Zpracov√°n√≠"}),e.jsx("button",{style:d.modalCloseButton,onClick:()=>I(!1),children:"‚úï"})]}),e.jsxs("div",{style:d.modalBody,children:[e.jsxs("p",{style:{marginBottom:"1rem"},children:['Vyberte jazyk pro OCR zpracov√°n√≠ knihy "',e.jsx("strong",{children:t.title}),'":']}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold"},children:"Jazyk OCR:"}),e.jsx("select",{value:ge,onChange:P=>Se(P.target.value),style:{width:"100%",padding:"0.5rem",borderRadius:"4px",border:"1px solid var(--border-color)",backgroundColor:"var(--background-primary)",color:"var(--text-primary)",fontSize:"1rem"},children:Ee.getAvailableLanguages().map(P=>e.jsx("option",{value:P.label,children:P.label},P.code))})]}),e.jsx("div",{style:{padding:"1rem",backgroundColor:"var(--background-tertiary)",borderRadius:"6px",marginBottom:"1rem",border:"1px solid var(--border-color)"},children:e.jsxs("p",{style:{margin:0,fontSize:"0.9rem",color:"var(--text-secondary)"},children:["‚ö†Ô∏è ",e.jsx("strong",{children:"Upozornƒõn√≠:"})," OCR zpracov√°n√≠ nahrad√≠ p≈Øvodn√≠ soubor verz√≠ s rozpoznan√Ωm textem. Proces m≈Ø≈æe trvat a≈æ hodinu pro velk√© soubory."]})}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"flex-end"},children:[e.jsx("button",{style:{...d.button,background:"transparent",border:"1px solid var(--border-color)",color:"var(--text-primary)"},onClick:()=>I(!1),children:"Zru≈°it"}),e.jsx("button",{style:{...d.button,backgroundColor:"#007cba",color:"white"},onClick:J,children:"üîç Spustit OCR"})]})]})]})}),j&&e.jsx("div",{style:d.modalOverlay,children:e.jsxs("div",{style:d.modalContent,children:[e.jsxs("div",{style:d.modalHeader,children:[e.jsx("h3",{style:{margin:0},children:"üóúÔ∏è Komprese PDF"}),e.jsx("button",{style:d.modalCloseButton,onClick:()=>T(!1),children:"‚úï"})]}),e.jsxs("div",{style:d.modalBody,children:[e.jsxs("p",{style:{marginBottom:"1rem"},children:['Vyberte √∫rove≈à komprese pro knihu "',e.jsx("strong",{children:t.title}),'":']}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold"},children:"√örove≈à komprese:"}),e.jsxs("select",{value:je,onChange:P=>_e(P.target.value),style:{width:"100%",padding:"0.5rem",borderRadius:"4px",border:"1px solid var(--border-color)",backgroundColor:"var(--background-primary)",color:"var(--text-primary)",fontSize:"1rem"},children:[e.jsx("option",{value:"low",children:"Low - Minim√°ln√≠ komprese (zachov√° kvalitu)"}),e.jsx("option",{value:"recommended",children:"Recommended - Optim√°ln√≠ pomƒõr velikost/kvalita"}),e.jsx("option",{value:"extreme",children:"Extreme - Maxim√°ln√≠ komprese (m≈Ø≈æe sn√≠≈æit kvalitu)"})]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--background-tertiary)",borderRadius:"6px",marginBottom:"1rem",border:"1px solid var(--border-color)"},children:[e.jsxs("p",{style:{margin:"0 0 0.5rem 0",fontSize:"0.9rem"},children:["üìä ",e.jsx("strong",{children:"Aktu√°ln√≠ velikost:"})," ",(t.fileSize/1024).toFixed(2)," MB"]}),e.jsxs("p",{style:{margin:0,fontSize:"0.9rem",color:"var(--text-secondary)"},children:["‚ö†Ô∏è ",e.jsx("strong",{children:"Upozornƒõn√≠:"})," Komprese nahrad√≠ p≈Øvodn√≠ soubor komprimovanou verz√≠. Proces m≈Ø≈æe trvat a≈æ hodinu pro velk√© soubory."]})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"flex-end"},children:[e.jsx("button",{style:{...d.button,background:"transparent",border:"1px solid var(--border-color)",color:"var(--text-primary)"},onClick:()=>T(!1),children:"Zru≈°it"}),e.jsx("button",{style:{...d.button,backgroundColor:"#ffc107",color:"white"},onClick:pe,children:"üóúÔ∏è Spustit Kompresi"})]})]})]})}),e.jsxs("div",{style:{marginTop:"2rem",borderTop:"1px solid var(--border-color)",paddingTop:"1rem"},children:[e.jsxs("button",{onClick:()=>ke(!ye),style:{width:"100%",padding:"8px 12px",backgroundColor:"var(--background-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",color:"var(--text-secondary)",fontSize:"0.85rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",transition:"all 0.2s"},children:[e.jsx("span",{children:"üõ†Ô∏è V√Ωvoj√°≈ôsk√© n√°stroje"}),e.jsx("span",{style:{transform:ye?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"},children:"‚ñº"})]}),ye&&e.jsxs("div",{style:{marginTop:"0.5rem",padding:"1rem",backgroundColor:"var(--background-tertiary)",border:"1px solid var(--border-color)",borderRadius:"6px",display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[e.jsxs("button",{style:{...d.button,fontSize:"0.85rem",padding:"6px 12px",backgroundColor:"#3b82f6",color:"white",border:"none",display:"flex",alignItems:"center",gap:"6px"},onClick:()=>a(t.id),title:"Testovat webhook (pouze zavol√° webhook bez maz√°n√≠ knihy)",children:[e.jsx(Zt,{size:16}),"Testovat webhook"]}),e.jsx("button",{style:{...d.button,fontSize:"0.85rem",padding:"6px 12px",backgroundColor:"#10b981",color:"white",border:"none"},onClick:()=>s(t.id,t.title),title:"Zkontrolovat storage cesty (otev≈ôete konzoli)",children:"üîç Diagnostika storage"}),e.jsx("button",{style:{...d.button,fontSize:"0.85rem",padding:"6px 12px",backgroundColor:"#f59e0b",color:"white",border:"none"},onClick:()=>c(t.id),title:"Testovat maz√°n√≠ images slo≈æky (skuteƒçn√© smaz√°n√≠!)",children:"üß™ Test maz√°n√≠ images"})]})]})]})},bt=({items:t,maxVisible:o=3,renderTag:n,tableMode:a=!1})=>{const[s,c]=h.useState(!1);if(t.length===0)return null;const l=s?t:t.slice(0,o),g=t.length>o;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",flexWrap:s?"wrap":"nowrap",overflow:s?"visible":"hidden"},children:[l.map((m,u)=>e.jsx("span",{style:{flexShrink:0},children:n(m)},`${m}-${u}`)),g&&!s&&(a?e.jsxs("span",{style:{color:"var(--text-secondary)",fontSize:"0.8em",padding:"2px 4px",flexShrink:0,whiteSpace:"nowrap"},title:`+${t.length-o} dal≈°√≠ch polo≈æek`,children:["... (+",t.length-o,")"]}):e.jsxs("button",{onClick:()=>c(!0),style:{background:"none",border:"none",color:"var(--primary-color)",cursor:"pointer",fontSize:"0.9em",padding:"2px 4px",borderRadius:"4px",textDecoration:"underline",flexShrink:0,whiteSpace:"nowrap"},title:`Zobrazit v≈°ech ${t.length} polo≈æek`,children:["... (+",t.length-o,")"]})),s&&g&&!a&&e.jsx("button",{onClick:()=>c(!1),style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",fontSize:"0.8em",padding:"2px 4px",borderRadius:"4px",flexShrink:0,whiteSpace:"nowrap"},title:"Zobrazit m√©nƒõ",children:"‚Üê m√©nƒõ"})]})},Fe=(t,o,n=!1)=>{const a=o!=null&&(typeof o!="string"||o.trim()!=="")&&(!Array.isArray(o)||o.length>0);return e.jsxs("div",{style:d.fieldGroup,children:[e.jsx("label",{style:d.label,children:t}),e.jsxs("div",{style:d.staticTextContainer,children:[!a&&e.jsx(Vn,{}),e.jsx("div",{style:n?d.staticTextParagraph:d.staticText,children:a?o:"‚Äì"})]})]})},pr=({value:t,onChange:o,onAIGenerate:n,isGenerating:a,allLanguages:s})=>{const[c,l]=h.useState(!1),g=h.useRef(null);h.useEffect(()=>{const u=y=>{g.current&&!g.current.contains(y.target)&&l(!1)};return document.addEventListener("mousedown",u),()=>{document.removeEventListener("mousedown",u)}},[]);const m=u=>{o(u),l(!1)};return e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx("label",{style:{fontWeight:"bold",color:"var(--text-primary)"},children:"Jazyk:"}),n&&e.jsx("button",{onClick:n,disabled:a,style:{...d.aiButton,opacity:a?.6:1,cursor:a?"not-allowed":"pointer"},title:"AI generov√°n√≠ jazyka",children:a?"‚è≥":"ü§ñ"})]}),e.jsxs("div",{style:{position:"relative"},ref:g,children:[e.jsxs("div",{onClick:()=>l(!c),style:{...d.input,display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",userSelect:"none"},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[ct(t)," ",t]}),e.jsx("span",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:c?"‚ñ≤":"‚ñº"})]}),c&&e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:"var(--background-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",maxHeight:"200px",overflowY:"auto",zIndex:1e3,boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)"},children:s.map(u=>e.jsxs("div",{onClick:()=>m(u),style:{padding:"0.5rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",backgroundColor:u===t?"var(--background-secondary)":"transparent",borderBottom:"1px solid var(--border-color)"},onMouseEnter:y=>{y.currentTarget.style.backgroundColor="var(--background-secondary)"},onMouseLeave:y=>{y.currentTarget.style.backgroundColor=u===t?"var(--background-secondary)":"transparent"},children:[ct(u)," ",u]},u))})]})]})},Ze=({label:t,name:o,value:n,setLocalBook:a,onAIGenerate:s,isGenerating:c,type:l="text"})=>{const g=h.useCallback(y=>{const{name:x,value:i}=y.target;let f=i;x==="keywords"||x==="labels"||x==="categories"||x==="publicationTypes"?f=i.split(",").map(z=>z.trim()):x==="publicationYear"&&(f=i?parseInt(i,10):null),a(z=>({...z,[x]:f}))},[a]),m=h.useCallback(()=>{s&&s(o)},[s,o]),u=l==="textarea"?"textarea":"input";return e.jsxs("div",{style:d.fieldGroup,children:[e.jsx("label",{style:d.label,children:t}),e.jsxs("div",{style:d.inputWithAction,children:[e.jsx(u,{name:o,value:n,onChange:g,style:l==="textarea"?{...d.textarea,minHeight:"100px"}:d.input,type:l==="number"?"number":"text"}),s&&e.jsx("button",{onClick:m,disabled:c,style:{...d.aiButton,opacity:1,cursor:c?"not-allowed":"pointer"},"aria-label":`Generovat ${t}`,children:c?"...":e.jsx(Vt,{})})]})]})},d={appContainer:{display:"flex",flexDirection:"column",height:"100vh",backgroundColor:"var(--background-primary)",color:"var(--text-primary)"},header:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"20px 20px",backgroundColor:"var(--background-secondary)",borderBottom:"1px solid var(--border-color)",flexShrink:0},headerActions:{display:"flex",alignItems:"center",gap:"0.75rem"},mainContent:{display:"flex",flexGrow:1,overflow:"hidden"},leftPanel:{width:"320px",flexShrink:0,borderRight:"1px solid var(--border-color)",padding:"1rem",overflowY:"auto",display:"flex",flexDirection:"column",gap:"1.5rem",backgroundColor:"var(--background-secondary)"},bookListContainer:{flexGrow:1,overflow:"auto",padding:"1rem"},detailPanel:{width:"420px",flexShrink:0,borderLeft:"1px solid var(--border-color)",overflowY:"auto",backgroundColor:"var(--background-secondary)"},button:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 16px",backgroundColor:"var(--background-secondary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"8px",cursor:"pointer",fontWeight:500,transition:"all 0.2s ease",fontSize:"14px",boxShadow:"var(--shadow-sm)",whiteSpace:"nowrap"},buttonDanger:{backgroundColor:"var(--danger-color)",color:"white",borderColor:"var(--danger-color)"},viewToggle:{display:"flex",backgroundColor:"var(--background-primary)",borderRadius:"8px",border:"1px solid var(--border-color)",padding:"2px"},iconButton:{background:"none",border:"none",color:"var(--text-secondary)",padding:"6px",cursor:"pointer",borderRadius:"6px",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease"},iconButtonActive:{backgroundColor:"var(--accent-primary)",color:"#fff",boxShadow:"var(--shadow-sm)"},detailContent:{padding:"1.5rem",display:"flex",flexDirection:"column"},detailCover:{width:"150px",height:"225px",objectFit:"cover",borderRadius:"8px",alignSelf:"center",marginBottom:"0.5rem",backgroundColor:"var(--background-tertiary)",border:"1px solid var(--border-color)",boxShadow:"var(--shadow-md)"},detailTitle:{fontSize:"1.25rem",fontWeight:600,textAlign:"center",marginBottom:"1rem"},detailActions:{display:"flex",gap:"0.75rem",justifyContent:"center",alignItems:"center",marginBottom:"1.5rem",flexWrap:"wrap"},detailMeta:{display:"flex",flexDirection:"column",gap:"1.25rem"},fieldGroup:{display:"flex",flexDirection:"column",gap:"0.5rem"},filterGroupHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"4px"},label:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px"},input:{width:"100%",padding:"8px 12px",backgroundColor:"var(--background-primary)",border:"1px solid var(--border-color)",borderRadius:"6px",color:"var(--text-primary)",fontSize:"1rem"},textarea:{width:"100%",padding:"8px 12px",backgroundColor:"var(--background-primary)",border:"1px solid var(--border-color)",borderRadius:"6px",color:"var(--text-primary)",fontSize:"1rem",fontFamily:"inherit",resize:"vertical"},inputWithAction:{position:"relative",display:"flex"},aiButton:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",color:"var(--accent-primary)",cursor:"pointer",padding:"4px",display:"flex",borderRadius:"50%"},addTagButton:{background:"none",border:"none",cursor:"pointer",color:"var(--accent-primary)",padding:"2px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"},bookTableWrapper:{overflowX:"auto"},bookTable:{width:"100%",borderCollapse:"collapse"},th:{textAlign:"left",padding:"12px 8px",borderBottom:"2px solid var(--border-color)",color:"var(--text-secondary)",fontWeight:600,fontSize:"0.8rem",textTransform:"uppercase",letterSpacing:"0.5px",whiteSpace:"nowrap"},tr:{transition:"background-color 0.15s"},trSelected:{backgroundColor:"var(--accent-primary-hover)",color:"#fff"},td:{padding:"12px 8px",borderBottom:"1px solid var(--border-color)",cursor:"pointer",verticalAlign:"middle",fontSize:"0.9rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},tdActions:{display:"flex",gap:"4px",alignItems:"center"},tdTitle:{fontWeight:500},gridContainer:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(180px, 1fr))",gap:"1.5rem"},gridCard:{backgroundColor:"var(--background-secondary)",borderRadius:"8px",padding:"1rem",cursor:"pointer",transition:"transform 0.2s, box-shadow 0.2s",border:"1px solid var(--border-color)"},gridCardSelected:{borderColor:"var(--accent-primary)",boxShadow:"0 0 10px rgba(93, 127, 163, 0.3)"},gridCardCover:{width:"100%",height:"200px",objectFit:"cover",borderRadius:"6px",marginBottom:"1rem",backgroundColor:"var(--background-tertiary)"},gridCardTitle:{fontSize:"1rem",fontWeight:600,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},gridCardAuthor:{fontSize:"0.875rem",color:"var(--text-secondary)"},staticTextContainer:{display:"flex",alignItems:"center",gap:"8px"},staticText:{fontSize:"1rem"},staticTextParagraph:{fontSize:"0.95rem",lineHeight:1.6,whiteSpace:"pre-wrap",color:"var(--text-primary)"},tag:{backgroundColor:"var(--background-tertiary)",padding:"4px 8px",borderRadius:"4px",fontSize:"0.8rem",cursor:"pointer",transition:"all 0.2s ease",border:"1px solid var(--border-color)",display:"inline-block"},tagSelected:{backgroundColor:"var(--accent-beige)",color:"var(--background-secondary)",borderColor:"var(--accent-beige)"},tagList:{display:"flex",flexWrap:"wrap",gap:"8px"},dropdownMenu:{position:"absolute",top:"calc(100% + 5px)",right:0,backgroundColor:"var(--background-secondary)",borderRadius:"8px",boxShadow:"var(--shadow-md)",border:"1px solid var(--border-color)",zIndex:10,minWidth:"220px",overflow:"hidden",padding:"5px 0"},dropdownMenuLink:{display:"flex",alignItems:"center",gap:"10px",padding:"10px 15px",color:"var(--text-primary)",textDecoration:"none",cursor:"pointer",fontSize:"14px"},modalOverlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.6)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3,backdropFilter:"blur(4px)"},modalContent:{backgroundColor:"var(--background-secondary)",padding:"2rem",borderRadius:"12px",width:"90%",maxWidth:"600px",boxShadow:"var(--shadow-md)"},modalHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid var(--border-color)",paddingBottom:"1rem",marginBottom:"1rem"},modalCloseButton:{background:"none",border:"none",cursor:"pointer",color:"var(--text-secondary)",padding:0},modalBody:{},rangeSliderContainer:{display:"flex",flexDirection:"column",gap:"1rem"},rangeSliderRowSimple:{display:"grid",gridTemplateColumns:"auto 1fr auto",alignItems:"center",gap:"1rem"},rangeLabel:{fontSize:"0.9rem",color:"var(--text-secondary)"},rangeValue:{fontSize:"0.9rem",color:"var(--text-primary)",minWidth:"80px",textAlign:"right"},tagInputContainer:{display:"flex",flexWrap:"wrap",gap:"8px",padding:"4px 8px",backgroundColor:"var(--background-primary)",border:"1px solid var(--border-color)",borderRadius:"6px",minHeight:"42px",alignItems:"center"},tagRemoveButton:{background:"none",border:"none",color:"inherit",cursor:"pointer",marginLeft:"4px",padding:"0",fontSize:"14px",fontWeight:"bold",lineHeight:1,opacity:.5},tagInputAddButton:{background:"none",border:"1px dashed var(--border-color)",color:"var(--text-secondary)",borderRadius:"4px",padding:"4px 8px",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",fontSize:"12px",marginLeft:"auto"},tagDropdown:{position:"absolute",top:"calc(100% + 5px)",left:0,right:0,backgroundColor:"var(--background-secondary)",borderRadius:"8px",boxShadow:"var(--shadow-md)",border:"1px solid var(--border-color)",zIndex:10,maxHeight:"200px",overflowY:"auto",padding:"5px 0"},addNewTagLink:{borderTop:"1px solid var(--border-color)",color:"var(--accent-primary)",fontWeight:500},chatOverlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3,padding:"10px"},chatContainer:{backgroundColor:"white",borderRadius:"12px",width:"98%",maxWidth:"1000px",height:"98%",minHeight:"80vh",maxHeight:"95vh",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.3)","@media (max-width: 768px)":{width:"100%",height:"100%",borderRadius:"0px"}},chatContent:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column",minHeight:0}},hr=Fo.createRoot(document.getElementById("root"));hr.render(e.jsx(Oo.StrictMode,{children:e.jsx(yn,{children:t=>e.jsxs(e.Fragment,{children:[e.jsx(ar,{currentUser:t}),e.jsx(Go,{currentUser:t})]})})}));window.testILovePDFFixed=async()=>{console.log("üß™ Testov√°n√≠ opraven√© iLovePDF slu≈æby...");try{const t=await Ee.checkAPIStatus();return console.log("üìä API Status:",t),t.available?(console.log(`‚úÖ API je dostupn√©, zb√Ωvaj√≠c√≠ kredity: ${t.credits}`),t):(console.error("‚ùå iLovePDF API nen√≠ dostupn√©"),t)}catch(t){return console.error("‚ùå Test selha≈Ç:",t),{success:!1,error:t}}};
