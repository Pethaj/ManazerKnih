<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test User Data - Produkce (Bewit Web)</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    h1 {
      color: #2563eb;
      margin-bottom: 10px;
    }
    
    .info {
      background: #eff6ff;
      border-left: 4px solid #2563eb;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 4px;
    }
    
    .info h3 {
      margin-top: 0;
      color: #1e40af;
    }
    
    .warning {
      background: #fef3c7;
      border-left: 4px solid #f59e0b;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 4px;
    }
    
    .success {
      background: #d1fae5;
      border-left: 4px solid #10b981;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 4px;
    }
    
    .error {
      background: #fee2e2;
      border-left: 4px solid #ef4444;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 4px;
    }
    
    #status {
      margin-bottom: 20px;
      min-height: 100px;
    }
    
    .status-item {
      padding: 8px;
      margin: 5px 0;
      border-radius: 4px;
      font-family: monospace;
      font-size: 14px;
    }
    
    .status-success {
      background: #d1fae5;
      color: #065f46;
    }
    
    .status-error {
      background: #fee2e2;
      color: #991b1b;
    }
    
    .status-info {
      background: #eff6ff;
      color: #1e40af;
    }
    
    iframe {
      width: 100%;
      height: 700px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      margin-top: 20px;
    }
    
    code {
      background: #f3f4f6;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: monospace;
    }
    
    .test-data {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      padding: 15px;
      border-radius: 4px;
      margin: 15px 0;
    }
    
    .test-data pre {
      margin: 0;
      font-family: monospace;
      font-size: 13px;
    }
  </style>
</head>
<body>
  
  <div class="container">
    <h1>ğŸ§ª Test User Data - PRODUKCE (Bewit Web)</h1>
    
    <div class="info">
      <h3>ğŸ“‹ Co tento test dÄ›lÃ¡:</h3>
      <p>1. NaÄte Wany Chat iframe z <strong>https://gr8learn.eu/embed.html</strong> (PRODUKCE)</p>
      <p>2. Po naÄtenÃ­ poÅ¡le testovacÃ­ user data pÅ™es <code>postMessage</code></p>
      <p>3. Zkontroluje, jestli data dorazila do iframe</p>
      <p>4. Po odeslÃ¡nÃ­ zprÃ¡vy v chatu zkontroluj N8N webhook - mÄ›l by obsahovat vyplnÄ›nÃ½ <code>user</code> objekt</p>
    </div>
    
    <div class="test-data">
      <h3>ğŸ“¦ TestovacÃ­ user data, kterÃ¡ budou odeslÃ¡na:</h3>
      <pre>{
  "id": "12345",
  "firstName": "Marcel",
  "lastName": "Haim",
  "email": "marcel.haim@bewit.cz",
  "position": "Supervisor"
}</pre>
    </div>
    
    <div class="warning">
      <h3>âš ï¸ DÅ¯leÅ¾itÃ©:</h3>
      <p><strong>1. OtevÅ™i konzoli (F12)</strong> a sleduj logy!</p>
      <p><strong>2. NapiÅ¡ nÄ›jakou zprÃ¡vu do chatu</strong></p>
      <p><strong>3. V konzoli najdi log:</strong> <code>Payload sent to N8N</code></p>
      <p><strong>4. Zkontroluj pole <code>user</code></strong> - mÄ›lo by obsahovat vyplnÄ›nÃ¡ data!</p>
    </div>
    
    <div id="status">
      <h3>ğŸ“Š Status integrace:</h3>
      <div id="status-logs"></div>
    </div>
    
    <div class="success" id="success-box" style="display: none;">
      <h3>âœ… ÃšSPÄšCH!</h3>
      <p>postMessage byl odeslÃ¡n. TeÄ:</p>
      <ol>
        <li>NapiÅ¡ zprÃ¡vu do chatu nÃ­Å¾e</li>
        <li>OtevÅ™i konzoli (F12)</li>
        <li>Najdi log <code>Payload sent to N8N</code></li>
        <li>Zkontroluj, Å¾e <code>"user"</code> objekt obsahuje data (ne prÃ¡zdnÃ© stringy)</li>
      </ol>
    </div>
    
    <!-- IFRAME -->
    <div style="border: 2px dashed #2563eb; padding: 10px; border-radius: 8px; margin-bottom: 20px;">
      <p style="margin: 0 0 10px 0;"><strong>Wany Chat Iframe (PRODUKCE):</strong></p>
      <iframe 
        id="wany-chat-iframe" 
        src="https://gr8learn.eu/embed.html"
        allow="clipboard-write" 
        title="Wany Chat Production Test"
      ></iframe>
    </div>
  </div>

  <!-- JAVASCRIPT - PRODUKÄŒNÃ TESTOVACÃ KÃ“D -->
  <script>
  // Helper funkce pro logovÃ¡nÃ­
  const statusLogs = document.getElementById('status-logs');
  const successBox = document.getElementById('success-box');
  
  function addLog(message, type = 'info') {
    const div = document.createElement('div');
    div.className = `status-item status-${type}`;
    div.textContent = message;
    statusLogs.appendChild(div);
    
    // Scroll dolÅ¯
    statusLogs.scrollTop = statusLogs.scrollHeight;
  }
  
  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  console.log('ğŸ§ª TEST USER DATA INTEGRATION - PRODUKCE');
  console.log('ğŸŒ URL: https://gr8learn.eu/embed.html');
  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  
  addLog('ğŸ”§ JavaScript inicializovÃ¡n (PRODUKCE)', 'info');
  console.log('ğŸ”§ JavaScript zaÄÃ­nÃ¡...');
  
  (function() {
    const iframe = document.getElementById('wany-chat-iframe');
    
    if (!iframe) {
      const errorMsg = 'âŒ CHYBA: Iframe nenalezen! ID: wany-chat-iframe';
      console.error(errorMsg);
      addLog(errorMsg, 'error');
      return;
    }
    
    const successMsg = 'âœ… Iframe nalezen: ' + iframe.id;
    console.log(successMsg, iframe);
    addLog(successMsg, 'success');
    
    function sendUserData() {
      console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
      console.log('ğŸ“¤ ODESÃLÃM USER DATA DO IFRAME (PRODUKCE)');
      console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
      
      addLog('ğŸ“¤ PÅ™ipravuji user data...', 'info');
      
      const userData = {
        id: '12345',
        firstName: 'Marcel',
        lastName: 'Haim',
        email: 'marcel.haim@bewit.cz',
        position: 'Supervisor'
      };
      
      console.log('ğŸ“¦ User data:', userData);
      addLog('ğŸ“¦ User data: ' + JSON.stringify(userData, null, 2), 'info');
      
      try {
        iframe.contentWindow.postMessage({
          type: 'USER_DATA',
          user: userData
        }, 'https://gr8learn.eu');
        
        const successMsg = 'âœ… postMessage ÃšSPÄšÅ NÄš ODESLÃN do iframe!';
        console.log(successMsg);
        addLog(successMsg, 'success');
        
        console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
        console.log('â³ TEÄ ÄŒEKÃM NA ODPOVÄšÄ Z IFRAME...');
        console.log('   (v konzoli by mÄ›l bÃ½t log z EmbedVanyChat.tsx)');
        console.log('   OÄekÃ¡vÃ¡m: "ğŸ‘¤ User data pÅ™ijata z rodiÄe pÅ™es postMessage"');
        console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
        
        addLog('â³ ÄŒekÃ¡m na potvrzenÃ­ z iframe...', 'info');
        
        // ZobrazÃ­me success box
        setTimeout(() => {
          successBox.style.display = 'block';
          addLog('âœ… Data odeslÃ¡na! NapiÅ¡ zprÃ¡vu do chatu a zkontroluj konzoli.', 'success');
        }, 2000);
        
      } catch (error) {
        const errorMsg = 'âŒ CHYBA pÅ™i odesÃ­lÃ¡nÃ­ postMessage: ' + error.message;
        console.error(errorMsg, error);
        addLog(errorMsg, 'error');
      }
    }
    
    // Event listener pro naÄtenÃ­ iframe
    iframe.addEventListener('load', function() {
      const successMsg = 'âœ… Iframe naÄtenÃ½ (load event)';
      console.log(successMsg);
      addLog(successMsg, 'success');
      
      console.log('â³ ÄŒekÃ¡m 1 sekundu pÅ™ed odeslÃ¡nÃ­m dat (pro jistotu)...');
      addLog('â³ ÄŒekÃ¡m 1 sekundu...', 'info');
      
      // PoÄkÃ¡me 1 sekundu pro jistotu, Å¾e se aplikace v iframe inicializovala
      setTimeout(sendUserData, 1000);
    });
    
    console.log('â³ ÄŒekÃ¡m na naÄtenÃ­ iframe...');
    addLog('â³ ÄŒekÃ¡m na naÄtenÃ­ iframe...', 'info');
    
  })();
  
  // Naslouchej takÃ© zprÃ¡vÃ¡m zpÄ›t z iframe (volitelnÃ©)
  window.addEventListener('message', function(event) {
    if (event.origin === 'https://gr8learn.eu') {
      console.log('ğŸ“¨ PÅ™ijata zprÃ¡va z iframe:', event);
      console.log('ğŸ“¦ Data z iframe:', event.data);
      addLog('ğŸ“¨ ZprÃ¡va z iframe: ' + JSON.stringify(event.data), 'success');
    }
  });
  
  </script>
  
</body>
</html>
