const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/inlineProductScreeningService-DrApfroN.js","assets/WaveLoader-DvqYMd3O.js","assets/preload-helper-B8tWKQ1F.js","assets/WaveLoader-MPqx-1mk.css","assets/productNameMatchingService-3dzt0v6S.js","assets/jszip.min-pmDCh66N.js"])))=>i.map(i=>d[i]);
import{_ as Et}from"./preload-helper-B8tWKQ1F.js";import{s as E,r as p,j as e,P as jo,G as co,e as wo,d as jn,C as It,a as Co,b as wn,M as pt,c as xt,f as ht,g as gt,h as zo,i as Cn,W as So,L as _o,R as No,k as Re,l as zn,m as Pe}from"./WaveLoader-DvqYMd3O.js";const Sn="https://bewit.love/feeds/zbozi.xml",_n="https://bewit.love/feed/bewit?auth=xr32PRbrs554K",Nn=()=>E.supabaseUrl;`${Nn()}`;const Pn=async()=>{try{const{data:{session:t}}=await E.auth.getSession(),o=t==null?void 0:t.access_token,{data:n,error:r}=await E.functions.invoke("sync-feed-2",{body:{}});if(r)throw r;return(n==null?void 0:n.ok)===!0}catch{return!1}},uo=async t=>{try{const{data:o,error:n}=await E.from("sync_logs").select("*").eq("sync_type",t).order("started_at",{ascending:!1}).limit(1).single();return n?null:o}catch{return null}},Ot=()=>{const[t,o]=p.useState(!1),[n,r]=p.useState(!1),[s,l]=p.useState("feed_1"),[a,c]=p.useState(null),[g,u]=p.useState(0),[m,b]=p.useState(null),[d,v]=p.useState(0);p.useEffect(()=>{P(),z(),f(),C()},[]);const P=async()=>{try{const S=await uo("products_feed");c(S)}catch{}},f=async()=>{try{const S=await uo("product_feed_2");b(S)}catch{}},z=async()=>{try{const{count:S,error:R}=await E.from("products").select("*",{count:"exact",head:!0});if(R)return;u(S||0)}catch{}},C=async()=>{try{const{count:S,error:R}=await E.from("product_feed_2").select("*",{count:"exact",head:!0});if(R)return;v(S||0)}catch{}},T=async()=>{o(!0);try{const S=await fetch("https://modopafybeslbcqjxsve.supabase.co/functions/v1/sync-products",{method:"POST",headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1vZG9wYWZ5YmVzbGJjcWp4c3ZlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyNTM0MjEsImV4cCI6MjA3MDgyOTQyMX0.8gxL0b9flTUyoltiEIJx8Djuiyx16rySlffHkd_nm1U","Content-Type":"application/json","X-Triggered-By":"manual-button"},body:JSON.stringify({source:"manual_button",trigger_time:new Date().toISOString()})});if(!S.ok)throw new Error(`HTTP ${S.status}: ${S.statusText}`);const R=await S.json();if(R.ok){await P(),await z();const J=`âœ… Synchronizace ÃºspÄ›Å¡nÃ¡!

ğŸ“Š ZpracovÃ¡no: ${R.processed||0}
â• NovÃ½ch: ${R.inserted||0}
ğŸ”„ AktualizovÃ¡no: ${R.updated||0}
âŒ Chyb: ${R.failed||0}`;alert(J)}else throw new Error(R.error||"NeznÃ¡mÃ¡ chyba z Edge Function")}catch(S){alert("âŒ Chyba pÅ™i synchronizaci: "+(S instanceof Error?S.message:"NeznÃ¡mÃ¡ chyba"))}finally{o(!1)}},y=async()=>{await T()},V=async()=>{r(!0);try{if(await Pn())await f(),await C(),alert("âœ… Synchronizace Feed 2 ÃºspÄ›Å¡nÄ› dokonÄena!");else throw new Error("Synchronizace Feed 2 selhala")}catch(S){alert("âŒ Chyba pÅ™i synchronizaci Feed 2: "+(S instanceof Error?S.message:"NeznÃ¡mÃ¡ chyba"))}finally{r(!1)}},F=S=>new Date(S).toLocaleString("cs-CZ");return e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 max-w-4xl mx-auto",children:[e.jsx("h2",{className:"text-2xl font-bold text-bewit-dark mb-6",children:"ğŸ›’ Synchronizace produktÅ¯ BEWIT"}),e.jsxs("div",{className:"mb-6 flex gap-4 border-b border-gray-200",children:[e.jsx("button",{onClick:()=>l("feed_1"),className:`px-6 py-3 font-semibold border-b-2 transition-colors ${s==="feed_1"?"border-bewit-blue text-bewit-blue":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Feed 1 - zbozi.xml"}),e.jsx("button",{onClick:()=>l("feed_2"),className:`px-6 py-3 font-semibold border-b-2 transition-colors ${s==="feed_2"?"border-bewit-blue text-bewit-blue":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Feed 2 - Product Feed 2"})]}),s==="feed_1"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-bewit-lightBlue rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-bewit-blue mb-2",children:"Produkty v databÃ¡zi"}),e.jsx("p",{className:"text-3xl font-bold text-bewit-blue",children:g})]}),a&&e.jsxs("div",{className:`rounded-lg p-4 ${a.status==="success"?"bg-green-100":a.status==="error"?"bg-red-100":"bg-yellow-100"}`,children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"PoslednÃ­ synchronizace"}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Status:"})," ",a.status==="success"?"âœ… ÃšspÄ›ch":a.status==="error"?"âŒ Chyba":"â³ BÄ›Å¾Ã­"]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"ÄŒas:"})," ",F(a.started_at)]}),a.status==="success"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"ZpracovÃ¡no:"})," ",a.records_processed]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"NovÃ½ch:"})," ",a.records_inserted,",",e.jsx("strong",{children:" AktualizovÃ¡no:"})," ",a.records_updated]})]}),a.error_message&&e.jsxs("p",{className:"text-sm text-red-600 mt-2",children:[e.jsx("strong",{children:"Chyba:"})," ",a.error_message]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:y,disabled:t,className:"flex-1 bg-bewit-blue text-white px-6 py-3 rounded-lg font-semibold hover:bg-bewit-blue/90 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:t?"â³ Synchronizuji...":"ğŸ”„ Synchronizovat Feed 1 nynÃ­"}),e.jsx("button",{onClick:()=>window.open(Sn,"_blank"),className:"bg-gray-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-gray-600 transition-colors",children:"ğŸ“‹ Zobrazit feed"})]})]}),s==="feed_2"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-purple-100 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-purple-700 mb-2",children:"Produkty v databÃ¡zi (Feed 2)"}),e.jsx("p",{className:"text-3xl font-bold text-purple-700",children:d}),e.jsx("p",{className:"text-xs text-gray-600 mt-2",children:"Tabulka: product_feed_2"})]}),m&&e.jsxs("div",{className:`rounded-lg p-4 ${m.status==="success"?"bg-green-100":m.status==="error"?"bg-red-100":"bg-yellow-100"}`,children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"PoslednÃ­ synchronizace"}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Status:"})," ",m.status==="success"?"âœ… ÃšspÄ›ch":m.status==="error"?"âŒ Chyba":"â³ BÄ›Å¾Ã­"]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"ÄŒas:"})," ",F(m.started_at)]}),m.status==="success"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"ZpracovÃ¡no:"})," ",m.records_processed]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"NovÃ½ch:"})," ",m.records_inserted,",",e.jsx("strong",{children:" AktualizovÃ¡no:"})," ",m.records_updated]})]}),m.error_message&&e.jsxs("p",{className:"text-sm text-red-600 mt-2",children:[e.jsx("strong",{children:"Chyba:"})," ",m.error_message]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:V,disabled:n,className:"flex-1 bg-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:n?"â³ Synchronizuji Feed 2...":"ğŸ”„ Synchronizovat Feed 2 nynÃ­"}),e.jsx("button",{onClick:()=>window.open(_n,"_blank"),className:"bg-gray-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-gray-600 transition-colors",children:"ğŸ“‹ Zobrazit feed"})]})]})]})},po="https://n8n.srv980546.hstgr.cloud/webhook/8eda4352-19ca-48fe-8325-855ecf554fc3/chat",Tn=({recommendedProducts:t,sessionId:o,metadata:n,chatHistory:r,onFunnelResponse:s,className:l=""})=>{const[a,c]=p.useState(!1),[g,u]=p.useState(""),[m,b]=p.useState(!1),[d,v]=p.useState(null),[P,f]=p.useState(null),z=async()=>{const C=g.split(/[\n,]+/).map(T=>T.trim()).filter(T=>T.length>0);if(C.length===0){v("Zadejte alespoÅˆ jeden symptom nebo problÃ©m.");return}if(t.length===0){v("Nejsou k dispozici Å¾Ã¡dnÃ© produkty pro doporuÄenÃ­.");return}b(!0),v(null);try{console.log("%câ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—","background: #3B82F6; color: white; font-weight: bold;"),console.log("%câ•‘         ğŸ¯ MANUÃLNÃ FUNNEL SPOUÅ TÄšÄŒ - START                       â•‘","background: #3B82F6; color: white; font-weight: bold;"),console.log("%câ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•","background: #3B82F6; color: white; font-weight: bold;"),console.log("%cğŸ“‹ Symptomy zadanÃ© uÅ¾ivatelem:","color: #3B82F6; font-weight: bold;"),C.forEach((W,re)=>console.log(`   ${re+1}. ${W}`)),console.log("%cğŸ“¦ DostupnÃ© produkty:","color: #8B5CF6; font-weight: bold;"),t.forEach((W,re)=>console.log(`   ${re+1}. ${W.product_name}`));const T=t.map(W=>W.description?`${W.product_name} (${W.description})`:W.product_name),V=[...new Set(T)].join(", "),F=C.join(", "),S=`âš ï¸ OMEZENÃ: Pracuj POUZE s tÄ›mito vybranÃ½mi produkty, NEDOPORUÄŒUJ Å¾Ã¡dnÃ© jinÃ©!

VybranÃ© produkty (POUZE TYTO): ${V}

Symptomy zÃ¡kaznÃ­ka: ${F}

ÃšKOL: Z vÃ½Å¡e uvedenÃ½ch ${t.length} produktÅ¯ (${V}) vyber 2 nejlepÅ¡Ã­ pro danÃ© symptomy.
- DetailnÄ› rozepiÅ¡ proÄ jsou vhodnÃ©
- UveÄ jak je pouÅ¾Ã­vat
- NEDOPORUÄŒUJ Å¾Ã¡dnÃ© jinÃ© produkty mimo tento seznam!`,R={sessionId:o,action:"sendMessage",chatInput:S,chatHistory:r.map(W=>({id:W.id,role:W.role,text:W.text.replace(/<<<PRODUCT:[^>]+>>>/g,"").trim()})),metadata:n};console.log("%cğŸ“¡ OdesÃ­lÃ¡m do N8N webhook:","color: #EF4444; font-weight: bold;"),console.log("   URL:",po),console.log("%cğŸ“ chatInput:","color: #EF4444;"),console.log(S);const J=await fetch(po,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(R)});if(!J.ok)throw new Error(`Webhook error: ${J.status} ${J.statusText}`);const w=await J.json();console.log("%cğŸ“¥ N8N response:","color: #10B981; font-weight: bold;",w);let U=Array.isArray(w)?w[0]:w;U!=null&&U.json&&(U=U.json);let ne=(U==null?void 0:U.output)||(U==null?void 0:U.text)||(U==null?void 0:U.response)||(U==null?void 0:U.html)||"NepodaÅ™ilo se zÃ­skat odpovÄ›Ä.",q=[],I=ne;if(typeof ne=="string"&&ne.trim().startsWith("{")&&ne.includes("selectedProductCodes"))try{const W=JSON.parse(ne);q=W.selectedProductCodes||[],I=W.recommendation||ne,console.log("%câœ… ParsovÃ¡n JSON z N8N:","color: #10B981;"),console.log("   selectedProductCodes:",q),console.log("   recommendation text length:",I.length)}catch(W){console.warn("%câš ï¸ NepodaÅ™ilo se parsovat JSON z botText:","color: orange;",W)}if(typeof I=="string"&&I.includes("<")&&I.includes(">")){const W=document.createElement("div");W.innerHTML=I,I=W.textContent||W.innerText||I}console.log("%cğŸ“ ExtrahovanÃ½ text (preview):","color: #8B5CF6;",I.substring(0,200)),console.log("%cğŸ”„ Obohacuji produkty z databÃ¡ze...","color: #8B5CF6;");let se=[];q.length>0?(console.log("   ğŸ¯ Filtrujeme produkty podle selectedProductCodes:",q),se=t.filter(W=>{const re=q.some(M=>W.product_name.startsWith(`${M} -`)),N=q.includes(W.product_code);return re||N?(console.log(`   âœ… Match: ${W.product_name} (code: ${W.product_code})`),!0):!1}),se.length===0&&(console.warn("   âš ï¸ Å½Ã¡dnÃ© produkty neodpovÃ­dajÃ­ selectedProductCodes, pouÅ¾iji prvnÃ­ 2"),se=t.slice(0,2))):(console.log("   âš ï¸ Å½Ã¡dnÃ© selectedProductCodes, pouÅ¾iji prvnÃ­ 2 produkty"),se=t.slice(0,2));const oe=(await wo(se)).map(W=>({product_code:W.product_code,product_name:W.product_name,description:W.description,description_short:W.description,price:W.price,currency:W.currency||"CZK",url:W.url||`https://bewit.love/produkt/${W.product_code}`,thumbnail:W.thumbnail}));console.log("%câœ… Funnel dokonÄen!","color: #10B981; font-weight: bold;"),console.log("   Produkty:",oe.map(W=>W.product_name)),f({text:I,products:oe}),s&&s(I,oe),c(!1),u("")}catch(T){console.error("%câŒ Chyba manuÃ¡lnÃ­ho funnelu:","color: #EF4444;",T),v(T instanceof Error?T.message:"NepodaÅ™ilo se zpracovat poÅ¾adavek.")}finally{b(!1)}};return P?e.jsx("div",{className:l,children:e.jsx(jo,{funnelText:P.text,selectedProducts:P.products,symptomList:g.split(/[\n,]+/).map(C=>C.trim()).filter(C=>C.length>0)})}):e.jsxs("div",{className:`manual-funnel-container ${l}`,children:[!a&&e.jsx("button",{onClick:()=>c(!0),className:"manual-funnel-trigger-button",children:e.jsx("span",{className:"manual-funnel-text",children:"âœ¨ DoporuÄit produkty pÅ™esnÄ› na mÃ­ru mÃ½m potÃ­Å¾Ã­m"})}),a&&e.jsxs("div",{className:"manual-funnel-form",children:[e.jsxs("div",{className:"manual-funnel-form-header",children:[e.jsx("h4",{children:"PopiÅ¡te svÃ© symptomy nebo potÃ­Å¾e"}),e.jsx("button",{onClick:()=>c(!1),className:"manual-funnel-close-btn",title:"ZavÅ™Ã­t",children:"âœ•"})]}),e.jsx("p",{className:"manual-funnel-form-desc",children:"NapiÅ¡te svÃ© symptomy nebo potÃ­Å¾e, kterÃ© vÃ¡s trÃ¡pÃ­. KaÅ¾dÃ½ symptom oddÄ›lte ÄÃ¡rkou nebo napiÅ¡te na novÃ½ Å™Ã¡dek. Na zÃ¡kladÄ› tÄ›chto informacÃ­ vÃ¡m doporuÄÃ­me nejvhodnÄ›jÅ¡Ã­ produkty."}),e.jsx("textarea",{value:g,onChange:C=>u(C.target.value),placeholder:"NapÅ™.: bolest hlavy, Ãºnava, nespavost...",className:"manual-funnel-textarea",disabled:m,rows:4}),d&&e.jsx("div",{className:"manual-funnel-error",children:d}),e.jsx("button",{onClick:z,disabled:m,className:"manual-funnel-submit-btn",children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"manual-funnel-spinner"}),e.jsx(co,{colors:["#00d084","#4079ff","#00d084","#4079ff","#00d084"],animationSpeed:8,showBorder:!1,children:"ZpracovÃ¡vÃ¡m..."})]}):e.jsx(co,{colors:["#00d084","#4079ff","#00d084","#4079ff","#00d084"],animationSpeed:8,showBorder:!1,children:"ğŸ’¬ DoporuÄ mi produkty"})})]}),e.jsx("style",{children:`
        .manual-funnel-container {
          margin-top: 16px;
        }

        .manual-funnel-trigger-button {
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 10px;
          padding: 14px 20px;
          background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
          border: 2px solid #2563EB;
          border-radius: 12px;
          cursor: pointer;
          transition: all 0.3s ease;
          width: 100%;
          text-align: center;
          box-shadow: 0 2px 8px rgba(59, 130, 246, 0.2);
        }

        .manual-funnel-trigger-button:hover {
          background: linear-gradient(135deg, #2563EB 0%, #1D4ED8 100%);
          transform: translateY(-2px);
          box-shadow: 0 6px 16px rgba(59, 130, 246, 0.35);
          border-color: #1D4ED8;
        }

        .manual-funnel-text {
          font-size: 15px;
          font-weight: 600;
          color: #ffffff;
          letter-spacing: 0.01em;
        }

        .manual-funnel-form {
          background: #ffffff;
          border: 2px solid #3B82F6;
          border-radius: 12px;
          padding: 20px;
          animation: slideDown 0.3s ease;
          box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }

        @keyframes slideDown {
          from {
            opacity: 0;
            transform: translateY(-10px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }

        .manual-funnel-form-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 12px;
        }

        .manual-funnel-form-header h4 {
          margin: 0;
          font-size: 16px;
          font-weight: 600;
          color: #1e293b;
        }

        .manual-funnel-close-btn {
          background: none;
          border: none;
          font-size: 18px;
          color: #64748b;
          cursor: pointer;
          padding: 4px 8px;
          border-radius: 4px;
          transition: all 0.2s;
        }

        .manual-funnel-close-btn:hover {
          background: #f1f5f9;
          color: #1e293b;
        }

        .manual-funnel-form-desc {
          font-size: 13px;
          color: #64748b;
          margin-bottom: 16px;
          line-height: 1.5;
        }

        .manual-funnel-textarea {
          width: 100%;
          padding: 12px 14px;
          border: 2px solid #e2e8f0;
          border-radius: 10px;
          font-size: 14px;
          font-family: inherit;
          line-height: 1.6;
          transition: all 0.2s;
          resize: vertical;
          min-height: 100px;
          margin-bottom: 16px;
        }

        .manual-funnel-textarea:focus {
          outline: none;
          border-color: #3B82F6;
          box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .manual-funnel-textarea:disabled {
          background: #f8fafc;
          color: #94a3b8;
          cursor: not-allowed;
        }

        .manual-funnel-textarea::placeholder {
          color: #94a3b8;
        }

        .manual-funnel-error {
          background: #fef2f2;
          border: 1px solid #fecaca;
          color: #dc2626;
          padding: 10px 12px;
          border-radius: 6px;
          font-size: 13px;
          margin-bottom: 16px;
        }

        .manual-funnel-submit-btn {
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 8px;
          width: 100%;
          padding: 14px 20px;
          background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
          border: 2px solid #e2e8f0;
          border-radius: 10px;
          cursor: pointer;
          transition: all 0.3s ease;
          font-size: 15px;
          font-weight: 600;
        }

        .manual-funnel-submit-btn:hover:not(:disabled) {
          background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
          border-color: #3B82F6;
          transform: translateY(-1px);
          box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
        }

        .manual-funnel-submit-btn:disabled {
          opacity: 0.7;
          cursor: not-allowed;
          transform: none;
        }

        .manual-funnel-spinner {
          width: 18px;
          height: 18px;
          border: 2px solid #3B82F6;
          border-top-color: transparent;
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to {
            transform: rotate(360deg);
          }
        }
      `})]})};async function $n(t){return console.warn("âš ï¸ Vector diagnostics test nenÃ­ implementovÃ¡n"),{success:!1,message:"SluÅ¾ba nenÃ­ k dispozici"}}async function Ln(t){return console.warn("âš ï¸ Complete vector test nenÃ­ implementovÃ¡n"),{success:!1,message:"SluÅ¾ba nenÃ­ k dispozici",results:[]}}async function Fn(t,o=10){return console.warn("âš ï¸ Combined search nenÃ­ implementovÃ¡n"),[]}async function At(t){return console.warn("âš ï¸ Embedding service nenÃ­ implementovÃ¡n, vracÃ­ se prÃ¡zdnÃ½ vektor"),new Array(1536).fill(0)}async function En(t,o,n=10,r=!0,s=!0){try{if(!r&&!s)return console.warn("âš ï¸ Å½Ã¡dnÃ½ feed nenÃ­ povolen pro vyhledÃ¡vÃ¡nÃ­"),[];const l=await At(t);let a=[];if(r&&s){const{data:c,error:g}=await E.rpc("hybrid_product_search",{query_text:t,query_embedding:l,match_count:n,full_text_weight:1,semantic_weight:1,rrf_k:50,filter_feed_source:null});if(g)return console.error("âŒ Chyba pÅ™i hybridnÃ­m vyhledÃ¡vÃ¡nÃ­:",g),await zt(t,l,n,null);c&&c.length>0&&(a=await St(c))}else if(r){const{data:c,error:g}=await E.rpc("hybrid_product_search",{query_text:t,query_embedding:l,match_count:n,full_text_weight:1,semantic_weight:1,rrf_k:50,filter_feed_source:"feed_1"});if(g)return console.error("âŒ Chyba pÅ™i vyhledÃ¡vÃ¡nÃ­ Feed 1:",g),await zt(t,l,n,"feed_1");c&&c.length>0&&(a=await St(c))}else if(s){const{data:c,error:g}=await E.rpc("hybrid_product_search",{query_text:t,query_embedding:l,match_count:n,full_text_weight:1,semantic_weight:1,rrf_k:50,filter_feed_source:"feed_2"});if(g)return console.error("âŒ Chyba pÅ™i vyhledÃ¡vÃ¡nÃ­ Feed 2:",g),await zt(t,l,n,"feed_2");c&&c.length>0&&(a=await St(c))}return a.length===0?[]:a}catch(l){return console.error("âŒ Chyba v hybridnÃ­m produktovÃ©m vyhledÃ¡vÃ¡nÃ­:",l),[]}}async function zt(t,o,n,r=null){try{const{data:s,error:l}=await E.rpc("search_products_by_vector",{query_embedding:o,similarity_threshold:.5,max_results:n,filter_feed_source:r});return l?(console.error("âŒ Chyba pÅ™i ÄistÄ› sÃ©mantickÃ©m vyhledÃ¡vÃ¡nÃ­:",l),[]):!s||s.length===0?[]:s.map(a=>({id:a.id||0,product_code:a.product_code,product_name:a.product_name,description:a.description,category:a.category,price:a.price,currency:a.currency,product_url:a.product_url,image_url:a.image_url,similarity_score:a.similarity_score}))}catch(s){return console.error("âŒ KritickÃ¡ chyba pÅ™i fallback vyhledÃ¡vÃ¡nÃ­:",s),[]}}async function St(t){const o=[];for(const n of t)try{const r=n.product_code;let s=null;const{data:l}=await E.from("product_embeddings").select("feed_source").eq("product_code",r).single(),a=(l==null?void 0:l.feed_source)||"feed_1";if(a==="feed_2"){const{data:c}=await E.from("product_feed_2").select("*").eq("product_code",r).single();s=c}else{const{data:c}=await E.from("products").select("*").eq("product_code",r).single();s=c}o.push({id:(s==null?void 0:s.id)||n.id||0,product_code:r,product_name:(s==null?void 0:s.product_name)||(s==null?void 0:s.name)||n.product_name,description:(s==null?void 0:s.description_short)||(s==null?void 0:s.description)||n.description,category:(s==null?void 0:s.category)||n.category,price:(s==null?void 0:s.price)||n.price,currency:(s==null?void 0:s.currency)||n.currency||"CZK",product_url:(s==null?void 0:s.url)||(s==null?void 0:s.product_url)||n.product_url,image_url:(s==null?void 0:s.thumbnail)||(s==null?void 0:s.image_url)||n.image_url,similarity_score:n.similarity_score||n.combined_score||0,feed_source:a})}catch(r){console.error(`âš ï¸ Chyba pÅ™i obohacenÃ­ produktu ${n.product_code}:`,r),o.push({id:n.id||0,product_code:n.product_code,product_name:n.product_name,description:n.description,category:n.category,price:n.price,currency:n.currency||"CZK",product_url:n.product_url,image_url:n.image_url,similarity_score:n.similarity_score||n.combined_score||0})}return o}const Be=structuredClone(jn);Be.protocols&&Be.protocols.href?Be.protocols.href.push("product"):Be.protocols?Be.protocols.href=["http","https","mailto","product"]:Be.protocols={href:["http","https","mailto","product"]};const _t={async getLabels(){const{data:t,error:o}=await E.from("labels").select("name").order("name");return o?(console.error("Error loading labels:",o),[]):t.map(n=>n.name)},async getCategories(){const{data:t,error:o}=await E.from("categories").select("name").order("name");return o?(console.error("Error loading categories:",o),[]):t.map(n=>n.name)},async getPublicationTypes(){const{data:t,error:o}=await E.from("publication_types").select("name").order("name");return o?(console.error("Error loading publication types:",o),[]):t.map(n=>n.name)}},Bn=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("line",{x1:"22",y1:"2",x2:"11",y2:"13"}),e.jsx("polygon",{points:"22 2 15 22 11 13 2 9 22 2"})]}),Dn=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),Po=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("path",{d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"}),e.jsx("path",{d:"M12 2C6.477 2 2 6.477 2 12h10c5.523 0 10-4.477 10-10C17.523 2 12 2 12 2z"})]}),To=t=>e.jsx("img",{src:"https://modopafybeslbcqjxsve.supabase.co/storage/v1/object/public/web/Generated_Image_September_08__2025_-_3_09PM-removebg-preview.png",alt:"Sana AI Logo",style:{objectFit:"contain"},...t}),Rn=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),e.jsx("polyline",{points:"21 15 16 10 5 21"})]}),In=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:e.jsx("path",{d:"M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"})}),On="https://n8n.srv980546.hstgr.cloud/webhook/97dc857e-352b-47b4-91cb-bc134afc764c/chat",xo=async(t,o,n,r,s,l,a,c)=>{var g,u,m;try{let b=s||On;l==="vany_chat"&&(b="https://n8n.srv980546.hstgr.cloud/webhook/22856d03-acea-4174-89ae-1b6f0c8ede71/chat");const d={sessionId:o,action:"sendMessage",chatInput:t,chatHistory:n,intent:a||"chat"};c&&c.length>0,r&&Object.keys(r).length>0&&(d.metadata=r),console.log("ğŸš€ OdesÃ­lÃ¡m poÅ¾adavek na N8N webhook..."),console.log("ğŸ”— Webhook URL:",b),console.log("ğŸ“¤ Payload size:",JSON.stringify(d).length,"bytes"),console.log("ğŸ“¤ Session ID:",o),console.log("ğŸ“¤ Message length:",t.length),console.log("ğŸ“¤ History length:",n.length),console.log("ğŸ“¤ Metadata:",r),console.log("ğŸ¯ Intent:",a||"chat");const v=await fetch(b,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});if(console.log("ğŸ“¥ N8N response status:",v.status,v.statusText),!v.ok){const y=await v.text();console.error("âŒ N8N error response:",y);let V="";try{const F=JSON.parse(y);V=`<pre style="background-color: #fff0f0; color: #b91c1c; border: 1px solid #fecaca; padding: 15px; border-radius: 8px; font-family: monospace; white-space: pre-wrap; word-wrap: break-word;"><code>${JSON.stringify(F,null,2)}</code></pre>`}catch{V=`<pre style="background-color: #fff0f0; color: #b91c1c; border: 1px solid #fecaca; padding: 15px; border-radius: 8px; font-family: monospace; white-space: pre-wrap; word-wrap: break-word;"><code>${y}</code></pre>`}throw v.status===500?new Error(`ğŸ”§ N8N workflow selhalo (500 error). Zkontrolujte prosÃ­m N8N workflow konfiguraci.<br/><br/>Detaily chyby:<br/>${V}<br/><br/>ğŸ’¡ <strong>Tip:</strong> ProblÃ©m je pravdÄ›podobnÄ› v N8N workflow, ne v aplikaci.`):new Error(`Chyba serveru: ${v.status} ${v.statusText}.<br/><br/>OdpovÄ›Ä ze serveru:<br/>${V}`)}const P=await v.json();console.log("N8N webhook response:",JSON.stringify(P,null,2)),console.log("Payload sent to N8N:",JSON.stringify(d,null,2)),console.log("Metadata being sent:",JSON.stringify(r,null,2));let f;Array.isArray(P)?(console.log("ğŸ“¦ N8N vrÃ¡til array dat:",P),f=P[0]):f=P,f&&typeof f.json=="object"&&f.json!==null?f=f.json:f&&f.body?f=f.body:f&&f.data&&(f=f.data);let z=(f==null?void 0:f.output)||(f==null?void 0:f.html)||(f==null?void 0:f.text)||(f==null?void 0:f.content)||(f==null?void 0:f.response)||(f==null?void 0:f.message)||(f==null?void 0:f.result);if(typeof z!="string"){const y="OdpovÄ›Ä ze serveru neobsahovala text nebo byl ve Å¡patnÃ©m formÃ¡tu.",V=`<br/><br/><small style="color: #6b7280; font-family: sans-serif;">PÅ™ijatÃ¡ data: <code style="background-color: #f3f4f6; padding: 2px 4px; border-radius: 4px; font-family: monospace;">${JSON.stringify(P,null,2)}</code></small>`;throw new Error(y+V)}let C=z;if(console.log("ğŸ” PÅ¯vodnÃ­ odpovÄ›Ä z N8N:",z.substring(0,500)+"..."),f!=null&&f.html||z.includes("<style>")||z.includes('<div class="chatgpt-text">')){C=z.replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").trim();const y=C.match(/<div class="chatgpt-text"[^>]*>([\s\S]*)<\/div>\s*$/i);y&&(C=y[1].trim())}f!=null&&f.sources&&f.sources.length>0&&C.includes("### Zdroje:")&&(C=C.replace(/###\s*Zdroje:[\s\S]*$/i,"").trim()),console.log("ğŸ”§ ZpracovanÃ½ text:",C.substring(0,500)+"..."),C.includes("<img")&&console.log("ğŸ–¼ï¸ DetekovÃ¡n HTML s obrÃ¡zky v odpovÄ›di - poÄet:",(C.match(/<img[^>]*>/gi)||[]).length);let T=[];console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("ğŸ” INLINE PRODUCT BUTTONS - DIAGNOSTIKA"),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("ğŸ“ Text dÃ©lka:",C.length,"znakÅ¯"),console.log("ğŸ“„ Text preview:",C.substring(0,200)+"..."),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");try{const{screenTextForProducts:y}=await Et(async()=>{const{screenTextForProducts:S}=await import("./inlineProductScreeningService-DrApfroN.js");return{screenTextForProducts:S}},__vite__mapDeps([0,1,2,3])),{matchProductNames:V}=await Et(async()=>{const{matchProductNames:S}=await import("./productNameMatchingService-3dzt0v6S.js");return{matchProductNames:S}},__vite__mapDeps([4,1,2,3]));console.log("âœ… SluÅ¾by ÃºspÄ›Å¡nÄ› importovÃ¡ny"),console.log("ğŸ” Zahajuji screening produktÅ¯ z odpovÄ›di...");const F=await y(C);if(console.log("ğŸ“Š Screening vÃ½sledek:",{success:F.success,productCount:((g=F.products)==null?void 0:g.length)||0,products:F.products,error:F.error}),F.success&&F.products.length>0){console.log(`ğŸ“¦ GPT identifikoval ${F.products.length} produktÅ¯/tÃ©mat:`,F.products),console.log("ğŸ” Zahajuji matching v databÃ¡zi...");const S=await V(F.products);if(console.log("ğŸ“Š Matching vÃ½sledek:",{success:S.success,matchCount:((u=S.matches)==null?void 0:u.length)||0,unmatchedCount:((m=S.unmatched)==null?void 0:m.length)||0,unmatched:S.unmatched,error:S.error}),S.success&&S.matches.length>0){console.log(`âœ… Nalezeno ${S.matches.length} produktÅ¯ v databÃ¡zi`),T=S.matches,console.log("ğŸ“¦ Matched produkty:",S.matches.map(J=>({matched_from:J.matched_from,product_name:J.product_name,pinyin_name:J.pinyin_name,similarity:J.similarity})));const R=S.matches.filter((J,w,U)=>w===U.findIndex(ne=>ne.product_code===J.product_code));console.log("ğŸ” VklÃ¡dÃ¡m produktovÃ© tlaÄÃ­tka pÅ™Ã­mo do textu na konec vÄ›t..."),R.forEach(J=>{const w=[J.matched_from,J.pinyin_name,J.product_name].filter(Boolean);console.log(`  ğŸ” HledÃ¡m "${J.matched_from}" v textu...`);let U=!1;for(const ne of w){const q=ne.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),I=new RegExp(`\\b${q}\\b`,"i"),se=C.match(I);if(se&&!U){let oe=se.index+se[0].length,W=C.substring(oe),re=0;W.startsWith("**")?re=2:W.startsWith("*")?re=1:W.startsWith("__")?re=2:W.startsWith("_")&&(re=1),oe+=re;const N=` <<<PRODUCT:${J.product_code}|||${J.url}|||${J.product_name}|||${J.pinyin_name}>>>`;C=C.slice(0,oe)+N+C.slice(oe),console.log(`    âœ… Marker vloÅ¾en hned za "${ne}" na pozici ${oe} (markdown offset: ${re})`),console.log("    ğŸ“ Marker:",N),U=!0;break}}U||console.log(`    âš ï¸ Nenalezen vÃ½skyt "${J.matched_from}"`)}),console.log("âœ… ProduktovÃ© tlaÄÃ­tka vloÅ¾ena do textu"),console.log("ğŸ“ FinÃ¡lnÃ­ text s markery (preview):",C.substring(0,300)+"..."),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")}else console.log("âš ï¸ Å½Ã¡dnÃ© produkty nebyly namatchovÃ¡ny v databÃ¡zi"),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")}else console.log("â„¹ï¸ GPT neidentifikoval Å¾Ã¡dnÃ© produkty v odpovÄ›di"),console.log("ğŸ’¡ TIP: Zkus se zeptat na konkrÃ©tnÃ­ produkt nebo ÄÃ­nskÃ½ nÃ¡zev"),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")}catch(y){console.error("âŒ CHYBA pÅ™i screeningu/matchingu produktÅ¯:",y),console.error("ğŸ“Š Detaily chyby:",{message:y instanceof Error?y.message:String(y),stack:y instanceof Error?y.stack:void 0}),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")}return{text:C,sources:(f==null?void 0:f.sources)||[],productRecommendations:void 0,matchedProducts:T}}catch(b){throw console.error("âŒ CelkovÃ¡ chyba v sendMessageToAPI:",b),b instanceof TypeError&&b.message==="Failed to fetch"?new Error(`<div style="font-family: sans-serif; line-height: 1.6;"><strong style="font-size: 1.1em; color: #b91c1c;">Chyba: Nelze se pÅ™ipojit k serveru</strong><br /><br />ZdÃ¡ se, Å¾e mÃ¡m potÃ­Å¾e s pÅ™ipojenÃ­m k vaÅ¡emu n8n webhooku na adrese <strong>${N8N_WEBHOOK_URL}</strong>.<br /><br />PÅ™Ã­Äinou je tÃ©mÄ›Å™ jistÄ› bezpeÄnostnÃ­ mechanismus prohlÃ­Å¾eÄe zvanÃ½ <strong>CORS</strong>. VÃ¡Å¡ n8n server musÃ­ explicitnÄ› povolit komunikaci s touto webovou aplikacÃ­.</div>`):b instanceof Error&&b.message.includes("N8N workflow selhalo")||b instanceof Error?b:new Error("DoÅ¡lo k neznÃ¡mÃ© chybÄ› pÅ™i komunikaci se serverem.")}},An=()=>console.log("New chat started. State cleared in UI."),Mn=({productName:t,pinyinName:o,url:n,similarity:r})=>{const[s,l]=No.useState(!1);return e.jsxs("a",{href:n,target:"_blank",rel:"noopener noreferrer",className:"relative overflow-hidden inline-flex items-center h-8 px-4 rounded-full bg-transparent text-gray-700 text-sm font-medium border border-gray-300 transition-all duration-300 cursor-pointer ml-1",title:r?`${o} - Shoda: ${(r*100).toFixed(0)}%`:o,onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),style:{position:"relative",overflow:"hidden",color:s?"#fff":"#374151",borderColor:s?"transparent":"#d1d5db"},children:[e.jsx("div",{style:{content:'""',position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:"inherit",background:"linear-gradient(135deg, #1e40af 0%, #3b82f6 100%)",transform:s?"scaleX(1)":"scaleX(0)",transformOrigin:"0 50%",transition:"all 0.475s",zIndex:0}}),e.jsx("span",{className:"relative z-10",children:t})]})},Un=()=>e.jsxs("div",{className:"flex items-start gap-3 max-w-4xl mx-auto justify-start",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-bewit-blue flex items-center justify-center text-white",children:e.jsx(Po,{className:"w-5 h-5"})}),e.jsx("div",{className:"px-4 py-3 rounded-2xl bg-white border border-slate-200 rounded-bl-none shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(So,{}),e.jsx(_o,{changeInterval:7e3})]})})]}),Wn=({message:t,onSilentPrompt:o,chatbotSettings:n,sessionId:r,lastUserQuery:s,chatbotId:l,recommendedProducts:a=[],chatHistory:c=[],metadata:g={categories:[],labels:[],publication_types:[]}})=>{var P;const u=t.role==="user",m=l==="sana_local_format"||l==="vany_chat",b=f=>{if(!f)return"";let z=f;if(z=z.replace(/<img([^>]*)>/gi,(C,T)=>{if(T.includes("loading=")&&T.includes("style="))return C;let y=T;return T.includes("loading=")||(y+=' loading="lazy"'),T.includes("style=")||(y+=' style="max-width: 100%; height: auto; border-radius: 8px; margin: 12px 0; display: block;"'),T.includes("alt=")||(y+=' alt="ObrÃ¡zek z dokumentu"'),`<img${y}>`}),z.includes("<img")){const C=z.match(/<img[^>]*>/gi)||[];console.log("ğŸ–¼ï¸ ZpracovÃ¡nÃ­ zprÃ¡vy s obrÃ¡zky - poÄet:",C.length),C.forEach((T,y)=>{const V=T.match(/src="([^"]*)"/)||T.match(/src='([^']*)'/);V&&console.log(`ğŸ–¼ï¸ ObrÃ¡zek ${y+1} URL:`,V[1])})}return(z.includes("<h1")||z.includes("<h2")||z.includes("<h3"))&&console.log("ğŸ“ ZpracovÃ¡nÃ­ zprÃ¡vy s nadpisy:",z.substring(0,200)+"..."),z},d=()=>{const f=t.text||"";console.log("ğŸ¨ renderTextWithProductButtons - zaÄÃ­nÃ¡m parsovÃ¡nÃ­"),console.log("ğŸ“ Text dÃ©lka:",f.length),console.log("ğŸ” HledÃ¡m markery ve formÃ¡tu: <<<PRODUCT:...");const z=/<<<PRODUCT:([^|]+)\|\|\|([^|]+)\|\|\|([^|]+)\|\|\|([^>]+)>>>/g,C=[];let T=0,y,V=0;for(;(y=z.exec(f))!==null;){console.log("âœ… Nalezen product marker:",y[0]);const F=y.index,S=y.index+y[0].length;if(F>T){const ne=f.substring(T,F);C.push(e.jsx(pt,{remarkPlugins:[gt],rehypePlugins:[xt,[ht,Be]],components:{h1:({node:q,...I})=>e.jsx("h1",{className:"text-2xl font-bold mt-4 mb-2",...I}),h2:({node:q,...I})=>e.jsx("h2",{className:"text-xl font-bold mt-3 mb-2",...I}),h3:({node:q,...I})=>e.jsx("h3",{className:"text-lg font-bold mt-2 mb-1",...I}),p:({node:q,...I})=>e.jsx("p",{className:"my-2 leading-relaxed",...I}),strong:({node:q,...I})=>e.jsx("strong",{className:"font-bold",...I}),a:({node:q,...I})=>e.jsx("a",{className:"text-bewit-blue hover:underline",target:"_blank",rel:"noopener noreferrer",...I}),ul:({node:q,...I})=>e.jsx("ul",{className:"list-disc list-inside my-2 space-y-1",...I}),ol:({node:q,...I})=>e.jsx("ol",{className:"list-decimal list-inside my-2 space-y-1",...I}),li:({node:q,...I})=>e.jsx("li",{className:"ml-4",...I}),code:({node:q,inline:I,...se})=>I?e.jsx("code",{className:"bg-slate-100 text-slate-800 px-1.5 py-0.5 rounded text-sm font-mono",...se}):e.jsx("code",{className:"block bg-slate-100 text-slate-800 p-3 rounded-lg my-2 overflow-x-auto font-mono text-sm",...se}),table:({node:q,...I})=>e.jsx("div",{className:"overflow-x-auto my-4 rounded-lg shadow-sm border border-slate-200",children:e.jsx("table",{className:"min-w-full border-collapse bg-white",...I})}),thead:({node:q,...I})=>e.jsx("thead",{className:"bg-gradient-to-r from-bewit-blue to-blue-700",...I}),tbody:({node:q,...I})=>e.jsx("tbody",{className:"divide-y divide-slate-200",...I}),tr:({node:q,...I})=>e.jsx("tr",{className:"hover:bg-slate-50 transition-colors",...I}),th:({node:q,...I})=>e.jsx("th",{className:"px-6 py-3 text-left text-xs font-bold text-white uppercase tracking-wider",...I}),td:({node:q,...I})=>e.jsx("td",{className:"px-6 py-4 text-sm text-slate-700 whitespace-nowrap",...I})},children:ne},`text-${V}`))}const[,R,J,w,U]=y;console.log("ğŸ”˜ VytvÃ¡Å™Ã­m ProductPill:",{productCode:R,productName:w,productPinyin:U}),C.push(e.jsx(Mn,{productName:w,pinyinName:U,url:J},`product-${V}`)),T=S,V++}if(T<f.length){const F=f.substring(T);C.push(e.jsx(pt,{remarkPlugins:[gt],rehypePlugins:[xt,[ht,Be]],components:{h1:({node:S,...R})=>e.jsx("h1",{className:"text-2xl font-bold mt-4 mb-2",...R}),h2:({node:S,...R})=>e.jsx("h2",{className:"text-xl font-bold mt-3 mb-2",...R}),h3:({node:S,...R})=>e.jsx("h3",{className:"text-lg font-bold mt-2 mb-1",...R}),p:({node:S,...R})=>e.jsx("p",{className:"my-2 leading-relaxed",...R}),strong:({node:S,...R})=>e.jsx("strong",{className:"font-bold",...R}),a:({node:S,...R})=>e.jsx("a",{className:"text-bewit-blue hover:underline",target:"_blank",rel:"noopener noreferrer",...R}),ul:({node:S,...R})=>e.jsx("ul",{className:"list-disc list-inside my-2 space-y-1",...R}),ol:({node:S,...R})=>e.jsx("ol",{className:"list-decimal list-inside my-2 space-y-1",...R}),li:({node:S,...R})=>e.jsx("li",{className:"ml-4",...R}),code:({node:S,inline:R,...J})=>R?e.jsx("code",{className:"bg-slate-100 text-slate-800 px-1.5 py-0.5 rounded text-sm font-mono",...J}):e.jsx("code",{className:"block bg-slate-100 text-slate-800 p-3 rounded-lg my-2 overflow-x-auto font-mono text-sm",...J}),table:({node:S,...R})=>e.jsx("div",{className:"overflow-x-auto my-4 rounded-lg shadow-sm border border-slate-200",children:e.jsx("table",{className:"min-w-full border-collapse bg-white",...R})}),thead:({node:S,...R})=>e.jsx("thead",{className:"bg-gradient-to-r from-bewit-blue to-blue-700",...R}),tbody:({node:S,...R})=>e.jsx("tbody",{className:"divide-y divide-slate-200",...R}),tr:({node:S,...R})=>e.jsx("tr",{className:"hover:bg-slate-50 transition-colors",...R}),th:({node:S,...R})=>e.jsx("th",{className:"px-6 py-3 text-left text-xs font-bold text-white uppercase tracking-wider",...R}),td:({node:S,...R})=>e.jsx("td",{className:"px-6 py-4 text-sm text-slate-700 whitespace-nowrap",...R})},children:F},`text-${V}`))}return console.log(`ğŸ“Š Celkem nalezeno ${C.length/2} product markerÅ¯`),console.log(`ğŸ“¦ VytvoÅ™eno ${C.length} segmentÅ¯ (text + buttony)`),C.length===0?(console.log("âš ï¸ Å½Ã¡dnÃ© product markery nenalezeny - renderuji normÃ¡lnÃ­ markdown"),e.jsx(pt,{remarkPlugins:[gt],rehypePlugins:[xt,[ht,Be]],components:{h1:({node:F,...S})=>e.jsx("h1",{className:"text-2xl font-bold mt-4 mb-2",...S}),h2:({node:F,...S})=>e.jsx("h2",{className:"text-xl font-bold mt-3 mb-2",...S}),h3:({node:F,...S})=>e.jsx("h3",{className:"text-lg font-bold mt-2 mb-1",...S}),p:({node:F,...S})=>e.jsx("p",{className:"my-2 leading-relaxed",...S}),strong:({node:F,...S})=>e.jsx("strong",{className:"font-bold",...S}),a:({node:F,...S})=>e.jsx("a",{className:"text-bewit-blue hover:underline",target:"_blank",rel:"noopener noreferrer",...S}),ul:({node:F,...S})=>e.jsx("ul",{className:"list-disc list-inside my-2 space-y-1",...S}),ol:({node:F,...S})=>e.jsx("ol",{className:"list-decimal list-inside my-2 space-y-1",...S}),li:({node:F,...S})=>e.jsx("li",{className:"ml-4",...S}),code:({node:F,inline:S,...R})=>S?e.jsx("code",{className:"bg-slate-100 text-slate-800 px-1.5 py-0.5 rounded text-sm font-mono",...R}):e.jsx("code",{className:"block bg-slate-100 text-slate-800 p-3 rounded-lg my-2 overflow-x-auto font-mono text-sm",...R}),table:({node:F,...S})=>e.jsx("div",{className:"overflow-x-auto my-4 rounded-lg shadow-sm border border-slate-200",children:e.jsx("table",{className:"min-w-full border-collapse bg-white",...S})}),thead:({node:F,...S})=>e.jsx("thead",{className:"bg-gradient-to-r from-bewit-blue to-blue-700",...S}),tbody:({node:F,...S})=>e.jsx("tbody",{className:"divide-y divide-slate-200",...S}),tr:({node:F,...S})=>e.jsx("tr",{className:"hover:bg-slate-50 transition-colors",...S}),th:({node:F,...S})=>e.jsx("th",{className:"px-6 py-3 text-left text-xs font-bold text-white uppercase tracking-wider",...S}),td:({node:F,...S})=>e.jsx("td",{className:"px-6 py-4 text-sm text-slate-700 whitespace-nowrap",...S})},children:f})):e.jsx(e.Fragment,{children:C})},v=b(t.text||"");return e.jsxs("div",{className:`flex items-start gap-3 max-w-4xl mx-auto group ${u?"justify-end ml-auto pl-12":"justify-start"}`,children:[!u&&e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-bewit-blue flex items-center justify-center text-white",children:e.jsx(Po,{className:"w-5 h-5"})}),e.jsx("div",{className:`flex flex-col ${u?"items-end":"items-start"}`,children:!u&&t.isFunnelMessage?e.jsx(jo,{funnelText:t.text||"",selectedProducts:t.funnelProducts||[],symptomList:t.symptomList||[]}):e.jsxs("div",{className:`px-4 py-3 rounded-2xl max-w-xl md:max-w-2xl lg:max-w-3xl shadow-sm ${u?"bg-bewit-blue text-white rounded-br-none":"bg-white text-bewit-dark border border-slate-200 rounded-bl-none"}`,children:[!u&&m&&((P=t.text)!=null&&P.includes("<<<PRODUCT:"))?e.jsx("div",{className:"markdown-content",children:d()}):m&&!u?e.jsx("div",{className:"markdown-content",children:e.jsx(pt,{remarkPlugins:[gt],rehypePlugins:[xt,[ht,Be]],components:{h1:({node:f,...z})=>e.jsx("h1",{className:"text-2xl font-bold mt-4 mb-2",...z}),h2:({node:f,...z})=>e.jsx("h2",{className:"text-xl font-bold mt-3 mb-2",...z}),h3:({node:f,...z})=>e.jsx("h3",{className:"text-lg font-bold mt-2 mb-1",...z}),h4:({node:f,...z})=>e.jsx("h4",{className:"text-base font-bold mt-2 mb-1",...z}),h5:({node:f,...z})=>e.jsx("h5",{className:"text-sm font-bold mt-1 mb-1",...z}),h6:({node:f,...z})=>e.jsx("h6",{className:"text-xs font-bold mt-1 mb-1",...z}),p:({node:f,...z})=>e.jsx("p",{className:"my-2 leading-relaxed",...z}),strong:({node:f,...z})=>e.jsx("strong",{className:"font-bold",...z}),em:({node:f,...z})=>e.jsx("em",{className:"italic",...z}),a:({node:f,...z})=>e.jsx("a",{className:"text-bewit-blue hover:underline",target:"_blank",rel:"noopener noreferrer",...z}),ul:({node:f,...z})=>e.jsx("ul",{className:"list-disc list-inside my-2 space-y-1",...z}),ol:({node:f,...z})=>e.jsx("ol",{className:"list-decimal list-inside my-2 space-y-1",...z}),li:({node:f,...z})=>e.jsx("li",{className:"ml-4",...z}),img:({node:f,...z})=>e.jsx("img",{className:"max-w-full h-auto rounded-lg my-3 shadow-md block",loading:"lazy",...z}),code:({node:f,inline:z,...C})=>z?e.jsx("code",{className:"bg-slate-100 text-slate-800 px-1.5 py-0.5 rounded text-sm font-mono",...C}):e.jsx("code",{className:"block bg-slate-100 text-slate-800 p-3 rounded-lg my-2 overflow-x-auto font-mono text-sm",...C}),pre:({node:f,...z})=>e.jsx("pre",{className:"bg-slate-100 p-3 rounded-lg my-2 overflow-x-auto",...z}),blockquote:({node:f,...z})=>e.jsx("blockquote",{className:"border-l-4 border-bewit-blue pl-4 my-2 italic text-slate-600",...z}),hr:({node:f,...z})=>e.jsx("hr",{className:"my-4 border-slate-200",...z}),table:({node:f,...z})=>e.jsx("div",{className:"overflow-x-auto my-4 rounded-lg shadow-sm border border-slate-200",children:e.jsx("table",{className:"min-w-full border-collapse bg-white",...z})}),thead:({node:f,...z})=>e.jsx("thead",{className:"bg-gradient-to-r from-bewit-blue to-blue-700",...z}),tbody:({node:f,...z})=>e.jsx("tbody",{className:"divide-y divide-slate-200",...z}),tr:({node:f,...z})=>e.jsx("tr",{className:"hover:bg-slate-50 transition-colors",...z}),th:({node:f,...z})=>e.jsx("th",{className:"px-6 py-3 text-left text-xs font-bold text-white uppercase tracking-wider",...z}),td:({node:f,...z})=>e.jsx("td",{className:"px-6 py-4 text-sm text-slate-700 whitespace-nowrap",...z})},children:t.text||""})}):e.jsx("div",{className:"prose prose-sm max-w-none text-inherit prose-headings:font-bold prose-h1:text-2xl prose-h2:text-xl prose-h3:text-lg prose-h4:text-base prose-h5:text-sm prose-h6:text-xs prose-p:my-2 prose-strong:font-bold prose-a:text-bewit-blue hover:prose-a:underline prose-img:block prose-img:max-w-full prose-img:h-auto prose-img:rounded-lg prose-img:mt-3 prose-img:mb-2 prose-img:shadow-md prose-img:object-cover",dangerouslySetInnerHTML:{__html:v}}),!u&&t.productRecommendations&&t.productRecommendations.length>0&&(n==null?void 0:n.product_recommendations)&&e.jsxs("div",{className:"mt-4",children:[console.log("ğŸ  Renderuji ProductCarousel s produkty:",t.productRecommendations.length,"Settings:",n),e.jsx(zo,{products:t.productRecommendations,showSimilarity:!0,title:"ğŸ›ï¸ DoporuÄenÃ© produkty"})]}),!u&&(n==null?void 0:n.product_button_recommendations)&&r&&s&&e.jsxs("div",{className:"mt-4",children:[console.log("ğŸ”˜ Zobrazuji tlaÄÃ­tko doporuÄenÃ­",{product_button_recommendations:n==null?void 0:n.product_button_recommendations,sessionId:!!r,lastUserQuery:s.substring(0,30)}),e.jsx(Cn,{userQuery:s,botResponse:t.text,sessionId:r})]}),!u&&t.hasCallout&&console.log("ğŸ¯ CALLOUT DECISION:",{hasCallout:t.hasCallout,enable_manual_funnel:n==null?void 0:n.enable_manual_funnel,chatbotSettings:n}),!u&&t.hasCallout&&(n!=null&&n.enable_manual_funnel?e.jsx(Tn,{recommendedProducts:a,sessionId:r||"",metadata:g,chatHistory:c}):e.jsx("div",{className:"mt-4 p-3 bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-amber-500 text-lg flex-shrink-0",children:"ğŸ’¡"}),e.jsxs("p",{className:"text-sm text-amber-800",children:[e.jsx("strong",{children:"PotÅ™ebujete pÅ™esnÄ›jÅ¡Ã­ doporuÄenÃ­?"}),e.jsx("br",{}),e.jsx("span",{className:"text-amber-700",children:"NapiÅ¡te nÃ¡m vÃ­ce o svÃ½ch symptomech nebo potÅ™ebÃ¡ch, abychom mohli produkty lÃ©pe zacÃ­lit pÅ™Ã­mo pro vÃ¡s."})]})]})})),!u&&t.sources&&t.sources.length>0&&e.jsxs("div",{className:`mt-4 pt-4 border-t ${u?"border-t-white/30":"border-t-slate-200"}`,children:[e.jsx("h4",{className:`text-xs font-semibold mb-2 uppercase tracking-wider ${u?"text-white/80":"text-slate-500"}`,children:"Zdroje"}),e.jsx("div",{className:"flex flex-col gap-1",children:t.sources.map((f,z)=>e.jsxs("div",{className:`text-xs ${u?"text-white/90":"text-slate-600"}`,children:["- ",f.title]},z))})]})]})}),!u&&e.jsxs("div",{className:"flex flex-col space-y-1 self-center opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[e.jsx("button",{onClick:()=>o("Ukaz mi vsechny obrazky, ktere s tematem souviseji"),className:"p-1.5 text-slate-500 hover:text-bewit-blue hover:bg-slate-200 rounded-full","aria-label":"UkÃ¡zat obrÃ¡zky k tÃ©matu",title:"UkÃ¡zat obrÃ¡zky k tÃ©matu",children:e.jsx(Rn,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>o("text detailne rozepis. POsbirej vsechny informace a udelej detailni vystup"),className:"p-1.5 text-slate-500 hover:text-bewit-blue hover:bg-slate-200 rounded-full","aria-label":"Rozepsat vÃ­ce",title:"Rozepsat vÃ­ce",children:e.jsx(In,{className:"h-5 w-5"})})]}),u&&e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-slate-300 flex items-center justify-center text-slate-600",children:e.jsx(Dn,{className:"w-5 h-5"})})]})},Vn=({messages:t,isLoading:o,onSilentPrompt:n,shouldAutoScroll:r=!0,chatbotSettings:s,sessionId:l,chatbotId:a,selectedCategories:c=[],selectedLabels:g=[],selectedPublicationTypes:u=[]})=>{const m=p.useRef(null),b=p.useRef(null),[d,v]=p.useState(0),[P,f]=p.useState(!1);p.useEffect(()=>{const T=t.length>d;r&&(T||o)?(console.log("ğŸ”„ Auto-scroll:",{shouldAutoScroll:r,newMessageAdded:T,isLoading:o,messageCount:t.length,lastCount:d}),setTimeout(()=>{var y;b.current?b.current.scrollTop=b.current.scrollHeight:(y=m.current)==null||y.scrollIntoView({behavior:"smooth"})},100),f(!1)):r||(t.some((V,F)=>F>=d?!1:V.productRecommendations&&V.productRecommendations.length>0)||T)&&(console.log("ğŸ“ Auto-scroll vypnutÃ½ - zobrazuji scroll tlaÄÃ­tko pro novÃ½ obsah"),f(!0)),v(t.length)},[t,o,r,d]);const z=()=>{var T;b.current?b.current.scrollTop=b.current.scrollHeight:(T=m.current)==null||T.scrollIntoView({behavior:"smooth"}),f(!1)},C=p.useCallback(()=>{if(b.current){const{scrollTop:T,scrollHeight:y,clientHeight:V}=b.current;!(T+V>=y-10)&&t.length>0?f(!0):f(!1)}},[t.length]);return e.jsxs("div",{className:"relative flex flex-col h-full",children:[e.jsxs("div",{ref:b,className:"chat-scroll-container flex-1 overflow-y-auto p-3 sm:p-4 md:p-6 lg:p-8 space-y-4 sm:space-y-6 min-h-0",onScroll:C,style:{scrollBehavior:"smooth",scrollbarWidth:"thin",scrollbarColor:"#CBD5E1 #F8FAFC"},children:[t.length===0&&!o&&e.jsxs("div",{className:"text-center text-slate-500 flex flex-col items-center justify-center min-h-96",children:[e.jsx(To,{className:"h-45 w-45 text-bewit-blue opacity-20 mb-4"}),e.jsx("h2",{className:"text-2xl font-semibold text-bewit-blue",children:"VÃ­tejte v Sana AI!"}),e.jsx("p",{children:"Jak vÃ¡m dnes mohu pomoci?"})]}),t.map((T,y)=>{var J;const V=((J=t.slice(0,y).reverse().find(w=>w.role==="user"))==null?void 0:J.text)||"",F=t.slice(0,y+1).map(w=>({id:w.id,role:w.role,text:w.text,hasCallout:w.hasCallout})),S=Co(F),R=F.map(w=>({id:w.id,role:w.role,text:w.text.replace(/<<<PRODUCT:[^>]+>>>/g,"").trim()}));return e.jsx(Wn,{message:T,onSilentPrompt:n,chatbotSettings:s,sessionId:l,lastUserQuery:V,chatbotId:a,recommendedProducts:S,chatHistory:R,metadata:{categories:c,labels:g,publication_types:u}},T.id)}),o&&e.jsx(Un,{}),e.jsx("div",{ref:m})]}),P&&e.jsx("div",{className:"absolute bottom-2 right-2 sm:bottom-4 sm:right-4 z-50",children:e.jsxs("button",{onClick:z,className:"flex items-center gap-1 sm:gap-2 bg-bewit-blue text-white px-3 py-2 sm:px-4 sm:py-2 rounded-full shadow-lg hover:bg-blue-700 transition-all duration-200 animate-bounce",title:"PÅ™ejÃ­t na konec chatu",children:[e.jsx("span",{className:"text-xs sm:text-sm font-medium hidden sm:inline",children:"NovÃ½ obsah"}),e.jsx("span",{className:"text-xs font-medium sm:hidden",children:"â†“"}),e.jsx("svg",{className:"hidden sm:block",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M7 10l5 5 5-5"})})]})})]})},Hn=({onSendMessage:t,isLoading:o})=>{const[n,r]=p.useState(""),s=p.useRef(null),l=c=>{c.preventDefault(),n.trim()&&!o&&(t(n),r(""))},a=c=>{c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),l(c))};return p.useEffect(()=>{s.current&&(s.current.style.height="auto",s.current.style.height=`${s.current.scrollHeight}px`)},[n]),e.jsx("form",{onSubmit:l,className:"relative",children:e.jsxs("div",{className:"flex items-center bg-white border border-slate-300 rounded-xl shadow-sm focus-within:ring-2 focus-within:ring-bewit-blue transition-shadow duration-200 p-3",children:[e.jsx("textarea",{ref:s,value:n,onChange:c=>r(c.target.value),onKeyDown:a,placeholder:"Jak vÃ¡m mohu pomoci...",className:"w-full flex-1 px-2 py-2 bg-transparent resize-none focus:outline-none text-bewit-dark placeholder-slate-400 leading-5",rows:1,style:{maxHeight:"120px",minHeight:"40px"},disabled:o}),e.jsx("button",{type:"submit",disabled:o||!n.trim(),className:"ml-3 flex-shrink-0 w-10 h-10 rounded-lg bg-bewit-blue text-white flex items-center justify-center transition-colors duration-200 disabled:bg-slate-300 disabled:cursor-not-allowed hover:bg-blue-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-bewit-blue","aria-label":"Odeslat zprÃ¡vu",children:o?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(Bn,{className:"w-5 h-5"})})]})})},ho=()=>"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx".replace(/[x]/g,()=>(Math.random()*16|0).toString(16)),Nt={cs:"OdpovÄ›z v ÄeÅ¡tinÄ›.",sk:"Odpovedz v slovenÄine.",de:"Antworte auf Deutsch.",en:"Answer in English."},$o=({selectedCategories:t,selectedLabels:o,selectedPublicationTypes:n,chatbotSettings:r={product_recommendations:!1,product_button_recommendations:!1,inline_product_links:!1,book_database:!0,use_feed_1:!0,use_feed_2:!0,enable_product_router:!0,enable_manual_funnel:!1},chatbotId:s,onClose:l})=>{console.log("%câ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•","background: #FF0000; color: #FFFFFF; font-size: 20px; font-weight: bold;"),console.log("%cğŸš¨ SANACHATCONTENT COMPONENT LOADED","background: #FF0000; color: #FFFFFF; font-size: 16px; font-weight: bold;"),console.log(`%cğŸ” chatbotId prop: "${s}" (type: ${typeof s})`,"background: #FFFF00; color: #000; font-size: 14px;"),console.log(`%cğŸ” chatbotId === 'vany_chat': ${s==="vany_chat"}`,"background: #FFFF00; color: #000; font-size: 14px;"),console.log("%câ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•","background: #FF0000; color: #FFFFFF; font-size: 20px; font-weight: bold;");const[a,c]=p.useState([]),[g,u]=p.useState(!1),[m,b]=p.useState(""),[d,v]=p.useState("cs"),[P,f]=p.useState(!0);p.useEffect(()=>{b(ho()),r.product_recommendations&&(console.log("ğŸ”§ SpouÅ¡tÃ­m KOMPLETNÃ diagnostiku vektorovÃ© databÃ¡ze..."),$n().catch(T=>{console.error("âŒ Chyba pÅ™i rychlÃ© diagnostice:",T)}),setTimeout(()=>{console.log("ğŸš€ SpouÅ¡tÃ­m kompletnÃ­ test vektorovÃ©ho vyhledÃ¡vÃ¡nÃ­..."),Ln().then(T=>{console.log("ğŸ¯ KompletnÃ­ test dokonÄen - vÃ½sledky vÃ½Å¡e v console")}).catch(T=>{console.error("âŒ Chyba pÅ™i kompletnÃ­m testu:",T)})},3e3))},[r.product_recommendations]);const z=p.useCallback(async T=>{var F;if(!T.trim()||!m)return;const y={id:Date.now().toString(),role:"user",text:T},V=[...a,y];c(V),u(!0),f(!0);try{console.log("ğŸ¯ Chatbot settings v SanaChatContent:",{book_database:r.book_database,product_recommendations:r.product_recommendations,willUseCombinedSearch:r.book_database&&r.product_recommendations,webhook_url:r.webhook_url});const S={};t.length>0&&(S.categories=t),o.length>0&&(S.labels=o),n.length>0&&(S.publication_types=n);const R=Nt[d],J=`${T.trim()} ${R}`;console.log(`ğŸ” Checking Intent Routing: chatbotId = "${s}" (type: ${typeof s})`),console.log(`ğŸ” Comparison: chatbotId === 'vany_chat' â†’ ${s==="vany_chat"}`);const w=(r==null?void 0:r.enable_product_router)!==!1;if(console.log(`ğŸ”€ Product Router enabled: ${w?"ANO":"NE"}`),s==="vany_chat"&&w){console.log("%câ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•","color: #8B5CF6; font-weight: bold;"),console.log("%cğŸ”€ WANY CHAT - KONTROLA INTENT ROUTING","color: #8B5CF6; font-weight: bold; font-size: 14px;"),console.log("%câ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•","color: #8B5CF6; font-weight: bold;");const U=a.filter(se=>se.role==="bot").pop(),ne=(U==null?void 0:U.text)||"",q=a.some(se=>se.role==="bot"&&se.hasCallout===!0),I=(r==null?void 0:r.enable_manual_funnel)===!0;if(console.log(`ğŸŸ¡ Å½lutÃ½ callout v historii: ${q?"ANO âœ“":"NE"}`),console.log(`ğŸ¯ ManuÃ¡lnÃ­ funnel: ${I?"AKTIVNÃ (pÅ™eskakuji auto routing)":"NEAKTIVNÃ"}`),!q||I)I&&q?console.log("%cğŸ¯ ManuÃ¡lnÃ­ funnel aktivnÃ­ â†’ PÅ˜ESKAKUJI AUTOMATICKÃ ROUTING","color: #F59E0B; font-weight: bold;"):console.log("%cğŸ’¬ Å½Ã¡dnÃ½ callout â†’ STANDARDNÃ CHAT (bez intent routingu)","color: #10B981; font-weight: bold;"),console.log("%câ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•","color: #8B5CF6; font-weight: bold;");else{console.log("%cğŸ¯ Callout detekovÃ¡n â†’ SPOUÅ TÃM INTENT ROUTING","color: #F59E0B; font-weight: bold;");const se=a.map(M=>({role:M.role,text:M.text,hasCallout:M.hasCallout})),G=Co(se);console.log(`ğŸ“¦ Produkty v historii: ${G.length}`),console.log("%cğŸ“¡ VolÃ¡m Intent Router (LLM model)...","color: #8B5CF6;");const oe=await wn(T.trim(),se,ne,G);console.log(`âœ… Intent Router odpovÄ›dÄ›l: ${oe.intent}`),console.log(`ğŸ“ DÅ¯vod: ${oe.reasoning}`),oe.symptomList&&oe.symptomList.length>0&&console.log(`ğŸ©º ExtrahovanÃ© symptomy: ${oe.symptomList.join(", ")}`);const W=oe.intent==="funnel",re=oe.intent==="update_funnel",N=G.length>0;if(console.log("%cğŸ” DIAGNOSTIKA ROZHODNUTÃ:","color: #FF6B6B; font-weight: bold;"),console.log(`   Intent = ${oe.intent}`),console.log(`   Products = ${G.length} (hasProducts: ${N})`),console.log(`   Action: ${W?"ğŸ¯ FUNNEL MODE (symptomy po calloutu)":re?"ğŸ”„ UPDATE FUNNEL (zmÄ›na produktÅ¯)":"ğŸ’¬ CHAT MODE"}`),(oe.intent==="funnel"||oe.intent==="update_funnel")&&G.length>0){console.log("%câ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—","background: #10B981; color: white; font-weight: bold; font-size: 16px;"),console.log("%câ•‘         ğŸ¯ SPUÅ TÄšNÃ PRODUKTOVÃ‰HO FUNNELU (N8N WEBHOOK)           â•‘","background: #10B981; color: white; font-weight: bold; font-size: 16px;"),console.log("%câ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•","background: #10B981; color: white; font-weight: bold; font-size: 16px;");const M=oe.symptomList&&oe.symptomList.length>0?oe.symptomList:[T.trim()];console.log("%câ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”","color: #F59E0B;"),console.log("%câ”‚ ğŸ“‹ SEZNAM SYMPTOMÅ®/PROBLÃ‰MÅ®                                      â”‚","color: #F59E0B; font-weight: bold; font-size: 14px;"),console.log("%câ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤","color: #F59E0B;"),M.forEach((de,Ce)=>{console.log(`%câ”‚   ${Ce+1}. ${de}`,"color: #F59E0B;")}),console.log("%câ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜","color: #F59E0B;"),console.log("%câ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”","color: #8B5CF6;"),console.log("%câ”‚ ğŸ“¦ SEZNAM PRODUKTÅ® (z Product Pills v pÅ™edchozÃ­ konverzaci)      â”‚","color: #8B5CF6; font-weight: bold; font-size: 14px;"),console.log("%câ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤","color: #8B5CF6;"),console.log(`%câ”‚   Celkem produktÅ¯: ${G.length}`,"color: #8B5CF6;"),console.log("%câ”‚","color: #8B5CF6;"),G.forEach((de,Ce)=>{console.log(`%câ”‚   ${Ce+1}. ${de.product_name}`,"color: #8B5CF6; font-weight: bold;"),console.log(`%câ”‚      KÃ³d: ${de.product_code||"N/A"}`,"color: #8B5CF6;"),de.description&&console.log(`%câ”‚      Popis: ${de.description.substring(0,80)}...`,"color: #8B5CF6;")}),console.log("%câ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜","color: #8B5CF6;");const x=`Jsi expert na tradiÄnÃ­ ÄÃ­nskou medicÃ­nu (TÄŒM) a produkty BEWIT.

## TVÅ®J ÃšKOL
Na zÃ¡kladÄ› symptomÅ¯ uÅ¾ivatele vyber PÅ˜ESNÄš 2 NEJLEPÅ Ã produkty z poskytnutÃ©ho seznamu a vytvoÅ™ detailnÃ­ doporuÄenÃ­.

## âš ï¸ KRITICKÃ‰ PRAVIDLO - POUZE PRODUKTY ZE SEZNAMU!
NESMÃÅ  doporuÄovat Å¾Ã¡dnÃ© jinÃ© produkty neÅ¾ ty, kterÃ© jsou uvedeny v seznamu "VybranÃ© produkty"!
Pokud v seznamu jsou napÅ™. "009 - ÄŒistÃ½ dech" a "200 - VolnÃ© meridiÃ¡ny", MUSÃÅ  pracovat POUZE s tÄ›mito produkty.
NIKDY nedoporuÄuj produkty, kterÃ© nejsou v seznamu - ani je nezmiÅˆuj.

## PRAVIDLA
1. Vyber PÅ˜ESNÄš 2 produkty z poskytnutÃ©ho seznamu, kterÃ© nejlÃ©pe odpovÃ­dajÃ­ symptomÅ¯m
2. Pro kaÅ¾dÃ½ produkt vysvÄ›tli PROÄŒ je vhodnÃ½ pro danÃ© symptomy
3. UveÄ jak produkt pouÅ¾Ã­vat (dÃ¡vkovÃ¡nÃ­, aplikace)
4. BuÄ konkrÃ©tnÃ­ a praktickÃ½
5. PiÅ¡ v ÄeÅ¡tinÄ›, pÅ™Ã¡telskÃ½m tÃ³nem
6. NIKDY nedoporuÄuj produkty mimo poskytnutÃ½ seznam!

## FORMÃT ODPOVÄšDI
VytvoÅ™ krÃ¡snÄ› formÃ¡tovanou odpovÄ›Ä v markdown s doporuÄenÃ­m obou vybranÃ½ch produktÅ¯ z poskytnutÃ©ho seznamu.`;console.log("%câ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”","color: #3B82F6;"),console.log("%câ”‚ ğŸ¤– SYSTEM PROMPT PRO FUNNEL                                      â”‚","color: #3B82F6; font-weight: bold; font-size: 14px;"),console.log("%câ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤","color: #3B82F6;"),x.split(`
`).forEach(de=>{console.log(`%câ”‚ ${de}`,"color: #3B82F6;")}),console.log("%câ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜","color: #3B82F6;");const _=G.map(de=>de.description?`${de.product_name} (${de.description})`:de.product_name),O=[...new Set(_)].join(", "),Y=M.join(", "),te=`âš ï¸ OMEZENÃ: Pracuj POUZE s tÄ›mito vybranÃ½mi produkty, NEDOPORUÄŒUJ Å¾Ã¡dnÃ© jinÃ©!

VybranÃ© produkty (POUZE TYTO): ${O}

Symptomy zÃ¡kaznÃ­ka: ${Y}

ÃšKOL: Z vÃ½Å¡e uvedenÃ½ch ${G.length} produktÅ¯ (${O}) vyber 2 nejlepÅ¡Ã­ pro danÃ© symptomy.
- DetailnÄ› rozepiÅ¡ proÄ jsou vhodnÃ©
- UveÄ jak je pouÅ¾Ã­vat
- NEDOPORUÄŒUJ Å¾Ã¡dnÃ© jinÃ© produkty mimo tento seznam!`,Q=Nt[d],he=`${te} ${Q}`,we="https://n8n.srv980546.hstgr.cloud/webhook/22856d03-acea-4174-89ae-1b6f0c8ede71/chat",$e=V.slice(0,-1).map(de=>({id:de.id,role:de.role,text:de.text.replace(/<<<PRODUCT:[^>]+>>>/g,"").trim()})),De={sessionId:m,action:"sendMessage",chatInput:he,chatHistory:$e,metadata:{categories:t,labels:o,publication_types:n}};console.log("%câ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—","background: #EF4444; color: white; font-weight: bold; font-size: 14px;"),console.log("%câ•‘ ğŸ“¡ ODESÃLÃM FUNNEL DO N8N WEBHOOKU                               â•‘","background: #EF4444; color: white; font-weight: bold; font-size: 14px;"),console.log("%câ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•","background: #EF4444; color: white; font-weight: bold; font-size: 14px;"),console.log("%cğŸ”— Webhook URL:","color: #EF4444; font-weight: bold;",we),console.log("%cğŸ“ chatInput (co jde do N8N):","color: #EF4444; font-weight: bold;"),console.log(he),console.log("%cğŸ“¦ KompletnÃ­ Payload:","color: #EF4444; font-weight: bold;"),console.log(JSON.stringify(De,null,2)),console.log("%câ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•","color: #EF4444; font-weight: bold;");try{const de=await fetch(we,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(De)});if(console.log("%cğŸ“¥ N8N FUNNEL response status:","color: #10B981; font-weight: bold;",de.status,de.statusText),!de.ok)throw new Error(`N8N webhook error: ${de.status} ${de.statusText}`);const Ce=await de.json();console.log("%cğŸ“¥ N8N FUNNEL response data:","color: #10B981; font-weight: bold;"),console.log(Ce);let me=Array.isArray(Ce)?Ce[0]:Ce;me!=null&&me.json&&(me=me.json);const et=(me==null?void 0:me.output)||(me==null?void 0:me.html)||(me==null?void 0:me.text)||(me==null?void 0:me.response)||"NepodaÅ™ilo se zÃ­skat odpovÄ›Ä.";console.log("%cğŸ”„ Obohacuji funnel produkty z product_feed_2...","color: #8B5CF6; font-weight: bold;");const B=G.slice(0,2),ae=(await wo(B)).map(le=>({product_code:le.product_code,product_name:le.product_name,description:le.description,description_short:le.description,price:le.price,currency:le.currency||"CZK",url:le.url||`https://bewit.love/produkt/${le.product_code}`,thumbnail:le.thumbnail}));console.log("%cğŸ“¦ Funnel produkty pro UI (max 2):","color: #3B82F6; font-weight: bold;",ae),console.log("%cğŸ–¼ï¸ ObrÃ¡zky produktÅ¯:","color: #3B82F6;",ae.map(le=>({name:le.product_name,thumbnail:le.thumbnail})));const ie={id:(Date.now()+1).toString(),role:"bot",text:et,sources:(me==null?void 0:me.sources)||[],isFunnelMessage:!0,funnelProducts:ae,symptomList:M};c(le=>[...le,ie]),u(!1);return}catch(de){console.error("%câŒ FUNNEL N8N WEBHOOK ERROR:","color: #EF4444; font-weight: bold;",de),console.log("%cğŸ”„ Fallback na standardnÃ­ chat mode...","color: #FFA500; font-weight: bold;")}}else console.log("%cğŸ’¬ POKRAÄŒUJI STANDARDNÃM CHAT MODE (intent byl CHAT)","color: #FFA500; font-weight: bold;")}}if(r.book_database&&r.product_recommendations){console.log("ğŸš€ KombinovanÃ© vyhledÃ¡vÃ¡nÃ­: knihy + produkty souÄasnÄ› s prioritizacÃ­ knih");let U=(Date.now()+1).toString();const ne=I=>{var G,oe,W;console.log("ğŸ“š onBooksReceived callback zavolÃ¡n v komponentÄ›!",{textLength:((G=I.text)==null?void 0:G.length)||0,sourcesCount:((oe=I.sources)==null?void 0:oe.length)||0,productsCount:((W=I.productRecommendations)==null?void 0:W.length)||0});const se={id:U,role:"bot",text:I.text||"",sources:I.sources||[],productRecommendations:I.productRecommendations};console.log("ğŸ“š PÅ™idÃ¡vÃ¡m zprÃ¡vu do messages:",se),c(re=>{const N=[...re,se];return console.log("ğŸ“š NovÃ½ stav messages:",N.length,"zprÃ¡v"),N}),f(!1)},q=I=>{console.log("ğŸ›ï¸ onProductsReceived callback zavolÃ¡n v komponentÄ›!",{productsCount:I.length,targetMessageId:U}),c(se=>{var oe,W;const G=se.map(re=>re.id===U?{...re,productRecommendations:[...re.productRecommendations||[],...I]}:re);return console.log("ğŸ›ï¸ Aktualizoval jsem zprÃ¡vu s produkty:",(W=(oe=G.find(re=>re.id===U))==null?void 0:oe.productRecommendations)==null?void 0:W.length),G})};await Fn(J,m,V.slice(0,-1),S,ne,q)}else if(r.book_database){console.log("ğŸ“š PouÅ¾Ã­vÃ¡m pouze webhook pro databÃ¡zi knih - IGNORUJI produktovÃ¡ doporuÄenÃ­...");const U=await xo(J,m,V.slice(0,-1),S,r.webhook_url,s),ne=(((F=U.text)==null?void 0:F.match(/<<<PRODUCT:/g))||[]).length,q=ne>2;console.log(`ğŸŸ¡ Callout detekce: ${ne} vloÅ¾enÃ½ch produktÅ¯ v textu â†’ callout = ${q?"ANO":"NE"}`);const I={id:(Date.now()+1).toString(),role:"bot",text:U.text,sources:U.sources||[],productRecommendations:void 0,matchedProducts:U.matchedProducts||[],hasCallout:q};c(se=>[...se,I])}else if(r.product_recommendations){console.log("ğŸ›ï¸ PouÅ¾Ã­vÃ¡m hybridnÃ­ systÃ©m pro produktovÃ© doporuÄenÃ­...");try{const U=r.use_feed_1!==!1,ne=r.use_feed_2!==!1,I=(await En(T.trim(),m,10,U,ne)).map((G,oe)=>({id:G.id||oe+1,product_code:G.product_code,product_name:G.product_name,description:G.description,category:G.category,price:G.price,currency:G.currency,product_url:G.product_url,image_url:G.image_url,similarity_score:G.similarity_score})),se={id:(Date.now()+1).toString(),role:"bot",text:I.length>0?`ğŸ¯ NaÅ¡el jsem ${I.length} doporuÄenÃ½ch produktÅ¯ podle vaÅ¡ich potÅ™eb:`:"ğŸ” BohuÅ¾el jsem nenaÅ¡el Å¾Ã¡dnÃ© produkty odpovÃ­dajÃ­cÃ­ vaÅ¡emu dotazu.",sources:[],productRecommendations:I.length>0?I:void 0};c(G=>[...G,se]),f(!1)}catch(U){console.error("âŒ Chyba pÅ™i hybridnÃ­m vyhledÃ¡vÃ¡nÃ­ produktÅ¯:",U);const ne={id:(Date.now()+1).toString(),role:"bot",text:`âŒ Chyba pÅ™i vyhledÃ¡vÃ¡nÃ­ produktÅ¯: ${U instanceof Error?U.message:"NeznÃ¡mÃ¡ chyba"}`};c(q=>[...q,ne])}}else{console.log("âš ï¸ Å½Ã¡dnÃ½ zdroj dat nenÃ­ zapnutÃ½");const U={id:(Date.now()+1).toString(),role:"bot",text:"âš ï¸ NenÃ­ zapnutÃ½ Å¾Ã¡dnÃ½ zdroj dat. ProsÃ­m, zapnÄ›te buÄ databÃ¡zi knih nebo produktovÃ¡ doporuÄenÃ­ v nastavenÃ­ chatbota."};c(ne=>[...ne,U])}}catch(S){console.error("âŒ Chyba v handleSendMessage:",S);const R=S instanceof Error?S.message:"OmlouvÃ¡m se, doÅ¡lo k neznÃ¡mÃ© chybÄ›.",J={id:(Date.now()+1).toString(),role:"bot",text:R};c(w=>[...w,J])}finally{u(!1)}},[m,a,d,t,o,n,r]),C=p.useCallback(async T=>{if(!(!T.trim()||!m)){u(!0);try{const y={};t.length>0&&(y.categories=t),o.length>0&&(y.labels=o),n.length>0&&(y.publication_types=n),console.log("Sending silent prompt with current metadata:",y);const V=Nt[d],F=`${T.trim()} ${V}`,{text:S,sources:R,productRecommendations:J,matchedProducts:w}=await xo(F,m,a,y,r.webhook_url,s),U={id:(Date.now()+1).toString(),role:"bot",text:S,sources:R,productRecommendations:J,matchedProducts:w};c(ne=>[...ne,U])}catch(y){const V=y instanceof Error?y.message:"OmlouvÃ¡m se, doÅ¡lo k neznÃ¡mÃ© chybÄ›.",F={id:(Date.now()+1).toString(),role:"bot",text:V};c(S=>[...S,F])}finally{u(!1)}}},[m,a,d,t,o,n]);return p.useCallback(()=>{c([]),b(ho()),An()},[]),p.useCallback(()=>{const T=document.getElementById("chat-container-for-pdf");if(T){const y=T.style.backgroundColor;T.style.backgroundColor="white",html2canvas(T,{scale:2,useCORS:!0}).then(V=>{const F=V.toDataURL("image/png"),S=new jspdf.jsPDF({orientation:"p",unit:"mm",format:"a4"}),R=S.internal.pageSize.getWidth(),J=V.height*R/V.width;let w=0,U=J;for(S.addImage(F,"PNG",0,w,R,J),U-=S.internal.pageSize.getHeight();U>0;)w=-U,S.addPage(),S.addImage(F,"PNG",0,w,R,J),U-=S.internal.pageSize.getHeight();S.save("sana-ai-chat.pdf"),T.style.backgroundColor=y})}},[]),e.jsx("div",{className:"flex flex-col h-full font-sans",children:e.jsxs("main",{className:"flex-1 flex flex-col w-full min-h-0",children:[e.jsx("div",{id:"chat-container-for-pdf",className:"w-full flex-1 min-h-0 relative",children:e.jsx(Vn,{messages:a,isLoading:g,onSilentPrompt:C,shouldAutoScroll:P,chatbotSettings:r,sessionId:m,chatbotId:s,selectedCategories:t,selectedLabels:o,selectedPublicationTypes:n})}),e.jsx("div",{className:"w-full max-w-4xl p-4 md:p-6 bg-bewit-gray flex-shrink-0 border-t border-slate-200 mx-auto",children:e.jsx(Hn,{onSendMessage:z,isLoading:g})})]})})},Zn=({chatbotSettings:t={product_recommendations:!1,product_button_recommendations:!1,inline_product_links:!1,book_database:!0,use_feed_1:!0,use_feed_2:!0,enable_product_router:!0,enable_manual_funnel:!1},chatbotId:o,onClose:n})=>{const[r,s]=p.useState(t);p.useEffect(()=>{s(t)},[t]);const[l,a]=p.useState([]),[c,g]=p.useState([]),[u,m]=p.useState([]),[b,d]=p.useState([]),[v,P]=p.useState([]),[f,z]=p.useState([]),[C,T]=p.useState(!1),[y,V]=p.useState(!1),[F,S]=p.useState("cs"),R=[{code:"cs",label:"CZ"},{code:"sk",label:"SK"},{code:"de",label:"DE"},{code:"en",label:"UK"}];p.useEffect(()=>{(async()=>{const oe=["Aromaterapie","MasÃ¡Å¾e","Akupunktura","Diagnostika","TÄŒM","Wany"],W=["OsobnÃ­","Chci pÅ™eÄÃ­st"],re=["public","students","internal_bewit"];a(oe),g(W),m(re),d([...oe]),P([...W]),z([...re]),console.log("ğŸ”„ Nastaveny vÃ½chozÃ­ hodnoty pro filtry (vÅ¡e zaÅ¡krtnutÃ©):",{categories:oe,labels:W,types:re});try{const[N,M,x]=await Promise.all([_t.getLabels(),_t.getCategories(),_t.getPublicationTypes()]);console.log("ğŸ“Š NaÄtenÃ¡ metadata z databÃ¡ze do Sana chatu:"),console.log("- Å tÃ­tky:",N),console.log("- Kategorie:",M),console.log("- Typy publikacÃ­:",x),N.length>0&&(g(N),P([...N])),M.length>0&&(a(M),d([...M])),x.length>0&&(m(x),z([...x]))}catch(N){console.error("Chyba pÅ™i naÄÃ­tÃ¡nÃ­ metadat z databÃ¡ze, zÅ¯stÃ¡vÃ¡m u fallback hodnot:",N)}})()},[]);const J=(G,oe,W)=>{if(console.log("Toggle filter:",{value:G,currentSelected:oe}),oe.includes(G)){const re=oe.filter(N=>N!==G);console.log("Removing filter, new selection:",re),W(re)}else{const re=[...oe,G];console.log("Adding filter, new selection:",re),W(re)}},w=()=>{d([]),P([]),z([])},U=()=>{d([...l]),P([...c]),z([...u])};b.length>0&&b.length<l.length||v.length>0&&v.length<c.length||f.length>0&&f.length<u.length;const ne=()=>{T(!C)},q=()=>{V(!y)},I=p.useCallback(()=>{console.log("ğŸ”„ NovÃ½ chat v FilteredSanaChat")},[]),se=p.useCallback(()=>{const G=document.getElementById("chat-container-for-pdf");if(G){const oe=G.style.backgroundColor;G.style.backgroundColor="white",html2canvas(G,{scale:2,useCORS:!0}).then(W=>{const re=W.toDataURL("image/png"),N=new jspdf.jsPDF({orientation:"p",unit:"mm",format:"a4"}),M=N.internal.pageSize.getWidth(),x=W.height*M/W.width;let _=0,j=x;for(N.addImage(re,"PNG",0,_,M,x),j-=N.internal.pageSize.getHeight();j>0;)_=-j,N.addPage(),N.addImage(re,"PNG",0,_,M,x),j-=N.internal.pageSize.getHeight();N.save("sana-ai-chat.pdf"),G.style.backgroundColor=oe})}},[]);return e.jsxs("div",{className:"flex h-full w-full bg-bewit-gray m-0 p-0",children:[e.jsx("div",{className:`${C?"w-80":"w-0"} bg-white overflow-hidden transition-all duration-300 ease-in-out`,children:e.jsxs("div",{className:"w-80 p-6 overflow-y-auto h-full",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-bewit-dark mb-2",children:"Filtrace obsahu"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Vyberte kategorie pro pÅ™esnÄ›jÅ¡Ã­ vÃ½sledky"})]}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsx("button",{onClick:U,className:"flex-1 px-3 py-2 text-xs font-medium text-bewit-blue bg-bewit-lightBlue rounded-md hover:bg-blue-100 transition-colors",children:"Vybrat vÅ¡e"}),e.jsx("button",{onClick:w,className:"flex-1 px-3 py-2 text-xs font-medium text-slate-600 bg-slate-100 rounded-md hover:bg-slate-200 transition-colors",children:"Filter Reset"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-bewit-dark mb-4 text-center",children:"Kategorie lÃ©Äby"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:l.map(G=>e.jsx("button",{onClick:()=>J(G,b,d),className:`p-2 rounded-lg text-xs sm:text-sm font-medium transition-all duration-200 text-center ${b.includes(G)?"bg-bewit-blue text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:G},G))})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-bewit-dark mb-4 text-center",children:"Typy publikacÃ­"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:u.map(G=>e.jsx("button",{onClick:()=>J(G,f,z),className:`p-2 rounded-lg text-xs sm:text-sm font-medium transition-all duration-200 text-center ${f.includes(G)?"bg-bewit-blue text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:G==="public"?"VeÅ™ejnÃ©":G==="students"?"Pro studenty":"InternÃ­"},G))})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-bewit-dark mb-4 text-center",children:"Å tÃ­tky"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:c.map(G=>e.jsx("button",{onClick:()=>J(G,v,P),className:`p-2 rounded-lg text-xs sm:text-sm font-medium transition-all duration-200 text-center ${v.includes(G)?"bg-bewit-blue text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:G},G))})]})]})}),e.jsxs("div",{className:"flex-1 flex flex-col w-full",children:[e.jsx(It,{onClose:n,languages:R,selectedLanguage:F,onLanguageChange:S,leftContent:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:C,onChange:ne,className:"sr-only peer","aria-label":"Zobrazit/skrÃ½t filtry"}),e.jsx("div",{className:"relative w-11 h-6 bg-white/20 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-white/30 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-white/40"})]}),e.jsx("div",{className:"h-6 w-px bg-white/20"}),e.jsx(To,{className:"h-10 w-auto object-contain"})]}),buttons:[{icon:"product",onClick:q,label:y?"SkrÃ½t produkty":"Spravovat produkty",tooltip:y?"SkrÃ½t produkty":"Spravovat produkty BEWIT",isActive:y},{icon:"plus",onClick:I,label:"NovÃ½ chat",tooltip:"NovÃ½ chat"},{icon:"download",onClick:se,label:"Export do PDF",tooltip:"Export do PDF"}]}),e.jsx("div",{className:"flex-1 bg-bewit-gray min-h-0",children:y?e.jsx("div",{className:"w-full h-full flex-1 overflow-y-auto p-6",children:e.jsx(Ot,{})}):e.jsx($o,{selectedCategories:b,selectedLabels:v,selectedPublicationTypes:f,chatbotSettings:r,chatbotId:o,onClose:n})})]})]})};class We{static async getAllChatbotSettings(){try{const{data:o,error:n}=await E.from("chatbot_settings").select("*").order("created_at",{ascending:!1});if(n)throw console.error("Chyba pÅ™i naÄÃ­tÃ¡nÃ­ nastavenÃ­ chatbotÅ¯:",n),n;return o||[]}catch(o){throw console.error("Chyba pÅ™i naÄÃ­tÃ¡nÃ­ nastavenÃ­ chatbotÅ¯:",o),o}}static async getChatbotSettings(o){try{const{data:n,error:r}=await E.from("chatbot_settings").select("*").eq("chatbot_id",o).single();return r?(console.error("Chyba pÅ™i naÄÃ­tÃ¡nÃ­ nastavenÃ­ chatbota:",r),null):n}catch(n){return console.error("Chyba pÅ™i naÄÃ­tÃ¡nÃ­ nastavenÃ­ chatbota:",n),null}}static async getChatbotSettingsWithDetails(o){return this.getChatbotSettings(o)}static async getDefaultWebChatbot(){try{const{data:o,error:n}=await E.from("chatbot_settings").select("*").eq("is_default_web_chatbot",!0).eq("is_active",!0).single();return n?(console.warn("âš ï¸ VÃ½chozÃ­ webovÃ½ chatbot nenalezen, fallback na sana_chat:",n),this.getChatbotSettings("sana_chat")):o}catch(o){return console.error("âŒ Chyba pÅ™i naÄÃ­tÃ¡nÃ­ vÃ½chozÃ­ho webovÃ©ho chatbota:",o),this.getChatbotSettings("sana_chat")}}static async createChatbotSettings(o){try{const{data:n,error:r}=await E.from("chatbot_settings").insert([o]).select().single();if(r)throw console.error("Chyba pÅ™i vytvÃ¡Å™enÃ­ chatbota:",r),r;return n}catch(n){throw console.error("Chyba pÅ™i vytvÃ¡Å™enÃ­ chatbota:",n),n}}static async updateChatbotSettings(o,n){try{const{data:r,error:s}=await E.from("chatbot_settings").update(n).eq("chatbot_id",o).select().single();if(s)throw console.error("âŒ Chyba pÅ™i UPDATE:",s),new Error(`UPDATE selhal: ${s.message}

ğŸ’¡ Å˜eÅ¡enÃ­:
1. Zkontrolujte, zda jste pÅ™ihlÃ¡Å¡eni
2. SpusÅ¥te SQL script pro opravu RLS politik (viz dokumentace)`);if(!r)throw new Error("UPDATE nevrÃ¡til Å¾Ã¡dnÃ¡ data");return r}catch(r){throw console.error("âŒ Chyba pÅ™i aktualizaci chatbota:",r),r}}static async deleteChatbotSettings(o){try{const{error:n}=await E.from("chatbot_settings").delete().eq("chatbot_id",o);if(n)throw console.error("Chyba pÅ™i mazÃ¡nÃ­ chatbota:",n),n}catch(n){throw console.error("Chyba pÅ™i mazÃ¡nÃ­ chatbota:",n),n}}static async getCategories(){try{const{data:o,error:n}=await E.from("categories").select("id, name").order("name",{ascending:!0});if(n)throw console.error("Chyba pÅ™i naÄÃ­tÃ¡nÃ­ kategoriÃ­:",n),n;return o||[]}catch(o){throw console.error("Chyba pÅ™i naÄÃ­tÃ¡nÃ­ kategoriÃ­:",o),o}}static async getPublicationTypes(){try{const{data:o,error:n}=await E.from("publication_types").select("id, name, description").order("name",{ascending:!0});if(n)throw console.error("Chyba pÅ™i naÄÃ­tÃ¡nÃ­ typÅ¯ publikacÃ­:",n),n;return o||[]}catch(o){throw console.error("Chyba pÅ™i naÄÃ­tÃ¡nÃ­ typÅ¯ publikacÃ­:",o),o}}static async getLabels(){try{const{data:o,error:n}=await E.from("labels").select("id, name").order("name",{ascending:!0});if(n)throw console.error("Chyba pÅ™i naÄÃ­tÃ¡nÃ­ Å¡tÃ­tkÅ¯:",n),n;return o||[]}catch(o){throw console.error("Chyba pÅ™i naÄÃ­tÃ¡nÃ­ Å¡tÃ­tkÅ¯:",o),o}}static async getChatbotFilters(o){try{const n=await this.getChatbotSettings(o);if(!n)throw new Error(`Chatbot s ID "${o}" nebyl nalezen`);const r=[];if(n.allowed_categories.length>0){const{data:a,error:c}=await E.from("categories").select("id, name").in("id",n.allowed_categories);c?console.error("Chyba pÅ™i naÄÃ­tÃ¡nÃ­ kategoriÃ­:",c):r.push(...a||[])}const s=[];if(n.allowed_publication_types.length>0){const{data:a,error:c}=await E.from("publication_types").select("id, name, description").in("id",n.allowed_publication_types);c?console.error("Chyba pÅ™i naÄÃ­tÃ¡nÃ­ typÅ¯ publikacÃ­:",c):s.push(...a||[])}const l=[];if(n.allowed_labels.length>0){const{data:a,error:c}=await E.from("labels").select("id, name").in("id",n.allowed_labels);c?console.error("Chyba pÅ™i naÄÃ­tÃ¡nÃ­ Å¡tÃ­tkÅ¯:",c):l.push(...a||[])}return{categories:r,publicationTypes:s,labels:l,productRecommendations:n.product_recommendations,productButtonRecommendations:n.product_button_recommendations,inlineProductLinks:n.inline_product_links||!1,bookDatabase:n.book_database,useFeed1:n.use_feed_1!==!1,useFeed2:n.use_feed_2!==!1,enableProductRouter:n.enable_product_router!==!1,enableManualFunnel:n.enable_manual_funnel===!0}}catch(n){throw console.error("Chyba pÅ™i naÄÃ­tÃ¡nÃ­ filtrÅ¯ chatbota:",n),n}}static async setActive(o,n){try{await this.updateChatbotSettings(o,{is_active:n})}catch(r){throw console.error("Chyba pÅ™i zmÄ›nÄ› aktivace chatbota:",r),r}}}const Kn=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:e.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})}),Gn=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),Yn=({chatbotSettings:t})=>{const[o,n]=p.useState(!1),[r,s]=p.useState(null),[l,a]=p.useState("sana_chat"),[c,g]=p.useState(!0);p.useEffect(()=>{(async()=>{if(t){s(t),g(!1);return}try{const b=await We.getDefaultWebChatbot();b?(a(b.chatbot_id),s({product_recommendations:b.product_recommendations||!1,product_button_recommendations:b.product_button_recommendations||!1,inline_product_links:b.inline_product_links||!1,book_database:b.book_database!==void 0?b.book_database:!0,use_feed_1:b.use_feed_1!==void 0?b.use_feed_1:!0,use_feed_2:b.use_feed_2!==void 0?b.use_feed_2:!0})):(a("sana_chat"),s({product_recommendations:!1,product_button_recommendations:!1,inline_product_links:!1,book_database:!0,use_feed_1:!0,use_feed_2:!0}))}catch{s({product_recommendations:!1,product_button_recommendations:!1,book_database:!0,use_feed_1:!0,use_feed_2:!0})}finally{g(!1)}})()},[t]);const u=()=>{n(!o)};return c||!r?null:e.jsxs(e.Fragment,{children:[o&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsx("div",{className:"w-[1200px] h-[700px] max-w-[95vw] max-h-[90vh] bg-white rounded-xl shadow-2xl flex flex-col transition-all duration-300 ease-in-out",children:e.jsx(Zn,{chatbotId:l,chatbotSettings:r,onClose:()=>n(!1)})})}),e.jsx("div",{className:"fixed bottom-5 right-5 z-50",children:e.jsx("button",{onClick:u,className:"w-16 h-16 bg-bewit-blue rounded-full text-white flex items-center justify-center shadow-lg hover:bg-blue-800 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-bewit-blue","aria-label":o?"ZavÅ™Ã­t chat":"OtevÅ™Ã­t chat",children:o?e.jsx(Gn,{className:"w-8 h-8"}):e.jsx(Kn,{className:"w-8 h-8"})})})]})},Jn=({onClose:t})=>{const[o,n]=p.useState([]),[r,s]=p.useState(new Set),[l,a]=p.useState(!0),[c,g]=p.useState(!1),[u,m]=p.useState(!1),[b,d]=p.useState(""),[v,P]=p.useState("all"),[f,z]=p.useState({current:0,total:0,productName:""}),[C,T]=p.useState({current:0,total:0,productName:""}),[y,V]=p.useState(50),[F,S]=p.useState(1),R=p.useCallback(async()=>{a(!0),console.log("ğŸ” NaÄÃ­tÃ¡m produkty z products tabulky...");try{const{data:x,error:_}=await E.from("products").select("id, product_code, name, description, category, price, currency, product_url, image_url").order("name");if(console.log("ğŸ“Š Products response:",{productsData:x,productsError:_}),_){console.error("âŒ Chyba pÅ™i naÄÃ­tÃ¡nÃ­ produktÅ¯:",_),alert(`Chyba pÅ™i naÄÃ­tÃ¡nÃ­ produktÅ¯: ${_.message}`);return}const{data:j,error:O}=await E.from("product_embeddings").select("product_code, embedding_status, embedding_generated_at");console.log("ğŸ“Š Embeddings response:",{embeddingsData:j,embeddingsError:O}),O&&console.warn("âš ï¸ Chyba pÅ™i naÄÃ­tÃ¡nÃ­ embeddingÅ¯ (moÅ¾nÃ¡ tabulka neexistuje):",O);const Y=new Map;j&&j.forEach(Q=>{Y.set(Q.product_code,Q)});const te=(x||[]).map(Q=>{const he=Y.get(Q.product_code);return{id:Q.id,product_code:Q.product_code,name:Q.name,description:Q.description,category:Q.category,price:Q.price,currency:Q.currency,product_url:Q.product_url,image_url:Q.image_url,has_embedding:!!he,embedding_status:he?he.embedding_status:"none",embedding_generated_at:he?he.embedding_generated_at:null}});console.log(`âœ… NaÄteno ${te.length} produktÅ¯`),n(te)}catch(x){console.error("âŒ Chyba pÅ™i naÄÃ­tÃ¡nÃ­ produktÅ¯:",x),alert(`Chyba pÅ™i naÄÃ­tÃ¡nÃ­ produktÅ¯: ${x}`)}finally{a(!1)}},[]);p.useEffect(()=>{R()},[R]);const J=o.filter(x=>{const _=x.name.toLowerCase().includes(b.toLowerCase())||x.description&&x.description.toLowerCase().includes(b.toLowerCase())||x.category&&x.category.toLowerCase().includes(b.toLowerCase()),j=v==="all"||v==="no_embedding"&&!x.has_embedding||v==="has_embedding"&&x.has_embedding||x.embedding_status===v;return _&&j}),w=Math.ceil(J.length/y),U=(F-1)*y,ne=U+y,q=J.slice(U,ne);p.useEffect(()=>{S(1)},[b,v,y]);const I={total:o.length,no_embedding:o.filter(x=>!x.has_embedding).length,pending:o.filter(x=>x.embedding_status==="pending").length,completed:o.filter(x=>x.embedding_status==="completed").length,error:o.filter(x=>x.embedding_status==="error").length},se=()=>{const x=q.map(O=>O.id),_=x.every(O=>r.has(O)),j=new Set(r);_?x.forEach(O=>j.delete(O)):x.forEach(O=>j.add(O)),s(j)},G=x=>{const _=new Set(r);_.has(x)?_.delete(x):_.add(x),s(_)},oe=async()=>{const x=o.filter(j=>r.has(j.id));if(x.length===0){alert("Vyberte alespoÅˆ jeden produkt pro odeslÃ¡nÃ­ na N8N webhook.");return}m(!0),T({current:0,total:1,productName:"PÅ™Ã­prava dat..."});const _="https://n8n.srv980546.hstgr.cloud/webhook/15210f31-7432-4002-aaa8-4026c462aa29";try{console.log(`ğŸ“¤ OdesÃ­lÃ¡m ${x.length} produktÅ¯ na N8N webhook`);const j={products:x.map(te=>({id:te.id,product_code:te.product_code,name:te.name,description:te.description,category:te.category,price:te.price,currency:te.currency,product_url:te.product_url,image_url:te.image_url,has_embedding:te.has_embedding,embedding_status:te.embedding_status,embedding_generated_at:te.embedding_generated_at,full_content:`${te.name}
${te.description||""}
Kategorie: ${te.category||""}
Cena: ${te.price?`${te.price} ${te.currency}`:"Neuvedena"}
KÃ³d produktu: ${te.product_code}`})),total_count:x.length,timestamp:new Date().toISOString(),batch_id:`batch_${Date.now()}`};T({current:1,total:2,productName:"OdesÃ­lÃ¡m data..."});const O=await fetch(_,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(j)});if(!O.ok)throw console.error("Chyba pÅ™i odesÃ­lÃ¡nÃ­ produktÅ¯:",O.status,O.statusText),new Error(`HTTP ${O.status}: ${O.statusText}`);T({current:2,total:2,productName:"ZpracovÃ¡vÃ¡m odpovÄ›Ä..."});let Y;try{Y=await O.json(),console.log("ğŸ“¥ OdpovÄ›Ä z N8N webhook:",Y)}catch(te){console.warn("âš ï¸ NepodaÅ™ilo se parsovat odpovÄ›Ä jako JSON:",te),Y={success:!0,message:"OdpovÄ›Ä pÅ™ijata bez JSON formÃ¡tu"}}if(Y.success===!0||Y.status==="success"||O.status===200){console.log(`âœ… ÃšspÄ›Å¡nÄ› odeslÃ¡no ${x.length} produktÅ¯ na N8N webhook`),s(new Set);let te=`âœ… ÃšspÄ›Å¡nÄ› odeslÃ¡no ${x.length} produktÅ¯ na N8N webhook`;Y.message&&(te+=`

ğŸ“‹ OdpovÄ›Ä webhoku: ${Y.message}`),Y.processed_count!==void 0&&(te+=`
ğŸ“Š ZpracovÃ¡no: ${Y.processed_count} produktÅ¯`),Y.batch_id&&(te+=`
ğŸ†” Batch ID: ${Y.batch_id}`),Y.processing_time&&(te+=`
â±ï¸ Doba zpracovÃ¡nÃ­: ${Y.processing_time}`),alert(te)}else{console.error("âŒ Webhook vrÃ¡til chybu:",Y);let te="âŒ Webhook vrÃ¡til chybu";(Y.message||Y.error)&&(te+=`

ğŸ“‹ ChybovÃ¡ zprÃ¡va: ${Y.message||Y.error}`),Y.failed_count!==void 0&&(te+=`
ğŸ“Š NeÃºspÄ›Å¡nÃ½ch: ${Y.failed_count} produktÅ¯`),Y.batch_id&&(te+=`
ğŸ†” Batch ID: ${Y.batch_id}`),alert(te);return}}catch(j){console.error("âŒ Chyba pÅ™i odesÃ­lÃ¡nÃ­ na N8N webhook:",j),alert(`âŒ Chyba pÅ™i komunikaci s N8N webhook:

${j}`)}finally{m(!1),T({current:0,total:0,productName:""})}},W=async()=>{const x=o.filter(_=>r.has(_.id));if(x.length===0){alert("Vyberte alespoÅˆ jeden produkt pro embedding.");return}g(!0),z({current:0,total:x.length,productName:""});try{for(let _=0;_<x.length;_++){const j=x[_];z({current:_+1,total:x.length,productName:j.name});try{console.log(`ğŸ”„ ZpracovÃ¡vÃ¡m produkt: ${j.name}`);const{error:O}=await E.from("product_embeddings").upsert({product_code:j.product_code,product_name:j.name,description:j.description,category:j.category,price:j.price,product_url:j.product_url,image_url:j.image_url,currency:j.currency,search_text:`${j.name} ${j.description||""} ${j.category||""}`.trim(),embedding_status:"processing",synced_from_products_at:new Date().toISOString(),updated_at:new Date().toISOString()},{onConflict:"product_code"});if(O){console.error("Chyba pÅ™i vklÃ¡dÃ¡nÃ­ do product_embeddings:",O);continue}const Y=`${j.name} ${j.description||""} ${j.category||""}`.trim();if(!Y){await E.from("product_embeddings").update({embedding_status:"error"}).eq("product_code",j.product_code);continue}const te=await At(Y);if(te.success&&te.embedding){const{error:Q}=await E.from("product_embeddings").update({embedding:`[${te.embedding.join(",")}]`,embedding_status:"completed",embedding_generated_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("product_code",j.product_code);Q?(console.error("Chyba pÅ™i uklÃ¡dÃ¡nÃ­ embeddingu:",Q),await E.from("product_embeddings").update({embedding_status:"error"}).eq("product_code",j.product_code)):console.log(`âœ… Embedding ÃºspÄ›Å¡nÄ› uloÅ¾en pro: ${j.name}`)}else await E.from("product_embeddings").update({embedding_status:"error"}).eq("product_code",j.product_code);await new Promise(Q=>setTimeout(Q,200))}catch(O){console.error(`Chyba pÅ™i zpracovÃ¡nÃ­ produktu ${j.name}:`,O),await E.from("product_embeddings").update({embedding_status:"error"}).eq("product_code",j.product_code)}}s(new Set),await R()}catch(_){console.error("Chyba pÅ™i zpracovÃ¡nÃ­ embeddingÅ¯:",_)}finally{g(!1),z({current:0,total:0,productName:""})}},re=()=>e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),N=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"23 4 23 10 17 10"}),e.jsx("path",{d:"m3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]}),M=(x,_)=>{if(!_)return e.jsx("span",{style:{...Z.statusBadge,backgroundColor:"#f8f9fa",color:"#6c757d",border:"1px solid #dee2e6"},children:"Bez embeddingu"});const j={pending:{backgroundColor:"#fff3cd",color:"#856404",border:"1px solid #ffeaa7"},processing:{backgroundColor:"#cce5ff",color:"#004085",border:"1px solid #74b9ff"},completed:{backgroundColor:"#d1edff",color:"#155724",border:"1px solid #74b9ff"},error:{backgroundColor:"#f8d7da",color:"#721c24",border:"1px solid #fd79a8"}},O={pending:"ÄŒekÃ¡",processing:"ZpracovÃ¡vÃ¡ se",completed:"DokonÄeno",error:"Chyba"};return e.jsx("span",{style:{...Z.statusBadge,...j[x]},children:O[x]||x})};return e.jsx("div",{style:Z.overlay,children:e.jsxs("div",{style:Z.modal,children:[e.jsxs("div",{style:Z.header,children:[e.jsx("h2",{style:Z.title,children:"ProduktovÃ½ Feed - Embeddingy"}),e.jsx("button",{style:Z.closeButton,onClick:t,children:e.jsx(re,{})})]}),e.jsx("div",{style:Z.statsSection,children:e.jsxs("div",{style:Z.statsGrid,children:[e.jsxs("div",{style:Z.statCard,children:[e.jsx("div",{style:Z.statNumber,children:I.total}),e.jsx("div",{style:Z.statLabel,children:"Celkem"})]}),e.jsxs("div",{style:Z.statCard,children:[e.jsx("div",{style:Z.statNumber,children:I.no_embedding}),e.jsx("div",{style:Z.statLabel,children:"Bez embeddingu"})]}),e.jsxs("div",{style:Z.statCard,children:[e.jsx("div",{style:Z.statNumber,children:I.pending}),e.jsx("div",{style:Z.statLabel,children:"ÄŒekÃ¡"})]}),e.jsxs("div",{style:Z.statCard,children:[e.jsx("div",{style:Z.statNumber,children:I.completed}),e.jsx("div",{style:Z.statLabel,children:"Hotovo"})]}),e.jsxs("div",{style:Z.statCard,children:[e.jsx("div",{style:Z.statNumber,children:I.error}),e.jsx("div",{style:Z.statLabel,children:"Chyby"})]})]})}),e.jsxs("div",{style:Z.controlsSection,children:[e.jsxs("div",{style:Z.controlsRow,children:[e.jsx("input",{type:"text",placeholder:"Vyhledat produkty...",value:b,onChange:x=>d(x.target.value),style:Z.searchInput}),e.jsxs("select",{value:v,onChange:x=>P(x.target.value),style:Z.statusSelect,children:[e.jsx("option",{value:"all",children:"VÅ¡echny statusy"}),e.jsx("option",{value:"no_embedding",children:"Bez embeddingu"}),e.jsx("option",{value:"pending",children:"ÄŒekÃ¡"}),e.jsx("option",{value:"processing",children:"ZpracovÃ¡vÃ¡ se"}),e.jsx("option",{value:"completed",children:"DokonÄeno"}),e.jsx("option",{value:"error",children:"Chyba"})]}),e.jsx("button",{style:Z.refreshButton,onClick:R,children:e.jsx(N,{})})]}),e.jsxs("div",{style:Z.actionRow,children:[e.jsxs("div",{style:Z.selectionInfo,children:["VybrÃ¡no: ",r.size," z ",J.length]}),e.jsxs("div",{style:Z.actionButtons,children:[e.jsx("button",{style:Z.selectAllButton,onClick:se,children:q.length>0&&q.every(x=>r.has(x.id))?"ZruÅ¡it vÃ½bÄ›r strÃ¡nky":"Vybrat strÃ¡nku"}),e.jsx("button",{style:Z.embeddingButton,onClick:W,disabled:r.size===0||c||u,children:c?"ZpracovÃ¡vÃ¡ se...":`Spustit Embedding (${r.size})`}),e.jsx("button",{style:Z.n8nButton,onClick:oe,disabled:r.size===0||c||u,children:u?"OdesÃ­lÃ¡ se...":`N8N Embedding (${r.size})`})]})]}),e.jsxs("div",{style:Z.paginationRow,children:[e.jsxs("div",{style:Z.paginationInfo,children:["Zobrazeno: ",U+1," - ",Math.min(ne,J.length)," z ",J.length]}),e.jsxs("div",{style:Z.paginationControls,children:[e.jsxs("label",{style:Z.paginationLabel,children:["ZÃ¡znamÅ¯ na strÃ¡nku:",e.jsxs("select",{value:y,onChange:x=>V(Number(x.target.value)),style:Z.paginationSelect,children:[e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"}),e.jsx("option",{value:500,children:"500"}),e.jsx("option",{value:1e3,children:"1000"})]})]}),e.jsxs("div",{style:Z.paginationButtons,children:[e.jsx("button",{style:{...Z.paginationButton,opacity:F===1?.5:1},onClick:()=>S(1),disabled:F===1,children:"<<"}),e.jsx("button",{style:{...Z.paginationButton,opacity:F===1?.5:1},onClick:()=>S(x=>Math.max(1,x-1)),disabled:F===1,children:"<"}),e.jsxs("span",{style:Z.pageNumber,children:["StrÃ¡nka ",F," z ",w||1]}),e.jsx("button",{style:{...Z.paginationButton,opacity:F===w?.5:1},onClick:()=>S(x=>Math.min(w,x+1)),disabled:F===w,children:">"}),e.jsx("button",{style:{...Z.paginationButton,opacity:F===w?.5:1},onClick:()=>S(w),disabled:F===w,children:">>"})]})]})]})]}),c&&e.jsxs("div",{style:Z.progressSection,children:[e.jsxs("div",{style:Z.progressText,children:["Embedding: ",f.current," / ",f.total," - ",f.productName]}),e.jsx("div",{style:Z.progressBar,children:e.jsx("div",{style:{...Z.progressFill,width:`${f.current/f.total*100}%`}})})]}),u&&e.jsxs("div",{style:Z.progressSection,children:[e.jsxs("div",{style:Z.progressText,children:["N8N Webhook: ",C.current," / ",C.total," - ",C.productName]}),e.jsx("div",{style:Z.progressBar,children:e.jsx("div",{style:{...Z.progressFill,backgroundColor:"#28a745",width:`${C.current/C.total*100}%`}})})]}),e.jsx("div",{style:Z.tableSection,children:l?e.jsx("div",{style:Z.loading,children:"NaÄÃ­tÃ¡m produkty..."}):e.jsxs("div",{style:Z.tableContainer,children:[e.jsxs("table",{style:Z.table,children:[e.jsx("thead",{children:e.jsxs("tr",{style:Z.tableHeaderRow,children:[e.jsx("th",{style:Z.tableHeaderCell,children:e.jsx("input",{type:"checkbox",checked:q.length>0&&q.every(x=>r.has(x.id)),onChange:se,style:Z.checkbox})}),e.jsx("th",{style:Z.tableHeaderCell,children:"KÃ³d"}),e.jsx("th",{style:Z.tableHeaderCell,children:"NÃ¡zev"}),e.jsx("th",{style:Z.tableHeaderCell,children:"Kategorie"}),e.jsx("th",{style:Z.tableHeaderCell,children:"Cena"}),e.jsx("th",{style:Z.tableHeaderCell,children:"Status"}),e.jsx("th",{style:Z.tableHeaderCell,children:"Embedding"})]})}),e.jsx("tbody",{children:q.map(x=>e.jsxs("tr",{style:Z.tableRow,children:[e.jsx("td",{style:Z.tableCell,children:e.jsx("input",{type:"checkbox",checked:r.has(x.id),onChange:()=>G(x.id),style:Z.checkbox})}),e.jsx("td",{style:Z.tableCell,children:e.jsx("div",{style:Z.productCode,children:x.product_code})}),e.jsxs("td",{style:Z.tableCell,children:[e.jsx("div",{style:Z.productName,children:x.name}),x.description&&e.jsxs("div",{style:Z.productDescription,children:[x.description.substring(0,100),"..."]})]}),e.jsx("td",{style:Z.tableCell,children:x.category||"-"}),e.jsx("td",{style:Z.tableCell,children:x.price?`${x.price} ${x.currency}`:"-"}),e.jsx("td",{style:Z.tableCell,children:M(x.embedding_status,x.has_embedding)}),e.jsx("td",{style:Z.tableCell,children:x.embedding_generated_at?new Date(x.embedding_generated_at).toLocaleDateString("cs-CZ"):"-"})]},x.id))})]}),q.length===0&&e.jsx("div",{style:Z.noResults,children:"Å½Ã¡dnÃ© produkty nenalezeny."})]})})]})})},Z={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",justifyContent:"center",alignItems:"flex-start",zIndex:1e3,padding:"20px",overflow:"auto"},modal:{backgroundColor:"white",borderRadius:"12px",width:"95%",maxWidth:"1200px",maxHeight:"90vh",overflow:"hidden",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.3)",display:"flex",flexDirection:"column"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",borderBottom:"1px solid #e0e0e0",backgroundColor:"#f8f9fa"},title:{margin:0,fontSize:"24px",fontWeight:"600",color:"#333"},closeButton:{background:"none",border:"none",cursor:"pointer",padding:"8px",borderRadius:"6px",color:"#666",transition:"all 0.2s"},statsSection:{padding:"16px 24px",borderBottom:"1px solid #e0e0e0"},statsGrid:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:"16px"},statCard:{textAlign:"center",padding:"12px",backgroundColor:"#f8f9fa",borderRadius:"8px"},statNumber:{fontSize:"20px",fontWeight:"bold",color:"#333"},statLabel:{fontSize:"12px",color:"#666",marginTop:"4px"},controlsSection:{padding:"16px 24px",borderBottom:"1px solid #e0e0e0",backgroundColor:"#f8f9fa"},controlsRow:{display:"flex",gap:"12px",alignItems:"center",marginBottom:"12px"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid #ddd",borderRadius:"6px",fontSize:"14px"},statusSelect:{padding:"8px 12px",border:"1px solid #ddd",borderRadius:"6px",fontSize:"14px",minWidth:"180px"},refreshButton:{padding:"8px",border:"1px solid #ddd",borderRadius:"6px",cursor:"pointer",backgroundColor:"white",color:"#666"},actionRow:{display:"flex",justifyContent:"space-between",alignItems:"center"},selectionInfo:{fontSize:"14px",color:"#666"},actionButtons:{display:"flex",gap:"8px"},selectAllButton:{padding:"8px 16px",border:"1px solid #007bff",borderRadius:"6px",cursor:"pointer",backgroundColor:"white",color:"#007bff",fontSize:"14px"},embeddingButton:{padding:"8px 16px",border:"none",borderRadius:"6px",cursor:"pointer",backgroundColor:"#007bff",color:"white",fontSize:"14px"},n8nButton:{padding:"8px 16px",border:"none",borderRadius:"6px",cursor:"pointer",backgroundColor:"#28a745",color:"white",fontSize:"14px",fontWeight:"500"},progressSection:{padding:"16px 24px",backgroundColor:"#f8f9fa",borderBottom:"1px solid #e0e0e0"},progressText:{fontSize:"14px",marginBottom:"8px",color:"#333"},progressBar:{width:"100%",height:"8px",backgroundColor:"#e9ecef",borderRadius:"4px",overflow:"hidden"},progressFill:{height:"100%",backgroundColor:"#007bff",transition:"width 0.3s ease"},tableSection:{flex:1,overflow:"auto"},loading:{textAlign:"center",padding:"40px",color:"#666"},tableContainer:{overflow:"auto",maxHeight:"100%"},table:{width:"100%",borderCollapse:"collapse",fontSize:"14px"},tableHeaderRow:{backgroundColor:"#f8f9fa",borderBottom:"2px solid #dee2e6"},tableHeaderCell:{padding:"12px 8px",textAlign:"left",fontWeight:"bold",color:"#333",borderBottom:"2px solid #dee2e6",position:"sticky",top:0,backgroundColor:"#f8f9fa",zIndex:10},tableRow:{borderBottom:"1px solid #e9ecef",transition:"background-color 0.2s"},tableCell:{padding:"12px 8px",verticalAlign:"top"},checkbox:{cursor:"pointer"},productCode:{fontFamily:"monospace",fontSize:"12px",color:"#666"},productName:{fontWeight:"bold",color:"#333",marginBottom:"4px"},productDescription:{fontSize:"12px",color:"#666",fontStyle:"italic"},statusBadge:{padding:"4px 8px",borderRadius:"4px",fontSize:"12px",fontWeight:"bold"},noResults:{textAlign:"center",padding:"40px",color:"666",fontStyle:"italic"},paginationRow:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"16px",paddingTop:"16px",borderTop:"1px solid #e0e0e0"},paginationInfo:{fontSize:"14px",color:"#666",fontWeight:"500"},paginationControls:{display:"flex",alignItems:"center",gap:"16px"},paginationLabel:{display:"flex",alignItems:"center",gap:"8px",fontSize:"14px",color:"#666"},paginationSelect:{padding:"6px 10px",border:"1px solid #ddd",borderRadius:"6px",fontSize:"14px",cursor:"pointer",backgroundColor:"white"},paginationButtons:{display:"flex",alignItems:"center",gap:"8px"},paginationButton:{padding:"6px 12px",border:"1px solid #ddd",borderRadius:"6px",cursor:"pointer",backgroundColor:"white",color:"#333",fontSize:"14px",fontWeight:"500",transition:"all 0.2s"},pageNumber:{fontSize:"14px",color:"#333",fontWeight:"500",padding:"0 8px"}},qn=({onClose:t})=>{const[o,n]=p.useState([]),[r,s]=p.useState(new Set),[l,a]=p.useState(!0),[c,g]=p.useState(!1),[u,m]=p.useState(!1),[b,d]=p.useState(""),[v,P]=p.useState("all"),[f,z]=p.useState({current:0,total:0,productName:""}),[C,T]=p.useState({current:0,total:0,productName:""}),[y,V]=p.useState(50),[F,S]=p.useState(1),R=p.useCallback(async()=>{a(!0),console.log("ğŸ” NaÄÃ­tÃ¡m produkty z product_feed_2 tabulky...");try{const{data:x,error:_}=await E.from("product_feed_2").select("id, product_code, product_name, description_short, description_long, category, price, currency, url, thumbnail, embedding_status, embedding_generated_at").order("product_name");if(console.log("ğŸ“Š Products Feed 2 response:",{productsData:x,productsError:_}),_){console.error("âŒ Chyba pÅ™i naÄÃ­tÃ¡nÃ­ produktÅ¯ Feed 2:",_),alert(`Chyba pÅ™i naÄÃ­tÃ¡nÃ­ produktÅ¯ Feed 2: ${_.message}`);return}const j=(x||[]).map(O=>({id:O.id,product_code:O.product_code,product_name:O.product_name,description_short:O.description_short,description_long:O.description_long,category:O.category,price:O.price,currency:O.currency,url:O.url,thumbnail:O.thumbnail,has_embedding:O.embedding_status==="completed",embedding_status:O.embedding_status||"none",embedding_generated_at:O.embedding_generated_at}));console.log(`âœ… NaÄteno ${j.length} produktÅ¯ z Feed 2`),n(j)}catch(x){console.error("âŒ Chyba pÅ™i naÄÃ­tÃ¡nÃ­ produktÅ¯ Feed 2:",x),alert(`Chyba pÅ™i naÄÃ­tÃ¡nÃ­ produktÅ¯ Feed 2: ${x}`)}finally{a(!1)}},[]);p.useEffect(()=>{R()},[R]);const J=o.filter(x=>{const _=x.product_name.toLowerCase().includes(b.toLowerCase())||x.description_short&&x.description_short.toLowerCase().includes(b.toLowerCase())||x.description_long&&x.description_long.toLowerCase().includes(b.toLowerCase())||x.category&&x.category.toLowerCase().includes(b.toLowerCase()),j=v==="all"||v==="no_embedding"&&!x.has_embedding||v==="has_embedding"&&x.has_embedding||x.embedding_status===v;return _&&j}),w=Math.ceil(J.length/y),U=(F-1)*y,ne=U+y,q=J.slice(U,ne);p.useEffect(()=>{S(1)},[b,v,y]);const I={total:o.length,no_embedding:o.filter(x=>!x.has_embedding).length,pending:o.filter(x=>x.embedding_status==="pending").length,completed:o.filter(x=>x.embedding_status==="completed").length,error:o.filter(x=>x.embedding_status==="error").length},se=()=>{const x=q.map(O=>O.id),_=x.every(O=>r.has(O)),j=new Set(r);_?x.forEach(O=>j.delete(O)):x.forEach(O=>j.add(O)),s(j)},G=x=>{const _=new Set(r);_.has(x)?_.delete(x):_.add(x),s(_)},oe=async()=>{const x=o.filter(j=>r.has(j.id));if(x.length===0){alert("Vyberte alespoÅˆ jeden produkt pro odeslÃ¡nÃ­ na N8N webhook.");return}m(!0),T({current:0,total:1,productName:"PÅ™Ã­prava dat..."});const _="https://n8n.srv980546.hstgr.cloud/webhook/3890ccdd-d09f-461b-b409-660d477023a3";try{console.log(`ğŸ“¤ OdesÃ­lÃ¡m ${x.length} produktÅ¯ Feed 2 na N8N webhook`);const j={products:x.map(Q=>({id:Q.id,product_code:Q.product_code,product_name:Q.product_name,description_short:Q.description_short,description_long:Q.description_long,category:Q.category,price:Q.price,currency:Q.currency,url:Q.url,thumbnail:Q.thumbnail,has_embedding:Q.has_embedding,embedding_status:Q.embedding_status,embedding_generated_at:Q.embedding_generated_at,feed_source:"feed_2",full_content:`${Q.product_name}
${Q.description_short||""}
${Q.description_long||""}
Kategorie: ${Q.category||""}
Cena: ${Q.price?`${Q.price} ${Q.currency}`:"Neuvedena"}
KÃ³d produktu: ${Q.product_code}`})),total_count:x.length,timestamp:new Date().toISOString(),batch_id:`feed2_batch_${Date.now()}`,feed_source:"feed_2"};T({current:1,total:2,productName:"OdesÃ­lÃ¡m data..."});const O=await fetch(_,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(j)});if(!O.ok)throw console.error("Chyba pÅ™i odesÃ­lÃ¡nÃ­ produktÅ¯ Feed 2:",O.status,O.statusText),new Error(`HTTP ${O.status}: ${O.statusText}`);T({current:2,total:2,productName:"ZpracovÃ¡vÃ¡m odpovÄ›Ä..."});let Y;try{Y=await O.json(),console.log("ğŸ“¥ OdpovÄ›Ä z N8N webhook Feed 2:",Y),console.log("ğŸ“¥ Response status:",O.status),console.log("ğŸ“¥ responseData.success:",Y.success),console.log("ğŸ“¥ responseData.status:",Y.status)}catch(Q){console.warn("âš ï¸ NepodaÅ™ilo se parsovat odpovÄ›Ä jako JSON:",Q),Y={success:!0,message:"OdpovÄ›Ä pÅ™ijata bez JSON formÃ¡tu"}}const te=O.status===200||O.ok||Y.success===!0||Y.status==="success";if(console.log("ğŸ” VyhodnocenÃ­ ÃºspÄ›chu:"),console.log("  - response.status:",O.status),console.log("  - response.ok:",O.ok),console.log("  - responseData.success:",Y.success),console.log("  - responseData.status:",Y.status),console.log("  - isSuccess:",te),te){console.log(`âœ… ÃšspÄ›Å¡nÄ› odeslÃ¡no ${x.length} produktÅ¯ Feed 2 na N8N webhook`),console.log("ğŸ”„ Aktualizuji embedding_status pro ÃºspÄ›Å¡nÄ› odeslanÃ© produkty...");const Q=x.map(we=>we.product_code);console.log("ğŸ“‹ Product codes k aktualizaci:",Q),console.log("ğŸ“Š PoÄet produktÅ¯ k aktualizaci:",Q.length);try{const{data:we,error:$e}=await E.from("product_feed_2").update({embedding_status:"completed",embedding_generated_at:new Date().toISOString()}).in("product_code",Q).select();$e?(console.error("âŒ Chyba pÅ™i aktualizaci embedding_status:",$e),alert(`âŒ Chyba pÅ™i aktualizaci statusu: ${$e.message}`)):(console.log("âœ… Status aktualizovÃ¡n v product_feed_2 tabulce"),console.log("âœ… PoÄet aktualizovanÃ½ch zÃ¡znamÅ¯:",(we==null?void 0:we.length)||0),console.log("âœ… AktualizovanÃ¡ data:",we))}catch(we){console.error("âŒ NeoÄekÃ¡vanÃ¡ chyba pÅ™i aktualizaci statusu:",we),alert(`âŒ NeoÄekÃ¡vanÃ¡ chyba: ${we}`)}await R(),s(new Set);let he=`âœ… ÃšspÄ›Å¡nÄ› odeslÃ¡no ${x.length} produktÅ¯ Feed 2 na N8N webhook`;Y.message&&(he+=`

ğŸ“‹ OdpovÄ›Ä webhoku: ${Y.message}`),Y.processed_count!==void 0&&(he+=`
ğŸ“Š ZpracovÃ¡no: ${Y.processed_count} produktÅ¯`),Y.batch_id&&(he+=`
ğŸ†” Batch ID: ${Y.batch_id}`),Y.processing_time&&(he+=`
â±ï¸ Doba zpracovÃ¡nÃ­: ${Y.processing_time}`),he+=`

âœ… Status aktualizovÃ¡n v databÃ¡zi`,alert(he)}else{console.error("âŒ Webhook Feed 2 vrÃ¡til chybu:",Y);let Q="âŒ Webhook Feed 2 vrÃ¡til chybu";(Y.message||Y.error)&&(Q+=`

ğŸ“‹ ChybovÃ¡ zprÃ¡va: ${Y.message||Y.error}`),Y.failed_count!==void 0&&(Q+=`
ğŸ“Š NeÃºspÄ›Å¡nÃ½ch: ${Y.failed_count} produktÅ¯`),Y.batch_id&&(Q+=`
ğŸ†” Batch ID: ${Y.batch_id}`),alert(Q);return}}catch(j){console.error("âŒ Chyba pÅ™i odesÃ­lÃ¡nÃ­ na N8N webhook Feed 2:",j),alert(`âŒ Chyba pÅ™i komunikaci s N8N webhook Feed 2:

${j}`)}finally{m(!1),T({current:0,total:0,productName:""})}},W=async()=>{const x=o.filter(_=>r.has(_.id));if(x.length===0){alert("Vyberte alespoÅˆ jeden produkt pro embedding.");return}g(!0),z({current:0,total:x.length,productName:""});try{for(let _=0;_<x.length;_++){const j=x[_];z({current:_+1,total:x.length,productName:j.product_name});try{console.log(`ğŸ”„ ZpracovÃ¡vÃ¡m produkt Feed 2: ${j.product_name}`);const{error:O}=await E.from("product_embeddings").upsert({product_code:j.product_code,product_name:j.product_name,description:null,description_short:j.description_short,description_long:j.description_long,category:j.category,price:j.price,product_url:j.url,image_url:j.thumbnail,currency:j.currency,feed_source:"feed_2",search_text:`${j.product_name} ${j.description_short||""} ${j.description_long||""} ${j.category||""}`.trim(),embedding_status:"processing",synced_from_products_at:new Date().toISOString(),updated_at:new Date().toISOString()},{onConflict:"product_code"});if(O){console.error("Chyba pÅ™i vklÃ¡dÃ¡nÃ­ do product_embeddings:",O);continue}const Y=`${j.product_name} ${j.description_short||""} ${j.description_long||""} ${j.category||""}`.trim();if(!Y){await E.from("product_embeddings").update({embedding_status:"error"}).eq("product_code",j.product_code);continue}const te=await At(Y);if(te.success&&te.embedding){const{error:Q}=await E.from("product_embeddings").update({embedding:`[${te.embedding.join(",")}]`,embedding_status:"completed",embedding_generated_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("product_code",j.product_code);Q?(console.error("Chyba pÅ™i uklÃ¡dÃ¡nÃ­ embeddingu:",Q),await E.from("product_embeddings").update({embedding_status:"error"}).eq("product_code",j.product_code)):console.log(`âœ… Embedding Feed 2 ÃºspÄ›Å¡nÄ› uloÅ¾en pro: ${j.product_name}`)}else await E.from("product_embeddings").update({embedding_status:"error"}).eq("product_code",j.product_code);await new Promise(Q=>setTimeout(Q,200))}catch(O){console.error(`Chyba pÅ™i zpracovÃ¡nÃ­ produktu Feed 2 ${j.product_name}:`,O),await E.from("product_embeddings").update({embedding_status:"error"}).eq("product_code",j.product_code)}}s(new Set),await R()}catch(_){console.error("Chyba pÅ™i zpracovÃ¡nÃ­ embeddingÅ¯ Feed 2:",_)}finally{g(!1),z({current:0,total:0,productName:""})}},re=()=>e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),N=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"23 4 23 10 17 10"}),e.jsx("path",{d:"m3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]}),M=(x,_)=>{if(!_)return e.jsx("span",{style:{...K.statusBadge,backgroundColor:"#f8f9fa",color:"#6c757d",border:"1px solid #dee2e6"},children:"Bez embeddingu"});const j={pending:{backgroundColor:"#fff3cd",color:"#856404",border:"1px solid #ffeaa7"},processing:{backgroundColor:"#cce5ff",color:"#004085",border:"1px solid #74b9ff"},completed:{backgroundColor:"#d1edff",color:"#155724",border:"1px solid #74b9ff"},error:{backgroundColor:"#f8d7da",color:"#721c24",border:"1px solid #fd79a8"}},O={pending:"ÄŒekÃ¡",processing:"ZpracovÃ¡vÃ¡ se",completed:"DokonÄeno",error:"Chyba"};return e.jsx("span",{style:{...K.statusBadge,...j[x]},children:O[x]||x})};return e.jsx("div",{style:K.overlay,children:e.jsxs("div",{style:K.modal,children:[e.jsxs("div",{style:K.header,children:[e.jsx("h2",{style:K.title,children:"ProduktovÃ½ Feed 2 - Embeddingy"}),e.jsx("button",{style:K.closeButton,onClick:t,children:e.jsx(re,{})})]}),e.jsx("div",{style:K.statsSection,children:e.jsxs("div",{style:K.statsGrid,children:[e.jsxs("div",{style:K.statCard,children:[e.jsx("div",{style:K.statNumber,children:I.total}),e.jsx("div",{style:K.statLabel,children:"Celkem"})]}),e.jsxs("div",{style:K.statCard,children:[e.jsx("div",{style:K.statNumber,children:I.no_embedding}),e.jsx("div",{style:K.statLabel,children:"Bez embeddingu"})]}),e.jsxs("div",{style:K.statCard,children:[e.jsx("div",{style:K.statNumber,children:I.pending}),e.jsx("div",{style:K.statLabel,children:"ÄŒekÃ¡"})]}),e.jsxs("div",{style:K.statCard,children:[e.jsx("div",{style:K.statNumber,children:I.completed}),e.jsx("div",{style:K.statLabel,children:"Hotovo"})]}),e.jsxs("div",{style:K.statCard,children:[e.jsx("div",{style:K.statNumber,children:I.error}),e.jsx("div",{style:K.statLabel,children:"Chyby"})]})]})}),e.jsxs("div",{style:K.controlsSection,children:[e.jsxs("div",{style:K.controlsRow,children:[e.jsx("input",{type:"text",placeholder:"Vyhledat produkty...",value:b,onChange:x=>d(x.target.value),style:K.searchInput}),e.jsxs("select",{value:v,onChange:x=>P(x.target.value),style:K.statusSelect,children:[e.jsx("option",{value:"all",children:"VÅ¡echny statusy"}),e.jsx("option",{value:"no_embedding",children:"Bez embeddingu"}),e.jsx("option",{value:"pending",children:"ÄŒekÃ¡"}),e.jsx("option",{value:"processing",children:"ZpracovÃ¡vÃ¡ se"}),e.jsx("option",{value:"completed",children:"DokonÄeno"}),e.jsx("option",{value:"error",children:"Chyba"})]}),e.jsx("button",{style:K.refreshButton,onClick:R,children:e.jsx(N,{})})]}),e.jsxs("div",{style:K.actionRow,children:[e.jsxs("div",{style:K.selectionInfo,children:["VybrÃ¡no: ",r.size," z ",J.length]}),e.jsxs("div",{style:K.actionButtons,children:[e.jsx("button",{style:K.selectAllButton,onClick:se,children:q.length>0&&q.every(x=>r.has(x.id))?"ZruÅ¡it vÃ½bÄ›r strÃ¡nky":"Vybrat strÃ¡nku"}),e.jsx("button",{style:K.embeddingButton,onClick:W,disabled:r.size===0||c||u,children:c?"ZpracovÃ¡vÃ¡ se...":`Spustit Embedding (${r.size})`}),e.jsx("button",{style:K.n8nButton,onClick:oe,disabled:r.size===0||c||u,children:u?"OdesÃ­lÃ¡ se...":`N8N Embedding (${r.size})`})]})]}),e.jsxs("div",{style:K.paginationRow,children:[e.jsxs("div",{style:K.paginationInfo,children:["Zobrazeno: ",U+1," - ",Math.min(ne,J.length)," z ",J.length]}),e.jsxs("div",{style:K.paginationControls,children:[e.jsxs("label",{style:K.paginationLabel,children:["ZÃ¡znamÅ¯ na strÃ¡nku:",e.jsxs("select",{value:y,onChange:x=>V(Number(x.target.value)),style:K.paginationSelect,children:[e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"}),e.jsx("option",{value:500,children:"500"}),e.jsx("option",{value:1e3,children:"1000"})]})]}),e.jsxs("div",{style:K.paginationButtons,children:[e.jsx("button",{style:{...K.paginationButton,opacity:F===1?.5:1},onClick:()=>S(1),disabled:F===1,children:"<<"}),e.jsx("button",{style:{...K.paginationButton,opacity:F===1?.5:1},onClick:()=>S(x=>Math.max(1,x-1)),disabled:F===1,children:"<"}),e.jsxs("span",{style:K.pageNumber,children:["StrÃ¡nka ",F," z ",w||1]}),e.jsx("button",{style:{...K.paginationButton,opacity:F===w?.5:1},onClick:()=>S(x=>Math.min(w,x+1)),disabled:F===w,children:">"}),e.jsx("button",{style:{...K.paginationButton,opacity:F===w?.5:1},onClick:()=>S(w),disabled:F===w,children:">>"})]})]})]})]}),c&&e.jsxs("div",{style:K.progressSection,children:[e.jsxs("div",{style:K.progressText,children:["Embedding: ",f.current," / ",f.total," - ",f.productName]}),e.jsx("div",{style:K.progressBar,children:e.jsx("div",{style:{...K.progressFill,width:`${f.current/f.total*100}%`}})})]}),u&&e.jsxs("div",{style:K.progressSection,children:[e.jsxs("div",{style:K.progressText,children:["N8N Webhook Feed 2: ",C.current," / ",C.total," - ",C.productName]}),e.jsx("div",{style:K.progressBar,children:e.jsx("div",{style:{...K.progressFill,backgroundColor:"#28a745",width:`${C.current/C.total*100}%`}})})]}),e.jsx("div",{style:K.tableSection,children:l?e.jsx("div",{style:K.loading,children:"NaÄÃ­tÃ¡m produkty Feed 2..."}):e.jsxs("div",{style:K.tableContainer,children:[e.jsxs("table",{style:K.table,children:[e.jsx("thead",{children:e.jsxs("tr",{style:K.tableHeaderRow,children:[e.jsx("th",{style:K.tableHeaderCell,children:e.jsx("input",{type:"checkbox",checked:q.length>0&&q.every(x=>r.has(x.id)),onChange:se,style:K.checkbox})}),e.jsx("th",{style:K.tableHeaderCell,children:"KÃ³d"}),e.jsx("th",{style:K.tableHeaderCell,children:"NÃ¡zev"}),e.jsx("th",{style:K.tableHeaderCell,children:"Kategorie"}),e.jsx("th",{style:K.tableHeaderCell,children:"Cena"}),e.jsx("th",{style:K.tableHeaderCell,children:"Status"}),e.jsx("th",{style:K.tableHeaderCell,children:"Embedding"})]})}),e.jsx("tbody",{children:q.map(x=>e.jsxs("tr",{style:K.tableRow,children:[e.jsx("td",{style:K.tableCell,children:e.jsx("input",{type:"checkbox",checked:r.has(x.id),onChange:()=>G(x.id),style:K.checkbox})}),e.jsx("td",{style:K.tableCell,children:e.jsx("div",{style:K.productCode,children:x.product_code})}),e.jsxs("td",{style:K.tableCell,children:[e.jsx("div",{style:K.productName,children:x.product_name}),x.description_short&&e.jsxs("div",{style:K.productDescription,children:[x.description_short.substring(0,100),"..."]})]}),e.jsx("td",{style:K.tableCell,children:x.category||"-"}),e.jsx("td",{style:K.tableCell,children:x.price?`${x.price} ${x.currency}`:"-"}),e.jsx("td",{style:K.tableCell,children:M(x.embedding_status,x.has_embedding)}),e.jsx("td",{style:K.tableCell,children:x.embedding_generated_at?new Date(x.embedding_generated_at).toLocaleDateString("cs-CZ"):"-"})]},x.id))})]}),q.length===0&&e.jsx("div",{style:K.noResults,children:"Å½Ã¡dnÃ© produkty Feed 2 nenalezeny."})]})})]})})},K={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",justifyContent:"center",alignItems:"flex-start",zIndex:1e3,padding:"20px",overflow:"auto"},modal:{backgroundColor:"white",borderRadius:"12px",width:"95%",maxWidth:"1200px",maxHeight:"90vh",overflow:"hidden",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.3)",display:"flex",flexDirection:"column"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",borderBottom:"1px solid #e0e0e0",backgroundColor:"#f8f9fa"},title:{margin:0,fontSize:"24px",fontWeight:"600",color:"#333"},closeButton:{background:"none",border:"none",cursor:"pointer",padding:"8px",borderRadius:"6px",color:"#666",transition:"all 0.2s"},statsSection:{padding:"16px 24px",borderBottom:"1px solid #e0e0e0"},statsGrid:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:"16px"},statCard:{textAlign:"center",padding:"12px",backgroundColor:"#f8f9fa",borderRadius:"8px"},statNumber:{fontSize:"20px",fontWeight:"bold",color:"#333"},statLabel:{fontSize:"12px",color:"#666",marginTop:"4px"},controlsSection:{padding:"16px 24px",borderBottom:"1px solid #e0e0e0",backgroundColor:"#f8f9fa"},controlsRow:{display:"flex",gap:"12px",alignItems:"center",marginBottom:"12px"},searchInput:{flex:1,padding:"8px 12px",border:"1px solid #ddd",borderRadius:"6px",fontSize:"14px"},statusSelect:{padding:"8px 12px",border:"1px solid #ddd",borderRadius:"6px",fontSize:"14px",minWidth:"180px"},refreshButton:{padding:"8px",border:"1px solid #ddd",borderRadius:"6px",cursor:"pointer",backgroundColor:"white",color:"#666"},actionRow:{display:"flex",justifyContent:"space-between",alignItems:"center"},selectionInfo:{fontSize:"14px",color:"#666"},actionButtons:{display:"flex",gap:"8px"},selectAllButton:{padding:"8px 16px",border:"1px solid #007bff",borderRadius:"6px",cursor:"pointer",backgroundColor:"white",color:"#007bff",fontSize:"14px"},embeddingButton:{padding:"8px 16px",border:"none",borderRadius:"6px",cursor:"pointer",backgroundColor:"#007bff",color:"white",fontSize:"14px"},n8nButton:{padding:"8px 16px",border:"none",borderRadius:"6px",cursor:"pointer",backgroundColor:"#28a745",color:"white",fontSize:"14px",fontWeight:"500"},progressSection:{padding:"16px 24px",backgroundColor:"#f8f9fa",borderBottom:"1px solid #e0e0e0"},progressText:{fontSize:"14px",marginBottom:"8px",color:"#333"},progressBar:{width:"100%",height:"8px",backgroundColor:"#e9ecef",borderRadius:"4px",overflow:"hidden"},progressFill:{height:"100%",backgroundColor:"#007bff",transition:"width 0.3s ease"},tableSection:{flex:1,overflow:"auto"},loading:{textAlign:"center",padding:"40px",color:"#666"},tableContainer:{overflow:"auto",maxHeight:"100%"},table:{width:"100%",borderCollapse:"collapse",fontSize:"14px"},tableHeaderRow:{backgroundColor:"#f8f9fa",borderBottom:"2px solid #dee2e6"},tableHeaderCell:{padding:"12px 8px",textAlign:"left",fontWeight:"bold",color:"#333",borderBottom:"2px solid #dee2e6",position:"sticky",top:0,backgroundColor:"#f8f9fa",zIndex:10},tableRow:{borderBottom:"1px solid #e9ecef",transition:"background-color 0.2s"},tableCell:{padding:"12px 8px",verticalAlign:"top"},checkbox:{cursor:"pointer"},productCode:{fontFamily:"monospace",fontSize:"12px",color:"#666"},productName:{fontWeight:"bold",color:"#333",marginBottom:"4px"},productDescription:{fontSize:"12px",color:"#666",fontStyle:"italic"},statusBadge:{padding:"4px 8px",borderRadius:"4px",fontSize:"12px",fontWeight:"bold"},noResults:{textAlign:"center",padding:"40px",color:"#666",fontStyle:"italic"},paginationRow:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"16px",paddingTop:"16px",borderTop:"1px solid #e0e0e0"},paginationInfo:{fontSize:"14px",color:"#666",fontWeight:"500"},paginationControls:{display:"flex",alignItems:"center",gap:"16px"},paginationLabel:{display:"flex",alignItems:"center",gap:"8px",fontSize:"14px",color:"#666"},paginationSelect:{padding:"6px 10px",border:"1px solid #ddd",borderRadius:"6px",fontSize:"14px",cursor:"pointer",backgroundColor:"white"},paginationButtons:{display:"flex",alignItems:"center",gap:"8px"},paginationButton:{padding:"6px 12px",border:"1px solid #ddd",borderRadius:"6px",cursor:"pointer",backgroundColor:"white",color:"#333",fontSize:"14px",fontWeight:"500",transition:"all 0.2s"},pageNumber:{fontSize:"14px",color:"#333",fontWeight:"500",padding:"0 8px"}},Xn="https://n8n.srv980546.hstgr.cloud/webhook/cd6b668b-1e35-4018-9bf4-28d0926b023b";async function Qn(t,o){try{const n=await fetch(Xn,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chatInput:t,session_id:o,timestamp:new Date().toISOString()})});if(!n.ok){const l=await n.text();throw console.error("âŒ N8N webhook error:",n.status,l),new Error(`N8N webhook failed: ${n.status} ${n.statusText}`)}let r=await n.json(),s=null;if(Array.isArray(r)&&r.length>0&&r[0].data)s=r[0].data;else if(r.data&&Array.isArray(r.data))s=r.data;else if(r.text&&Array.isArray(r.products))return r;if(s&&Array.isArray(s)){const l=s.map(a=>({product_code:a["ID produktu"]||a.product_code,recommendation:a.Doporuceni||a.recommendation}));r={text:`NaÅ¡el jsem pro vÃ¡s ${l.length} doporuÄenÃ½ch produktÅ¯:`,products:l}}if(!r.text||!Array.isArray(r.products))throw console.error("âŒ Invalid N8N response format po konverzi:",JSON.stringify(r,null,2)),new Error("Invalid response format from N8N webhook - nelze konvertovat na standardnÃ­ formÃ¡t");return r}catch(n){throw console.error("âŒ Chyba pÅ™i volÃ¡nÃ­ N8N webhooku:",n),n}}async function er(t){try{if(t.length===0)return[];const o=t.map(l=>l.product_code),{data:n,error:r}=await E.from("product_feed_2").select("product_code, product_name, description_short, url, thumbnail, price, currency, availability").in("product_code",o);if(r)throw console.error("âŒ Chyba pÅ™i naÄÃ­tÃ¡nÃ­ metadat z product_feed_2:",r),r;return!n||n.length===0?(console.warn("âš ï¸ Å½Ã¡dnÃ¡ metadata nenalezena pro produkty:",o),t.map(l=>({product_code:l.product_code,product_name:"Produkt "+l.product_code,recommendation:l.recommendation,description:"",url:"",image_url:"",price:0,currency:"CZK",availability:0}))):t.map(l=>{const a=n.find(c=>c.product_code===l.product_code);return{product_code:l.product_code,product_name:(a==null?void 0:a.product_name)||"Produkt "+l.product_code,recommendation:l.recommendation,description:(a==null?void 0:a.description_short)||"",url:(a==null?void 0:a.url)||"",image_url:(a==null?void 0:a.thumbnail)||"",price:(a==null?void 0:a.price)||0,currency:(a==null?void 0:a.currency)||"CZK",availability:(a==null?void 0:a.availability)||0}})}catch(o){throw console.error("âŒ Chyba pÅ™i obohacovÃ¡nÃ­ produktÅ¯:",o),o}}async function tr(t,o){try{const n=await Qn(t,o),r=await er(n.products);return{text:n.text,products:r}}catch(n){return console.error("âŒ KritickÃ¡ chyba pÅ™i zÃ­skÃ¡vÃ¡nÃ­ produktovÃ½ch doporuÄenÃ­:",n),{text:"âŒ OmlouvÃ¡me se, doÅ¡lo k chybÄ› pÅ™i zpracovÃ¡nÃ­ vaÅ¡eho dotazu. Zkuste to prosÃ­m znovu.",products:[]}}}const or=()=>"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx".replace(/[x]/g,()=>(Math.random()*16|0).toString(16)),nr=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("line",{x1:"22",y1:"2",x2:"11",y2:"13"}),e.jsx("polygon",{points:"22 2 15 22 11 13 2 9 22 2"})]}),rr=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),go=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("path",{d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"}),e.jsx("path",{d:"M12 2C6.477 2 2 6.477 2 12h10c5.523 0 10-4.477 10-10C17.523 2 12 2 12 2z"})]}),sr=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...t,children:[e.jsx("path",{d:"M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"}),e.jsx("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),e.jsx("path",{d:"M16 10a4 4 0 0 1-8 0"})]}),ar=({onClose:t})=>{const[o,n]=p.useState([]),[r,s]=p.useState(""),[l,a]=p.useState(!1),[c]=p.useState(()=>or()),g=p.useRef(null),u=p.useRef(null);p.useEffect(()=>{var d;(d=g.current)==null||d.scrollIntoView({behavior:"smooth"})},[o]),p.useEffect(()=>{var d;(d=u.current)==null||d.focus()},[]);const m=p.useCallback(async()=>{if(!r.trim()||l)return;const d=r.trim();s("");const v={id:Date.now().toString(),role:"user",text:d};n(P=>[...P,v]),a(!0);try{const{text:P,products:f}=await tr(d,c),z={id:(Date.now()+1).toString(),role:"bot",text:P,products:f.length>0?f:void 0};n(C=>[...C,z])}catch(P){console.error("âŒ Chyba v Product Chat:",P);const f={id:(Date.now()+1).toString(),role:"bot",text:"âŒ OmlouvÃ¡me se, doÅ¡lo k chybÄ› pÅ™i zpracovÃ¡nÃ­ vaÅ¡eho dotazu. Zkuste to prosÃ­m znovu."};n(z=>[...z,f])}finally{a(!1)}},[r,l,c]),b=d=>{d.key==="Enter"&&!d.shiftKey&&(d.preventDefault(),m())};return e.jsxs("div",{className:"flex flex-col h-full bg-bewit-gray",children:[e.jsx(It,{onClose:t,buttons:[]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[o.length===0&&e.jsxs("div",{className:"text-center text-slate-500 flex flex-col items-center justify-center min-h-96",children:[e.jsx(sr,{className:"h-16 w-16 text-bewit-blue opacity-20 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-bewit-blue mb-2",children:"VÃ­tejte v Product Chat!"}),e.jsx("p",{children:"Zeptejte se na produkty BEWIT a dostanete personalizovanÃ¡ doporuÄenÃ­."}),e.jsx("p",{className:"text-sm mt-2",children:'NapÅ™Ã­klad: "Wany na bolest nohy" nebo "Produkty pro lepÅ¡Ã­ spÃ¡nek"'})]}),o.map(d=>e.jsxs("div",{className:`flex items-start gap-3 ${d.role==="user"?"justify-end":"justify-start"}`,children:[d.role==="bot"&&e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-bewit-blue flex items-center justify-center text-white",children:e.jsx(go,{className:"w-5 h-5"})}),e.jsxs("div",{className:`flex flex-col ${d.role==="user"?"items-end":"items-start"} max-w-3xl`,children:[e.jsx("div",{className:`px-4 py-3 rounded-2xl ${d.role==="user"?"bg-bewit-blue text-white rounded-br-none":"bg-white text-bewit-dark border border-slate-200 rounded-bl-none shadow-sm"}`,children:e.jsx("div",{className:"whitespace-pre-wrap",children:d.text})}),d.products&&d.products.length>0&&e.jsx("div",{className:"mt-4 w-full",children:e.jsx(zo,{products:d.products.slice(0,6).map(v=>({id:v.product_code,title:v.product_name,product_code:v.product_code,product_name:v.product_name,description:v.recommendation,product_url:v.url,image_url:v.image_url,price:v.price,currency:v.currency})),title:"DoporuÄenÃ© produkty",showSimilarity:!1})})]}),d.role==="user"&&e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-slate-300 flex items-center justify-center text-slate-600",children:e.jsx(rr,{className:"w-5 h-5"})})]},d.id)),l&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-bewit-blue flex items-center justify-center text-white",children:e.jsx(go,{className:"w-5 h-5"})}),e.jsx("div",{className:"px-4 py-3 rounded-2xl bg-white border border-slate-200 rounded-bl-none shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(So,{}),e.jsx(_o,{changeInterval:7e3})]})})]}),e.jsx("div",{ref:g})]}),e.jsx("div",{className:"border-t border-slate-200 p-4 bg-white",children:e.jsxs("div",{className:"flex items-center bg-white border border-slate-300 rounded-xl shadow-sm focus-within:ring-2 focus-within:ring-bewit-blue transition-shadow duration-200 p-3",children:[e.jsx("textarea",{ref:u,value:r,onChange:d=>s(d.target.value),onKeyPress:b,placeholder:"Zeptejte se na produkty BEWIT...",className:"w-full flex-1 px-2 py-2 bg-transparent resize-none focus:outline-none text-bewit-dark placeholder-slate-400 leading-5",rows:1,style:{maxHeight:"120px",minHeight:"40px"},disabled:l}),e.jsx("button",{type:"button",onClick:m,disabled:l||!r.trim(),className:"ml-3 flex-shrink-0 w-10 h-10 rounded-lg bg-bewit-blue text-white flex items-center justify-center transition-colors duration-200 disabled:bg-slate-300 disabled:cursor-not-allowed hover:bg-blue-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-bewit-blue","aria-label":"Odeslat zprÃ¡vu",children:l?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(nr,{className:"w-5 h-5"})})]})})]})},fo=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10z"}),e.jsx("circle",{cx:"9",cy:"10",r:"1"}),e.jsx("circle",{cx:"15",cy:"10",r:"1"})]}),Pt=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M20 7h-9"}),e.jsx("path",{d:"M14 17H5"}),e.jsx("circle",{cx:"17",cy:"17",r:"3"}),e.jsx("circle",{cx:"7",cy:"7",r:"3"})]}),lr=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"3"}),e.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]}),ir=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),cr=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20"}),e.jsx("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"})]}),mo=()=>e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})}),dr=()=>e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})}),ur=({onClose:t,onOpenChat:o})=>{const[n,r]=p.useState("chatbots"),[s,l]=p.useState([]),[a,c]=p.useState([]),[g,u]=p.useState([]),[m,b]=p.useState(!0),[d,v]=p.useState(null),[P,f]=p.useState(null),[z,C]=p.useState(new Set),[T,y]=p.useState({}),[V,F]=p.useState([{id:"sana_medbase",name:"Sana MedBase",description:"AI asistent pro sprÃ¡vu a vyhledÃ¡vÃ¡nÃ­ v knihovnÄ› lÃ©kaÅ™skÃ© literatury",url:"https://bewit.love/sana-chat",features:{product_recommendations:!1,product_button_recommendations:!1,book_database:!0}},{id:"sana_kancelar",name:"Sana KancelÃ¡Å™",description:"AI asistent pro internÃ­ firemnÃ­ dokumenty a procesy",url:"https://bewit.love/sana-kancelar",features:{product_recommendations:!1,product_button_recommendations:!1,book_database:!1}}]),[S,R]=p.useState(!1),[J,w]=p.useState(!1),[U,ne]=p.useState(!1);p.useEffect(()=>{(async()=>{try{b(!0),v(null),console.log("ğŸ”„ NaÄÃ­tÃ¡m data chatbotÅ¯ z databÃ¡ze..."),console.log("ğŸ“‹ Tabulka chatbot_settings existuje v databÃ¡zi");const[M,x,_]=await Promise.all([We.getAllChatbotSettings(),We.getCategories(),We.getPublicationTypes()]);if(console.log("ğŸ“Š NaÄtenÃ¡ data:",{settings:M.length,categories:x.length,publicationTypes:_.length}),M.length===0){v("V databÃ¡zi nejsou Å¾Ã¡dnÃ© chatboti. SpusÅ¥te SQL script create_chatbot_settings_table.sql pro vytvoÅ™enÃ­ vÃ½chozÃ­ch chatbotÅ¯.");return}console.log("ğŸ¤– ExistujÃ­cÃ­ chatboti v databÃ¡zi:"),M.forEach(j=>{console.log(`- ID: "${j.chatbot_id}", NÃ¡zev: "${j.chatbot_name}"`),console.log(`  ğŸ¯ enable_product_router: ${j.enable_product_router}, enable_manual_funnel: ${j.enable_manual_funnel}`)}),l(M),c(x),u(_)}catch(M){console.error("âŒ Chyba pÅ™i naÄÃ­tÃ¡nÃ­ dat chatbotÅ¯:",M),v(`NepodaÅ™ilo se naÄÃ­st data chatbotÅ¯ z databÃ¡ze: ${M instanceof Error?M.message:"NeznÃ¡mÃ¡ chyba"}`)}finally{b(!1)}})()},[]);const q=(N,M)=>{l(x=>x.map(_=>_.chatbot_id===N?{..._,...M}:_)),C(x=>new Set(x).add(N)),y(x=>({...x,[N]:{...x[N],...M}}))},I=(N,M)=>{const x=s.find(j=>j.chatbot_id===N);if(!x)return;const _=x.allowed_categories.includes(M)?x.allowed_categories.filter(j=>j!==M):[...x.allowed_categories,M];q(N,{allowed_categories:_})},se=(N,M)=>{const x=s.find(j=>j.chatbot_id===N);if(!x)return;const _=x.allowed_publication_types.includes(M)?x.allowed_publication_types.filter(j=>j!==M):[...x.allowed_publication_types,M];q(N,{allowed_publication_types:_})},G=(N,M)=>{const x=s.find(O=>O.chatbot_id===N);if(!x)return;const _=!x[M];let j={[M]:_};M==="book_database"&&!_&&(console.log("ğŸ“š VypÃ­nÃ¡m databÃ¡zi knih - resetuji takÃ© vÅ¡echny filtrace"),j={...j,allowed_categories:[],allowed_publication_types:[]}),M==="is_default_web_chatbot"&&_&&(console.log("ğŸŒ Nastavuji jako vÃ½chozÃ­ webovÃ½ chatbot - ruÅ¡Ã­m oznaÄenÃ­ u ostatnÃ­ch"),s.forEach(O=>{O.chatbot_id!==N&&O.is_default_web_chatbot&&q(O.chatbot_id,{is_default_web_chatbot:!1})})),q(N,j)},oe=async N=>{const M=T[N];if(M)try{f(N),v(null),console.log(`ğŸ’¾ UklÃ¡dÃ¡m nastavenÃ­ pro chatbota ${N}:`,M);const x=await We.updateChatbotSettings(N,M);l(_=>_.map(j=>j.chatbot_id===N?x:j)),C(_=>{const j=new Set(_);return j.delete(N),j}),y(_=>{const j={..._};return delete j[N],j}),console.log("âœ… NastavenÃ­ ÃºspÄ›Å¡nÄ› uloÅ¾eno"),alert("âœ… NastavenÃ­ chatbota bylo ÃºspÄ›Å¡nÄ› uloÅ¾eno!")}catch(x){console.error("âŒ Chyba pÅ™i uklÃ¡dÃ¡nÃ­ nastavenÃ­:",x);const _=x instanceof Error?x.message:"NepodaÅ™ilo se uloÅ¾it nastavenÃ­ chatbota";v(`Chyba pÅ™i uklÃ¡dÃ¡nÃ­ nastavenÃ­ chatbota "${N}": ${_}`),alert(`âŒ ${_}`)}finally{f(null)}},W=async N=>{try{const M=await We.getChatbotSettings(N);if(!M)return;l(x=>x.map(_=>_.chatbot_id===N?M:_)),C(x=>{const _=new Set(x);return _.delete(N),_}),y(x=>{const _={...x};return delete _[N],_}),console.log("ğŸ”„ NastavenÃ­ resetovÃ¡no na pÅ¯vodnÃ­ hodnoty")}catch(M){console.error("âŒ Chyba pÅ™i resetovÃ¡nÃ­ nastavenÃ­:",M),v("NepodaÅ™ilo se resetovat nastavenÃ­ chatbota")}},re=N=>{console.log(`ğŸš€ SpouÅ¡tÃ­m chat "${N.name}" s nastavenÃ­m:`,N.features);const M=[];N.features.product_recommendations&&M.push("ProduktovÃ¡ doporuÄenÃ­"),N.features.product_button_recommendations&&M.push("ProduktovÃ© doporuÄenÃ­ na tlaÄÃ­tko"),N.features.book_database&&M.push("DatabÃ¡ze knih");const x=M.length>0?M.join(" + "):"Å½Ã¡dnÃ© funkce nejsou povoleny";console.log(`ğŸ’¬ OtevÃ­rÃ¡m chat s nastavenÃ­m: ${x}`),t(),o?o(N.id,N.features):alert(`ğŸ¤– ${N.name}

âœ… AktivnÃ­ funkce: ${x}

âš ï¸ PoznÃ¡mka: NastavenÃ­ se zatÃ­m neuklÃ¡dajÃ­ a po obnovenÃ­ strÃ¡nky se resetujÃ­.`)};return e.jsx("div",{style:L.overlay,children:e.jsxs("div",{style:L.modal,children:[e.jsxs("div",{style:L.header,children:[e.jsx("h2",{style:L.title,children:"ğŸ¤– SprÃ¡va chatbotÅ¯"}),e.jsx("button",{style:L.closeButton,onClick:t,children:e.jsx(ir,{})})]}),e.jsxs("div",{style:L.tabs,children:[e.jsxs("button",{style:{...L.tabButton,...n==="chatbots"&&L.tabButtonActive},onClick:()=>r("chatbots"),children:[e.jsx(fo,{}),"Chatboty"]}),e.jsxs("button",{style:{...L.tabButton,...n==="product_feed"&&L.tabButtonActive},onClick:()=>r("product_feed"),children:[e.jsx(Pt,{}),"ProduktovÃ½ feed"]}),e.jsxs("button",{style:{...L.tabButton,...n==="settings"&&L.tabButtonActive},onClick:()=>r("settings"),children:[e.jsx(lr,{}),"NastavenÃ­"]})]}),e.jsxs("div",{style:L.content,children:[n==="chatbots"&&e.jsxs("div",{style:L.tabContent,children:[e.jsx("h3",{style:L.sectionTitle,children:"Konfigurace chatbotÅ¯"}),e.jsx("p",{style:L.sectionDescription,children:"Nastavte funkce a filtrace pro jednotlivÃ© chatboty. VÅ¡echna nastavenÃ­ se automaticky uklÃ¡dajÃ­ do databÃ¡ze."}),d&&e.jsxs("div",{style:L.errorMessage,children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"8px"},children:"âŒ Chyba"}),e.jsx("div",{style:{marginBottom:"8px"},children:d}),d.includes("nebyl nalezen v databÃ¡zi")&&e.jsxs("div",{style:L.errorHint,children:[e.jsx("strong",{children:"ğŸ’¡ Å˜eÅ¡enÃ­:"}),e.jsxs("ol",{style:{margin:"8px 0",paddingLeft:"20px"},children:[e.jsx("li",{children:"OtevÅ™ete Supabase SQL Editor"}),e.jsxs("li",{children:["SpusÅ¥te script ",e.jsx("code",{children:"fix_chatbot_settings.sql"})]}),e.jsx("li",{children:"Obnovte tuto strÃ¡nku"})]})]})]}),m?e.jsx("div",{style:L.loadingMessage,children:"ğŸ”„ NaÄÃ­tÃ¡m nastavenÃ­ chatbotÅ¯..."}):e.jsxs("div",{style:L.chatbotGrid,children:[s.map(N=>e.jsxs("div",{style:L.chatbotCard,children:[e.jsxs("div",{style:L.chatbotHeader,children:[e.jsxs("div",{style:L.chatbotIconName,children:[e.jsx(fo,{}),e.jsx("h3",{style:L.chatbotName,children:N.chatbot_name}),P===N.chatbot_id&&e.jsx("span",{style:L.savingIndicator,children:"ğŸ’¾ UklÃ¡dÃ¡m..."}),z.has(N.chatbot_id)&&e.jsx("span",{style:L.unsavedIndicator,children:"â— NeuloÅ¾enÃ© zmÄ›ny"})]}),e.jsx("div",{style:{...L.statusBadge,backgroundColor:N.is_active?"#28a745":"#dc3545"},children:N.is_active?"AktivnÃ­":"NeaktivnÃ­"})]}),e.jsx("p",{style:L.chatbotDescription,children:N.description||"Bez popisu"}),e.jsxs("div",{style:L.chatbotId,children:["ID: ",N.chatbot_id]}),e.jsxs("div",{style:L.chatbotSettings,children:[e.jsx("h4",{style:L.sectionSubtitle,children:"ğŸ”§ ZÃ¡kladnÃ­ funkce"}),e.jsxs("div",{style:L.settingRow,children:[e.jsxs("label",{style:L.settingLabel,children:[e.jsx("input",{type:"checkbox",checked:N.product_recommendations||!1,onChange:()=>G(N.chatbot_id,"product_recommendations"),style:L.checkbox}),e.jsx(Pt,{}),"ProduktovÃ¡ doporuÄenÃ­"]}),e.jsx("div",{style:L.settingDescription,children:"Zobrazovat relevantnÃ­ produkty na zÃ¡kladÄ› uÅ¾ivatelskÃ½ch dotazÅ¯"})]}),e.jsxs("div",{style:L.settingRow,children:[e.jsxs("label",{style:L.settingLabel,children:[e.jsx("input",{type:"checkbox",checked:N.product_button_recommendations||!1,onChange:()=>G(N.chatbot_id,"product_button_recommendations"),style:L.checkbox}),e.jsx(Pt,{}),"ProduktovÃ© doporuÄenÃ­ na tlaÄÃ­tko"]}),e.jsx("div",{style:L.settingDescription,children:'Zobrazit tlaÄÃ­tko "DoporuÄit produkty" na konci odpovÄ›di chatbota'})]}),e.jsxs("div",{style:L.settingRow,children:[e.jsxs("label",{style:L.settingLabel,children:[e.jsx("input",{type:"checkbox",checked:N.inline_product_links||!1,onChange:()=>G(N.chatbot_id,"inline_product_links"),style:L.checkbox}),e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}),e.jsx("path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"})]}),"Inline produktovÃ© linky"]}),e.jsx("div",{style:L.settingDescription,children:"Zobrazovat produktovÃ© linky pÅ™Ã­mo v textu odpovÄ›di chatbota (ChatGPT styl)"})]}),e.jsxs("div",{style:L.settingRow,children:[e.jsxs("label",{style:L.settingLabel,children:[e.jsx("input",{type:"checkbox",checked:N.book_database||!1,onChange:()=>G(N.chatbot_id,"book_database"),style:L.checkbox}),e.jsx(cr,{}),"DatabÃ¡ze knih"]}),e.jsx("div",{style:L.settingDescription,children:"VyhledÃ¡vat v databÃ¡zi lÃ©kaÅ™skÃ© literatury a dokumentÅ¯"})]}),e.jsxs("div",{style:L.settingRow,children:[e.jsxs("label",{style:L.settingLabel,children:[e.jsx("input",{type:"checkbox",checked:N.is_default_web_chatbot||!1,onChange:()=>G(N.chatbot_id,"is_default_web_chatbot"),style:L.checkbox}),e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"2",y1:"12",x2:"22",y2:"12"}),e.jsx("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"})]}),"Zobrazit v bublinÄ› na webu"]}),e.jsx("div",{style:L.settingDescription,children:"Tento chatbot se zobrazÃ­ v plovoucÃ­ bublinÄ› na medbase.cz (pouze jeden mÅ¯Å¾e bÃ½t vybrÃ¡n)"})]})]}),e.jsxs("div",{style:L.chatbotSettings,children:[e.jsx("h4",{style:L.sectionSubtitle,children:"ğŸ¯ ProduktovÃ½ funnel"}),e.jsxs("div",{style:L.settingRow,children:[e.jsxs("label",{style:L.settingLabel,children:[e.jsx("input",{type:"checkbox",checked:N.enable_product_router!==!1,onChange:()=>q(N.chatbot_id,{enable_product_router:N.enable_product_router===!1}),style:L.checkbox}),e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),"Aktivovat produktovÃ½ router"]}),e.jsx("div",{style:L.settingDescription,children:"AutomatickÃ© smÄ›rovÃ¡nÃ­ dotazÅ¯ do produktovÃ©ho funnelu na zÃ¡kladÄ› symptomÅ¯. KdyÅ¾ je vypnuto, vÅ¡e jde jako standardnÃ­ chat."})]}),e.jsxs("div",{style:L.settingRow,children:[e.jsxs("label",{style:L.settingLabel,children:[e.jsx("input",{type:"checkbox",checked:N.enable_manual_funnel===!0,onChange:()=>q(N.chatbot_id,{enable_manual_funnel:N.enable_manual_funnel!==!0}),style:L.checkbox}),e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"16"}),e.jsx("line",{x1:"8",y1:"12",x2:"16",y2:"12"})]}),"ManuÃ¡lnÃ­ funnel spouÅ¡tÄ›Ä"]}),e.jsx("div",{style:L.settingDescription,children:"MÃ­sto Å¾lutÃ©ho calloutu zobrazÃ­ tlaÄÃ­tko pro manuÃ¡lnÃ­ zadÃ¡nÃ­ symptomÅ¯. UÅ¾ivatel sÃ¡m rozhodne, kdy chce doporuÄit produkty."})]})]}),e.jsxs("div",{style:L.filterSection,children:[e.jsxs("h4",{style:L.sectionSubtitle,children:[e.jsx(mo,{}),"PovolenÃ© kategorie (",N.allowed_categories.length,"/",a.length,")",!N.book_database&&e.jsx("span",{style:L.disabledLabel,children:" (pouze s databÃ¡zÃ­ knih)"})]}),N.book_database?e.jsx("div",{style:L.filterGrid,children:a.map(M=>e.jsxs("label",{style:L.filterItem,children:[e.jsx("input",{type:"checkbox",checked:N.allowed_categories.includes(M.id),onChange:()=>I(N.chatbot_id,M.id),style:L.checkbox}),e.jsx("span",{style:L.filterLabel,children:M.name})]},M.id))}):e.jsx("div",{style:L.disabledSection,children:e.jsx("p",{style:L.disabledText,children:"ğŸ“š Filtrace kategoriÃ­ je dostupnÃ¡ pouze kdyÅ¾ je povolena databÃ¡ze knih."})})]}),e.jsxs("div",{style:L.filterSection,children:[e.jsxs("h4",{style:L.sectionSubtitle,children:[e.jsx(mo,{}),"PovolenÃ© typy publikacÃ­ (",N.allowed_publication_types.length,"/",g.length,")",!N.book_database&&e.jsx("span",{style:L.disabledLabel,children:" (pouze s databÃ¡zÃ­ knih)"})]}),N.book_database?e.jsx("div",{style:L.filterGrid,children:g.map(M=>e.jsxs("label",{style:L.filterItemLarge,children:[e.jsx("input",{type:"checkbox",checked:N.allowed_publication_types.includes(M.id),onChange:()=>se(N.chatbot_id,M.id),style:L.checkbox}),e.jsxs("div",{children:[e.jsx("div",{style:L.filterLabel,children:M.name}),M.description&&e.jsx("div",{style:L.filterDescription,children:M.description})]})]},M.id))}):e.jsx("div",{style:L.disabledSection,children:e.jsx("p",{style:L.disabledText,children:"ğŸ“„ Filtrace typÅ¯ publikacÃ­ je dostupnÃ¡ pouze kdyÅ¾ je povolena databÃ¡ze knih."})})]}),z.has(N.chatbot_id)&&e.jsxs("div",{style:L.settingsActions,children:[e.jsxs("button",{style:L.saveButton,onClick:()=>oe(N.chatbot_id),disabled:P===N.chatbot_id,children:[e.jsx(dr,{}),P===N.chatbot_id?"UklÃ¡dÃ¡m...":"UloÅ¾it nastavenÃ­"]}),e.jsx("button",{style:L.resetButton,onClick:()=>W(N.chatbot_id),disabled:P===N.chatbot_id,children:"ZruÅ¡it zmÄ›ny"})]}),e.jsx("div",{style:L.testChatSection,children:N.chatbot_id==="product_chat"?e.jsxs(e.Fragment,{children:[e.jsx("button",{style:{...L.testChatButton,backgroundColor:"#28a745",borderColor:"#28a745"},onClick:()=>ne(!0),children:"ğŸ’¬ OtevÅ™Ã­t Product Chat"}),e.jsx("div",{style:L.testChatDescription,children:"ProduktovÃ½ chat s personalizovanÃ½mi doporuÄenÃ­mi pÅ™es N8N webhook"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{style:L.testChatButton,onClick:()=>re({id:N.chatbot_id,name:N.chatbot_name,description:N.description||"",features:{product_recommendations:N.product_recommendations,product_button_recommendations:N.product_button_recommendations,inline_product_links:N.inline_product_links,book_database:N.book_database,use_feed_1:N.use_feed_1,use_feed_2:N.use_feed_2,webhook_url:N.webhook_url,enable_product_router:N.enable_product_router,enable_manual_funnel:N.enable_manual_funnel}}),children:"ğŸ’¬ Spustit chat s nastavenÃ­m"}),e.jsxs("div",{style:L.testChatDescription,children:["Chat bude pouÅ¾Ã­vat pouze zaÅ¡krtnutÃ© kategorie a typy publikacÃ­",z.has(N.chatbot_id)&&e.jsx("span",{style:{color:"#dc3545"},children:" (âš ï¸ NeuloÅ¾enÃ© zmÄ›ny se neprojevÃ­)"})]})]})})]},N.id)),s.length===0&&e.jsxs("div",{style:L.emptyChatbots,children:[e.jsx("h4",{children:"Å½Ã¡dnÃ© chatboty nenalezeny"}),e.jsx("p",{children:"SpusÅ¥te SQL script create_chatbot_settings_table.sql pro vytvoÅ™enÃ­ vÃ½chozÃ­ch chatbotÅ¯."})]})]})]}),n==="product_feed"&&e.jsxs("div",{style:L.tabContent,children:[e.jsx("h3",{style:L.sectionTitle,children:"ProduktovÃ½ feed a embeddingy"}),e.jsx("p",{style:L.sectionDescription,children:"GlobÃ¡lnÃ­ sprÃ¡va produktovÃ©ho feedu a AI embeddingÅ¯ pro vÅ¡echny chatboty"}),e.jsxs("div",{style:L.productActions,children:[e.jsxs("div",{style:L.actionCard,children:[e.jsx("h4",{children:"Synchronizace feedu"}),e.jsx("p",{children:"AutomatickÃ¡ aktualizace produktovÃ½ch dat z externÃ­ XML feed"}),e.jsx(Ot,{})]}),e.jsxs("div",{style:L.actionCard,children:[e.jsx("h4",{children:"AI Embeddingy"}),e.jsx("p",{children:"Vygenerujte embeddingy pro vylepÅ¡enÃ¡ produktovÃ¡ doporuÄenÃ­"}),e.jsx("button",{style:L.primaryButton,onClick:()=>R(!0),children:"ğŸ“‹ Spravovat Embeddingy"})]}),e.jsxs("div",{style:L.actionCard,children:[e.jsx("h4",{children:"AI Embeddingy Pro Feed 2"}),e.jsx("p",{children:"Vygenerujte embeddingy pro vylepÅ¡enÃ¡ produktovÃ¡ doporuÄenÃ­ z Feed 2"}),e.jsx("button",{style:L.primaryButton,onClick:()=>w(!0),children:"ğŸ“‹ Spravovat Embeddingy Pro Feed 2"})]})]})]}),n==="settings"&&e.jsxs("div",{style:L.tabContent,children:[e.jsx("h3",{style:L.sectionTitle,children:"ObecnÃ© nastavenÃ­"}),e.jsx("p",{style:L.sectionDescription,children:"BudoucÃ­ globÃ¡lnÃ­ nastavenÃ­ aplikace"}),e.jsxs("div",{style:L.settingsGrid,children:[e.jsxs("div",{style:L.settingCard,children:[e.jsx("h4",{children:"ğŸ”’ BezpeÄnost"}),e.jsx("p",{children:"SprÃ¡va API klÃ­ÄÅ¯ a autentifikace"}),e.jsx("button",{style:L.secondaryButton,children:"PÅ™ipravuje se..."})]}),e.jsxs("div",{style:L.settingCard,children:[e.jsx("h4",{children:"ğŸ“Š Analytika"}),e.jsx("p",{children:"SledovÃ¡nÃ­ vyuÅ¾itÃ­ a vÃ½konu chatbotÅ¯"}),e.jsx("button",{style:L.secondaryButton,children:"PÅ™ipravuje se..."})]}),e.jsxs("div",{style:L.settingCard,children:[e.jsx("h4",{children:"ğŸ”” Notifikace"}),e.jsx("p",{children:"UpozornÄ›nÃ­ na aktualizace a chyby"}),e.jsx("button",{style:L.secondaryButton,children:"PÅ™ipravuje se..."})]})]})]})]}),S&&e.jsx(Jn,{onClose:()=>R(!1)}),J&&e.jsx(qn,{onClose:()=>w(!1)}),U&&e.jsx("div",{style:L.overlay,children:e.jsx("div",{style:{...L.container,width:"95vw",height:"90vh",maxWidth:"1400px",padding:0,display:"flex",flexDirection:"column"},children:e.jsx(ar,{onClose:()=>ne(!1)})})})]})})},L={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3,padding:"20px"},modal:{backgroundColor:"white",borderRadius:"12px",width:"95%",maxWidth:"1200px",maxHeight:"90vh",overflow:"hidden",display:"flex",flexDirection:"column",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.3)"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",borderBottom:"1px solid #e0e0e0",backgroundColor:"#f8f9fa"},title:{margin:0,fontSize:"24px",fontWeight:"600",color:"#333"},closeButton:{background:"none",border:"none",cursor:"pointer",padding:"8px",borderRadius:"4px",color:"#666",transition:"all 0.2s"},tabs:{display:"flex",borderBottom:"1px solid #e0e0e0",backgroundColor:"#f8f9fa"},tabButton:{backgroundColor:"transparent",border:"none",padding:"16px 24px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",fontSize:"14px",fontWeight:"500",color:"#666",borderBottom:"3px solid transparent",transition:"all 0.2s"},tabButtonActive:{color:"#007bff",borderBottom:"3px solid #007bff",backgroundColor:"white"},content:{flex:1,overflow:"auto",padding:"24px"},tabContent:{maxWidth:"100%"},sectionTitle:{fontSize:"20px",fontWeight:"600",color:"#333",marginBottom:"8px"},sectionDescription:{fontSize:"14px",color:"#666",marginBottom:"24px",lineHeight:"1.5"},chatbotGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(400px, 1fr))",gap:"20px"},chatbotCard:{border:"1px solid #e0e0e0",borderRadius:"12px",padding:"20px",backgroundColor:"#f8f9fa"},chatbotHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},chatbotIconName:{display:"flex",alignItems:"center",gap:"8px"},chatbotName:{margin:0,fontSize:"18px",fontWeight:"600",color:"#333"},chatbotDescription:{fontSize:"14px",color:"#666",lineHeight:"1.4",marginBottom:"8px"},chatbotSettings:{display:"flex",flexDirection:"column",gap:"12px",paddingTop:"16px",borderTop:"1px solid #e0e0e0"},settingRow:{display:"flex",flexDirection:"column",gap:"4px"},settingLabel:{display:"flex",alignItems:"center",gap:"8px",fontSize:"14px",fontWeight:"500",color:"#333",cursor:"pointer"},settingDescription:{fontSize:"12px",color:"#666",paddingLeft:"24px"},checkbox:{cursor:"pointer"},productActions:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"20px"},actionCard:{border:"1px solid #e0e0e0",borderRadius:"12px",padding:"20px",backgroundColor:"#f8f9fa"},primaryButton:{backgroundColor:"#007bff",color:"white",border:"none",padding:"12px 16px",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"500",marginTop:"12px",transition:"all 0.2s"},secondaryButton:{backgroundColor:"#6c757d",color:"white",border:"none",padding:"8px 12px",borderRadius:"6px",cursor:"pointer",fontSize:"12px",marginTop:"8px",transition:"all 0.2s"},settingsGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"16px"},settingCard:{border:"1px solid #e0e0e0",borderRadius:"8px",padding:"16px",backgroundColor:"#f8f9fa",textAlign:"center"},testChatSection:{marginTop:"16px",paddingTop:"16px",borderTop:"1px solid #e0e0e0",textAlign:"center"},testChatButton:{backgroundColor:"#28a745",color:"white",border:"none",padding:"12px 20px",borderRadius:"8px",cursor:"pointer",fontSize:"14px",fontWeight:"600",transition:"all 0.2s",display:"flex",alignItems:"center",gap:"8px",margin:"0 auto",boxShadow:"0 2px 4px rgba(40, 167, 69, 0.2)"},testChatDescription:{fontSize:"12px",color:"#666",marginTop:"8px",fontStyle:"italic"},errorMessage:{backgroundColor:"#f8d7da",color:"#721c24",padding:"12px 16px",borderRadius:"8px",marginBottom:"16px",border:"1px solid #f5c6cb",fontSize:"14px",lineHeight:"1.5"},errorHint:{backgroundColor:"#fff3cd",color:"#856404",padding:"12px",borderRadius:"6px",marginTop:"12px",border:"1px solid #ffeaa7",fontSize:"13px"},loadingMessage:{textAlign:"center",padding:"40px",color:"#666",fontSize:"16px"},savingIndicator:{fontSize:"12px",color:"#007bff",fontWeight:"500",marginLeft:"8px"},statusBadge:{fontSize:"11px",color:"white",padding:"4px 8px",borderRadius:"12px",fontWeight:"600",textTransform:"uppercase"},chatbotId:{fontSize:"11px",color:"#007bff",fontFamily:"monospace",marginBottom:"16px",backgroundColor:"#f8f9fa",padding:"4px 8px",borderRadius:"4px",display:"inline-block"},sectionSubtitle:{fontSize:"14px",fontWeight:"600",color:"#333",marginBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},filterSection:{marginTop:"20px",paddingTop:"16px",borderTop:"1px solid #e0e0e0"},filterGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(160px, 1fr))",gap:"8px"},filterItem:{display:"flex",alignItems:"center",gap:"6px",fontSize:"12px",color:"#333",cursor:"pointer",padding:"4px",borderRadius:"4px",transition:"background-color 0.2s"},filterItemLarge:{display:"flex",alignItems:"flex-start",gap:"8px",fontSize:"12px",color:"#333",cursor:"pointer",padding:"8px",borderRadius:"6px",transition:"background-color 0.2s",border:"1px solid #e0e0e0",backgroundColor:"#f8f9fa"},filterLabel:{fontWeight:"500"},filterDescription:{fontSize:"10px",color:"#666",marginTop:"2px",lineHeight:"1.3"},emptyChatbots:{textAlign:"center",padding:"40px",color:"#666",backgroundColor:"#f8f9fa",borderRadius:"8px",border:"1px solid #e0e0e0"},unsavedIndicator:{fontSize:"11px",color:"#dc3545",fontWeight:"500",marginLeft:"8px"},settingsActions:{display:"flex",gap:"8px",marginTop:"16px",paddingTop:"16px",borderTop:"1px solid #e0e0e0"},saveButton:{backgroundColor:"#28a745",color:"white",border:"none",padding:"8px 16px",borderRadius:"6px",cursor:"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",gap:"6px",transition:"all 0.2s",flex:1},resetButton:{backgroundColor:"#6c757d",color:"white",border:"none",padding:"8px 16px",borderRadius:"6px",cursor:"pointer",fontSize:"13px",fontWeight:"500",transition:"all 0.2s",flex:1},disabledLabel:{fontSize:"11px",color:"#999",fontWeight:"400"},disabledSection:{backgroundColor:"#f8f9fa",padding:"16px",borderRadius:"6px",border:"1px solid #e0e0e0"},disabledText:{fontSize:"13px",color:"#666",margin:0,fontStyle:"italic"}},pr=t=>e.jsx("img",{src:"https://modopafybeslbcqjxsve.supabase.co/storage/v1/object/public/web/Generated_Image_September_08__2025_-_3_09PM-removebg-preview.png",alt:"Sana AI Logo",style:{objectFit:"contain"},...t}),xr=({chatbotId:t,chatbotName:o,onClose:n})=>{const[r,s]=p.useState([]),[l,a]=p.useState([]),[c,g]=p.useState([]),[u,m]=p.useState([]),[b,d]=p.useState([]),[v,P]=p.useState([]),[f,z]=p.useState({product_recommendations:!1,product_button_recommendations:!1,inline_product_links:!1,book_database:!0,use_feed_1:!0,use_feed_2:!0,enable_product_router:!0,enable_manual_funnel:!1}),[C,T]=p.useState(!1),[y,V]=p.useState(!1),[F,S]=p.useState(!0),[R,J]=p.useState(null),[w,U]=p.useState(o||t),[ne,q]=p.useState("cs"),I=[{code:"cs",label:"CZ"},{code:"sk",label:"SK"},{code:"de",label:"DE"},{code:"en",label:"UK"}];p.useEffect(()=>{(async()=>{try{S(!0),J(null);const j=await We.getChatbotFilters(t);s(j.categories),g(j.publicationTypes),a(j.labels),m(j.categories.map(te=>te.name)),P(j.publicationTypes.map(te=>te.name)),d(j.labels.map(te=>te.name));const O={product_recommendations:j.productRecommendations,product_button_recommendations:j.productButtonRecommendations,inline_product_links:j.inlineProductLinks,book_database:j.bookDatabase,use_feed_1:j.useFeed1,use_feed_2:j.useFeed2,enable_product_router:j.enableProductRouter,enable_manual_funnel:j.enableManualFunnel};z(O);const Y=await We.getChatbotSettingsWithDetails(t);Y&&U(Y.chatbot_name)}catch{J("NepodaÅ™ilo se naÄÃ­st nastavenÃ­ chatbota");const O=[{id:"1",name:"Aromaterapie"},{id:"2",name:"MasÃ¡Å¾e"},{id:"3",name:"Akupunktura"},{id:"4",name:"Diagnostika"}],Y=[{id:"1",name:"public",description:"VeÅ™ejnÄ› dostupnÃ© publikace"}],te=[];s(O),g(Y),a(te),m(O.map(Q=>Q.name)),P(Y.map(Q=>Q.name)),d([]),z({product_recommendations:!1,product_button_recommendations:!1,inline_product_links:!1,book_database:!0,use_feed_1:!0,use_feed_2:!0,enable_product_router:!0,enable_manual_funnel:!1})}finally{S(!1)}})()},[t,o]);const se=(_,j,O)=>{if(j.includes(_)){const Y=j.filter(te=>te!==_);O(Y)}else{const Y=[...j,_];O(Y)}},G=()=>{m([]),d([]),P([])},oe=()=>{m(r.map(_=>_.name)),d(l.map(_=>_.name)),P(c.map(_=>_.name))},W=()=>{T(!C)},re=()=>{V(!y)},N=()=>{window.location.reload()},M=()=>{alert("Export do PDF bude implementovÃ¡n pozdÄ›ji")};if(F)return e.jsx("div",{className:"flex items-center justify-center h-full bg-bewit-gray",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl text-gray-600 mb-2",children:"NaÄÃ­tÃ¡m nastavenÃ­ chatbota..."}),e.jsx("div",{className:"text-sm text-gray-500",children:w})]})});if(R)return e.jsx("div",{className:"flex items-center justify-center h-full bg-bewit-gray",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl text-red-600 mb-2",children:"Chyba pÅ™i naÄÃ­tÃ¡nÃ­"}),e.jsx("div",{className:"text-sm text-gray-500",children:R}),e.jsxs("div",{className:"text-xs text-gray-400 mt-2",children:["Chatbot: ",w]})]})});const x=r.length>0||c.length>0;return e.jsxs("div",{className:"flex h-full w-full bg-bewit-gray m-0 p-0",children:[e.jsx("div",{className:`${C?"w-80":"w-0"} bg-white overflow-hidden transition-all duration-300 ease-in-out`,children:e.jsxs("div",{className:"w-80 p-6 overflow-y-auto h-full",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-bewit-dark mb-2",children:"Filtrace obsahu"}),e.jsx("p",{className:"text-sm text-gray-600",children:w}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:x?"Vyberte kategorie pro pÅ™esnÄ›jÅ¡Ã­ vÃ½sledky":"Å½Ã¡dnÃ© filtrace nejsou k dispozici"})]}),x&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsx("button",{onClick:oe,className:"flex-1 px-3 py-2 text-xs font-medium text-bewit-blue bg-bewit-lightBlue rounded-md hover:bg-blue-100 transition-colors",children:"Vybrat vÅ¡e"}),e.jsx("button",{onClick:G,className:"flex-1 px-3 py-2 text-xs font-medium text-slate-600 bg-slate-100 rounded-md hover:bg-slate-200 transition-colors",children:"Filter Reset"})]})}),r.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-bewit-dark mb-4 text-center",children:"Kategorie lÃ©Äby"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:r.map(_=>e.jsx("button",{onClick:()=>se(_.name,u,m),className:`p-2 rounded-lg text-xs sm:text-sm font-medium transition-all duration-200 text-center ${u.includes(_.name)?"bg-bewit-blue text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:_.name},_.id))})]}),c.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-bewit-dark mb-4 text-center",children:"Typy publikacÃ­"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:c.map(_=>e.jsx("button",{onClick:()=>se(_.name,v,P),className:`p-2 rounded-lg text-xs sm:text-sm font-medium transition-all duration-200 text-center ${v.includes(_.name)?"bg-bewit-blue text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,title:_.description,children:_.name==="public"?"VeÅ™ejnÃ©":_.name==="students"?"Pro studenty":_.name==="internal_bewit"?"InternÃ­":_.name},_.id))})]}),l.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-bewit-dark mb-4 text-center",children:"Å tÃ­tky"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:l.map(_=>e.jsx("button",{onClick:()=>se(_.name,b,d),className:`p-2 rounded-lg text-xs sm:text-sm font-medium transition-all duration-200 text-center ${b.includes(_.name)?"bg-bewit-blue text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:_.name},_.id))})]}),!x&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-500 mb-2",children:"Å½Ã¡dnÃ© filtrace nejsou povoleny"}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Chatbot ",w," nemÃ¡ pÅ™Ã­stup k Å¾Ã¡dnÃ½m kategoriÃ­m nebo typÅ¯m publikacÃ­."]})]})]})}),e.jsxs("div",{className:"flex-1 flex flex-col w-full",children:[e.jsx(It,{onClose:n,languages:I,selectedLanguage:ne,onLanguageChange:q,leftContent:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:C,onChange:W,className:"sr-only peer","aria-label":"Zobrazit/skrÃ½t filtry"}),e.jsx("div",{className:"relative w-11 h-6 bg-white/20 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-white/30 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-white/40"})]}),e.jsx("div",{className:"h-6 w-px bg-white/20"}),e.jsx(pr,{className:"h-10 w-auto object-contain"})]}),buttons:[...f.product_recommendations?[{icon:"product",onClick:re,label:y?"SkrÃ½t produkty":"Spravovat produkty",tooltip:y?"SkrÃ½t produkty":"Spravovat produkty BEWIT",isActive:y}]:[],{icon:"plus",onClick:N,label:"NovÃ½ chat",tooltip:"NovÃ½ chat"},{icon:"download",onClick:M,label:"Export do PDF",tooltip:"Export do PDF"}]}),e.jsx("div",{className:"flex-1 bg-bewit-gray flex flex-col min-h-0",children:y&&f.product_recommendations?e.jsx("div",{className:"w-full h-full flex-1 overflow-y-auto p-6",children:e.jsx(Ot,{})}):e.jsx($o,{selectedCategories:u,selectedLabels:b,selectedPublicationTypes:v,chatbotSettings:f,chatbotId:t})})]})]})};class Ie{static async checkAPIStatus(){return{available:!1,message:"ILovePDF sluÅ¾ba nenÃ­ nakonfigurovÃ¡na"}}static getAvailableLanguages(){return[{code:"ces",name:"ÄŒeÅ¡tina"},{code:"eng",name:"AngliÄtina"},{code:"deu",name:"NÄ›mÄina"},{code:"fra",name:"FrancouzÅ¡tina"},{code:"spa",name:"Å panÄ›lÅ¡tina"},{code:"ita",name:"ItalÅ¡tina"},{code:"pol",name:"PolÅ¡tina"},{code:"rus",name:"RuÅ¡tina"}]}static getBestLanguageMatch(o){const n={cs:"ces",czech:"ces",ÄeÅ¡tina:"ces",en:"eng",english:"eng",de:"deu",german:"deu",fr:"fra",french:"fra",es:"spa",spanish:"spa",it:"ita",italian:"ita",pl:"pol",polish:"pol",ru:"rus",russian:"rus"},r=o.toLowerCase().trim();return n[r]||"eng"}static async performOCR(o,n="ces"){return console.warn("âš ï¸ ILovePDF OCR nenÃ­ implementovÃ¡no, vracÃ­ se pÅ¯vodnÃ­ soubor"),o}static async compressPDF(o,n="recommended"){return console.warn("âš ï¸ ILovePDF komprese nenÃ­ implementovÃ¡na, vracÃ­ se pÅ¯vodnÃ­ soubor"),o}static async processWithOCRThenCompression(o,n="ces",r="recommended"){return console.warn("âš ï¸ ILovePDF OCR + komprese nenÃ­ implementovÃ¡no, vracÃ­ se pÅ¯vodnÃ­ soubor"),o}}async function hr(t,o=10){try{const n=window.pdfjsLib;if(!n)throw new Error("PDF.js nenÃ­ naÄten. Zkuste obnovit strÃ¡nku.");const s=await n.getDocument({data:t}).promise,l=Math.min(s.numPages,o);let a="";for(let c=1;c<=l;c++)try{const m=(await(await s.getPage(c)).getTextContent()).items.map(b=>b.str!==void 0?String(b.str):b.text!==void 0?String(b.text):b.chars!==void 0?String(b.chars):typeof b=="string"?b:"").join(" ");a+=m+`
`}catch(g){console.warn(`Chyba pÅ™i zpracovÃ¡nÃ­ PDF strÃ¡nky ${c}:`,g)}return a.trim()}catch(n){return console.error("âŒ Chyba pÅ™i extrakci textu z PDF:",n),""}}async function gr(t,o=10,n=2){try{const r=window.pdfjsLib;if(!r)throw new Error("PDF.js nenÃ­ naÄten. Zkuste obnovit strÃ¡nku.");const l=await r.getDocument({data:t}).promise,a=Math.min(l.numPages,o),c=[];for(let g=1;g<=a;g++)try{const u=await l.getPage(g),m=u.getViewport({scale:n}),b=document.createElement("canvas"),d=b.getContext("2d");if(!d){console.error("âŒ NepodaÅ™ilo se zÃ­skat 2D kontext canvasu");continue}b.width=m.width,b.height=m.height;const v={canvasContext:d,viewport:m};await u.render(v).promise;const P=b.toDataURL("image/png").split(",")[1];c.push(P)}catch(u){console.error(`âŒ Chyba pÅ™i konverzi strÃ¡nky ${g}:`,u)}return c}catch(r){return console.error("âŒ Chyba pÅ™i konverzi PDF na obrÃ¡zky:",r),[]}}async function fr(t,o,n,r){try{const s=await fetch(t);if(!s.ok)throw new Error(`NepodaÅ™ilo se stÃ¡hnout PDF: ${s.status}`);const a=await(await s.blob()).arrayBuffer(),c=await hr(a,10);let g,u;if(c.length>500)u="text",g={type:"text",content:c,fileName:o};else{const v=await gr(a,10,2);if(v.length===0)throw new Error("NepodaÅ™ilo se pÅ™evÃ©st PDF na obrÃ¡zky");u="images",g={type:"images",content:v,fileName:o}}const m=`${n}/functions/v1/extract-metadata-ai`,b=await fetch(m,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(g)});if(!b.ok){const v=await b.text();throw new Error(`Edge Function chyba: ${b.status} - ${v}`)}const d=await b.json();if(!d.success)throw new Error(d.error||"Edge Function vrÃ¡tila chybu");return{success:!0,metadata:{...d.metadata,hasOCR:u==="text"},type:u,model:d.model}}catch(s){return console.error("âŒ Chyba pÅ™i inteligentnÃ­ extrakci metadat:",s),{success:!1,error:s instanceof Error?s.message:String(s)}}}const mr={};var Bt=null;function br(t){try{return crypto.getRandomValues(new Uint8Array(t))}catch{}try{return mr.randomBytes(t)}catch{}if(!Bt)throw Error("Neither WebCryptoAPI nor a crypto module is available. Use bcrypt.setRandomFallback to set an alternative");return Bt(t)}function yr(t){Bt=t}function Mt(t,o){if(t=t||Ut,typeof t!="number")throw Error("Illegal arguments: "+typeof t+", "+typeof o);t<4?t=4:t>31&&(t=31);var n=[];return n.push("$2b$"),t<10&&n.push("0"),n.push(t.toString()),n.push("$"),n.push(yt(br(nt),nt)),n.join("")}function Lo(t,o,n){if(typeof o=="function"&&(n=o,o=void 0),typeof t=="function"&&(n=t,t=void 0),typeof t>"u")t=Ut;else if(typeof t!="number")throw Error("illegal arguments: "+typeof t);function r(s){Ee(function(){try{s(null,Mt(t))}catch(l){s(l)}})}if(n){if(typeof n!="function")throw Error("Illegal callback: "+typeof n);r(n)}else return new Promise(function(s,l){r(function(a,c){if(a){l(a);return}s(c)})})}function Fo(t,o){if(typeof o>"u"&&(o=Ut),typeof o=="number"&&(o=Mt(o)),typeof t!="string"||typeof o!="string")throw Error("Illegal arguments: "+typeof t+", "+typeof o);return Dt(t,o)}function Eo(t,o,n,r){function s(l){typeof t=="string"&&typeof o=="number"?Lo(o,function(a,c){Dt(t,c,l,r)}):typeof t=="string"&&typeof o=="string"?Dt(t,o,l,r):Ee(l.bind(this,Error("Illegal arguments: "+typeof t+", "+typeof o)))}if(n){if(typeof n!="function")throw Error("Illegal callback: "+typeof n);s(n)}else return new Promise(function(l,a){s(function(c,g){if(c){a(c);return}l(g)})})}function Bo(t,o){for(var n=t.length^o.length,r=0;r<t.length;++r)n|=t.charCodeAt(r)^o.charCodeAt(r);return n===0}function vr(t,o){if(typeof t!="string"||typeof o!="string")throw Error("Illegal arguments: "+typeof t+", "+typeof o);return o.length!==60?!1:Bo(Fo(t,o.substring(0,o.length-31)),o)}function kr(t,o,n,r){function s(l){if(typeof t!="string"||typeof o!="string"){Ee(l.bind(this,Error("Illegal arguments: "+typeof t+", "+typeof o)));return}if(o.length!==60){Ee(l.bind(this,null,!1));return}Eo(t,o.substring(0,29),function(a,c){a?l(a):l(null,Bo(c,o))},r)}if(n){if(typeof n!="function")throw Error("Illegal callback: "+typeof n);s(n)}else return new Promise(function(l,a){s(function(c,g){if(c){a(c);return}l(g)})})}function jr(t){if(typeof t!="string")throw Error("Illegal arguments: "+typeof t);return parseInt(t.split("$")[2],10)}function wr(t){if(typeof t!="string")throw Error("Illegal arguments: "+typeof t);if(t.length!==60)throw Error("Illegal hash length: "+t.length+" != 60");return t.substring(0,29)}function Cr(t){if(typeof t!="string")throw Error("Illegal arguments: "+typeof t);return Do(t)>72}var Ee=typeof setImmediate=="function"?setImmediate:typeof scheduler=="object"&&typeof scheduler.postTask=="function"?scheduler.postTask.bind(scheduler):setTimeout;function Do(t){for(var o=0,n=0,r=0;r<t.length;++r)n=t.charCodeAt(r),n<128?o+=1:n<2048?o+=2:(n&64512)===55296&&(t.charCodeAt(r+1)&64512)===56320?(++r,o+=4):o+=3;return o}function zr(t){for(var o=0,n,r,s=new Array(Do(t)),l=0,a=t.length;l<a;++l)n=t.charCodeAt(l),n<128?s[o++]=n:n<2048?(s[o++]=n>>6|192,s[o++]=n&63|128):(n&64512)===55296&&((r=t.charCodeAt(l+1))&64512)===56320?(n=65536+((n&1023)<<10)+(r&1023),++l,s[o++]=n>>18|240,s[o++]=n>>12&63|128,s[o++]=n>>6&63|128,s[o++]=n&63|128):(s[o++]=n>>12|224,s[o++]=n>>6&63|128,s[o++]=n&63|128);return s}var qe="./ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),Me=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,54,55,56,57,58,59,60,61,62,63,-1,-1,-1,-1,-1,-1,-1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,-1,-1,-1,-1,-1,-1,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,-1,-1,-1,-1,-1];function yt(t,o){var n=0,r=[],s,l;if(o<=0||o>t.length)throw Error("Illegal len: "+o);for(;n<o;){if(s=t[n++]&255,r.push(qe[s>>2&63]),s=(s&3)<<4,n>=o){r.push(qe[s&63]);break}if(l=t[n++]&255,s|=l>>4&15,r.push(qe[s&63]),s=(l&15)<<2,n>=o){r.push(qe[s&63]);break}l=t[n++]&255,s|=l>>6&3,r.push(qe[s&63]),r.push(qe[l&63])}return r.join("")}function Ro(t,o){var n=0,r=t.length,s=0,l=[],a,c,g,u,m,b;if(o<=0)throw Error("Illegal len: "+o);for(;n<r-1&&s<o&&(b=t.charCodeAt(n++),a=b<Me.length?Me[b]:-1,b=t.charCodeAt(n++),c=b<Me.length?Me[b]:-1,!(a==-1||c==-1||(m=a<<2>>>0,m|=(c&48)>>4,l.push(String.fromCharCode(m)),++s>=o||n>=r)||(b=t.charCodeAt(n++),g=b<Me.length?Me[b]:-1,g==-1)||(m=(c&15)<<4>>>0,m|=(g&60)>>2,l.push(String.fromCharCode(m)),++s>=o||n>=r)));)b=t.charCodeAt(n++),u=b<Me.length?Me[b]:-1,m=(g&3)<<6>>>0,m|=u,l.push(String.fromCharCode(m)),++s;var d=[];for(n=0;n<s;n++)d.push(l[n].charCodeAt(0));return d}var nt=16,Ut=10,Sr=16,_r=100,bo=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],yo=[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946,1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055,3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504,976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462],Io=[1332899944,1700884034,1701343084,1684370003,1668446532,1869963892];function rt(t,o,n,r){var s,l=t[o],a=t[o+1];return l^=n[0],s=r[l>>>24],s+=r[256|l>>16&255],s^=r[512|l>>8&255],s+=r[768|l&255],a^=s^n[1],s=r[a>>>24],s+=r[256|a>>16&255],s^=r[512|a>>8&255],s+=r[768|a&255],l^=s^n[2],s=r[l>>>24],s+=r[256|l>>16&255],s^=r[512|l>>8&255],s+=r[768|l&255],a^=s^n[3],s=r[a>>>24],s+=r[256|a>>16&255],s^=r[512|a>>8&255],s+=r[768|a&255],l^=s^n[4],s=r[l>>>24],s+=r[256|l>>16&255],s^=r[512|l>>8&255],s+=r[768|l&255],a^=s^n[5],s=r[a>>>24],s+=r[256|a>>16&255],s^=r[512|a>>8&255],s+=r[768|a&255],l^=s^n[6],s=r[l>>>24],s+=r[256|l>>16&255],s^=r[512|l>>8&255],s+=r[768|l&255],a^=s^n[7],s=r[a>>>24],s+=r[256|a>>16&255],s^=r[512|a>>8&255],s+=r[768|a&255],l^=s^n[8],s=r[l>>>24],s+=r[256|l>>16&255],s^=r[512|l>>8&255],s+=r[768|l&255],a^=s^n[9],s=r[a>>>24],s+=r[256|a>>16&255],s^=r[512|a>>8&255],s+=r[768|a&255],l^=s^n[10],s=r[l>>>24],s+=r[256|l>>16&255],s^=r[512|l>>8&255],s+=r[768|l&255],a^=s^n[11],s=r[a>>>24],s+=r[256|a>>16&255],s^=r[512|a>>8&255],s+=r[768|a&255],l^=s^n[12],s=r[l>>>24],s+=r[256|l>>16&255],s^=r[512|l>>8&255],s+=r[768|l&255],a^=s^n[13],s=r[a>>>24],s+=r[256|a>>16&255],s^=r[512|a>>8&255],s+=r[768|a&255],l^=s^n[14],s=r[l>>>24],s+=r[256|l>>16&255],s^=r[512|l>>8&255],s+=r[768|l&255],a^=s^n[15],s=r[a>>>24],s+=r[256|a>>16&255],s^=r[512|a>>8&255],s+=r[768|a&255],l^=s^n[16],t[o]=a^n[Sr+1],t[o+1]=l,t}function Xe(t,o){for(var n=0,r=0;n<4;++n)r=r<<8|t[o]&255,o=(o+1)%t.length;return{key:r,offp:o}}function vo(t,o,n){for(var r=0,s=[0,0],l=o.length,a=n.length,c,g=0;g<l;g++)c=Xe(t,r),r=c.offp,o[g]=o[g]^c.key;for(g=0;g<l;g+=2)s=rt(s,0,o,n),o[g]=s[0],o[g+1]=s[1];for(g=0;g<a;g+=2)s=rt(s,0,o,n),n[g]=s[0],n[g+1]=s[1]}function Nr(t,o,n,r){for(var s=0,l=[0,0],a=n.length,c=r.length,g,u=0;u<a;u++)g=Xe(o,s),s=g.offp,n[u]=n[u]^g.key;for(s=0,u=0;u<a;u+=2)g=Xe(t,s),s=g.offp,l[0]^=g.key,g=Xe(t,s),s=g.offp,l[1]^=g.key,l=rt(l,0,n,r),n[u]=l[0],n[u+1]=l[1];for(u=0;u<c;u+=2)g=Xe(t,s),s=g.offp,l[0]^=g.key,g=Xe(t,s),s=g.offp,l[1]^=g.key,l=rt(l,0,n,r),r[u]=l[0],r[u+1]=l[1]}function ko(t,o,n,r,s){var l=Io.slice(),a=l.length,c;if(n<4||n>31)if(c=Error("Illegal number of rounds (4-31): "+n),r){Ee(r.bind(this,c));return}else throw c;if(o.length!==nt)if(c=Error("Illegal salt length: "+o.length+" != "+nt),r){Ee(r.bind(this,c));return}else throw c;n=1<<n>>>0;var g,u,m=0,b;typeof Int32Array=="function"?(g=new Int32Array(bo),u=new Int32Array(yo)):(g=bo.slice(),u=yo.slice()),Nr(o,t,g,u);function d(){if(s&&s(m/n),m<n)for(var P=Date.now();m<n&&(m=m+1,vo(t,g,u),vo(o,g,u),!(Date.now()-P>_r)););else{for(m=0;m<64;m++)for(b=0;b<a>>1;b++)rt(l,b<<1,g,u);var f=[];for(m=0;m<a;m++)f.push((l[m]>>24&255)>>>0),f.push((l[m]>>16&255)>>>0),f.push((l[m]>>8&255)>>>0),f.push((l[m]&255)>>>0);if(r){r(null,f);return}else return f}r&&Ee(d)}if(typeof r<"u")d();else for(var v;;)if(typeof(v=d())<"u")return v||[]}function Dt(t,o,n,r){var s;if(typeof t!="string"||typeof o!="string")if(s=Error("Invalid string / salt: Not a string"),n){Ee(n.bind(this,s));return}else throw s;var l,a;if(o.charAt(0)!=="$"||o.charAt(1)!=="2")if(s=Error("Invalid salt version: "+o.substring(0,2)),n){Ee(n.bind(this,s));return}else throw s;if(o.charAt(2)==="$")l="\0",a=3;else{if(l=o.charAt(2),l!=="a"&&l!=="b"&&l!=="y"||o.charAt(3)!=="$")if(s=Error("Invalid salt revision: "+o.substring(2,4)),n){Ee(n.bind(this,s));return}else throw s;a=4}if(o.charAt(a+2)>"$")if(s=Error("Missing salt rounds"),n){Ee(n.bind(this,s));return}else throw s;var c=parseInt(o.substring(a,a+1),10)*10,g=parseInt(o.substring(a+1,a+2),10),u=c+g,m=o.substring(a+3,a+25);t+=l>="a"?"\0":"";var b=zr(t),d=Ro(m,nt);function v(P){var f=[];return f.push("$2"),l>="a"&&f.push(l),f.push("$"),u<10&&f.push("0"),f.push(u.toString()),f.push("$"),f.push(yt(d,d.length)),f.push(yt(P,Io.length*4-1)),f.join("")}if(typeof n>"u")return v(ko(b,d,u));ko(b,d,u,function(P,f){P?n(P,null):n(null,v(f))},r)}function Pr(t,o){return yt(t,o)}function Tr(t,o){return Ro(t,o)}const Wt={setRandomFallback:yr,genSaltSync:Mt,genSalt:Lo,hashSync:Fo,hash:Eo,compareSync:vr,compare:kr,getRounds:jr,getSalt:wr,truncates:Cr,encodeBase64:Pr,decodeBase64:Tr},vt="app_user_session",$r=7;function Lr(){return Math.random().toString(36).substring(2)+Math.random().toString(36).substring(2)+Date.now().toString(36)}function Oo(){try{const t=localStorage.getItem(vt);if(!t)return null;const o=JSON.parse(t);return new Date(o.expiresAt)<new Date?(localStorage.removeItem(vt),null):o}catch(t){return console.error("Chyba pÅ™i naÄÃ­tÃ¡nÃ­ session:",t),null}}function Fr(t){localStorage.setItem(vt,JSON.stringify(t))}function Rt(){localStorage.removeItem(vt)}async function Er(t,o){try{const{data:n,error:r}=await E.from("users").select("*").eq("email",t.toLowerCase()).single();if(r||!n)return console.error("âŒ UÅ¾ivatel nenalezen:",r),{user:null,error:"NesprÃ¡vnÃ½ email nebo heslo"};if(!await Wt.compare(o,n.password_hash))return console.error("âŒ NesprÃ¡vnÃ© heslo"),{user:null,error:"NesprÃ¡vnÃ½ email nebo heslo"};const l=Lr(),a=new Date;a.setDate(a.getDate()+$r);const{error:c}=await E.from("user_sessions").insert({user_id:n.id,token:l,expires_at:a.toISOString()});c&&console.error("âš ï¸ NepodaÅ™ilo se uloÅ¾it session do DB:",c);const g={userId:n.id,email:n.email,role:n.role,token:l,expiresAt:a.toISOString()};return Fr(g),{user:{id:n.id,email:n.email,firstName:n.first_name,lastName:n.last_name,role:n.role,createdAt:n.created_at},error:null}}catch(n){return console.error("âŒ Chyba pÅ™i pÅ™ihlÃ¡Å¡enÃ­:",n),{user:null,error:"NeoÄekÃ¡vanÃ¡ chyba pÅ™i pÅ™ihlÃ¡Å¡enÃ­"}}}async function Br(){try{const t=Oo();return t&&await E.from("user_sessions").delete().eq("token",t.token),Rt(),{error:null}}catch(t){return console.error("âŒ Chyba pÅ™i odhlÃ¡Å¡enÃ­:",t),Rt(),{error:null}}}async function Vt(){try{const t=Oo();if(!t)return{user:null,error:null};const{data:o,error:n}=await E.from("users").select("*").eq("id",t.userId).single();return n||!o?(console.error("âŒ NepodaÅ™ilo se naÄÃ­st uÅ¾ivatele:",n),Rt(),{user:null,error:"UÅ¾ivatel nenalezen"}):{user:{id:o.id,email:o.email,firstName:o.first_name,lastName:o.last_name,role:o.role,createdAt:o.created_at},error:null}}catch(t){return console.error("âŒ Chyba pÅ™i zÃ­skÃ¡vÃ¡nÃ­ uÅ¾ivatele:",t),{user:null,error:"Chyba pÅ™i naÄÃ­tÃ¡nÃ­ uÅ¾ivatele"}}}async function jt(){const{user:t}=await Vt();return(t==null?void 0:t.role)==="spravce"}async function Dr(t){try{const{user:o}=await Vt();if(!o)return{success:!1,error:"UÅ¾ivatel nenÃ­ pÅ™ihlÃ¡Å¡en"};const n=await Wt.hash(t,10),{error:r}=await E.from("users").update({password_hash:n}).eq("id",o.id);return r?(console.error("âŒ Chyba pÅ™i zmÄ›nÄ› hesla:",r),{success:!1,error:"NepodaÅ™ilo se zmÄ›nit heslo"}):{success:!0,error:null}}catch(o){return console.error("âŒ Chyba pÅ™i zmÄ›nÄ› hesla:",o),{success:!1,error:"NeoÄekÃ¡vanÃ¡ chyba pÅ™i zmÄ›nÄ› hesla"}}}const Rr=({onLoginSuccess:t})=>{const[o,n]=p.useState(""),[r,s]=p.useState(""),[l,a]=p.useState(!1),[c,g]=p.useState(null),[u,m]=p.useState(!1),b=async d=>{d.preventDefault(),g(null),m(!0);try{const{user:v,error:P}=await Er(o,r);if(P||!v){g(P||"PÅ™ihlÃ¡Å¡enÃ­ se nezdaÅ™ilo"),m(!1);return}t()}catch{g("NeoÄekÃ¡vanÃ¡ chyba pÅ™i pÅ™ihlÃ¡Å¡enÃ­"),m(!1)}};return e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#fdfaf6",padding:"20px"},children:e.jsxs("div",{style:{background:"#ffffff",borderRadius:"12px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",padding:"48px",width:"100%",maxWidth:"420px",border:"1px solid #eaddd7"},children:[e.jsx("div",{style:{textAlign:"center",marginBottom:"40px"},children:e.jsx("img",{src:"https://modopafybeslbcqjxsve.supabase.co/storage/v1/object/public/web/image-removebg-preview%20(1).png",alt:"MedBase Logo",style:{height:"80px",width:"auto",objectFit:"contain",margin:"0 auto"}})}),e.jsxs("form",{onSubmit:b,children:[e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",color:"#4a4a4a",marginBottom:"8px",fontFamily:"Inter, sans-serif"},children:"Email"}),e.jsx("input",{type:"email",value:o,onChange:d=>n(d.target.value),required:!0,disabled:u,placeholder:"vas.email@example.com",autoComplete:"email",name:"email",style:{width:"100%",padding:"12px 16px",fontSize:"14px",border:"1px solid #eaddd7",borderRadius:"8px",outline:"none",transition:"all 0.2s",boxSizing:"border-box",fontFamily:"Inter, sans-serif",backgroundColor:"#ffffff"},onFocus:d=>{d.target.style.borderColor="#5d7fa3",d.target.style.boxShadow="0 0 0 3px rgba(93, 127, 163, 0.1)"},onBlur:d=>{d.target.style.borderColor="#eaddd7",d.target.style.boxShadow="none"}})]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",color:"#4a4a4a",marginBottom:"8px",fontFamily:"Inter, sans-serif"},children:"Heslo"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:l?"text":"password",value:r,onChange:d=>s(d.target.value),required:!0,disabled:u,placeholder:"VaÅ¡e heslo",autoComplete:"current-password",name:"password",style:{width:"100%",padding:"12px 48px 12px 16px",fontSize:"14px",border:"1px solid #eaddd7",borderRadius:"8px",outline:"none",transition:"all 0.2s",boxSizing:"border-box",fontFamily:"Inter, sans-serif",backgroundColor:"#ffffff"},onFocus:d=>{d.target.style.borderColor="#5d7fa3",d.target.style.boxShadow="0 0 0 3px rgba(93, 127, 163, 0.1)"},onBlur:d=>{d.target.style.borderColor="#eaddd7",d.target.style.boxShadow="none"}}),e.jsx("button",{type:"button",onClick:()=>a(!l),style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center",color:"#7a7a7a"},children:l?"ğŸ‘ï¸":"ğŸ‘ï¸â€ğŸ—¨ï¸"})]})]}),c&&e.jsx("div",{style:{padding:"12px 16px",marginBottom:"20px",background:"#fee2e2",border:"1px solid #fecaca",borderRadius:"8px",fontSize:"14px",color:"#991b1b",fontFamily:"Inter, sans-serif"},children:c}),e.jsx("button",{type:"submit",disabled:u,style:{width:"100%",padding:"14px 24px",fontSize:"16px",fontWeight:"600",color:"white",backgroundColor:u?"#9ca3af":"#5d7fa3",border:"none",borderRadius:"8px",cursor:u?"not-allowed":"pointer",transition:"all 0.2s",boxShadow:u?"none":"0 1px 2px rgba(0, 0, 0, 0.05)",fontFamily:"Inter, sans-serif"},onMouseEnter:d=>{u||(d.currentTarget.style.backgroundColor="#4a6582",d.currentTarget.style.transform="translateY(-1px)",d.currentTarget.style.boxShadow="0 4px 6px rgba(0, 0, 0, 0.1)")},onMouseLeave:d=>{u||(d.currentTarget.style.backgroundColor="#5d7fa3",d.currentTarget.style.transform="translateY(0)",d.currentTarget.style.boxShadow="0 1px 2px rgba(0, 0, 0, 0.05)")},children:u?"PÅ™ihlaÅ¡ovÃ¡nÃ­...":"PÅ™ihlÃ¡sit se"})]}),e.jsx("div",{style:{marginTop:"24px",paddingTop:"24px",borderTop:"1px solid #eaddd7",fontSize:"12px",color:"#7a7a7a",textAlign:"center",fontFamily:"Inter, sans-serif"},children:"Pro vytvoÅ™enÃ­ novÃ©ho ÃºÄtu kontaktujte sprÃ¡vce systÃ©mu"})]})})},Ir=({children:t})=>{const[o,n]=p.useState(null),[r,s]=p.useState(!0),[l,a]=p.useState(!0),c=async()=>{try{const{user:u,error:m}=await Vt();n(m?null:u||null)}catch(u){console.error("âŒ NeoÄekÃ¡vanÃ¡ chyba pÅ™i ovÄ›Å™ovÃ¡nÃ­:",u),n(null)}finally{s(!1),a(!1)}};p.useEffect(()=>{c()},[]);const g=()=>{c()};return r&&l?e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},children:e.jsxs("div",{style:{background:"white",borderRadius:"12px",boxShadow:"0 20px 60px rgba(0,0,0,0.3)",padding:"40px",textAlign:"center"},children:[e.jsx("div",{style:{width:"48px",height:"48px",border:"4px solid #e5e7eb",borderTopColor:"#667eea",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 20px"}}),e.jsx("p",{style:{color:"#374151",fontSize:"16px",fontWeight:"500",margin:0},children:"NaÄÃ­tÃ¡nÃ­ session..."}),e.jsx("style",{children:`
                        @keyframes spin {
                            to { transform: rotate(360deg); }
                        }
                    `})]})}):o?e.jsx(e.Fragment,{children:t(o)}):e.jsx(Rr,{onLoginSuccess:g})};function Or(t){const o=t.substring(0,4).toLowerCase(),n=Math.floor(1e3+Math.random()*9e3).toString();return o+n}async function Ar(t,o,n,r,s){try{if(!await jt())return{success:!1,error:"Pouze sprÃ¡vce mÅ¯Å¾e vytvÃ¡Å™et uÅ¾ivatele"};const{data:a}=await E.from("users").select("id").eq("email",t.toLowerCase()).single();if(a)return{success:!1,error:"UÅ¾ivatel s tÃ­mto emailem jiÅ¾ existuje"};const c=s||Or(n),g=await Wt.hash(c,10),{data:u,error:m}=await E.from("users").insert({email:t.toLowerCase(),password_hash:g,first_name:o,last_name:n,role:r}).select().single();if(m||!u)return console.error("âŒ Chyba pÅ™i vytvÃ¡Å™enÃ­ uÅ¾ivatele:",m),{success:!1,error:"NepodaÅ™ilo se vytvoÅ™it uÅ¾ivatele"};const b={id:u.id,email:u.email,firstName:u.first_name,lastName:u.last_name,role:u.role,created_at:u.created_at,updated_at:u.updated_at};return{success:!0,error:null,password:c,user:b}}catch(l){return console.error("âŒ Chyba pÅ™i vytvÃ¡Å™enÃ­ uÅ¾ivatele:",l),{success:!1,error:"NeoÄekÃ¡vanÃ¡ chyba pÅ™i vytvÃ¡Å™enÃ­ uÅ¾ivatele"}}}async function Mr(){try{if(!await jt())return{users:null,error:"Pouze sprÃ¡vce mÅ¯Å¾e zobrazit seznam uÅ¾ivatelÅ¯"};const{data:o,error:n}=await E.from("users").select("*").order("created_at",{ascending:!1});return n?(console.error("âŒ Chyba pÅ™i naÄÃ­tÃ¡nÃ­ uÅ¾ivatelÅ¯:",n),{users:null,error:"NepodaÅ™ilo se naÄÃ­st seznam uÅ¾ivatelÅ¯"}):{users:(o||[]).map(s=>({id:s.id,email:s.email,firstName:s.first_name,lastName:s.last_name,role:s.role,created_at:s.created_at,updated_at:s.updated_at})),error:null}}catch(t){return console.error("âŒ Chyba pÅ™i naÄÃ­tÃ¡nÃ­ uÅ¾ivatelÅ¯:",t),{users:null,error:"NeoÄekÃ¡vanÃ¡ chyba pÅ™i naÄÃ­tÃ¡nÃ­ uÅ¾ivatelÅ¯"}}}async function Ur(t){try{if(!await jt())return{success:!1,error:"Pouze sprÃ¡vce mÅ¯Å¾e mazat uÅ¾ivatele"};await E.from("user_sessions").delete().eq("user_id",t);const{error:n}=await E.from("users").delete().eq("id",t);return n?(console.error("âŒ Chyba pÅ™i mazÃ¡nÃ­ uÅ¾ivatele:",n),{success:!1,error:"NepodaÅ™ilo se smazat uÅ¾ivatele"}):{success:!0,error:null}}catch(o){return console.error("âŒ Chyba pÅ™i mazÃ¡nÃ­ uÅ¾ivatele:",o),{success:!1,error:"NeoÄekÃ¡vanÃ¡ chyba pÅ™i mazÃ¡nÃ­ uÅ¾ivatele"}}}async function Wr(t,o){try{if(!await jt())return{success:!1,error:"Pouze sprÃ¡vce mÅ¯Å¾e mÄ›nit role uÅ¾ivatelÅ¯"};const{error:r}=await E.from("users").update({role:o}).eq("id",t);return r?(console.error("âŒ Chyba pÅ™i zmÄ›nÄ› role:",r),{success:!1,error:"NepodaÅ™ilo se zmÄ›nit roli"}):{success:!0,error:null}}catch(n){return console.error("âŒ Chyba pÅ™i zmÄ›nÄ› role:",n),{success:!1,error:"NeoÄekÃ¡vanÃ¡ chyba pÅ™i zmÄ›nÄ› role"}}}const Vr=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),e.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]}),Hr=({email:t,password:o,onClose:n})=>{const[r,s]=p.useState(!1),l=async()=>{try{await navigator.clipboard.writeText(o),s(!0),setTimeout(()=>s(!1),2e3)}catch(a){console.error("Chyba pÅ™i kopÃ­rovÃ¡nÃ­:",a)}};return e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999,padding:"20px"},children:e.jsxs("div",{style:{background:"white",borderRadius:"16px",padding:"40px",maxWidth:"500px",width:"100%",boxShadow:"0 20px 60px rgba(0,0,0,0.3)",textAlign:"center"},children:[e.jsx("div",{style:{width:"80px",height:"80px",background:"#22c55e",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 24px"},children:e.jsx("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"white",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}),e.jsx("h2",{style:{margin:"0 0 16px 0",fontSize:"28px",fontWeight:"700",color:"#1a1a1a",fontFamily:"Inter, sans-serif"},children:"UÅ¾ivatel vytvoÅ™en!"}),e.jsx("p",{style:{margin:"0 0 32px 0",fontSize:"16px",color:"#666",fontFamily:"Inter, sans-serif"},children:"ZkopÃ­rujte heslo a pÅ™edejte ho uÅ¾ivateli"}),e.jsxs("div",{style:{background:"#f8f9fa",borderRadius:"12px",padding:"20px",marginBottom:"16px",textAlign:"left"},children:[e.jsx("div",{style:{fontSize:"12px",color:"#888",marginBottom:"8px",fontWeight:"600",textTransform:"uppercase",letterSpacing:"0.5px",fontFamily:"Inter, sans-serif"},children:"Email"}),e.jsx("div",{style:{fontSize:"18px",color:"#1a1a1a",fontFamily:"monospace",fontWeight:"600"},children:t})]}),e.jsxs("div",{style:{background:"#fff3cd",border:"2px solid #ffc107",borderRadius:"12px",padding:"20px",marginBottom:"32px",textAlign:"left"},children:[e.jsx("div",{style:{fontSize:"12px",color:"#856404",marginBottom:"12px",fontWeight:"600",textTransform:"uppercase",letterSpacing:"0.5px",fontFamily:"Inter, sans-serif"},children:"Heslo"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[e.jsx("div",{style:{fontSize:"32px",color:"#1a1a1a",fontFamily:"monospace",fontWeight:"700",letterSpacing:"3px",flex:1},children:o}),e.jsxs("button",{type:"button",onClick:l,style:{padding:"14px 20px",background:r?"#22c55e":"#5d7fa3",color:"white",border:"none",borderRadius:"10px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",fontSize:"16px",fontFamily:"Inter, sans-serif",fontWeight:"700",transition:"all 0.2s",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},onMouseEnter:a=>{r||(a.currentTarget.style.transform="translateY(-2px)",a.currentTarget.style.boxShadow="0 6px 16px rgba(0,0,0,0.2)")},onMouseLeave:a=>{r||(a.currentTarget.style.transform="translateY(0)",a.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.15)")},children:[e.jsx(Vr,{}),r?"ZkopÃ­rovÃ¡no!":"KopÃ­rovat"]})]})]}),e.jsx("button",{type:"button",onClick:n,style:{padding:"16px 48px",fontSize:"18px",fontWeight:"700",color:"white",background:"#22c55e",border:"none",borderRadius:"12px",cursor:"pointer",fontFamily:"Inter, sans-serif",transition:"all 0.2s",boxShadow:"0 4px 12px rgba(34, 197, 94, 0.3)"},onMouseEnter:a=>{a.currentTarget.style.background="#16a34a",a.currentTarget.style.transform="translateY(-2px)",a.currentTarget.style.boxShadow="0 6px 16px rgba(34, 197, 94, 0.4)"},onMouseLeave:a=>{a.currentTarget.style.background="#22c55e",a.currentTarget.style.transform="translateY(0)",a.currentTarget.style.boxShadow="0 4px 12px rgba(34, 197, 94, 0.3)"},children:"Hotovo"})]})})},Zr=()=>e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),Kr=({onClose:t,onUserAdded:o})=>{const[n,r]=p.useState(""),[s,l]=p.useState(""),[a,c]=p.useState(""),[g,u]=p.useState("admin"),[m,b]=p.useState(!1),[d,v]=p.useState(null),[P,f]=p.useState(""),[z,C]=p.useState(""),[T,y]=p.useState(!1),[V,F]=p.useState(!1),S=w=>{l(w)},R=w=>{if(c(w),w.length>=4){const U=w.substring(0,4).toLowerCase();C(U+"XXXX")}else w.length>0?C(w.toLowerCase()+"XXXX"):C("")},J=async w=>{if(w.preventDefault(),v(null),b(!0),!n.trim()){v("VyplÅˆte email"),b(!1);return}if(!s.trim()||s.trim().length<2){v("JmÃ©no musÃ­ mÃ­t alespoÅˆ 2 znaky"),b(!1);return}if(!a.trim()||a.trim().length<2){v("PÅ™Ã­jmenÃ­ musÃ­ mÃ­t alespoÅˆ 2 znaky"),b(!1);return}const{success:U,error:ne,password:q}=await Ar(n.trim(),s.trim(),a.trim(),g,void 0);if(b(!1),ne){v(ne);return}U&&q?(f(q),F(!0)):v("NepodaÅ™ilo se vytvoÅ™it uÅ¾ivatele")};return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1001,padding:"20px"},children:e.jsxs("div",{style:{background:"#ffffff",borderRadius:"12px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",width:"100%",maxWidth:"500px",maxHeight:"90vh",overflow:"auto",border:"1px solid #eaddd7",fontFamily:"Inter, sans-serif"},children:[e.jsxs("div",{style:{padding:"24px",borderBottom:"1px solid #eaddd7",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("h3",{style:{margin:0,fontSize:"18px",fontWeight:"600",color:"#4a4a4a",fontFamily:"Inter, sans-serif"},children:"Pozvat novÃ©ho uÅ¾ivatele"}),e.jsx("button",{onClick:t,style:{background:"none",border:"none",cursor:"pointer",padding:"8px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"6px",color:"#6b7280"},onMouseEnter:w=>{w.currentTarget.style.background="#f3eee8"},onMouseLeave:w=>{w.currentTarget.style.background="none"},children:e.jsx(Zr,{})})]}),e.jsx("div",{style:{padding:"24px"},children:e.jsxs("form",{onSubmit:J,children:[e.jsxs("div",{style:{padding:"16px",background:"#e6f2f9",border:"1px solid #C8A97E",borderRadius:"8px",marginBottom:"24px",fontSize:"13px",color:"#4a4a4a",lineHeight:"1.6",fontFamily:"Inter, sans-serif"},children:[e.jsx("strong",{children:"PoznÃ¡mka:"})," Heslo bude automaticky vygenerovÃ¡no z pÅ™Ã­jmenÃ­ (4 pÃ­smena) + 4 nÃ¡hodnÃ© ÄÃ­slice (napÅ™. ",e.jsx("strong",{children:"haj d2847"}),"). UÅ¾ivatel se mÅ¯Å¾e pÅ™ihlÃ¡sit s tÃ­mto heslem a nÃ¡slednÄ› si ho zmÄ›nit v nastavenÃ­."]}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsxs("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",color:"#4a4a4a",marginBottom:"8px",fontFamily:"Inter, sans-serif"},children:["Email",e.jsx("span",{style:{color:"#d9534f",marginLeft:"4px"},children:"*"})]}),e.jsx("input",{type:"email",value:n,onChange:w=>r(w.target.value),required:!0,disabled:m,placeholder:"uzivatel@example.com",style:{width:"100%",padding:"12px 16px",fontSize:"14px",border:"1px solid #eaddd7",borderRadius:"8px",outline:"none",transition:"all 0.2s",boxSizing:"border-box",fontFamily:"Inter, sans-serif",backgroundColor:"#ffffff"},onFocus:w=>{w.target.style.borderColor="#5d7fa3",w.target.style.boxShadow="0 0 0 3px rgba(93, 127, 163, 0.1)"},onBlur:w=>{w.target.style.borderColor="#eaddd7",w.target.style.boxShadow="none"}})]}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsxs("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",color:"#4a4a4a",marginBottom:"8px",fontFamily:"Inter, sans-serif"},children:["JmÃ©no",e.jsx("span",{style:{color:"#d9534f",marginLeft:"4px"},children:"*"})]}),e.jsx("input",{type:"text",value:s,onChange:w=>S(w.target.value),required:!0,disabled:m,placeholder:"JmÃ©no uÅ¾ivatele",minLength:2,style:{width:"100%",padding:"12px 16px",fontSize:"14px",border:"1px solid #eaddd7",borderRadius:"8px",outline:"none",transition:"all 0.2s",boxSizing:"border-box",fontFamily:"Inter, sans-serif",backgroundColor:"#ffffff"},onFocus:w=>{w.target.style.borderColor="#5d7fa3",w.target.style.boxShadow="0 0 0 3px rgba(93, 127, 163, 0.1)"},onBlur:w=>{w.target.style.borderColor="#eaddd7",w.target.style.boxShadow="none"}}),s.length>0&&s.length<2&&e.jsx("div",{style:{fontSize:"12px",color:"#dc2626",marginTop:"4px",fontFamily:"Inter, sans-serif"},children:"JmÃ©no musÃ­ mÃ­t alespoÅˆ 2 znaky"})]}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsxs("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",color:"#4a4a4a",marginBottom:"8px",fontFamily:"Inter, sans-serif"},children:["PÅ™Ã­jmenÃ­",e.jsx("span",{style:{color:"#d9534f",marginLeft:"4px"},children:"*"})]}),e.jsx("input",{type:"text",value:a,onChange:w=>R(w.target.value),required:!0,disabled:m,placeholder:"PÅ™Ã­jmenÃ­ uÅ¾ivatele",minLength:2,style:{width:"100%",padding:"12px 16px",fontSize:"14px",border:"1px solid #eaddd7",borderRadius:"8px",outline:"none",transition:"all 0.2s",boxSizing:"border-box",fontFamily:"Inter, sans-serif",backgroundColor:"#ffffff"},onFocus:w=>{w.target.style.borderColor="#5d7fa3",w.target.style.boxShadow="0 0 0 3px rgba(93, 127, 163, 0.1)"},onBlur:w=>{w.target.style.borderColor="#eaddd7",w.target.style.boxShadow="none"}}),a.length>0&&a.length<2&&e.jsx("div",{style:{fontSize:"12px",color:"#dc2626",marginTop:"4px",fontFamily:"Inter, sans-serif"},children:"PÅ™Ã­jmenÃ­ musÃ­ mÃ­t alespoÅˆ 2 znaky"}),z&&e.jsxs("div",{style:{fontSize:"12px",color:"#6b7280",marginTop:"4px",fontFamily:"Inter, sans-serif"},children:["NÃ¡hled hesla: ",e.jsx("span",{style:{fontFamily:"monospace",fontWeight:"600"},children:z})]})]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",color:"#4a4a4a",marginBottom:"8px",fontFamily:"Inter, sans-serif"},children:["Role",e.jsx("span",{style:{color:"#d9534f",marginLeft:"4px"},children:"*"})]}),e.jsxs("select",{value:g,onChange:w=>u(w.target.value),disabled:m,style:{width:"100%",padding:"12px 16px",fontSize:"14px",border:"1px solid #eaddd7",borderRadius:"8px",outline:"none",transition:"all 0.2s",boxSizing:"border-box",background:"#ffffff",cursor:"pointer",fontFamily:"Inter, sans-serif",color:"#4a4a4a"},onFocus:w=>{w.target.style.borderColor="#5d7fa3",w.target.style.boxShadow="0 0 0 3px rgba(93, 127, 163, 0.1)"},onBlur:w=>{w.target.style.borderColor="#eaddd7",w.target.style.boxShadow="none"},children:[e.jsx("option",{value:"admin",children:"Admin (mÅ¯Å¾e pÅ™idÃ¡vat/upravovat knihy)"}),e.jsx("option",{value:"spravce",children:"SprÃ¡vce (plnÃ½ pÅ™Ã­stup k systÃ©mu)"})]})]}),d&&e.jsx("div",{style:{padding:"12px 16px",marginBottom:"20px",background:"#fee2e2",border:"1px solid #fecaca",borderRadius:"8px",fontSize:"14px",color:"#991b1b",fontFamily:"Inter, sans-serif"},children:d}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",onClick:t,disabled:m,style:{padding:"10px 20px",fontSize:"14px",fontWeight:"600",color:"#4a4a4a",background:"#f3eee8",border:"1px solid #eaddd7",borderRadius:"8px",cursor:m?"not-allowed":"pointer",opacity:m?.5:1,fontFamily:"Inter, sans-serif",transition:"all 0.2s"},onMouseEnter:w=>{m||(w.currentTarget.style.background="#eaddd7")},onMouseLeave:w=>{m||(w.currentTarget.style.background="#f3eee8")},children:"ZruÅ¡it"}),e.jsx("button",{type:"submit",disabled:m,style:{padding:"10px 20px",fontSize:"14px",fontWeight:"600",color:"white",backgroundColor:m?"#9ca3af":"#5d7fa3",border:"none",borderRadius:"8px",cursor:m?"not-allowed":"pointer",boxShadow:m?"none":"0 1px 2px rgba(0, 0, 0, 0.05)",fontFamily:"Inter, sans-serif",transition:"all 0.2s"},onMouseEnter:w=>{m||(w.currentTarget.style.backgroundColor="#4a6582",w.currentTarget.style.transform="translateY(-1px)",w.currentTarget.style.boxShadow="0 4px 6px rgba(0, 0, 0, 0.1)")},onMouseLeave:w=>{m||(w.currentTarget.style.backgroundColor="#5d7fa3",w.currentTarget.style.transform="translateY(0)",w.currentTarget.style.boxShadow="0 1px 2px rgba(0, 0, 0, 0.05)")},children:m?"VytvÃ¡Å™enÃ­...":"VytvoÅ™it uÅ¾ivatele"})]})]})})]})}),V&&P&&e.jsx(Hr,{email:n,password:P,onClose:()=>{F(!1),o()}})]})},Gr=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),Yr=()=>e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),Jr=()=>e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),e.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),e.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]}),qr=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),Xr=({currentUserId:t,onClose:o})=>{const[n,r]=p.useState([]),[s,l]=p.useState(!0),[a,c]=p.useState(null),[g,u]=p.useState(!1),[m,b]=p.useState(null),d=async()=>{l(!0),c(null);const{users:C,error:T}=await Mr();if(T){c(T),l(!1);return}r(C||[]),l(!1)};p.useEffect(()=>{d()},[]);const v=async(C,T)=>{if(C===t){alert("NemÅ¯Å¾ete smazat svÅ¯j vlastnÃ­ ÃºÄet");return}if(!confirm(`Opravdu chcete smazat uÅ¾ivatele ${T}?`))return;b(C);const{success:y,error:V}=await Ur(C);if(V){alert(`Chyba pÅ™i mazÃ¡nÃ­ uÅ¾ivatele: ${V}`),b(null);return}y&&await d(),b(null)},P=async(C,T)=>{if(C===t){alert("NemÅ¯Å¾ete zmÄ›nit svou vlastnÃ­ roli");return}const y=T==="admin"?"spravce":"admin";if(!confirm(`Opravdu chcete zmÄ›nit roli na "${y}"?`))return;const{success:V,error:F}=await Wr(C,y);if(F){alert(`Chyba pÅ™i zmÄ›nÄ› role: ${F}`);return}V&&await d()},f=C=>C==="spravce"?{bg:"#dbeafe",text:"#1e40af",border:"#bfdbfe"}:{bg:"#e0e7ff",text:"#4338ca",border:"#c7d2fe"},z=C=>C==="spravce"?"SprÃ¡vce":"Admin";return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"20px"},children:e.jsxs("div",{style:{background:"white",borderRadius:"12px",boxShadow:"0 20px 60px rgba(0,0,0,0.3)",width:"100%",maxWidth:"800px",maxHeight:"90vh",display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{padding:"24px",borderBottom:"1px solid #e5e7eb",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx(Gr,{}),e.jsx("h2",{style:{margin:0,fontSize:"20px",fontWeight:"600",color:"#1a202c"},children:"SprÃ¡va uÅ¾ivatelÅ¯"})]}),e.jsx("button",{onClick:o,style:{background:"none",border:"none",cursor:"pointer",padding:"8px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"6px",color:"#6b7280"},onMouseEnter:C=>{C.currentTarget.style.background="#f3f4f6"},onMouseLeave:C=>{C.currentTarget.style.background="none"},children:e.jsx(Yr,{})})]}),e.jsx("div",{style:{flex:1,overflow:"auto",padding:"24px"},children:s?e.jsxs("div",{style:{textAlign:"center",padding:"40px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",border:"4px solid #e5e7eb",borderTopColor:"#667eea",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto"}}),e.jsx("p",{style:{marginTop:"16px",color:"#6b7280"},children:"NaÄÃ­tÃ¡nÃ­ uÅ¾ivatelÅ¯..."})]}):a?e.jsx("div",{style:{padding:"16px",background:"#fee2e2",border:"1px solid #fecaca",borderRadius:"8px",color:"#991b1b"},children:a}):e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:"20px"},children:e.jsxs("button",{onClick:()=>u(!0),style:{padding:"10px 20px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"14px",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px"},onMouseEnter:C=>{C.currentTarget.style.transform="translateY(-2px)",C.currentTarget.style.boxShadow="0 4px 12px rgba(102, 126, 234, 0.4)"},onMouseLeave:C=>{C.currentTarget.style.transform="translateY(0)",C.currentTarget.style.boxShadow="none"},children:[e.jsx(qr,{}),"PÅ™idat uÅ¾ivatele"]})}),e.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:"8px",overflow:"hidden"},children:[e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#f9fafb"},children:[e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:"#6b7280",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Email"}),e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:"#6b7280",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Role"}),e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",fontSize:"12px",fontWeight:"600",color:"#6b7280",textTransform:"uppercase",letterSpacing:"0.05em"},children:"VytvoÅ™eno"}),e.jsx("th",{style:{padding:"12px 16px",textAlign:"right",fontSize:"12px",fontWeight:"600",color:"#6b7280",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Akce"})]})}),e.jsx("tbody",{children:n.map(C=>{const T=f(C.role),y=C.id===t;return e.jsxs("tr",{style:{borderTop:"1px solid #e5e7eb",background:y?"#f0fdf4":"white"},children:[e.jsx("td",{style:{padding:"16px"},children:e.jsxs("div",{style:{fontSize:"14px",color:"#1a202c",fontWeight:y?"600":"400"},children:[C.email,y&&e.jsx("span",{style:{marginLeft:"8px",fontSize:"12px",color:"#059669",fontWeight:"500"},children:"(Vy)"})]})}),e.jsx("td",{style:{padding:"16px"},children:e.jsx("span",{style:{display:"inline-block",padding:"4px 12px",fontSize:"12px",fontWeight:"600",color:T.text,background:T.bg,border:`1px solid ${T.border}`,borderRadius:"12px"},children:z(C.role)})}),e.jsx("td",{style:{padding:"16px"},children:e.jsx("span",{style:{fontSize:"14px",color:"#6b7280"},children:new Date(C.created_at).toLocaleDateString("cs-CZ")})}),e.jsx("td",{style:{padding:"16px",textAlign:"right"},children:e.jsx("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:!y&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>P(C.id,C.role),style:{padding:"6px 12px",fontSize:"12px",fontWeight:"500",color:"#4338ca",background:"#e0e7ff",border:"1px solid #c7d2fe",borderRadius:"6px",cursor:"pointer"},onMouseEnter:V=>{V.currentTarget.style.background="#c7d2fe"},onMouseLeave:V=>{V.currentTarget.style.background="#e0e7ff"},children:"ZmÄ›nit roli"}),e.jsxs("button",{onClick:()=>v(C.id,C.email),disabled:m===C.id,style:{padding:"6px 12px",fontSize:"12px",fontWeight:"500",color:"#991b1b",background:"#fee2e2",border:"1px solid #fecaca",borderRadius:"6px",cursor:m===C.id?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"6px",opacity:m===C.id?.5:1},onMouseEnter:V=>{m!==C.id&&(V.currentTarget.style.background="#fecaca")},onMouseLeave:V=>{m!==C.id&&(V.currentTarget.style.background="#fee2e2")},children:[e.jsx(Jr,{}),"Smazat"]})]})})})]},C.id)})})]}),n.length===0&&e.jsx("div",{style:{padding:"40px",textAlign:"center",color:"#6b7280"},children:"Nebyli nalezeni Å¾Ã¡dnÃ­ uÅ¾ivatelÃ©"})]})]})})]})}),g&&e.jsx(Kr,{onClose:()=>u(!1),onUserAdded:()=>{u(!1),d()}}),e.jsx("style",{children:`
                @keyframes spin {
                    to { transform: rotate(360deg); }
                }
            `})]})},Qr=({currentUser:t,onClose:o})=>{const[n,r]=p.useState(""),[s,l]=p.useState(""),[a,c]=p.useState(!1),[g,u]=p.useState(null),[m,b]=p.useState(!1),d=async v=>{if(v.preventDefault(),u(null),b(!1),!n||!s){u("VyplÅˆte vÅ¡echna pole");return}if(n.length<6){u("NovÃ© heslo musÃ­ mÃ­t alespoÅˆ 6 znakÅ¯");return}if(n!==s){u("NovÃ¡ hesla se neshodujÃ­");return}c(!0);try{const P=await Dr("",n);P.error?u(P.error):(b(!0),r(""),l(""),setTimeout(()=>{o()},2e3))}catch{u("NeoÄekÃ¡vanÃ¡ chyba pÅ™i zmÄ›nÄ› hesla")}finally{c(!1)}};return e.jsxs("div",{style:fe.container,children:[e.jsxs("div",{style:fe.header,children:[e.jsx("h2",{style:fe.title,children:"NastavenÃ­ profilu"}),e.jsx("button",{onClick:o,style:fe.closeButton,"aria-label":"ZavÅ™Ã­t",children:"âœ•"})]}),e.jsxs("div",{style:fe.userInfo,children:[e.jsxs("div",{style:fe.userInfoRow,children:[e.jsx("span",{style:fe.label,children:"Email:"}),e.jsx("span",{style:fe.value,children:t.email})]}),e.jsxs("div",{style:fe.userInfoRow,children:[e.jsx("span",{style:fe.label,children:"Role:"}),e.jsx("span",{style:fe.value,children:t.role==="spravce"?"SprÃ¡vce":"Admin"})]})]}),e.jsx("div",{style:fe.divider}),e.jsx("h3",{style:fe.subtitle,children:"ZmÄ›na hesla"}),g&&e.jsx("div",{style:fe.errorMessage,children:g}),m&&e.jsx("div",{style:fe.successMessage,children:"âœ“ Heslo bylo ÃºspÄ›Å¡nÄ› zmÄ›nÄ›no"}),e.jsxs("form",{onSubmit:d,style:fe.form,children:[e.jsxs("div",{style:fe.formGroup,children:[e.jsx("label",{style:fe.formLabel,htmlFor:"newPassword",children:"NovÃ© heslo"}),e.jsx("input",{id:"newPassword",type:"password",value:n,onChange:v=>r(v.target.value),style:fe.input,disabled:a,autoComplete:"new-password",minLength:6}),e.jsx("span",{style:fe.hint,children:"MinimÃ¡lnÄ› 6 znakÅ¯"})]}),e.jsxs("div",{style:fe.formGroup,children:[e.jsx("label",{style:fe.formLabel,htmlFor:"confirmPassword",children:"Potvrdit novÃ© heslo"}),e.jsx("input",{id:"confirmPassword",type:"password",value:s,onChange:v=>l(v.target.value),style:fe.input,disabled:a,autoComplete:"new-password"})]}),e.jsxs("div",{style:fe.buttonGroup,children:[e.jsx("button",{type:"button",onClick:o,style:fe.cancelButton,disabled:a,children:"ZruÅ¡it"}),e.jsx("button",{type:"submit",style:fe.submitButton,disabled:a,children:a?"UklÃ¡dÃ¡m...":"ZmÄ›nit heslo"})]})]})]})},fe={container:{display:"flex",flexDirection:"column",gap:"1.5rem",minWidth:"400px",maxWidth:"500px"},header:{display:"flex",justifyContent:"space-between",alignItems:"center"},title:{margin:0,fontSize:"1.5rem",fontWeight:"600",color:"var(--text-primary)"},closeButton:{background:"none",border:"none",fontSize:"1.5rem",cursor:"pointer",padding:"0.25rem",color:"var(--text-secondary)",transition:"color 0.2s"},userInfo:{display:"flex",flexDirection:"column",gap:"0.75rem",padding:"1rem",background:"var(--bg-secondary)",borderRadius:"8px"},userInfoRow:{display:"flex",justifyContent:"space-between",alignItems:"center"},label:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"500"},value:{color:"var(--text-primary)",fontSize:"0.9rem",fontWeight:"600"},divider:{height:"1px",background:"var(--border-color)",margin:"0.5rem 0"},subtitle:{margin:0,fontSize:"1.1rem",fontWeight:"600",color:"var(--text-primary)"},errorMessage:{padding:"0.75rem 1rem",background:"#fee",border:"1px solid #fcc",borderRadius:"6px",color:"#c33",fontSize:"0.9rem"},successMessage:{padding:"0.75rem 1rem",background:"#efe",border:"1px solid #cfc",borderRadius:"6px",color:"#3c3",fontSize:"0.9rem",fontWeight:"500"},form:{display:"flex",flexDirection:"column",gap:"1.25rem"},formGroup:{display:"flex",flexDirection:"column",gap:"0.5rem"},formLabel:{fontSize:"0.9rem",fontWeight:"500",color:"var(--text-primary)"},input:{padding:"0.75rem",fontSize:"1rem",border:"1px solid var(--border-color)",borderRadius:"6px",outline:"none",transition:"border-color 0.2s"},hint:{fontSize:"0.8rem",color:"var(--text-secondary)",fontStyle:"italic"},buttonGroup:{display:"flex",gap:"0.75rem",justifyContent:"flex-end",marginTop:"0.5rem"},cancelButton:{padding:"0.75rem 1.5rem",fontSize:"0.95rem",fontWeight:"500",border:"1px solid var(--border-color)",borderRadius:"6px",background:"white",color:"var(--text-primary)",cursor:"pointer",transition:"all 0.2s"},submitButton:{padding:"0.75rem 1.5rem",fontSize:"0.95rem",fontWeight:"500",border:"none",borderRadius:"6px",background:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",color:"white",cursor:"pointer",transition:"all 0.2s",boxShadow:"0 2px 8px rgba(59, 130, 246, 0.3)"}},es=["Leden","Ãšnor","BÅ™ezen","Duben","KvÄ›ten","ÄŒerven","ÄŒervenec","Srpen","ZÃ¡Å™Ã­","Å˜Ã­jen","Listopad","Prosinec"],Ao=()=>e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M12 2L9 9l-7 3 7 3 3 7 3-7 7-3-7-3L12 2z"}),e.jsx("path",{d:"M22 12l-3 3-3-3"}),e.jsx("path",{d:"M12 22l3-3 3 3"})]}),ts=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"3",width:"7",height:"7"}),e.jsx("rect",{x:"14",y:"3",width:"7",height:"7"}),e.jsx("rect",{x:"14",y:"14",width:"7",height:"7"}),e.jsx("rect",{x:"3",y:"14",width:"7",height:"7"})]}),os=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"8",y1:"6",x2:"21",y2:"6"}),e.jsx("line",{x1:"8",y1:"12",x2:"21",y2:"12"}),e.jsx("line",{x1:"8",y1:"18",x2:"21",y2:"18"}),e.jsx("line",{x1:"3",y1:"6",x2:"3.01",y2:"6"}),e.jsx("line",{x1:"3",y1:"12",x2:"3.01",y2:"12"}),e.jsx("line",{x1:"3",y1:"18",x2:"3.01",y2:"18"})]}),ns=()=>e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"17 8 12 3 7 8"}),e.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),Mo=()=>e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"7 10 12 15 17 10"}),e.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),Oe=({size:t=16})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),e.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),e.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]}),Uo=({size:t=16})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"#3b82f6",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),e.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),e.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"}),e.jsx("circle",{cx:"18",cy:"18",r:"3",fill:"#3b82f6"}),e.jsx("path",{d:"M16.5 18l1 1 2-2",stroke:"white",strokeWidth:"1.5",fill:"none"})]}),rs=()=>e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),ss=()=>e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M19 21H5a2 2 0 0 1-2 2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"}),e.jsx("polyline",{points:"17 21 17 13 7 13 7 21"}),e.jsx("polyline",{points:"7 3 7 8 15 8"})]}),as=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"1"}),e.jsx("circle",{cx:"12",cy:"5",r:"1"}),e.jsx("circle",{cx:"12",cy:"19",r:"1"})]}),ls=()=>e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"var(--warning-color)",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M12 9v2m0 4h.01"}),e.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"})]}),is=()=>e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),cs=()=>e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e.jsx("polyline",{points:"10 9 9 9 8 9"})]}),Qe=()=>e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),ds=()=>e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10z"}),e.jsx("circle",{cx:"9",cy:"10",r:"1"}),e.jsx("circle",{cx:"15",cy:"10",r:"1"})]}),us=()=>e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polygon",{points:"23 7 16 12 23 17 23 7"}),e.jsx("rect",{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"})]}),ps=()=>e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),xs=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"3"}),e.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]}),hs=()=>e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),e.jsx("polyline",{points:"16 17 21 12 16 7"}),e.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]}),Ve=({status:t="pending",isLoading:o=!1})=>{const n=()=>{if(o)return"#3b82f6";switch(t){case"success":return"#22c55e";case"error":return"#ef4444";case"pending":default:return"#6b7280"}},r=o?{animation:"spin 2s linear infinite",transformOrigin:"center"}:{};return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
                @keyframes spin {
                    from { transform: rotate(0deg); }
                    to { transform: rotate(360deg); }
                }
            `}),e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:n(),strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:r,children:[e.jsx("ellipse",{cx:"12",cy:"5",rx:"9",ry:"3"}),e.jsx("path",{d:"M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"}),e.jsx("path",{d:"M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"})]})]})},kt=t=>{if(!t)return"ğŸ³ï¸";const o=t.toLowerCase(),n={ÄeÅ¡tina:"ğŸ‡¨ğŸ‡¿",slovenÅ¡tina:"ğŸ‡¸ğŸ‡°",nÄ›mÄina:"ğŸ‡©ğŸ‡ª",angliÄtina:"ğŸ‡¬ğŸ‡§",francouzÅ¡tina:"ğŸ‡«ğŸ‡·",Å¡panÄ›lÅ¡tina:"ğŸ‡ªğŸ‡¸",italÅ¡tina:"ğŸ‡®ğŸ‡¹",portugalÅ¡tina:"ğŸ‡µğŸ‡¹",ruÅ¡tina:"ğŸ‡·ğŸ‡º",polÅ¡tina:"ğŸ‡µğŸ‡±",holandÅ¡tina:"ğŸ‡³ğŸ‡±",Å¡vÃ©dÅ¡tina:"ğŸ‡¸ğŸ‡ª",norÅ¡tina:"ğŸ‡³ğŸ‡´",dÃ¡nÅ¡tina:"ğŸ‡©ğŸ‡°",finÅ¡tina:"ğŸ‡«ğŸ‡®",ÄÃ­nÅ¡tina:"ğŸ‡¨ğŸ‡³",japonÅ¡tina:"ğŸ‡¯ğŸ‡µ",korejÅ¡tina:"ğŸ‡°ğŸ‡·",thajÅ¡tina:"ğŸ‡¹ğŸ‡­",vietnamÅ¡tina:"ğŸ‡»ğŸ‡³",hindÅ¡tina:"ğŸ‡®ğŸ‡³",arabÅ¡tina:"ğŸ‡¸ğŸ‡¦",hebrejÅ¡tina:"ğŸ‡®ğŸ‡±",tureÄtina:"ğŸ‡¹ğŸ‡·",perÅ¡tina:"ğŸ‡®ğŸ‡·",indonÃ©Å¡tina:"ğŸ‡®ğŸ‡©",bengÃ¡lÅ¡tina:"ğŸ‡§ğŸ‡©",mongolÅ¡tina:"ğŸ‡²ğŸ‡³",nepÃ¡lÅ¡tina:"ğŸ‡³ğŸ‡µ",maÄarÅ¡tina:"ğŸ‡­ğŸ‡º",rumunÅ¡tina:"ğŸ‡·ğŸ‡´",bulharÅ¡tina:"ğŸ‡§ğŸ‡¬",chorvatÅ¡tina:"ğŸ‡­ğŸ‡·",srbÅ¡tina:"ğŸ‡·ğŸ‡¸",slovinÅ¡tina:"ğŸ‡¸ğŸ‡®",bosenÅ¡tina:"ğŸ‡§ğŸ‡¦",makedonÅ¡tina:"ğŸ‡²ğŸ‡°",albÃ¡nÅ¡tina:"ğŸ‡¦ğŸ‡±",Å™eÄtina:"ğŸ‡¬ğŸ‡·",lotyÅ¡tina:"ğŸ‡±ğŸ‡»",litevÅ¡tina:"ğŸ‡±ğŸ‡¹",estonÅ¡tina:"ğŸ‡ªğŸ‡ª",islandÅ¡tina:"ğŸ‡®ğŸ‡¸",irÅ¡tina:"ğŸ‡®ğŸ‡ª",velÅ¡tina:"ğŸ´ó §ó ¢ó ·ó ¬ó ³ó ¿",maltÅ¡tina:"ğŸ‡²ğŸ‡¹",lucemburÅ¡tina:"ğŸ‡±ğŸ‡º",ukrajinÅ¡tina:"ğŸ‡ºğŸ‡¦",bÄ›loruÅ¡tina:"ğŸ‡§ğŸ‡¾",moldavÅ¡tina:"ğŸ‡²ğŸ‡©",gruzÃ­nÅ¡tina:"ğŸ‡¬ğŸ‡ª",armÃ©nÅ¡tina:"ğŸ‡¦ğŸ‡²",Ã¡zerbÃ¡jdÅ¾Ã¡nÅ¡tina:"ğŸ‡¦ğŸ‡¿",kazaÅ¡tina:"ğŸ‡°ğŸ‡¿",kyrgyzÅ¡tina:"ğŸ‡°ğŸ‡¬",uzbeÄtina:"ğŸ‡ºğŸ‡¿",tÃ¡dÅ¾iÄtina:"ğŸ‡¹ğŸ‡¯",tatarÅ¡tina:"ğŸ‡·ğŸ‡º",katalÃ¡nÅ¡tina:"ğŸ‡ªğŸ‡¸",baskiÄtina:"ğŸ‡ªğŸ‡¸",galicijÅ¡tina:"ğŸ‡ªğŸ‡¸",bretonÅ¡tina:"ğŸ‡«ğŸ‡·",sardÃ­nÅ¡tina:"ğŸ‡®ğŸ‡¹",latinÄina:"ğŸ‡»ğŸ‡¦",jidiÅ¡:"ğŸ‡®ğŸ‡±"};if(n[o])return n[o];for(const[r,s]of Object.entries(n))if(o.includes(r.substring(0,4))||r.includes(o.substring(0,4)))return s;return"ğŸ³ï¸"},gs=t=>t?new Date(t).toLocaleDateString("cs-CZ"):"N/A",fs=t=>t?t<1024?`${t} KB`:`${(t/1024).toFixed(2)} MB`:"0 KB",ms=t=>t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w.-]/g,"_").replace(/_{2,}/g,"_");console.log("âœ… PouÅ¾Ã­vÃ¡m centrÃ¡lnÃ­ Supabase klient z /src/lib/supabase.ts");console.log("âœ… Supabase client inicializovÃ¡n");(async()=>{try{console.log("ğŸ§ª TestovÃ¡nÃ­ pÅ™ipojenÃ­ k Supabase...");const{data:t,error:o}=await E.from("books").select("count").limit(1);o?console.error("âŒ Supabase pÅ™ipojenÃ­ selhalo:",o):console.log("âœ… Supabase pÅ™ipojenÃ­ ÃºspÄ›Å¡nÃ©!")}catch(t){console.error("âŒ Supabase test exception:",t)}})();const ft=t=>{if(!t)return[];if(Array.isArray(t))return t;if(typeof t=="string"){const o=t.trim();if(o.startsWith("[")&&o.endsWith("]"))try{const n=JSON.parse(o);return Array.isArray(n)?n:[]}catch(n){return console.error("Failed to parse JSON array string:",t,n),[]}if(o.startsWith("{")&&o.endsWith("}")){const n=o.slice(1,-1);return n===""?[]:n.split(",").map(r=>r.trim().replace(/^"|"$/g,""))}}return[]},bt=t=>(console.log("ğŸ”„ mapSupabaseToBook - OCR z DB:",t.OCR,"pro knihu:",t.title),{id:t.id,title:t.title,author:t.author||"NeznÃ¡mÃ½",publicationYear:t.publication_year,publisher:t.publisher||"",summary:t.summary||"",keywords:ft(t.keywords),language:t.language||"ÄeÅ¡tina",format:t.format,fileSize:t.file_size,coverImageUrl:t.cover_image_url,publicationTypes:ft(t.publication_types),labels:ft(t.labels),categories:ft(t.categories),releaseVersion:t.releaseVersion||"",dateAdded:t.created_at,filePath:t.file_path,content:"",vectorStatus:t.Vdtb||"pending",hasOCR:t.OCR||!1,vectorAddedAt:t.vector_added_at||void 0,metadataSnapshot:t.metadata_snapshot||void 0}),ce={async getBooks(){var o;const t=Math.random().toString(36).substring(7);console.log(`ğŸ“š [${t}] NaÄÃ­tÃ¡m knihy z databÃ¡ze...`);try{console.log(`[${t}] ğŸ” Metoda 1: ZkouÅ¡Ã­m Supabase client...`);const n=Date.now(),r=await fetch(`${Re}/rest/v1/books?select=*&order=created_at.desc`,{headers:{apikey:Pe,Authorization:`Bearer ${Pe}`,"Content-Type":"application/json"}}),s=Date.now();if(console.log(`[${t}] âœ… REST API odpovÄ›Ä za ${s-n}ms, status: ${r.status}`),!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const l=await r.json();console.log(`[${t}] âœ… NaÄteno ${l.length} knih z databÃ¡ze`),l.length>0&&console.log(`[${t}] PrvnÃ­ kniha:`,{id:l[0].id,title:l[0].title});const a=l.map(bt);return console.log(`[${t}] ğŸ“‹ MapovÃ¡no ${a.length} knih`),console.log(`[${t}] ğŸ‰ getBooks ÃºspÄ›Å¡nÄ› dokonÄen`),a}catch(n){throw console.error(`[${t}] âŒ Chyba pÅ™i naÄÃ­tÃ¡nÃ­ knih:`,{name:n.name,message:n.message,stack:(o=n.stack)==null?void 0:o.substring(0,200)}),n}},async callDeleteWebhook(t){const o="https://n8n.srv980546.hstgr.cloud/webhook/e871e7d6-ca10-4b9d-adc4-3b58ee2f8279";try{console.log(`ğŸ”— VolÃ¡m N8N webhook pro smazÃ¡nÃ­ knihy: ${t}`);const n=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_id:t})});if(!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);const r=await n.text();return console.log("âœ… N8N webhook ÃºspÄ›Å¡nÄ› zavolÃ¡n:",r),{success:!0,message:"N8N webhook ÃºspÄ›Å¡nÄ› zavolÃ¡n"}}catch(n){return console.error("âŒ Chyba pÅ™i volÃ¡nÃ­ N8N webhookÅ¯:",n),{success:!1,message:`Chyba pÅ™i volÃ¡nÃ­ N8N webhookÅ¯: ${n instanceof Error?n.message:"NeznÃ¡mÃ¡ chyba"}`}}},async callBulkDeleteWebhooks(t){const o="https://n8n.srv980546.hstgr.cloud/webhook/ae6f98d7-53a8-40b2-9d24-ca2ddf7c82de";console.log(`ğŸ”— VolÃ¡m N8N webhooky pro hromadnÃ© smazÃ¡nÃ­ ${t.length} knih`);const n=t.map(async r=>{try{const s=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:r,action:"delete",timestamp:new Date().toISOString()})});if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);return console.log(`âœ… N8N webhook ÃºspÄ›Å¡nÄ› zavolÃ¡n pro knihu: ${r}`),{bookId:r,success:!0,error:null}}catch(s){return console.error(`âŒ Chyba pÅ™i volÃ¡nÃ­ N8N webhookÅ¯ pro knihu ${r}:`,s),{bookId:r,success:!1,error:s instanceof Error?s.message:"NeznÃ¡mÃ¡ chyba"}}});try{const r=await Promise.allSettled(n);let s=0,l=0;r.forEach(c=>{c.status==="fulfilled"&&c.value.success?s++:l++});const a=`HromadnÃ© volÃ¡nÃ­ webhookÅ¯ dokonÄeno: ${s} ÃºspÄ›Å¡nÃ½ch, ${l} neÃºspÄ›Å¡nÃ½ch`;return console.log(`ğŸ”— ${a}`),{success:l===0,message:a,successCount:s,failureCount:l}}catch(r){return console.error("âŒ NeoÄekÃ¡vanÃ¡ chyba pÅ™i hromadnÃ©m volÃ¡nÃ­ webhookÅ¯:",r),{success:!1,message:`NeoÄekÃ¡vanÃ¡ chyba pÅ™i hromadnÃ©m volÃ¡nÃ­ webhookÅ¯: ${r instanceof Error?r.message:"NeznÃ¡mÃ¡ chyba"}`,successCount:0,failureCount:t.length}}},async updateBook(t){const o={title:t.title,author:t.author,publication_year:t.publicationYear,publisher:t.publisher,summary:t.summary,keywords:t.keywords,language:t.language,format:t.format,file_size:t.fileSize,cover_image_url:t.coverImageUrl,publication_types:t.publicationTypes,labels:t.labels,categories:t.categories,file_path:t.filePath,OCR:t.hasOCR,Vdtb:t.vectorStatus,...t.releaseVersion&&{releaseVersion:t.releaseVersion},...t.vectorAddedAt!==void 0&&{vector_added_at:t.vectorAddedAt},...t.metadataSnapshot!==void 0&&{metadata_snapshot:t.metadataSnapshot}},{data:n,error:r}=await E.from("books").update(o).eq("id",t.id).select().single();if(r)throw console.error("Error updating book:",r.message,r),r;if(!n)throw new Error("Book not found after update.");return bt(n)},async deleteBook(t,o,n,r){const s=[];if(o)try{console.log(`ğŸ–¼ï¸ MazÃ¡nÃ­ cover obrÃ¡zku pro knihu: ${t}`),console.log(`File path: ${o}`);const c=`covers/covers/${o.replace(/\.[^/.]+$/,"")}.jpg`;console.log(`Attempting to delete cover: ${c} from Books bucket`);const{error:g}=await E.storage.from("Books").remove([c]);g?(console.error("COVER DELETE FAILED:",g),s.push(`NepodaÅ™ilo se smazat cover obrÃ¡zek: ${g.message}`)):console.log(`âœ… Cover deleted successfully from Books bucket: ${c}`)}catch(a){console.error("Could not delete cover image:",a),s.push(`Chyba pÅ™i mazÃ¡nÃ­ cover obrÃ¡zku: ${a}`)}if(o)try{const{error:a}=await E.storage.from("Books").remove([o]);a&&(console.error("STORAGE DELETE FAILED:",a),s.push(`NepodaÅ™ilo se smazat soubor z ÃºloÅ¾iÅ¡tÄ›: ${a.message}`))}catch(a){console.error("STORAGE DELETE ERROR:",a),s.push(`Chyba pÅ™i mazÃ¡nÃ­ souboru: ${a}`)}try{console.log("ğŸ—‘ï¸ MazÃ¡nÃ­ z Supabase vektorovÃ© databÃ¡ze public.documents pro knihu:",t);const{error:a}=await E.rpc("delete_documents_by_file_id",{file_id:t});a?(console.error("SUPABASE DOCUMENTS DELETE FAILED:",a),s.push(`NepodaÅ™ilo se smazat z public.documents: ${a.message}`)):console.log("âœ… ÃšspÄ›Å¡nÄ› smazÃ¡no z Supabase public.documents")}catch(a){console.error("SUPABASE DOCUMENTS DELETE ERROR:",a),s.push(`Chyba pÅ™i mazÃ¡nÃ­ z Supabase documents: ${a}`)}try{console.log(`ğŸ–¼ï¸ MazÃ¡nÃ­ obrÃ¡zkÅ¯ pro knihu: ${t}`);const a=`main/production/${t}`;console.log(`ğŸ—‚ï¸ Attempting to delete image folder: ${a} from images bucket`);try{const{data:c,error:g}=await E.storage.from("images").list(a,{limit:1e3});if(console.log(`ğŸ“‹ List result - Error: ${(g==null?void 0:g.message)||"none"}, Files found: ${(c==null?void 0:c.length)||0}`),!g&&c&&c.length>0){const u=c.map(b=>`${a}/${b.name}`);console.log(`ğŸ—‘ï¸ Found ${u.length} files to delete:`,u);const{error:m}=await E.storage.from("images").remove(u);m?(console.error("âŒ IMAGE FILES DELETE FAILED:",m),s.push(`NepodaÅ™ilo se smazat obrÃ¡zky: ${m.message}`)):console.log(`âœ… Successfully deleted ${u.length} images from ${a}`)}else console.log(g?`ğŸ“ Folder not found or error: ${a} - ${g.message}`:`ğŸ“ No images found in folder: ${a}`)}catch(c){console.error(`ğŸ“ Error accessing folder ${a}:`,c),s.push(`Chyba pÅ™i pÅ™Ã­stupu ke sloÅ¾ce obrÃ¡zkÅ¯: ${c}`)}}catch(a){console.error("Could not delete image folder:",a),s.push(`Chyba pÅ™i mazÃ¡nÃ­ sloÅ¾ky obrÃ¡zkÅ¯: ${a}`)}let l=!1;try{const{error:a}=await E.from("books").delete().eq("id",t);a?(console.error("DATABASE DELETE FAILED:",a),s.push(`NepodaÅ™ilo se smazat zÃ¡znam z databÃ¡ze: ${a.message}`)):(console.log("Book record deleted successfully from database"),l=!0)}catch(a){console.error("DATABASE DELETE ERROR:",a),s.push(`Chyba pÅ™i mazÃ¡nÃ­ zÃ¡znamu z databÃ¡ze: ${a}`)}if(l)try{const a=await ce.callDeleteWebhook(t);a.success?console.log("âœ… N8N webhook ÃºspÄ›Å¡nÄ› zavolÃ¡n"):(console.warn("N8N webhook se nepodaÅ™ilo zavolat:",a.message),s.push(`VarovÃ¡nÃ­ - N8N webhook: ${a.message}`))}catch(a){console.error("N8N WEBHOOK ERROR:",a),s.push(`Chyba pÅ™i volÃ¡nÃ­ N8N webhookÅ¯: ${a}`)}s.length>0&&console.warn("Delete operation completed with warnings:",s)},async uploadFile(t,o="Books"){const n=ms(t.name),r=`${Date.now()}-${n}`,{error:s}=await E.storage.from(o).upload(r,t,{upsert:!0});if(s)throw console.error(`Error uploading file to bucket ${o}:`,s.message,s),s.message.includes("Unauthorized")||s.message.includes("row-level security")?new Error(`ProblÃ©m s oprÃ¡vnÄ›nÃ­mi pro nahrÃ¡vÃ¡nÃ­ do ${o}. Kontaktujte administrÃ¡tora.`):s;return{filePath:r,fileSize:Math.round(t.size/1024)}},async uploadFileWithId(t,o,n){const r=t.name.split(".").pop()||"";let s;o==="covers"?s=`${n}.jpg`:o==="Books"&&t.type.startsWith("image/")?s=`covers/${n}.jpg`:n.startsWith("covers/")?s=`covers/${n.replace("covers/","")}.jpg`:s=`${n}.${r}`,console.log(`Uploading to bucket '${o}' with path: ${s}`);const{error:l}=await E.storage.from(o).upload(s,t,{upsert:!0});if(l)throw console.error(`Error uploading file to bucket ${o}:`,l.message,l),l.message.includes("Unauthorized")||l.message.includes("row-level security")?new Error(`ProblÃ©m s oprÃ¡vnÄ›nÃ­mi pro nahrÃ¡vÃ¡nÃ­ do ${o}. Kontaktujte administrÃ¡tora.`):l;return console.log(`Successfully uploaded to ${o}/${s}`),{filePath:s,fileSize:Math.round(t.size/1024)}},async createBook(t){console.log("ğŸ’¾ API createBook - vstupnÃ­ OCR stav:",t.hasOCR);const o={title:t.title,author:t.author,publication_year:t.publicationYear,publisher:t.publisher,summary:t.summary,keywords:t.keywords,language:t.language,format:t.format,file_size:t.fileSize,cover_image_url:t.coverImageUrl,publication_types:t.publicationTypes,labels:t.labels,categories:t.categories,file_path:t.filePath,OCR:t.hasOCR,Vdtb:t.vectorStatus||"pending",...t.releaseVersion&&{releaseVersion:t.releaseVersion},...t.vectorAddedAt&&{vector_added_at:t.vectorAddedAt},...t.metadataSnapshot&&{metadata_snapshot:t.metadataSnapshot}};console.log("ğŸ’¾ UklÃ¡dÃ¡m do Supabase s OCR:",o.OCR);const{data:n,error:r}=await E.from("books").insert(o).select().single();if(r)throw console.error("Error creating book:",r.message,r),r.message.includes("row-level security")||r.message.includes("violates")?new Error("ProblÃ©m s databÃ¡zovÃ½mi oprÃ¡vnÄ›nÃ­mi. Aplikace potÅ™ebuje sprÃ¡vnÃ© nastavenÃ­ RLS politik v Supabase."):r;if(!n)throw new Error("Failed to create book.");return bt(n)},async getFileContent(t){if(!t)return"Soubor pro tuto knihu nebyl nalezen.";try{const{data:o,error:n}=await E.storage.from("Books").download(t);if(n)throw console.error("Error downloading file content:",n.message,n),n;return o?t.toLowerCase().split(".").pop()==="pdf"?(console.log("ğŸ” DetekovÃ¡n PDF soubor - spouÅ¡tÃ­m inteligentnÃ­ analÃ½zu..."),await this.extractPdfTextContent(o)):await o.text():"NepodaÅ™ilo se naÄÃ­st obsah souboru: soubor je prÃ¡zdnÃ½."}catch(o){return console.error("Failed to read file content:",o.message,o),`NepodaÅ™ilo se zpracovat obsah souboru: ${o.message}`}},async detectOCRFromStorage(t){if(!t)return!1;try{console.log("ğŸ” Detekuji OCR ze storage pro soubor:",t);const{data:o,error:n}=await E.storage.from("Books").download(t);if(n)return console.error("âŒ Chyba pÅ™i stahovÃ¡nÃ­ souboru pro OCR detekci:",n),!1;if(!o)return console.error("âŒ Soubor je prÃ¡zdnÃ½"),!1;const r=t.toLowerCase().split(".").pop();return r==="pdf"?(console.log("ğŸ“„ Analyzuji PDF soubor pro OCR..."),await this.detectOCRFromPDF(o)):r==="epub"?(console.log("ğŸ“š EPUB soubory obvykle obsahujÃ­ text"),!0):["txt","doc","docx","rtf"].includes(r||"")?(console.log("ğŸ“ TextovÃ© soubory obsahujÃ­ text"),!0):(console.log("â“ NeznÃ¡mÃ½ formÃ¡t, pÅ™edpoklÃ¡dÃ¡m Å¾e neobsahuje OCR"),!1)}catch(o){return console.error("âŒ Chyba pÅ™i detekci OCR:",o.message),!1}},async detectOCRFromPDF(t){try{const o=await t.arrayBuffer(),r=await pdfjsLib.getDocument(o).promise;console.log(`ğŸ“„ PDF mÃ¡ ${r.numPages} strÃ¡nek, kontroluji OCR...`);const s=Math.min(r.numPages,3);let l=0,a="";for(let u=1;u<=s;u++)try{const b=await(await r.getPage(u)).getTextContent();console.log(`ğŸ“„ StrÃ¡nka ${u}: Nalezeno ${b.items.length} textovÃ½ch objektÅ¯`);let d="";b.items.forEach((v,P)=>{let f="";v.str!==void 0?f=String(v.str):v.text!==void 0?f=String(v.text):v.chars!==void 0?f=String(v.chars):typeof v=="string"&&(f=v),f&&f.trim().length>0&&(d+=f+" ",console.log(`   PoloÅ¾ka ${P+1}: "${f.substring(0,50)}${f.length>50?"...":""}"`))}),d=d.trim(),a+=d+" ",l+=d.length,console.log(`ğŸ“ StrÃ¡nka ${u} celkem: ${d.length} znakÅ¯`),d.length>0&&console.log(`ğŸ“ Text strÃ¡nky ${u}: "${d.substring(0,200)}${d.length>200?"...":""}"`)}catch(m){console.warn(`âš ï¸ Chyba pÅ™i zpracovÃ¡nÃ­ strÃ¡nky ${u}:`,m)}if(l===0){console.log("ğŸ”„ Å½Ã¡dnÃ½ text nenalezen standardnÃ­ metodou, zkouÅ¡Ã­m alternativnÃ­ pÅ™Ã­stup...");try{for(let u=1;u<=Math.min(r.numPages,2);u++){const b=await(await r.getPage(u)).getOperatorList();console.log(`ğŸ“„ StrÃ¡nka ${u}: Nalezeno ${b.fnArray.length} operacÃ­`);for(let d=0;d<b.fnArray.length;d++){const v=b.fnArray[d],P=b.argsArray[d];(v===84||v===85||v===82)&&P&&P.length>0&&typeof P[0]=="string"&&(console.log(`ğŸ”¤ Nalezen text operÃ¡torem: "${P[0].substring(0,50)}"`),a+=P[0]+" ",l+=P[0].length)}}}catch(u){console.warn("âš ï¸ AlternativnÃ­ metoda selhala:",u)}}const c=a.trim(),g=c.length>10;return console.log(`âœ… OCR detekce dokonÄena: ${g?"NALEZEN":"NENALEZEN"}`),console.log(`ğŸ“Š Celkem extrahovÃ¡no: ${l} znakÅ¯`),c.length>0&&console.log(`ğŸ“ UkÃ¡zka extrahovanÃ©ho textu: "${c.substring(0,300)}${c.length>300?"...":""}"`),g}catch(o){return console.error("âŒ Chyba pÅ™i analÃ½ze PDF pro OCR:",o),!1}},async extractPdfTextContent(t){console.log("ğŸš€ SPOUÅ TÃM NOVÃ OCR PROCES...");try{const o=await t.arrayBuffer();console.log("ğŸ“¦ PDF naÄten, velikost:",Math.round(o.byteLength/1024),"KB");const r=await pdfjsLib.getDocument(o).promise;console.log(`ğŸ“„ PDF ÃºspÄ›Å¡nÄ› naÄten - ${r.numPages} strÃ¡nek`);const s=50,l=15e4,a=Math.min(r.numPages,s);let c="",g=0;console.log(`ğŸ”„ ZaÄÃ­nÃ¡m extrakci textu z ${a} strÃ¡nek...`);for(let m=1;m<=a;m++)try{const P=(await(await r.getPage(m)).getTextContent()).items.filter(f=>"str"in f&&f.str.trim().length>0).map(f=>f.str).join(" ").trim();if(P.length>0){if(c+=`

=== STRÃNKA ${m} ===
${P}`,g+=P.length,console.log(`ğŸ“ƒ StrÃ¡nka ${m}: ${P.length} znakÅ¯ (celkem: ${g})`),g>l){c=c.substring(0,l)+`

... [TEXT ZKRÃCEN] ...`,console.log(`âœ‚ï¸ Text zkrÃ¡cen na ${l} znakÅ¯ na strÃ¡nce ${m}`);break}}else console.log(`ğŸ“ƒ StrÃ¡nka ${m}: prÃ¡zdnÃ¡ nebo bez textu`)}catch(b){console.error(`âŒ Chyba pÅ™i zpracovÃ¡nÃ­ strÃ¡nky ${m}:`,b);continue}const u=c.trim();return u.length>50?(console.log(`âœ… ÃšSPÄšCH! ExtrahovÃ¡no ${u.length} znakÅ¯ z ${a} strÃ¡nek`),console.log(`ğŸ“Š PrvnÃ­ 200 znakÅ¯: "${u.substring(0,200)}..."`),u):(console.log(`âŒ NEÃšSPÄšCH! ExtrahovÃ¡no pouze ${u.length} znakÅ¯`),this.createNoTextResponse(r,u.length))}catch(o){return console.error("ğŸ’¥ KRITICKÃ CHYBA pÅ™i OCR:",o),`CHYBA pÅ™i zpracovÃ¡nÃ­ PDF: ${o instanceof Error?o.message:String(o)}`}},createNoTextResponse(t,o){return console.log("ğŸ“‹ VytvÃ¡Å™Ã­m strukturÃ¡lnÃ­ odpovÄ›Ä - PDF neobsahuje dostatek textu"),`âŒ PDF NEOBSAHUJE DOSTATEÄŒNÃ TEXT PRO AI ANALÃZU

ğŸ“Š Informace o dokumentu:
â€¢ PoÄet strÃ¡nek: ${t.numPages}
â€¢ Nalezeno znakÅ¯: ${o}
â€¢ PoÅ¾adovÃ¡no: minimÃ¡lnÄ› 50 znakÅ¯

ğŸ”§ MoÅ¾nÃ¡ Å™eÅ¡enÃ­:
1. PDF je naskenovanÃ½ obrÃ¡zek bez OCR vrstvy
2. PouÅ¾ijte OCR nÃ¡stroj pro pÅ™evod obrÃ¡zkÅ¯ na text
3. Nahrajte PDF s textovou vrstvou
4. Zkontrolujte kvalitu skenovÃ¡nÃ­

âš ï¸ Bez ÄitelnÃ©ho textu nelze provÃ©st AI analÃ½zu obsahu.`},async sendToVectorDatabase(t,o=!1){var r,s;const n="https://n8n.srv980546.hstgr.cloud/webhook/10f5ed9e-e0b1-465d-8bc8-b2ba9a37bc58";try{await ce.updateBook({...t,vectorStatus:"pending"}),console.log("ğŸ“¤ Stahuji soubor z Supabase storage...");const{data:l,error:a}=await E.storage.from("Books").download(t.filePath);if(a||!l)throw new Error(`NepodaÅ™ilo se stÃ¡hnout soubor: ${a==null?void 0:a.message}`);console.log("âœ… Soubor staÅ¾en, velikost:",l.size,"bytes");const c=new FormData;if(c.append("file",l,t.filePath.split("/").pop()||"unknown.pdf"),c.append("bookId",t.id),c.append("fileName",t.filePath.split("/").pop()||"unknown.pdf"),c.append("fileType",t.format.toLowerCase()),c.append("id",t.id),c.append("title",t.title),c.append("author",t.author),c.append("publicationYear",((r=t.publicationYear)==null?void 0:r.toString())||""),c.append("publisher",t.publisher||""),c.append("summary",t.summary||""),c.append("language",t.language||""),c.append("releaseVersion",t.releaseVersion||""),c.append("format",t.format),c.append("fileSize",((s=t.fileSize)==null?void 0:s.toString())||"0"),t.keywords&&t.keywords.length>0&&t.keywords.forEach(g=>{c.append("keywords[]",g)}),t.categories&&t.categories.length>0&&t.categories.forEach(g=>{c.append("categories[]",g)}),t.labels&&t.labels.length>0&&t.labels.forEach(g=>{c.append("labels[]",g)}),t.publicationTypes&&t.publicationTypes.length>0&&t.publicationTypes.forEach(g=>{c.append("publicationTypes[]",g)}),console.log("ğŸ“¦ FormData pÅ™ipraven s binÃ¡rnÃ­m souborem a strukturovanÃ½mi metadaty:",{bookId:t.id,fileName:t.filePath.split("/").pop(),fileType:t.format.toLowerCase(),fileSize:l.size,title:t.title,author:t.author,"keywords[]":t.keywords,"categories[]":t.categories,"labels[]":t.labels,"publicationTypes[]":t.publicationTypes}),o){console.log("â³ OdesÃ­lÃ¡m webhook a ÄekÃ¡m na odpovÄ›Ä (timeout 5 minut)...");const g=new AbortController,u=setTimeout(()=>{g.abort()},300*1e3);try{const m=await fetch(n,{method:"POST",body:c,signal:g.signal});if(clearTimeout(u),!m.ok){const z=await m.text();throw new Error(`HTTP ${m.status}: ${z||m.statusText}`)}let b=null;const d=await m.text();if(console.log("ğŸ“¥ Webhook raw odpovÄ›Ä:",d),d&&d.trim().length>0)try{b=JSON.parse(d),console.log("âœ… Webhook odpovÄ›Ä parsovÃ¡na:",b),console.log("ğŸ“Š Typ odpovÄ›di:",typeof b,"Array?",Array.isArray(b),"DÃ©lka:",b==null?void 0:b.length)}catch(z){console.warn("âš ï¸ NepodaÅ™ilo se parsovat JSON odpovÄ›Ä:",z),console.warn("âš ï¸ Raw text:",d)}else console.log("âš ï¸ Webhook vrÃ¡til prÃ¡zdnou odpovÄ›Ä");let v="error",P="";if(!b||d.trim().length===0)v="error",P="âŒ Webhook vrÃ¡til prÃ¡zdnou odpovÄ›Ä. Zkontrolujte n8n workflow a ujistÄ›te se, Å¾e vracÃ­ validnÃ­ JSON odpovÄ›Ä.";else if(Array.isArray(b)&&b.length>=2){console.log("ğŸ” HledÃ¡m objekty v poli...");const z=b.find(V=>V.hasOwnProperty("qdrant_ok")),C=b.find(V=>V.hasOwnProperty("supabase_ok"));console.log("ğŸ—„ï¸ Qdrant result:",z),console.log("ğŸ—„ï¸ Supabase result:",C);const T=(z==null?void 0:z.qdrant_ok)===!0,y=(C==null?void 0:C.supabase_ok)===!0;console.log("âœ… Qdrant OK:",T,"Supabase OK:",y),T&&y?(v="success",P="âœ… Soubor ÃºspÄ›Å¡nÄ› nahrÃ¡n do obou databÃ¡zÃ­ (Supabase + Qdrant)"):y&&!T?(v="error",P=`âš ï¸ Soubor nahrÃ¡n pouze do Supabase. Chyba Qdrant: ${(z==null?void 0:z.qdrant_error)||"NeznÃ¡mÃ¡ chyba"}`):T&&!y?(v="error",P=`âš ï¸ Soubor nahrÃ¡n pouze do Qdrant. Chyba Supabase: ${(C==null?void 0:C.supabase_error)||"NeznÃ¡mÃ¡ chyba"}`):(v="error",P=`âŒ Soubor se nepodaÅ™ilo nahrÃ¡t do Å¾Ã¡dnÃ© databÃ¡ze.
Supabase: ${(C==null?void 0:C.supabase_error)||"NeznÃ¡mÃ¡ chyba"}
Qdrant: ${(z==null?void 0:z.qdrant_error)||"NeznÃ¡mÃ¡ chyba"}`)}else console.log("âš ï¸ NeoÄekÃ¡vanÃ½ formÃ¡t odpovÄ›di, pouÅ¾Ã­vÃ¡m fallback. result.success:",b.success),v=b.success?"success":"error",P=b.message||(b.success?"ÃšspÄ›Å¡nÄ› nahrÃ¡no do vektorovÃ© databÃ¡ze":"Chyba pÅ™i nahrÃ¡vÃ¡nÃ­ do vektorovÃ© databÃ¡ze");let f={...t,vectorStatus:v};if(v==="success"){const z={title:t.title,author:t.author,publicationYear:t.publicationYear,publisher:t.publisher,summary:t.summary,keywords:t.keywords,language:t.language,format:t.format,fileSize:t.fileSize,coverImageUrl:t.coverImageUrl,publicationTypes:t.publicationTypes,labels:t.labels,categories:t.categories,releaseVersion:t.releaseVersion},C=JSON.stringify(z);f={...f,vectorAddedAt:new Date().toISOString(),metadataSnapshot:C},console.log("ğŸ“¸ VytvoÅ™en snapshot metadat pro detekci zmÄ›n:",z),console.log("ğŸ“¸ Snapshot JSON:",C)}try{await ce.updateBook(f)}catch(z){console.warn("âš ï¸ Webhook byl ÃºspÄ›Å¡nÃ½, ale nepodaÅ™ilo se aktualizovat status v databÃ¡zi:",z)}return{success:v==="success",message:P,details:b}}catch(m){throw clearTimeout(u),m instanceof Error&&m.name==="AbortError"?new Error("â° Timeout: Webhook neodpovÄ›dÄ›l do 5 minut. Zkuste to pozdÄ›ji nebo kontaktujte administrÃ¡tora."):m}}else return console.log("ğŸš€ OdesÃ­lÃ¡m webhook bez ÄekÃ¡nÃ­ na odpovÄ›Ä (fire-and-forget)..."),fetch(n,{method:"POST",body:c}).catch(g=>{console.error("âš ï¸ Chyba pÅ™i odesÃ­lÃ¡nÃ­ fire-and-forget webhoku (ignorovÃ¡no):",g)}),{success:!0,message:"PoÅ¾adavek odeslÃ¡n do fronty na zpracovÃ¡nÃ­"}}catch(l){console.error("Chyba pÅ™i odesÃ­lÃ¡nÃ­ do vektorovÃ© databÃ¡ze:",l);try{await ce.updateBook({...t,vectorStatus:"error"})}catch(a){console.error("Chyba pÅ™i aktualizaci statusu:",a)}return{success:!1,message:`Chyba: ${l instanceof Error?l.message:"NeznÃ¡mÃ¡ chyba"}`}}},async deleteFromSupabaseVectorDB(t){try{console.log("ğŸ—‘ï¸ MazÃ¡nÃ­ z Supabase vektorovÃ© databÃ¡ze, bookId:",t);const o=await fetch(`${Re}/rest/v1/documents?metadata->>file_id=eq.${t}`,{method:"DELETE",headers:{"Content-Type":"application/json",apikey:Pe,Authorization:`Bearer ${Pe}`,Prefer:"return=minimal"}});if(!o.ok){const n=await o.text();return console.error("âŒ Chyba pÅ™i mazÃ¡nÃ­ z Supabase vektorovÃ© DB:",o.status,n),{success:!1,message:`Chyba pÅ™i mazÃ¡nÃ­ z Supabase vektorovÃ© databÃ¡ze: ${o.status} ${n}`}}return console.log("âœ… ÃšspÄ›Å¡nÄ› smazÃ¡no z Supabase vektorovÃ© databÃ¡ze"),{success:!0,message:"ÃšspÄ›Å¡nÄ› smazÃ¡no z Supabase vektorovÃ© databÃ¡ze"}}catch(o){return console.error("âŒ Chyba pÅ™i mazÃ¡nÃ­ z Supabase vektorovÃ© DB:",o),{success:!1,message:`NeoÄekÃ¡vanÃ¡ chyba pÅ™i mazÃ¡nÃ­ z Supabase: ${o instanceof Error?o.message:"NeznÃ¡mÃ¡ chyba"}`}}},async deleteFromQdrantVectorDB(t){const o=["https://9aaad106-c442-4dba-b072-3fb8ad4da051.us-west-2-0.aws.cloud.qdrant.io:6333","https://9aaad106-c442-4dba-b072-3fb8ad4da051.us-west-2-0.aws.cloud.qdrant.io","https://9aaad106-c442-4dba-b072-3fb8ad4da051.us-west-2-0.aws.cloud.qdrant.io/api"],n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhY2Nlc3MiOiJtIn0.ls9vPmwrlvxTco80TUsQBMPg0utIzNTYgk25x9__Vbo";for(const r of o)try{console.log(`ğŸ—‘ï¸ ZkouÅ¡Ã­m mazÃ¡nÃ­ z Qdrant s URL: ${r}, bookId:`,t);const s=await fetch(`${r}/collections/documents/points/delete`,{method:"POST",headers:{"Content-Type":"application/json","Api-Key":n},body:JSON.stringify({filter:{must:[{key:"file_id",match:{value:t}}]}})});if(!s.ok){const a=await s.text();console.warn(`âŒ Chyba s URL ${r}:`,s.status,a);continue}const l=await s.json();return console.log("âœ… ÃšspÄ›Å¡nÃ¡ odpovÄ›Ä z Qdrant s URL",r,":",l),{success:!0,message:"ÃšspÄ›Å¡nÄ› smazÃ¡no z Qdrant vektorovÃ© databÃ¡ze"}}catch(s){console.warn(`âŒ Chyba s URL ${r}:`,s instanceof Error?s.message:"NeznÃ¡mÃ¡ chyba");continue}return{success:!1,message:"NeoÄekÃ¡vanÃ¡ chyba pÅ™i mazÃ¡nÃ­ z Qdrant: VÅ¡echny URL varianty selhaly (CORS nebo nedostupnost)"}},async deleteFromVectorDatabases(t){console.log("ğŸ—‘ï¸ Zahajuji mazÃ¡nÃ­ z obou vektorovÃ½ch databÃ¡zÃ­ pro knihu:",t);const o={supabase:{success:!1,message:""},qdrant:{success:!1,message:""}},[n,r]=await Promise.allSettled([this.deleteFromSupabaseVectorDB(t),this.deleteFromQdrantVectorDB(t)]);n.status==="fulfilled"?o.supabase=n.value:o.supabase={success:!1,message:`Chyba pÅ™i mazÃ¡nÃ­ z Supabase: ${n.reason}`},r.status==="fulfilled"?o.qdrant=r.value:o.qdrant={success:!1,message:`Chyba pÅ™i mazÃ¡nÃ­ z Qdrant: ${r.reason}`};const s=o.supabase.success&&o.qdrant.success,l=o.supabase.success||o.qdrant.success;let a="";return s?a="âœ… ÃšspÄ›Å¡nÄ› smazÃ¡no z obou vektorovÃ½ch databÃ¡zÃ­ (Supabase + Qdrant)":l?o.supabase.success?a=`âš ï¸ SmazÃ¡no pouze z Supabase. Qdrant chyba: ${o.qdrant.message}`:a=`âš ï¸ SmazÃ¡no pouze z Qdrant. Supabase chyba: ${o.supabase.message}`:a=`âŒ NepodaÅ™ilo se smazat z Å¾Ã¡dnÃ© vektorovÃ© databÃ¡ze.
Supabase: ${o.supabase.message}
Qdrant: ${o.qdrant.message}`,console.log("ğŸ“Š CelkovÃ½ vÃ½sledek mazÃ¡nÃ­ z vektorovÃ½ch databÃ¡zÃ­:",a),{success:s,message:a,details:o}},async getLabels(){try{const t=await fetch(`${Re}/rest/v1/labels?select=name&order=name.asc`,{headers:{apikey:Pe,Authorization:`Bearer ${Pe}`}});return t.ok?(await t.json()).map(n=>n.name):[]}catch(t){return console.error("Error fetching labels:",t),[]}},async addLabel(t){if(!t||t.trim()==="")return!1;const{error:o}=await E.from("labels").insert({name:t.trim()});return o?(console.error("Error adding label:",o.message,o),!1):!0},async deleteLabel(t){if(!t||t.trim()==="")return!1;const{error:o}=await E.from("labels").delete().eq("name",t.trim());return o?(console.error("Error deleting label:",o.message,o),!1):!0},async getCategories(){try{const t=await fetch(`${Re}/rest/v1/categories?select=name&order=name.asc`,{headers:{apikey:Pe,Authorization:`Bearer ${Pe}`}});return t.ok?(await t.json()).map(n=>n.name):[]}catch(t){return console.error("Error fetching categories:",t),[]}},async addCategory(t){if(!t||t.trim()==="")return!1;const{error:o}=await E.from("categories").insert({name:t.trim()});return o?(console.error("Error adding category:",o.message,o),!1):!0},async deleteCategory(t){if(!t||t.trim()==="")return!1;const{error:o}=await E.from("categories").delete().eq("name",t.trim());return o?(console.error("Error deleting category:",o.message,o),!1):!0},async getLanguages(){try{const t=await fetch(`${Re}/rest/v1/languages?select=name&order=name.asc`,{headers:{apikey:Pe,Authorization:`Bearer ${Pe}`}});return t.ok?(await t.json()).map(n=>n.name):[]}catch(t){return console.error("Error fetching languages:",t),[]}},async addLanguage(t,o){if(!t||t.trim()==="")return!1;const{error:n}=await E.from("languages").insert({name:t.trim(),code:(o==null?void 0:o.trim())||null});return n?(console.error("Error adding language:",n.message,n),!1):!0},async deleteLanguage(t){if(!t||t.trim()==="")return!1;const{error:o}=await E.from("languages").delete().eq("name",t.trim());return o?(console.error("Error deleting language:",o.message,o),!1):!0},async getPublicationTypes(){try{const t=await fetch(`${Re}/rest/v1/publication_types?select=name&order=name.asc`,{headers:{apikey:Pe,Authorization:`Bearer ${Pe}`}});return t.ok?(await t.json()).map(n=>n.name):[]}catch(t){return console.error("Error fetching publication types:",t),[]}},async addPublicationType(t,o){if(!t||t.trim()==="")return!1;const{error:n}=await E.from("publication_types").insert({name:t.trim(),description:(o==null?void 0:o.trim())||null});return n?(console.error("Error adding publication type:",n.message,n),!1):!0},async deletePublicationType(t){if(!t||t.trim()==="")return!1;const{error:o}=await E.from("publication_types").delete().eq("name",t.trim());return o?(console.error("Error deleting publication type:",o.message,o),!1):!0},async updateQdrantMetadata(t,o,n,r){const s="https://n8n.srv980546.hstgr.cloud/webhook/822e584e-0836-4d1d-aef1-5c4dce6573c0";try{console.log("ğŸ”„ OdesÃ­lÃ¡m poÅ¾adavek na aktualizaci Qdrant metadata pÅ™es n8n webhook"),console.log("ğŸ“‚ Kniha ID:",t),console.log("ğŸ“‚ NovÃ© categories:",o),console.log("ğŸ“‚ NovÃ© labels:",n),console.log("ğŸ“‚ NovÃ© publicationTypes:",r);const a=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"update_metadata",bookId:t,metadata:{categories:o,labels:n,publicationTypes:r}})});if(!a.ok){const g=await a.text();return console.error("âŒ Chyba pÅ™i volÃ¡nÃ­ n8n webhook:",a.status,g),{success:!1,message:`Chyba pÅ™i volÃ¡nÃ­ webhook: ${a.status} ${g}`}}const c=await a.json();if(console.log("âœ… OdpovÄ›Ä z n8n webhook:",c),c.status==="ok")return{success:!0,message:"âœ… Metadata ÃºspÄ›Å¡nÄ› aktualizovÃ¡na v databÃ¡zi"};if(Array.isArray(c)){const g=c.find(u=>u.hasOwnProperty("qdrant_ok"));return(g==null?void 0:g.qdrant_ok)===!0?{success:!0,message:"âœ… Metadata v Qdrant ÃºspÄ›Å¡nÄ› aktualizovÃ¡na"}:{success:!1,message:`âŒ Chyba pÅ™i aktualizaci Qdrant: ${(g==null?void 0:g.qdrant_error)||"NeznÃ¡mÃ¡ chyba"}`}}else return c.success?{success:!0,message:c.message||"âœ… Metadata v Qdrant ÃºspÄ›Å¡nÄ› aktualizovÃ¡na"}:{success:!1,message:c.message||"âŒ Chyba pÅ™i aktualizaci metadata"}}catch(l){return console.error("âŒ NeoÄekÃ¡vanÃ¡ chyba pÅ™i volÃ¡nÃ­ n8n webhook:",l),{success:!1,message:`NeoÄekÃ¡vanÃ¡ chyba pÅ™i aktualizaci metadata: ${l instanceof Error?l.message:"NeznÃ¡mÃ¡ chyba"}`}}}},bs=async(t,o)=>(alert("AI generovÃ¡nÃ­ bylo odstranÄ›no. PouÅ¾ijte prosÃ­m automatickou extrakci metadat pÅ™i nahrÃ¡vÃ¡nÃ­ souboru."),"AI nenÃ­ k dispozici."),ys=async t=>{console.log("ğŸ¤– Generuji metadata pomocÃ­ inteligentnÃ­ extrakce (auto-detekce OCR)..."),console.log("ğŸ“ FilePath:",t.filePath),console.log("ğŸ“– Kniha:",t.title,"od",t.author);try{if(t.format.toLowerCase()!=="pdf")throw new Error("InteligentnÃ­ extrakce metadat je podporovÃ¡na pouze pro PDF soubory");console.log("ğŸ“¥ VytvÃ¡Å™Ã­m signed URL pro PDF...");const{data:o,error:n}=await E.storage.from("Books").createSignedUrl(t.filePath,60);if(n||!o||!o.signedUrl)throw console.error("âŒ Chyba pÅ™i vytvÃ¡Å™enÃ­ signed URL:",n),new Error(`NepodaÅ™ilo se zÃ­skat signed URL: ${(n==null?void 0:n.message)||"NeznÃ¡mÃ¡ chyba"}`);console.log("âœ… Signed URL vytvoÅ™ena:",o.signedUrl),console.log("ğŸ¤– VolÃ¡m inteligentnÃ­ extrakÄnÃ­ sluÅ¾bu...");const r=await fr(o.signedUrl,t.title||"dokument.pdf",Re,Pe);if(!r.success)throw new Error(r.error||"InteligentnÃ­ extrakce selhala bez zprÃ¡vy");if(!r.metadata)throw new Error("InteligentnÃ­ extrakce nevrÃ¡tila metadata");console.log("âœ… Metadata ÃºspÄ›Å¡nÄ› extrahovÃ¡na:",r.metadata),console.log(`ğŸ“Š PouÅ¾itÃ½ vstup: ${r.type} | Model: ${r.model}`);const s={};return r.metadata.title&&(s.title=r.metadata.title),r.metadata.author&&(s.author=r.metadata.author),r.metadata.publicationYear&&(s.publicationYear=r.metadata.publicationYear),r.metadata.publisher&&(s.publisher=r.metadata.publisher),r.metadata.language&&(s.language=r.metadata.language),r.metadata.summary&&(s.summary=r.metadata.summary),r.metadata.keywords&&r.metadata.keywords.length>0&&(s.keywords=r.metadata.keywords),r.metadata.releaseVersion&&(s.releaseVersion=r.metadata.releaseVersion),console.log("âœ… Metadata pÅ™ipravena k naplnÄ›nÃ­ polÃ­:",s),s}catch(o){throw console.error("âŒ Chyba pÅ™i inteligentnÃ­ extrakci metadat:",o),console.error("âŒ Error details:",{message:o instanceof Error?o.message:String(o),stack:o instanceof Error?o.stack:"N/A"}),o}},vs=(t,o,n)=>{const r=document.createElement("a"),s=new Blob([t],{type:n});r.href=URL.createObjectURL(s),r.download=o,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(r.href)},Wo=async t=>{try{if(console.log("Loading PDF document, size:",t.byteLength,"bytes"),!pdfjsLib||!pdfjsLib.getDocument)return console.error("PDF.js library is not properly loaded"),null;const o=pdfjsLib.getDocument(t);console.log("PDF loading task created");const n=await o.promise;if(console.log("PDF loaded successfully, pages:",n.numPages),n.numPages===0)return console.error("PDF has no pages"),null;const r=await n.getPage(1);console.log("First page loaded successfully");const s=r.getViewport({scale:1.5});console.log("Viewport created:",{width:s.width,height:s.height});const l=document.createElement("canvas"),a=l.getContext("2d");return l.height=s.height,l.width=s.width,a?(console.log("Starting page render..."),await r.render({canvasContext:a,viewport:s}).promise,console.log("Page rendered successfully to canvas"),new Promise(c=>{l.toBlob(g=>{if(g){console.log("Canvas converted to blob, size:",g.size,"bytes");const u=`cover-${Date.now()}.jpg`;c(new File([g],u,{type:"image/jpeg"}))}else console.error("Failed to convert canvas to blob"),c(null)},"image/jpeg",.9)})):(console.error("Could not get canvas context"),null)}catch(o){return console.error("Error generating cover from PDF:",o),console.error("Error details:",{name:o.name,message:o.message,stack:o.stack}),null}};window.testPdfCoverGeneration=async t=>{if(!t||t.type!=="application/pdf"){console.error("Please provide a valid PDF file");return}console.log("Testing PDF cover generation with file:",t.name);const o=await t.arrayBuffer(),n=await Wo(o);if(n){console.log("âœ… Success! Generated cover:",{name:n.name,type:n.type,size:n.size});const r=URL.createObjectURL(n);console.log("Preview URL:",r);const s=document.createElement("img");return s.src=r,s.style.maxWidth="200px",s.style.border="1px solid #ccc",s.style.margin="10px",s.title="Generated PDF Cover",document.body.appendChild(s),{success:!0,file:n,previewUrl:r}}else return console.error("âŒ Failed to generate cover"),{success:!1}};window.testBucketStructure=()=>{console.log("ğŸ“ Expected bucket structure:"),console.log("Books bucket: book_[timestamp]_[id].pdf"),console.log("Covers bucket: book_[timestamp]_[id].jpg"),console.log(""),console.log("Example:"),console.log("Books/book_1735234567890_abc123def.pdf"),console.log("Covers/book_1735234567890_abc123def.jpg"),console.log(""),console.log("Both files share the same ID for easy pairing!")};window.testSupabaseConnection=async()=>{var t;console.log("ğŸ§ª TestovÃ¡nÃ­ pÅ™ipojenÃ­ k Supabase..."),console.log("URL:",Re),console.log("Client:",!!E);try{console.log("ğŸ” ZaÄÃ­nÃ¡m jednoduchÃ½ test dotaz...");const{data:o,error:n,count:r}=await E.from("books").select("id",{count:"exact"}).limit(1);return console.log("ğŸ” Test dotaz dokonÄen:",{data:!!o,error:!!n,count:r}),n?(console.error("âŒ Supabase connection failed:",{message:n.message,details:n.details,hint:n.hint,code:n.code}),{success:!1,error:n,details:"Query returned error"}):(console.log("âœ… Supabase connection successful! PoÄet knih:",r),{success:!0,data:o,count:r,details:"Connection OK"})}catch(o){return console.error("âŒ Supabase connection exception:",{name:o.name,message:o.message,stack:((t=o.stack)==null?void 0:t.substring(0,200))+"..."}),{success:!1,error:o,details:o.message||"Unknown error"}}};window.refreshBooks=async()=>{console.log("ğŸ”„ RuÄnÄ› obnovuji seznam knih...");try{const t=await ce.getBooks();return console.log(`âœ… NaÄteno ${t.length} knih:`),t.length>0&&console.log("PrvnÃ­ch 3 knihy:",t.slice(0,3).map(o=>({id:o.id,title:o.title}))),t}catch(t){return console.error("âŒ Chyba pÅ™i obnovovÃ¡nÃ­ knih:",t),null}};window.loadBooksSlowly=async()=>{console.log("ğŸŒ PostupnÃ© naÄÃ­tÃ¡nÃ­ knih...");try{console.log("1. ZÃ­skÃ¡vÃ¡m poÄet knih...");const{count:t}=await E.from("books").select("*",{count:"exact",head:!0});if(console.log(`PoÄet knih v databÃ¡zi: ${t}`),!t||t===0)return console.log("âš ï¸ DatabÃ¡ze je prÃ¡zdnÃ¡!"),[];console.log("2. NaÄÃ­tÃ¡m knihy po dÃ¡vkÃ¡ch...");const o=10,n=[];for(let r=0;r<t;r+=o){console.log(`NaÄÃ­tÃ¡m knihy ${r+1}-${Math.min(r+o,t)}...`);const{data:s,error:l}=await E.from("books").select("*").order("created_at",{ascending:!1}).range(r,r+o-1);if(l){console.error(`Chyba pÅ™i naÄÃ­tÃ¡nÃ­ dÃ¡vky ${r}:`,l);break}s&&(n.push(...s),console.log(`âœ… NaÄteno ${s.length} knih (celkem: ${n.length})`))}return console.log(`ğŸ“‹ Celkem naÄteno: ${n.length} knih`),n.map(bt)}catch(t){return console.error("âŒ Chyba pÅ™i postupnÃ©m naÄÃ­tÃ¡nÃ­:",t),null}};window.testCoversBucketAccess=async()=>{console.log('ğŸ§ª Testing access to "covers" bucket...');const t="test",o=new Blob([t],{type:"text/plain"}),n=new File([o],"test.txt",{type:"text/plain"});try{console.log("1. Testing upload to covers bucket...");const{error:r}=await E.storage.from("covers").upload("test-file.txt",n,{upsert:!0});if(r)return console.error("âŒ Upload to covers bucket failed:",r.message),console.error("Full error:",r),{success:!1,error:r.message};{console.log("âœ… Upload to covers bucket successful!"),console.log("2. Testing public URL from covers bucket...");const{data:s}=E.storage.from("covers").getPublicUrl("test-file.txt");return console.log("Public URL:",s.publicUrl),console.log("3. Cleaning up test file..."),await E.storage.from("covers").remove(["test-file.txt"]),console.log("âœ… Test completed successfully!"),{success:!0,publicUrl:s.publicUrl}}}catch(r){return console.error("âŒ Unexpected error during covers bucket test:",r),{success:!1,error:r.message}}};const Tt=t=>{const o=`extracted_text_${t}`,n=`${o}_timestamp`,r=localStorage.getItem(o),s=localStorage.getItem(n);if(r&&s){const l=Date.now()-parseInt(s),a=1440*60*1e3;if(l<a)return console.log("ğŸ’¾ Text naÄten z mezipamÄ›ti (vÄ›k:",Math.round(l/1e3/60),"minut)"),r;console.log("â° MezipamÄ›Å¥ vyprÅ¡ela, mazÃ¡nÃ­..."),localStorage.removeItem(o),localStorage.removeItem(n)}return null},Se=t=>{const o=`extracted_text_${t}`,n=`${o}_timestamp`,r=localStorage.getItem(o),s=localStorage.getItem(n);if(r&&s){const l=Date.now()-parseInt(s),a=1440*60*1e3;if(l<a){const c=Math.round(l/1e3/60),g=c<60?`${c} min`:`${Math.round(c/60)} hod`;return{hasCache:!0,size:r.length,age:g}}}return{hasCache:!1,size:0,age:""}},$t=t=>{const o=`extracted_text_${t}`,n=`${o}_timestamp`;localStorage.removeItem(o),localStorage.removeItem(n),console.log("ğŸ—‘ï¸ MezipamÄ›Å¥ pro knihu",t,"vyÄiÅ¡tÄ›na")};window.showTextCache=()=>{console.log("ğŸ” STAV MEZIPAMÄšTI TEXTU:"),console.log("â”€".repeat(50));const o=Object.keys(localStorage).filter(n=>n.startsWith("extracted_text_"));if(o.length===0){console.log("ğŸ“­ Å½Ã¡dnÃ© texty v mezipamÄ›ti");return}o.forEach(n=>{const r=n.replace("extracted_text_",""),s=`${n}_timestamp`,l=localStorage.getItem(s);if(l){const a=Date.now()-parseInt(l),c=Math.round(a/1e3/60),g=c<60?`${c} min`:`${Math.round(c/60)} hod`,u=localStorage.getItem(n),m=u?u.length:0;console.log(`ğŸ“– ${r}: ${m} znakÅ¯ (vÄ›k: ${g})`)}}),console.log("â”€".repeat(50))};const mt=async t=>{const o="https://n8n.srv980546.hstgr.cloud/webhook/79522dec-53ac-4f64-9253-1c5759aa8b45";try{console.log("ğŸš€ OdesÃ­lÃ¡m dokument na webhook pro extrakci textu..."),console.log("ğŸ“– Kniha:",t.title),console.log("ğŸ“ FilePath:",t.filePath);const{data:n,error:r}=await E.storage.from("Books").download(t.filePath);if(r||!n)throw new Error(`NepodaÅ™ilo se stÃ¡hnout soubor: ${r==null?void 0:r.message}`);console.log("ğŸ“¤ OdesÃ­lÃ¡m binÃ¡rnÃ­ soubor na webhook..."),console.log("ğŸ“Š Velikost souboru:",n.size,"bajtÅ¯");const s=new FormData;s.append("file",n,t.filePath.split("/").pop()||"document.pdf"),s.append("bookId",t.id),s.append("fileName",t.filePath.split("/").pop()||"unknown.pdf"),s.append("fileType",t.format.toLowerCase()),s.append("metadata",JSON.stringify({title:t.title,author:t.author,publicationYear:t.publicationYear,language:t.language,releaseVersion:t.releaseVersion}));const l=await fetch(o,{method:"POST",body:s});if(!l.ok){const u=await l.text();throw console.error("âŒ Webhook chyba:",u),l.status===404?new Error(`Webhook nenÃ­ dostupnÃ½ (404). Zkontrolujte, zda je n8n workflow aktivnÃ­ a webhook zaregistrovanÃ½. Chyba: ${u}`):new Error(`HTTP error! status: ${l.status} - ${u}`)}let a;const c=await l.text();try{const u=JSON.parse(c);console.log("âœ… Webhook JSON odpovÄ›Ä:",u),u.success&&u.extractedText||u.extractedText?a=u.extractedText:a=c}catch{console.log("âœ… Webhook vrÃ¡til ÄistÃ½ text (ne JSON):",c.substring(0,200)+"..."),a=c}if(!a||a.trim().length===0)throw new Error("Webhook vrÃ¡til prÃ¡zdnÃ½ text");const g=`extracted_text_${t.id}`;return localStorage.setItem(g,a),localStorage.setItem(`${g}_timestamp`,Date.now().toString()),console.log("ğŸ’¾ Text uloÅ¾en do mezipamÄ›ti:",a.length,"znakÅ¯"),a}catch(n){throw console.error("âŒ Chyba pÅ™i extrakci textu pÅ™es webhook:",n),n}},ks=async t=>{const o="https://n8n.srv980546.hstgr.cloud/webhook/c2d2f94f-1be3-4d68-a2ec-12f23b3580e1";try{console.log("ğŸš€ OdesÃ­lÃ¡m dokument na LLM kontext webhook s limitem",50,"strÃ¡nek..."),console.log("ğŸ“– Kniha:",t.title),console.log("ğŸ“ FilePath:",t.filePath),console.log("ğŸ” TestovÃ¡nÃ­ PDFLib dostupnosti:",{windowPDFLib:!!window.PDFLib,PDFDocument:!!(window.PDFLib&&window.PDFLib.PDFDocument)});const{data:r,error:s}=await E.storage.from("Books").download(t.filePath);if(s||!r)throw new Error(`NepodaÅ™ilo se stÃ¡hnout soubor: ${s==null?void 0:s.message}`);let l=r;if(t.format.toLowerCase()==="pdf"){console.log("ğŸ“„ Kontroluji poÄet strÃ¡nek PDF...");const v=await r.arrayBuffer(),f=await pdfjsLib.getDocument(v).promise;if(console.log(`ğŸ“Š PDF mÃ¡ ${f.numPages} strÃ¡nek`),f.numPages>50){console.log("âœ‚ï¸ PDF mÃ¡ vÃ­ce neÅ¾ 50 strÃ¡nek, oÅ™ezÃ¡vÃ¡m na prvnÃ­ch 50 strÃ¡nek...");try{let z=null;if(window.PDFLib&&window.PDFLib.PDFDocument?(z=window.PDFLib.PDFDocument,console.log("ğŸ“š PouÅ¾Ã­vÃ¡m window.PDFLib.PDFDocument")):window.PDFLib&&window.PDFLib.PDFDocument?(z=window.PDFLib.PDFDocument,console.log("ğŸ“š PouÅ¾Ã­vÃ¡m (window as any).PDFLib.PDFDocument")):globalThis.PDFLib&&globalThis.PDFLib.PDFDocument&&(z=globalThis.PDFLib.PDFDocument,console.log("ğŸ“š PouÅ¾Ã­vÃ¡m globalThis.PDFLib.PDFDocument")),!z)console.warn("âš ï¸ PDFLib nenÃ­ dostupnÃ©, posÃ­lÃ¡m celÃ© PDF s upozornÄ›nÃ­m"),console.warn("ğŸ” DostupnÃ© objekty:",Object.keys(window).filter(C=>C.includes("PDF"))),console.log(`ğŸ“¤ PosÃ­lÃ¡m celÃ© PDF (${f.numPages} strÃ¡nek) - webhook musÃ­ oÅ™ezat na 50 strÃ¡nek`);else{console.log("ğŸ“ VytvÃ¡Å™Ã­m novÃ© PDF s prvnÃ­mi",50,"strÃ¡nkami...");const C=await z.load(v),T=await z.create(),y=Array.from({length:Math.min(50,f.numPages)},(S,R)=>R);(await T.copyPages(C,y)).forEach(S=>T.addPage(S));const F=await T.save();l=new Blob([F],{type:"application/pdf"}),console.log(`âœ… PDF ÃºspÄ›Å¡nÄ› oÅ™ezÃ¡no z ${f.numPages} na 50 strÃ¡nek`),console.log(`ğŸ“¦ NovÃ¡ velikost: ${Math.round(l.size/1024)} KB (pÅ¯vodnÃ­: ${Math.round(r.size/1024)} KB)`)}}catch(z){console.error("âŒ Chyba pÅ™i oÅ™ezÃ¡vÃ¡nÃ­ PDF pomocÃ­ PDFLib:",z),console.log("âš ï¸ PokusÃ­m se o alternativnÃ­ Å™eÅ¡enÃ­..."),console.log("âš ï¸ PosÃ­lÃ¡m celÃ© PDF s explicitnÃ­ instrukcÃ­ pro oÅ™ezÃ¡nÃ­ na 50 strÃ¡nek"),l.__needsTrimming=!0,l.__originalPages=f.numPages}}else console.log(`âœ… PDF mÃ¡ ${f.numPages} strÃ¡nek, coÅ¾ je v limitu 50 strÃ¡nek`)}let a=50;if(t.format.toLowerCase()==="pdf")try{const v=await l.arrayBuffer();a=(await pdfjsLib.getDocument(v).promise).numPages,console.log(`ğŸ“‹ SkuteÄnÃ½ poÄet strÃ¡nek v odesÃ­lanÃ©m PDF: ${a}`)}catch{console.warn("âš ï¸ NepodaÅ™ilo se zjistit poÄet strÃ¡nek oÅ™ezanÃ©ho PDF, pouÅ¾Ã­vÃ¡m MAX_PAGES")}console.log("ğŸ“¤ OdesÃ­lÃ¡m soubor na LLM kontext webhook..."),console.log("ğŸ“Š Velikost souboru:",l.size,"bajtÅ¯"),console.log("ğŸŒ Webhook URL:",o);const c=new FormData;c.append("file",l,t.filePath.split("/").pop()||"document.pdf"),c.append("bookId",t.id),c.append("fileName",t.filePath.split("/").pop()||"unknown.pdf"),c.append("fileType",t.format.toLowerCase()),c.append("maxPages","50"),c.append("actualPages",a.toString()),c.append("isLLMContext","true");const g=l.__needsTrimming||!1,u=l.__originalPages||a;c.append("needsTrimming",g.toString()),c.append("originalPages",u.toString()),c.append("metadata",JSON.stringify({title:t.title,author:t.author,publicationYear:t.publicationYear,language:t.language,releaseVersion:t.releaseVersion,requestedMaxPages:50,actualPages:a})),console.log("ğŸ“‹ FormData obsahuje:",{fileName:t.filePath.split("/").pop(),bookId:t.id,fileType:t.format.toLowerCase(),maxPages:50,actualPages:a,needsTrimming:g,originalPages:u,isLLMContext:!0});const m=await fetch(o,{method:"POST",body:c});if(!m.ok){const v=await m.text();throw console.error("âŒ LLM kontext webhook chyba:",v),m.status===404?new Error(`LLM kontext webhook nenÃ­ dostupnÃ½ (404). Zkontrolujte, zda je n8n workflow aktivnÃ­ a webhook zaregistrovanÃ½. Chyba: ${v}`):new Error(`HTTP error! status: ${m.status} - ${v}`)}const b=await m.text();console.log("âœ… LLM kontext webhook odpovÄ›Ä:",b.length,"znakÅ¯");const d=`extracted_text_${t.id}`;return localStorage.setItem(d,b),localStorage.setItem(`${d}_timestamp`,Date.now().toString()),console.log("ğŸ’¾ LLM kontext text uloÅ¾en do mezipamÄ›ti a pÅ™epsal stÃ¡vajÃ­cÃ­ OCR:",b.length,"znakÅ¯"),b}catch(r){throw console.error("âŒ Chyba pÅ™i odesÃ­lÃ¡nÃ­ na LLM kontext webhook:",r),r}},Te=({isOpen:t,onClose:o,title:n,children:r})=>t?e.jsx("div",{style:h.modalOverlay,onClick:o,children:e.jsxs("div",{style:h.modalContent,onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{style:h.modalHeader,children:[e.jsx("h3",{children:n}),e.jsx("button",{style:h.modalCloseButton,onClick:o,children:e.jsx(is,{})})]}),e.jsx("div",{style:h.modalBody,children:r})]})}):null,Lt=({selectedTags:t,allTags:o,onChange:n,onAddNewTag:r,onDeleteTag:s,promptText:l,creationText:a})=>{const[c,g]=p.useState(!1),[u,m]=p.useState(!1),[b,d]=p.useState(!1),[v,P]=p.useState(""),[f,z]=p.useState({isOpen:!1,tag:null}),C=o.filter(w=>!t.includes(w)),T=p.useRef(null),y=w=>{n(t.filter(U=>U!==w))},V=w=>{t.includes(w)||n([...t,w]),g(!1)},F=()=>{g(!1),P(""),m(!0)},S=()=>{const w=v.trim();w&&(r(w),t.includes(w)||n([...t,w])),m(!1),P("")},R=w=>{z({isOpen:!0,tag:w}),g(!1),d(!1)},J=()=>{f.tag&&s&&s(f.tag),z({isOpen:!1,tag:null})};return p.useEffect(()=>{const w=U=>{T.current&&!T.current.contains(U.target)&&g(!1)};return document.addEventListener("mousedown",w),()=>document.removeEventListener("mousedown",w)},[T]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{position:"relative"},ref:T,children:[e.jsxs("div",{style:h.tagInputContainer,children:[t.map(w=>e.jsxs("span",{style:{...h.tag,display:"flex",alignItems:"center"},children:[w,e.jsx("button",{onClick:()=>y(w),style:h.tagRemoveButton,children:"Ã—"})]},w)),e.jsxs("button",{onClick:()=>g(w=>!w),style:h.tagInputAddButton,children:[e.jsx(Qe,{})," PÅ™idat"]})]}),c&&e.jsxs("div",{style:h.tagDropdown,children:[C.map(w=>e.jsx("a",{onClick:()=>V(w),style:h.dropdownMenuLink,children:w},w)),e.jsx("div",{style:{borderTop:"1px solid var(--border)",margin:"4px 0"}}),e.jsxs("a",{onClick:F,style:{...h.dropdownMenuLink,...h.addNewTagLink},children:[e.jsx(Qe,{})," ",a]}),s&&o.length>0&&e.jsxs("a",{onClick:()=>{g(!1),d(!0)},style:{...h.dropdownMenuLink,color:"var(--danger-color)"},children:[e.jsx(Oe,{size:14})," Spravovat poloÅ¾ky"]})]})]}),e.jsx(Te,{isOpen:u,onClose:()=>m(!1),title:l,children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsx("input",{type:"text",value:v,onChange:w=>P(w.target.value),style:h.input,placeholder:"Zadejte nÃ¡zev...",onKeyDown:w=>{w.key==="Enter"&&S()},autoFocus:!0}),e.jsxs("button",{onClick:S,style:{...h.button,alignSelf:"flex-end"},children:[e.jsx(Qe,{})," PÅ™idat"]})]})}),e.jsx(Te,{isOpen:b,onClose:()=>d(!1),title:"Spravovat poloÅ¾ky",children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",maxHeight:"400px",overflowY:"auto"},children:[e.jsx("p",{style:{fontSize:"0.9em",color:"var(--text-secondary)",margin:0},children:"KliknutÃ­m na poloÅ¾ku ji smazÃ¡te ze systÃ©mu. Tato akce je nevratnÃ¡."}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[o.map(w=>e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 12px",borderRadius:"6px",border:"1px solid var(--border)",backgroundColor:"var(--surface)"},children:[e.jsx("span",{style:{flex:1},children:w}),e.jsxs("button",{onClick:()=>R(w),style:{background:"var(--danger-color)",color:"white",border:"none",borderRadius:"4px",padding:"4px 8px",cursor:"pointer",fontSize:"12px",display:"flex",alignItems:"center",gap:"4px"},title:`Smazat ${w}`,children:[e.jsx(Oe,{size:12})," Smazat"]})]},w)),o.length===0&&e.jsx("p",{style:{textAlign:"center",color:"var(--text-secondary)",margin:"20px 0"},children:"Å½Ã¡dnÃ© poloÅ¾ky k zobrazenÃ­."})]})]})}),e.jsx(Te,{isOpen:f.isOpen,onClose:()=>z({isOpen:!1,tag:null}),title:"PotvrzenÃ­ smazÃ¡nÃ­",children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsxs("p",{children:['Opravdu chcete smazat poloÅ¾ku "',f.tag,'"?']}),e.jsx("p",{style:{fontSize:"0.9em",color:"var(--text-secondary)"},children:"Tato akce je nevratnÃ¡. PoloÅ¾ka bude odebrÃ¡na ze vÅ¡ech knih."}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>z({isOpen:!1,tag:null}),style:{...h.button,background:"var(--surface)",color:"var(--text)"},children:"ZruÅ¡it"}),e.jsxs("button",{onClick:J,style:{...h.button,background:"var(--danger-color)",color:"white"},children:[e.jsx(Oe,{size:16})," Smazat"]})]})]})})]})},js=({currentUser:t})=>{var ro,so,ao,lo,io;const[o,n]=p.useState([]),[r,s]=p.useState(null),[l,a]=p.useState(new Set),[c,g]=p.useState("list"),[u,m]=p.useState(!1),[b,d]=p.useState(!1),[v,P]=p.useState(""),[f,z]=p.useState([]),[C,T]=p.useState([]),[y,V]=p.useState([]),[F,S]=p.useState([]),[R,J]=p.useState([]),[w,U]=p.useState("all"),[ne,q]=p.useState({from:null,to:null}),[I,se]=p.useState({from:0,to:0}),[G,oe]=p.useState(!1),[W,re]=p.useState({isOpen:!1,book:null}),[N,M]=p.useState(!1),[x,_]=p.useState({isOpen:!1,book:null,missingFields:[]}),[j,O]=p.useState(new Set),[Y,te]=p.useState(!1),[Q,he]=p.useState(null),[we,$e]=p.useState(!1),[De,de]=p.useState(""),[Ce,me]=p.useState(!1),[et,B]=p.useState(!1),[H,ae]=p.useState({performOCR:!1,performCompression:!1}),[ie,le]=p.useState(null),[ye,je]=p.useState("AngliÄtina"),[ke,He]=p.useState("recommended"),[Ge,Ye]=p.useState([]),[st,at]=p.useState(["Aromaterapie","MasÃ¡Å¾e","Akupunktura","Diagnostika"]),[lt,it]=p.useState(["public","students","internal_bewit"]),[Vo,Ho]=p.useState([]),[Zo,Ko]=p.useState([]),[Go,Yo]=p.useState([]),[Ht,ct]=p.useState(!0),Je=p.useRef(null);p.useEffect(()=>{console.log("ğŸš€ useEffect - ZaÄÃ­nÃ¡m naÄÃ­tÃ¡nÃ­ dat...");let i=!0;return ct(!0),Promise.all([ce.getBooks(),ce.getLabels(),ce.getCategories(),ce.getLanguages(),ce.getPublicationTypes()]).then(([k,$,D,A,X])=>{if(console.log("âœ… Promise.all dokonÄen!"),!i){console.log("âš ï¸ Komponenta jiÅ¾ nenÃ­ namountovanÃ¡, pÅ™eskakuji aktualizaci stavu");return}console.log("ğŸ“Š NaÄtenÃ¡ metadata z databÃ¡ze:"),console.log("- Knihy:",k.length),console.log("- Å tÃ­tky:",$.length),console.log("- Kategorie:",D.length),console.log("- VÅ¡echny jazyky z DB:",A.length),console.log("- Typy publikacÃ­:",X.length),n(k),Ye($),at(D),Yo(A),it(X);const ee=new Set,ue=new Set;k.forEach(xe=>{xe.language&&ee.add(xe.language),xe.releaseVersion&&xe.releaseVersion.trim()!==""&&ue.add(xe.releaseVersion.trim())});const pe=Array.from(ee).sort(),ge=Array.from(ue).sort();console.log("ğŸ“ Jazyky pouÅ¾Ã­vanÃ© v knihÃ¡ch pro filtraci:",pe),console.log("ğŸ“ Verze vydÃ¡nÃ­ pouÅ¾Ã­vanÃ© v knihÃ¡ch pro filtraci:",ge),Ko(pe),Ho(ge),k.length>0&&!r&&s(k[0].id)}).catch(k=>{if(!i){console.log("âš ï¸ Chyba v odmountovanÃ© komponentÄ›, ignoruji");return}console.error("âŒ KRITICKÃ CHYBA - Failed to fetch data:",k.message,k),console.error("ğŸ” Detaily chyby:",{name:k.name,message:k.message,stack:k.stack,supabaseUrl:Re,timestamp:new Date().toISOString()}),console.log("ğŸ§ª Testuji pÅ™ipojenÃ­ k Supabase..."),E.from("books").select("count").then($=>{console.log("âœ… Test pÅ™ipojenÃ­ ÃºspÄ›Å¡nÃ½:",$)},$=>{console.error("âŒ Test pÅ™ipojenÃ­ selhal:",$)}),alert(`NepodaÅ™ilo se naÄÃ­st data z databÃ¡ze: ${k.message}

Zkontrolujte konzoli pro vÃ­ce detailÅ¯.`)}).finally(()=>{i&&(console.log("ğŸ NaÄÃ­tÃ¡nÃ­ dokonÄeno, nastavuji isLoading na false"),ct(!1))}),()=>{console.log("ğŸ§¹ useEffect cleanup - komponenta se odpojuje"),i=!1}},[]);const Ze=p.useMemo(()=>{if(o.length===0)return[];const i=new Set;return o.forEach(k=>{const $=new Date(k.dateAdded);i.add(`${$.getFullYear()}-${String($.getMonth()+1).padStart(2,"0")}`)}),Array.from(i).sort()},[o]);p.useEffect(()=>{Ze.length>0&&se({from:0,to:Ze.length-1})},[Ze]);const Zt=async i=>{var k,$;console.log("ğŸ” extractMetadataFromFile - typ souboru:",i.type,"nÃ¡zev:",i.name);try{if(i.type==="application/pdf"){console.log("ğŸ“„ ZpracovÃ¡vÃ¡m PDF soubor...");const D=await Jo(i);return console.log("ğŸ“„ PDF metadata extrahovÃ¡na"),D}else if(i.name.toLowerCase().endsWith(".epub")){console.log("ğŸ“š ZpracovÃ¡vÃ¡m EPUB soubor...");const D=await qo(i);return console.log("ğŸ“š EPUB metadata extrahovÃ¡na"),D}return console.log("ğŸ“ ZpracovÃ¡vÃ¡m textovÃ½ formÃ¡t"),{title:i.name.replace(/\.[^/.]+$/,""),releaseVersion:"",format:((k=i.name.split(".").pop())==null?void 0:k.toUpperCase())||"N/A"}}catch(D){return console.error("âŒ Chyba pÅ™i extrakci metadat:",D),{title:i.name.replace(/\.[^/.]+$/,""),releaseVersion:"",format:(($=i.name.split(".").pop())==null?void 0:$.toUpperCase())||"N/A"}}},Jo=async i=>{try{const k=await i.arrayBuffer(),X=(await(await pdfjsLib.getDocument(k).promise).getMetadata()).info,ee=i.name.replace(/\.[^/.]+$/,""),ue=pe=>{if(!pe||pe.trim()==="")return"";const ge=pe.toLowerCase();return["encoding software","pdf creator","microsoft word","libreoffice","openoffice","adobe acrobat","pdfmaker","ghostscript","latex","tex","pdflatex","xelatex","pandoc","prince xml","weasyprint"].some(_e=>ge.includes(_e))?"":pe.trim()};return{title:ee,author:X!=null&&X.Author&&X.Author.trim()!==""?X.Author:"NeznÃ¡mÃ½",publisher:ue((X==null?void 0:X.Producer)||""),publicationYear:X!=null&&X.CreationDate?Xo(X.CreationDate):null,language:Qo(X==null?void 0:X.Language)||"NeznÃ¡mÃ½",releaseVersion:"",format:"PDF"}}catch(k){return console.error("Failed to extract PDF metadata:",k),{title:i.name.replace(/\.[^/.]+$/,""),author:"NeznÃ¡mÃ½",language:"NeznÃ¡mÃ½",releaseVersion:"",format:"PDF"}}},qo=async i=>({title:i.name.replace(/\.[^/.]+$/,""),author:"NeznÃ¡mÃ½",language:"NeznÃ¡mÃ½",releaseVersion:"",format:"EPUB"}),Xo=i=>{try{const $=new Date(i).getFullYear();return $>1900&&$<=new Date().getFullYear()?$:null}catch{return null}},Qo=i=>{if(!i||i.trim()==="")return"NeznÃ¡mÃ½";const k=i.toLowerCase();return k.includes("cs")||k.includes("czech")||k.includes("ÄeÅ¡tina")?"ÄŒeÅ¡tina":k.includes("en")||k.includes("english")||k.includes("angliÄtina")?"AngliÄtina":k.includes("sk")||k.includes("slovak")||k.includes("slovenÅ¡tina")?"SlovenÅ¡tina":k.includes("de")||k.includes("german")||k.includes("nÄ›mÄina")?"NÄ›mÄina":k.includes("fr")||k.includes("french")||k.includes("francouzÅ¡tina")?"FrancouzÅ¡tina":k.includes("es")||k.includes("spanish")||k.includes("Å¡panÄ›lÅ¡tina")?"Å panÄ›lÅ¡tina":i},en=async i=>{var $;const k=($=i.target.files)==null?void 0:$[0];if(k){if(k.type==="application/pdf"){le(k),ae({performOCR:!1,performCompression:!1});const A=(await Zt(k)).language||"NeznÃ¡mÃ½",X=Ie.getBestLanguageMatch(A);je(X),B(!0);return}await Kt(k,{performOCR:!1,performCompression:!1},"AngliÄtina")}},Kt=async(i,k,$,D="recommended")=>{var A,X;ct(!0);try{const ee=await Zt(i);console.log("ğŸ“Š ExtrahovanÃ¡ metadata:",{title:ee.title,hasOCR:ee.hasOCR,format:ee.format});let ue=i,pe=ee.hasOCR;if(i.type==="application/pdf"&&(k.performOCR||k.performCompression)){const be=[];k.performOCR&&be.push("OCR"),k.performCompression&&be.push("komprese"),console.log(`ğŸ”„ SpouÅ¡tÃ­m zpracovÃ¡nÃ­ pomocÃ­ iLovePDF (${be.join(" + ")})...`);try{k.performOCR&&k.performCompression?(console.log("ğŸ”„ SpouÅ¡tÃ­m dvoustupÅˆovÃ© zpracovÃ¡nÃ­: OCR â†’ Komprese..."),ue=(await Ie.processWithOCRThenCompression(i,$,D,(ze,Ne)=>{console.log(`ğŸ“Š ${ze} (${Ne}%)`)})).compressedFile,pe=!0,console.log("âœ… DvoustupÅˆovÃ© zpracovÃ¡nÃ­ dokonÄeno (OCR + komprese)")):k.performOCR?(ue=await Ie.performOCR(i,$),pe=!0,console.log("âœ… OCR zpracovÃ¡nÃ­ dokonÄeno")):k.performCompression&&(ue=await Ie.compressPDF(i,D),console.log(`âœ… Komprese (${D}) dokonÄena`)),ue=new File([ue],i.name,{type:i.type})}catch(ve){console.error("âŒ iLovePDF zpracovÃ¡nÃ­ selhalo:",ve.message);const ze=[];k.performOCR&&ze.push("OCR rozpoznÃ¡nÃ­ textu"),k.performCompression&&ze.push("komprese souboru");const Ne=["ZpracovÃ¡nÃ­ pomocÃ­ iLovePDF se nezdaÅ™ilo:","",`${ve.message}`,"",`ZvolenÃ© operace: ${ze.join(" a ")}`,"","MÅ¯Å¾ete:","â€¢ ZRUÅ IT nahrÃ¡nÃ­ a zkusit to pozdÄ›ji","â€¢ POKRAÄŒOVAT a nahrÃ¡t soubor bez zpracovÃ¡nÃ­","","Chcete pokraÄovat s nahrÃ¡nÃ­m bez zpracovÃ¡nÃ­?"].join(`
`);if(!confirm(Ne))throw new Error(`Upload zruÅ¡en uÅ¾ivatelem. PÅ¯vodnÃ­ chyba: ${ve.message}`);console.log("ğŸ“ PokraÄuji s nahrÃ¡vÃ¡nÃ­m bez iLovePDF zpracovÃ¡nÃ­..."),console.log(`â„¹ï¸  Soubor bude nahrÃ¡n s pÅ¯vodnÃ­mi metadaty bez ${ze.join(" a ")}`),alert(`âœ… PokraÄuji s nahrÃ¡nÃ­m bez zpracovÃ¡nÃ­

Soubor bude nahrÃ¡n s pÅ¯vodnÃ­mi metadaty.
ZpracovÃ¡nÃ­ ${ze.join(" a ")} mÅ¯Å¾ete zkusit pozdÄ›ji.`),k.performOCR||(pe=ee.hasOCR)}}const ge=`book_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;console.log(`ğŸ“Š Velikost souboru pÅ™ed nahrÃ¡nÃ­m: ${(ue.size/1024/1024).toFixed(2)} MB`),console.log(`ğŸ“„ NÃ¡zev souboru: ${ue.name}`),console.log(`ğŸ“‹ Typ souboru: ${ue.type}`);const{filePath:xe,fileSize:_e}=await ce.uploadFileWithId(ue,"Books",ge);let Le=`https://placehold.co/150x225/f3eee8/4a4a4a?text=${ee.format||((A=i.name.split(".").pop())==null?void 0:A.toUpperCase())}`;if(ue.type==="application/pdf")try{console.log("Starting PDF cover generation...");const be=await ue.arrayBuffer();console.log("PDF file buffer created, size:",be.byteLength);const ve=await Wo(be);if(console.log("Cover generation result:",ve?"Success":"Failed"),ve){console.log("Generated cover file:",{name:ve.name,type:ve.type,size:ve.size}),console.log('ğŸš€ Attempting to upload cover to "covers" bucket...'),console.log("Cover file details:",{name:ve.name,type:ve.type,size:ve.size,bookId:ge});try{const ze=await ce.uploadFileWithId(ve,"covers",ge);console.log("âœ… Successfully uploaded to covers bucket:",ze.filePath);const{data:Ne}=E.storage.from("covers").getPublicUrl(ze.filePath);Ne&&Ne.publicUrl?(Le=Ne.publicUrl,console.log("âœ… Successfully got public URL from covers bucket:",Le)):console.warn(`âŒ Cover was uploaded to ${ze.filePath}, but could not get a public URL.`)}catch(ze){console.error("âŒ FAILED to upload to covers bucket:",ze.message),console.error("Full upload error:",ze),console.log("ğŸ”„ Trying fallback: uploading to Books bucket in covers/ subfolder...");try{const Ne=await ce.uploadFileWithId(ve,"Books",`covers/${ge}`);console.log("âœ… Fallback successful - uploaded to Books/covers/:",Ne.filePath);const{data:ut}=E.storage.from("Books").getPublicUrl(Ne.filePath);ut&&ut.publicUrl?(Le=ut.publicUrl,console.log("âœ… Successfully got public URL from Books bucket:",Le)):console.warn(`âŒ Cover was uploaded to ${Ne.filePath}, but could not get a public URL.`)}catch(Ne){console.error("âŒ FALLBACK ALSO FAILED:",Ne.message),console.error("Proceeding with placeholder image")}}}else console.error("generateCoverFromPdf returned null")}catch(be){console.error("Failed to process cover image, proceeding with placeholder. Error:",be.message),console.error("Full error:",be)}const tt={title:ee.title||i.name.replace(/\.[^/.]+$/,""),author:ee.author||"NeznÃ¡mÃ½",publicationYear:ee.publicationYear||null,publisher:ee.publisher||"",summary:ee.summary||"",keywords:ee.keywords||[],language:ee.language||"NeznÃ¡mÃ½",format:ee.format||((X=i.name.split(".").pop())==null?void 0:X.toUpperCase())||"N/A",fileSize:_e,coverImageUrl:Le,publicationTypes:ee.publicationTypes||[],labels:ee.labels||[],categories:ee.categories||[],releaseVersion:ee.releaseVersion||"",filePath:xe,vectorStatus:"pending",hasOCR:pe||!1};console.log("ğŸ“š VytvÃ¡Å™Ã­m knihu s pÅ™edbÄ›Å¾nÃ½m OCR stavem:",tt.hasOCR);const Ae=await ce.createBook(tt);if(console.log("âœ… Kniha vytvoÅ™ena, nynÃ­ detekuji skuteÄnÃ½ OCR stav..."),k.performOCR){const be=[Ae,...o];n(be)}else try{const be=await ce.detectOCRFromStorage(xe);if(console.log("ğŸ” SkuteÄnÃ½ OCR stav:",be),be!==Ae.hasOCR){console.log("ğŸ“ Aktualizuji OCR stav v databÃ¡zi...");const ve=await ce.updateBook({...Ae,hasOCR:be});console.log("âœ… OCR stav aktualizovÃ¡n:",ve.hasOCR);const ze=[ve,...o];n(ze)}else{const ve=[Ae,...o];n(ve)}}catch(be){console.error("âŒ Chyba pÅ™i detekci OCR:",be);const ve=[Ae,...o];n(ve)}P(""),z([]),T([]),V([]),S([]),U("all"),q({from:null,to:null}),s(Ae.id)}catch(ee){console.error("Failed to upload book:",ee.message,ee),alert(`NahrÃ¡nÃ­ knihy se nezdaÅ™ilo: ${ee.message}`)}finally{ct(!1),Je.current&&(Je.current.value="")}},tn=async()=>{ie&&(B(!1),await Kt(ie,H,ye,ke),le(null))},Gt=()=>{B(!1),le(null),Je.current&&(Je.current.value="")},on=i=>{const k=[...o];n(X=>X.map(ee=>ee.id===i.id?i:ee));const $=new Set(Ge);i.labels.forEach(X=>$.add(X)),Ye(Array.from($).sort());const D=new Set(st);i.categories.forEach(X=>D.add(X)),at(Array.from(D).sort());const A=new Set(lt);i.publicationTypes.forEach(X=>A.add(X)),it(Array.from(A).sort()),ce.updateBook(i).catch(X=>{console.error("Failed to update book:",X.message,X),alert(`UloÅ¾enÃ­ zmÄ›n se nezdaÅ™ilo: ${X.message}`),n(k)})},Yt=i=>{const k=o.find($=>$.id===i);k&&re({isOpen:!0,book:k})},Jt=async i=>{const k=o.find($=>$.id===i);if(!k){alert("âŒ Kniha nebyla nalezena");return}try{console.log("ğŸ“¥ StahovÃ¡nÃ­ knihy:",k.title);const{data:$,error:D}=await E.storage.from("Books").download(k.filePath);if(D||!$)throw new Error(`NepodaÅ™ilo se stÃ¡hnout soubor: ${D==null?void 0:D.message}`);const A=URL.createObjectURL($),X=k.filePath.split("/").pop()||`${k.title.replace(/[^a-zA-Z0-9]/g,"_")}.${k.format.toLowerCase()}`,ee=document.createElement("a");ee.href=A,ee.download=X,document.body.appendChild(ee),ee.click(),document.body.removeChild(ee),URL.revokeObjectURL(A),console.log("âœ… Soubor byl ÃºspÄ›Å¡nÄ› staÅ¾en:",X)}catch($){console.error("Chyba pÅ™i stahovÃ¡nÃ­ knihy:",$),alert(`âŒ Chyba pÅ™i stahovÃ¡nÃ­ knihy: ${$.message}`)}},nn=async()=>{const i=o.filter(k=>l.has(k.id));if(i.length===0){alert("âŒ Nejsou vybranÃ© Å¾Ã¡dnÃ© knihy pro staÅ¾enÃ­");return}if(i.length===1){await Jt(i[0].id);return}try{console.log(`ğŸ“¥ StahovÃ¡nÃ­ ${i.length} knih...`);const k=(await Et(async()=>{const{default:ge}=await import("./jszip.min-pmDCh66N.js").then(xe=>xe.j);return{default:ge}},__vite__mapDeps([5,1,2,3]))).default,$=new k;let D=0,A=0;const X=i.map(async ge=>{try{console.log(`ğŸ“¥ StahovÃ¡nÃ­: ${ge.title}`);const{data:xe,error:_e}=await E.storage.from("Books").download(ge.filePath);if(_e||!xe)return console.error(`âŒ Chyba pÅ™i stahovÃ¡nÃ­ ${ge.title}:`,_e==null?void 0:_e.message),A++,null;const Le=ge.filePath.split("/").pop()||`${ge.title.replace(/[^a-zA-Z0-9]/g,"_")}.${ge.format.toLowerCase()}`;return $.file(Le,xe),D++,console.log(`âœ… ÃšspÄ›Å¡nÄ› pÅ™idÃ¡no do ZIP: ${Le}`),Le}catch(xe){return console.error(`âŒ Chyba pÅ™i zpracovÃ¡nÃ­ ${ge.title}:`,xe),A++,null}});if(await Promise.all(X),D===0){alert("âŒ NepodaÅ™ilo se stÃ¡hnout Å¾Ã¡dnou knihu");return}console.log(`ğŸ“¦ VytvÃ¡Å™enÃ­ ZIP archivu s ${D} soubory...`);const ee=await $.generateAsync({type:"blob"}),ue=URL.createObjectURL(ee),pe=document.createElement("a");pe.href=ue,pe.download=`knihy_${i.length}_souboru.zip`,document.body.appendChild(pe),pe.click(),document.body.removeChild(pe),URL.revokeObjectURL(ue),alert(A===0?`âœ… ÃšspÄ›Å¡nÄ› staÅ¾eno ${D} knih do ZIP archivu`:`âš ï¸ StaÅ¾eno ${D} knih, ${A} se nepodaÅ™ilo stÃ¡hnout`),console.log("âœ… HromadnÃ© stahovÃ¡nÃ­ dokonÄeno")}catch(k){console.error("Chyba pÅ™i hromadnÃ©m stahovÃ¡nÃ­:",k),alert(`âŒ Chyba pÅ™i vytvÃ¡Å™enÃ­ ZIP archivu: ${k.message}`)}},rn=async()=>{if(!W.book)return;const i=W.book;try{await ce.deleteBook(i.id,i.filePath,i.coverImageUrl,i.title);const k=o.findIndex(D=>D.id===i.id),$=o.filter(D=>D.id!==i.id);if(n($),r===i.id){let D=null;if($.length>0){const A=Math.min(k,$.length-1);D=$[A].id}s(D)}if(l.has(i.id)){const D=new Set(l);D.delete(i.id),a(D)}console.log(`Kniha "${i.title}" byla ÃºspÄ›Å¡nÄ› smazÃ¡na`)}catch(k){console.error("Failed to delete book:",k.message,k),alert(`SmazÃ¡nÃ­ knihy se nezdaÅ™ilo: ${k.message}`)}finally{re({isOpen:!1,book:null})}},sn=async(i,k)=>{console.log(`ğŸ” DIAGNOSTIKA STORAGE pro knihu: ${k} (ID: ${i})`);const $=o.find(A=>A.id===i),D=$==null?void 0:$.filePath;if(console.log(`ğŸ“„ File path: ${D}`),!D){console.error("âŒ Nelze najÃ­t filePath pro knihu");return}try{console.log("ğŸ“ Kontrola Books/covers/covers/...");const{data:A}=await E.storage.from("Books").list("covers/covers",{limit:100});console.log("Books/covers/covers/ obsahuje:",(A==null?void 0:A.map(xe=>xe.name))||[]);const ee=`${D.replace(/\.[^/.]+$/,"")}.jpg`;console.log(`ğŸ–¼ï¸ HledÃ¡m cover: ${ee}`);const ue=A==null?void 0:A.some(xe=>xe.name===ee);console.log(`Cover existuje: ${ue?"âœ…":"âŒ"}`),console.log("ğŸ“ Kontrola images/main/production/...");const{data:pe}=await E.storage.from("images").list("main/production",{limit:100});console.log("images/main/production/ obsahuje sloÅ¾ky:",(pe==null?void 0:pe.map(xe=>xe.name))||[]),console.log(`ğŸ“ HledÃ¡m sloÅ¾ku podle UUID: ${i}`);const ge=pe==null?void 0:pe.some(xe=>xe.name===i);if(console.log(`SloÅ¾ka existuje: ${ge?"âœ…":"âŒ"}`),ge){const{data:xe}=await E.storage.from("images").list(`main/production/${i}`,{limit:100});console.log(`ğŸ“ images/main/production/${i}/ obsahuje:`,(xe==null?void 0:xe.map(_e=>_e.name))||[])}}catch(A){console.error("Chyba pÅ™i diagnostice storage:",A)}},an=async i=>{const k=o.find($=>$.id===i);if(!k){alert("âŒ Kniha nenalezena");return}console.log(`ğŸ§ª TESTOVÃNÃ MAZÃNÃ IMAGES pro knihu: ${k.title} (ID: ${i})`);try{const $=`main/production/${i}`;console.log(`ğŸ—‚ï¸ Pokus o smazÃ¡nÃ­: ${$}`);const{data:D,error:A}=await E.storage.from("images").list($,{limit:1e3});if(console.log("ğŸ“‹ Seznam souborÅ¯:",{imageFiles:D,listError:A}),!A&&D&&D.length>0){const X=D.map(ue=>`${$}/${ue.name}`);console.log("ğŸ—‘ï¸ Soubory k smazÃ¡nÃ­:",X);const{error:ee}=await E.storage.from("images").remove(X);ee?(alert(`âŒ Test neÃºspÄ›Å¡nÃ½! Chyba: ${ee.message}`),console.error("Delete error:",ee)):alert(`âœ… Test ÃºspÄ›Å¡nÃ½! SmazÃ¡no ${X.length} souborÅ¯ ze sloÅ¾ky ${$}`)}else alert(`âš ï¸ SloÅ¾ka ${$} neexistuje nebo je prÃ¡zdnÃ¡`)}catch($){console.error("Test error:",$),alert(`âŒ Chyba pÅ™i testu: ${$}`)}},qt=async i=>{try{console.log(`ğŸ§ª TestovÃ¡nÃ­ webhook pro knihu: ${i}`);const k=await ce.callDeleteWebhook(i);k.success?alert(`âœ… Webhook test ÃºspÄ›Å¡nÃ½!

ZavolÃ¡n webhook pro knihu ID: ${i}
OdpovÄ›Ä: ${k.message}`):alert(`âŒ Webhook test neÃºspÄ›Å¡nÃ½!

Chyba: ${k.message}`)}catch(k){console.error("Chyba pÅ™i testovÃ¡nÃ­ webhookÅ¯:",k),alert(`âŒ Chyba pÅ™i testovÃ¡nÃ­ webhookÅ¯: ${k.message}`)}},ln=i=>{const k=[];return(!i.author||i.author.trim()===""||i.author==="NeznÃ¡mÃ½")&&k.push("Autor"),i.publicationYear||k.push("Rok vydÃ¡nÃ­"),(!i.publisher||i.publisher.trim()==="")&&k.push("NakladatelstvÃ­"),(!i.summary||i.summary.trim()==="")&&k.push("Sumarizace"),(!i.keywords||i.keywords.length===0)&&k.push("KlÃ­ÄovÃ¡ slova"),(!i.categories||i.categories.length===0)&&k.push("Kategorie"),k},cn=i=>{const k=ln(i);_({isOpen:!0,book:i,missingFields:k})},dn=async()=>{const{book:i,missingFields:k}=x;if(i&&(_({isOpen:!1,book:null,missingFields:[]}),!(k.length>0))){O($=>new Set([...$,i.id]));try{console.log("ğŸ“¤ OdesÃ­lÃ¡nÃ­ knihy do vektorovÃ© databÃ¡ze:",i.title),console.log("â³ ÄŒekÃ¡m na webhook odpovÄ›Ä (mÅ¯Å¾e trvat aÅ¾ 5 minut)...");const $=await ce.sendToVectorDatabase(i,!0);$.success?(console.log("âœ… Webhook ÃºspÄ›Å¡nÄ› zpracovÃ¡n"),alert(`âœ… ${$.message}`),n(D=>D.map(A=>A.id===i.id?{...A,vectorStatus:"success"}:A))):(console.error("âŒ Webhook selhal:",$.message),alert(`âŒ ${$.message}`),n(D=>D.map(A=>A.id===i.id?{...A,vectorStatus:"error"}:A)))}catch($){console.error("âŒ Chyba pÅ™i komunikaci s webhookem:",$),n(D=>D.map(A=>A.id===i.id?{...A,vectorStatus:"error"}:A))}finally{O($=>{const D=new Set($);return D.delete(i.id),D})}}},un=i=>{if(!i.metadataSnapshot||!i.vectorAddedAt)return console.log("âš ï¸ Å½Ã¡dnÃ½ snapshot metadat nebo datum VDB - posÃ­lÃ¡m vÅ¡echna data"),{id:i.id,title:i.title,author:i.author,publicationYear:i.publicationYear,publisher:i.publisher,summary:i.summary,keywords:i.keywords,language:i.language,format:i.format,fileSize:i.fileSize,coverImageUrl:i.coverImageUrl,publicationTypes:i.publicationTypes,labels:i.labels,categories:i.categories,releaseVersion:i.releaseVersion};try{const k=JSON.parse(i.metadataSnapshot);console.log("ğŸ“¸ Snapshot data:",k);const $={title:i.title,author:i.author,publicationYear:i.publicationYear,publisher:i.publisher,summary:i.summary,keywords:i.keywords,language:i.language,format:i.format,fileSize:i.fileSize,coverImageUrl:i.coverImageUrl,publicationTypes:i.publicationTypes,labels:i.labels,categories:i.categories,releaseVersion:i.releaseVersion};console.log("ğŸ“Š Current data:",$);const D={id:i.id};let A=!1;return Object.keys($).forEach(X=>{const ee=$[X],ue=k[X];console.log(`ğŸ” PorovnÃ¡vÃ¡m pole '${X}':`),console.log("  - Snapshot:",ue),console.log("  - Current:",ee);const pe=Array.isArray(ee)?JSON.stringify(ee.sort()):String(ee||""),ge=Array.isArray(ue)?JSON.stringify(ue.sort()):String(ue||"");console.log("  - Snapshot str:",ge),console.log("  - Current str:",pe),console.log("  - Jsou stejnÃ©:",pe===ge),pe!==ge&&(D[X]=ee,A=!0,console.log(`ğŸ”„ ZmÄ›na v poli '${X}':`,{pÅ™ed:ue,nynÃ­:ee}))}),A?(console.log("ğŸ“ DetekovanÃ© zmÄ›ny:",Object.keys(D).filter(X=>X!=="id")),D):(console.log("âœ… Å½Ã¡dnÃ© zmÄ›ny v metadatech od pÅ™idÃ¡nÃ­ do VDB"),null)}catch(k){return console.error("âŒ Chyba pÅ™i parsovÃ¡nÃ­ snapshot metadat:",k),{id:i.id,title:i.title,author:i.author,publicationYear:i.publicationYear,publisher:i.publisher,summary:i.summary,keywords:i.keywords,language:i.language,format:i.format,fileSize:i.fileSize,coverImageUrl:i.coverImageUrl,publicationTypes:i.publicationTypes,labels:i.labels,categories:i.categories,releaseVersion:i.releaseVersion}}},pn=async i=>{try{console.log("VolÃ¡nÃ­ webhook pro aktualizaci metadat:",i.title);const k=un(i);if(!k){alert("â„¹ï¸ Å½Ã¡dnÃ© zmÄ›ny v metadatech od pÅ™idÃ¡nÃ­ do vektorovÃ© databÃ¡ze");return}console.log("ğŸ“¤ OdesÃ­lÃ¡m pouze zmÄ›nÄ›nÃ¡ metadata:",k);const $={action:"update_metadata",bookId:i.id,metadata:{...Object.fromEntries(Object.entries(k).filter(([A])=>A!=="id"))}};console.log("ğŸ“¤ Webhook payload:",$);const D=await fetch("https://n8n.srv980546.hstgr.cloud/webhook/822e584e-0836-4d1d-aef1-5c4dce6573c0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify($)});if(D.ok){const A=await D.json().catch(()=>({})),X=Object.keys(k).filter(ee=>ee!=="id").length;alert(`âœ… Metadata ÃºspÄ›Å¡nÄ› aktualizovÃ¡na (${X} zmÄ›n)`)}else alert("âŒ Chyba pÅ™i aktualizaci metadat")}catch(k){console.error("Chyba pÅ™i volÃ¡nÃ­ webhooku:",k),alert("âŒ Chyba pÅ™i aktualizaci metadat")}},xn=async()=>{if(!De.trim()){alert("ProsÃ­m, zadejte URL videa");return}me(!0);try{const i=await fetch("https://n8n.srv980546.hstgr.cloud/webhook-test/stt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({videoUrl:De,timestamp:new Date().toISOString()})});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const k=await i.json();console.log("Video ÃºspÄ›Å¡nÄ› odeslÃ¡no:",k),alert("Video bylo ÃºspÄ›Å¡nÄ› odeslÃ¡no ke zpracovÃ¡nÃ­!"),de(""),$e(!1)}catch(i){console.error("Chyba pÅ™i odesÃ­lÃ¡nÃ­ videa:",i),alert(`Chyba pÅ™i odesÃ­lÃ¡nÃ­ videa: ${i.message}`)}finally{me(!1)}},hn=()=>{l.size>0&&M(!0)},gn=async()=>{if(l.size===0)return;const k=o.filter($=>l.has($.id)).map($=>ce.deleteBook($.id,$.filePath,$.coverImageUrl,$.title));try{const $=await Promise.allSettled(k),D=$.filter(ee=>ee.status==="fulfilled").length,A=$.filter(ee=>ee.status==="rejected").length,X=o.filter(ee=>!l.has(ee.id));n(X),r&&l.has(r)&&s(X.length>0?X[0].id:null),a(new Set),A>0?(console.warn(`Bulk delete completed: ${D} ÃºspÄ›Å¡nÃ½ch, ${A} neÃºspÄ›Å¡nÃ½ch`),alert(`HromadnÃ© mazÃ¡nÃ­ dokonÄeno: ${D} knih smazÃ¡no, ${A} se nepodaÅ™ilo smazat. Zkontrolujte konzoli pro detaily.`)):console.log(`VÅ¡ech ${D} knih bylo ÃºspÄ›Å¡nÄ› smazÃ¡no`)}catch($){console.error("Failed to bulk delete books:",$.message,$),alert(`Chyba pÅ™i hromadnÃ©m mazÃ¡nÃ­: ${$.message}`)}finally{M(!1)}},fn=()=>{const i=o.filter($=>l.has($.id));if(i.length===0)return;let k=`<?xml version="1.0" encoding="UTF-8"?>
<books>
`;i.forEach($=>{k+=`  <book id="${$.id}">
`,k+=`    <title><![CDATA[${$.title}]]></title>
`,k+=`    <author><![CDATA[${$.author}]]></author>
`,k+=`    <publicationYear>${$.publicationYear||""}</publicationYear>
`,k+=`  </book>
`}),k+="</books>",vs(k,"export.xml","application/xml")},mn=i=>{const k=new Set(l);k.has(i)?k.delete(i):k.add(i),a(k)},bn=i=>{a(i?new Set(wt.map(k=>k.id)):new Set)},Xt=async i=>{i&&!Ge.includes(i)&&(await ce.addLabel(i)?(Ye($=>[...$,i].sort()),console.log("âœ… Å tÃ­tek pÅ™idÃ¡n do databÃ¡ze:",i)):alert(`NepodaÅ™ilo se pÅ™idat Å¡tÃ­tek "${i}" do databÃ¡ze.`))},Qt=async i=>{i&&!st.includes(i)&&(await ce.addCategory(i)?(at($=>[...$,i].sort()),console.log("âœ… Kategorie pÅ™idÃ¡na do databÃ¡ze:",i)):alert(`NepodaÅ™ilo se pÅ™idat kategorii "${i}" do databÃ¡ze.`))},eo=async i=>{i&&!lt.includes(i)&&(await ce.addPublicationType(i)?(it($=>[...$,i].sort()),console.log("âœ… Typ publikace pÅ™idÃ¡n do databÃ¡ze:",i)):alert(`NepodaÅ™ilo se pÅ™idat typ publikace "${i}" do databÃ¡ze.`))},to=async i=>{if(!await ce.deleteLabel(i)){alert(`NepodaÅ™ilo se smazat Å¡tÃ­tek "${i}" z databÃ¡ze.`);return}const $=o.map(D=>({...D,labels:D.labels.filter(A=>A!==i)}));n($),Ye(D=>D.filter(A=>A!==i)),z(D=>D.filter(A=>A!==i)),$.forEach(D=>{D.labels.some(A=>{var X;return!((X=o.find(ee=>ee.id===D.id))!=null&&X.labels.includes(A))})&&ce.updateBook(D).catch(A=>{console.error("Failed to update book after label deletion:",A)})}),console.log("âœ… Å tÃ­tek smazÃ¡n z databÃ¡ze a vÅ¡ech knih:",i)},oo=async i=>{if(!await ce.deleteCategory(i)){alert(`NepodaÅ™ilo se smazat kategorii "${i}" z databÃ¡ze.`);return}const $=o.map(D=>({...D,categories:D.categories.filter(A=>A!==i)}));n($),at(D=>D.filter(A=>A!==i)),T(D=>D.filter(A=>A!==i)),$.forEach(D=>{D.categories.some(A=>{var X;return!((X=o.find(ee=>ee.id===D.id))!=null&&X.categories.includes(A))})&&ce.updateBook(D).catch(A=>{console.error("Failed to update book after category deletion:",A)})}),console.log("âœ… Kategorie smazÃ¡na z databÃ¡ze a vÅ¡ech knih:",i)},no=async i=>{if(!await ce.deletePublicationType(i)){alert(`NepodaÅ™ilo se smazat typ publikace "${i}" z databÃ¡ze.`);return}const $=o.map(D=>({...D,publicationTypes:D.publicationTypes.filter(A=>A!==i)}));n($),it(D=>D.filter(A=>A!==i)),V(D=>D.filter(A=>A!==i)),$.forEach(D=>{D.publicationTypes.some(A=>{var X;return!((X=o.find(ee=>ee.id===D.id))!=null&&X.publicationTypes.includes(A))})&&ce.updateBook(D).catch(A=>{console.error("Failed to update book after publication type deletion:",A)})}),console.log("âœ… Typ publikace smazÃ¡n z databÃ¡ze a vÅ¡ech knih:",i)},dt=i=>{alert(`Konverze pro ${l.size} ${l.size===1?"knihu":l.size>1&&l.size<5?"knihy":"knih"} do formÃ¡tu ${i} byla spuÅ¡tÄ›na.`),oe(!1),a(new Set)},yn=i=>{if(!i||!i.filePath){alert("K tÃ©to knize nenÃ­ pÅ™iÅ™azen Å¾Ã¡dnÃ½ soubor.");return}const{data:k}=E.storage.from("Books").getPublicUrl(i.filePath);k&&k.publicUrl?window.open(k.publicUrl,"_blank","noopener,noreferrer"):alert("NepodaÅ™ilo se zÃ­skat veÅ™ejnou URL adresu souboru.")},wt=p.useMemo(()=>o.filter(i=>{const k=v.toLowerCase(),$=k===""||i.title.toLowerCase().includes(k)||i.author.toLowerCase().includes(k)||i.keywords.some(be=>be.toLowerCase().includes(k)),D=f.length===0||f.every(be=>i.labels.includes(be)),A=C.length===0||C.every(be=>i.categories.includes(be)),X=y.length===0||y.some(be=>i.publicationTypes.includes(be)),ee=R.length===0||R.includes(i.releaseVersion),ue=F.length===0||F.includes(i.language),pe=w==="all"||i.vectorStatus===w,ge=(!ne.from||i.publicationYear&&i.publicationYear>=ne.from)&&(!ne.to||i.publicationYear&&i.publicationYear<=ne.to),xe=Ze[I.from],_e=Ze[I.to];if(!xe||!_e)return!0;const Le=new Date(i.dateAdded),tt=`${Le.getFullYear()}-${String(Le.getMonth()+1).padStart(2,"0")}`,Ae=tt>=xe&&tt<=_e;return $&&D&&A&&X&&ee&&ue&&pe&&ge&&Ae}),[o,v,f,C,y,R,F,w,ne,I,Ze]),Ct=p.useMemo(()=>o.find(i=>i.id===r),[o,r]),[vn,kn]=p.useMemo(()=>{const i=o.map(k=>k.publicationYear).filter(k=>k!==null&&k>1e3);return i.length===0?[new Date().getFullYear()-20,new Date().getFullYear()]:[Math.min(...i),Math.max(...i)]},[o]);return e.jsxs("div",{style:h.appContainer,children:[e.jsx("input",{type:"file",ref:Je,onChange:en,style:{display:"none"},accept:".pdf,.epub,.mobi,.txt"}),e.jsx(ws,{onUploadClick:()=>{var i;return(i=Je.current)==null?void 0:i.click()},viewMode:c,onViewModeChange:g,selectedCount:l.size,onBulkDelete:hn,onBulkDownload:nn,onExportXml:fn,onConvertClick:()=>oe(!0),isAnyBookSelected:l.size>0,onChatbotManagementClick:()=>te(!0),onAddVideoClick:()=>$e(!0),currentUser:t,onUserManagementClick:()=>m(!0),onProfileSettingsClick:()=>d(!0),onLogoutClick:async()=>{const{error:i}=await Br();i?alert(`Chyba pÅ™i odhlÃ¡Å¡enÃ­: ${i}`):window.location.reload()}}),e.jsxs("div",{style:h.mainContent,children:[e.jsx(zs,{filter:v,onFilterChange:P,allLabels:Ge,selectedLabels:f,onLabelFilterChange:z,onAddLabel:Xt,onDeleteLabel:to,allCategories:st,selectedCategories:C,onCategoryFilterChange:T,onAddCategory:Qt,onDeleteCategory:oo,allTypes:lt,selectedTypes:y,onTypeFilterChange:V,onAddType:eo,onDeleteType:no,allVersions:Vo,selectedVersions:R,onVersionFilterChange:J,allLanguages:Zo,selectedLanguages:F,onLanguageFilterChange:S,vdbFilter:w,onVdbFilterChange:U,yearRange:ne,onYearRangeChange:q,minYear:vn,maxYear:kn,availableMonths:Ze,dateAddedRange:I,onDateAddedRangeChange:se}),e.jsx("main",{style:h.bookListContainer,children:Ht?e.jsx("p",{children:"NaÄÃ­tÃ¡nÃ­ knih..."}):c==="list"?e.jsx(Ss,{books:wt,selectedBookId:r,selectedBookIds:l,onSelectBook:i=>{s(i)},onToggleSelection:mn,onSelectAll:bn,onDeleteBook:Yt,onDownloadBook:Jt,onTestWebhook:qt,onVectorDatabaseAction:cn,vectorProcessingBooks:j}):e.jsx(_s,{books:wt,selectedBookId:r,onSelectBook:s})}),Ct?e.jsx("aside",{style:h.detailPanel,children:e.jsx(Ns,{book:Ct,onUpdate:on,onDelete:Yt,onTestWebhook:qt,onDebugStorage:sn,onTestDeleteImages:an,onReadClick:()=>yn(Ct),allLabels:Ge,onAddNewLabel:Xt,onDeleteLabel:to,allCategories:st,onAddNewCategory:Qt,onDeleteCategory:oo,allPublicationTypes:lt,onAddNewPublicationType:eo,onDeletePublicationType:no,allAvailableLanguages:Go})}):!Ht&&o.length>0&&e.jsx("aside",{style:h.detailPanel,children:e.jsx("div",{style:{...h.detailContent,justifyContent:"center",alignItems:"center",height:"100%"},children:e.jsx("p",{style:{color:"var(--text-secondary)"},children:"Vyberte knihu ze seznamu."})})})]}),e.jsxs(Te,{isOpen:G,onClose:()=>oe(!1),title:"Konvertovat knihu",children:[e.jsxs("p",{children:["Vyberte formÃ¡t pro konverzi vybranÃ½ch knih (",l.size,")."]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:[e.jsx("button",{style:h.button,onClick:()=>dt("EPUB"),children:"EPUB"}),e.jsx("button",{style:h.button,onClick:()=>dt("MOBI"),children:"MOBI"}),e.jsx("button",{style:h.button,onClick:()=>dt("PDF"),children:"PDF"}),e.jsx("button",{style:h.button,onClick:()=>dt("TXT"),children:"TXT"})]})]}),e.jsxs(Te,{isOpen:W.isOpen,onClose:()=>re({isOpen:!1,book:null}),title:"Potvrdit smazÃ¡nÃ­",children:[e.jsxs("p",{children:['Opravdu chcete smazat knihu "',(ro=W.book)==null?void 0:ro.title,'"?']}),e.jsxs("div",{style:{display:"flex",gap:"1rem",marginTop:"1.5rem",justifyContent:"flex-end"},children:[e.jsx("button",{style:h.button,onClick:()=>re({isOpen:!1,book:null}),children:"ZruÅ¡it"}),e.jsx("button",{style:{...h.button,...h.buttonDanger},onClick:rn,children:"Smazat"})]})]}),e.jsxs(Te,{isOpen:N,onClose:()=>M(!1),title:"Potvrdit hromadnÃ© smazÃ¡nÃ­",children:[e.jsxs("p",{children:["Opravdu chcete smazat ",l.size," ",l.size===1?"knihu":l.size>1&&l.size<5?"knihy":"knih","?"]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",marginTop:"1.5rem",justifyContent:"flex-end"},children:[e.jsx("button",{style:h.button,onClick:()=>M(!1),children:"ZruÅ¡it"}),e.jsx("button",{style:{...h.button,...h.buttonDanger},onClick:gn,children:"Smazat"})]})]}),e.jsx(Te,{isOpen:x.isOpen,onClose:()=>_({isOpen:!1,book:null,missingFields:[]}),title:x.missingFields.length>0?"ChybÃ­ povinnÃ¡ metadata":"Potvrdit odeslÃ¡nÃ­ do vektorovÃ© databÃ¡ze",children:x.missingFields.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:['âŒ Nelze odeslat knihu "',(so=x.book)==null?void 0:so.title,'" do vektorovÃ© databÃ¡ze.']}),e.jsx("p",{children:e.jsx("strong",{children:"ChybÃ­ nÃ¡sledujÃ­cÃ­ povinnÃ¡ metadata:"})}),e.jsx("ul",{style:{margin:"1rem 0",paddingLeft:"1.5rem"},children:x.missingFields.map(i=>e.jsx("li",{style:{margin:"0.5rem 0",color:"var(--danger-color)"},children:i},i))}),e.jsx("p",{style:{fontSize:"0.9em",color:"var(--text-secondary)"},children:"ProsÃ­m doplÅˆte tato metadata v detailu knihy a zkuste to znovu."}),e.jsxs("div",{style:{display:"flex",gap:"1rem",marginTop:"1.5rem",justifyContent:"flex-end"},children:[e.jsx("button",{style:h.button,onClick:()=>_({isOpen:!1,book:null,missingFields:[]}),children:"ZavÅ™Ã­t"}),e.jsx("button",{style:{...h.button,backgroundColor:"var(--primary-color)",color:"white"},onClick:()=>{_({isOpen:!1,book:null,missingFields:[]}),x.book&&s(x.book.id)},children:"Upravit knihu"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"1rem"},children:[e.jsx(Ve,{status:"pending"}),e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Kniha:"})," ",(ao=x.book)==null?void 0:ao.title]}),e.jsxs("p",{style:{fontSize:"0.9em",color:"var(--text-secondary)"},children:["Autor: ",(lo=x.book)==null?void 0:lo.author," â€¢ ",(io=x.book)==null?void 0:io.publicationYear]})]})]}),e.jsx("p",{children:"Opravdu chcete odeslat tuto knihu do vektorovÃ© databÃ¡ze?"}),e.jsx("p",{style:{fontSize:"0.9em",color:"var(--text-secondary)",marginTop:"1rem"},children:"âš ï¸ Tato operace mÅ¯Å¾e trvat nÄ›kolik minut. Kniha bude zpracovÃ¡na n8n workflow a pÅ™idÃ¡na do vektorovÃ© databÃ¡ze."}),e.jsx("div",{style:{margin:"1.5rem 0",padding:"1rem",backgroundColor:"var(--bg-secondary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:e.jsxs("div",{style:{fontSize:"0.95em"},children:[e.jsx("div",{style:{fontWeight:"500",marginBottom:"4px"},children:"â³ ÄŒekÃ¡nÃ­ na zpracovÃ¡nÃ­"}),e.jsx("div",{style:{fontSize:"0.85em",color:"var(--text-secondary)"},children:"Aplikace bude Äekat na webhook odpovÄ›Ä aÅ¾ 5 minut a zobrazÃ­ vÃ½sledek zpracovÃ¡nÃ­. Ikona se bude otÃ¡Äet bÄ›hem celÃ©ho procesu."})]})}),e.jsxs("div",{style:{display:"flex",gap:"1rem",marginTop:"1.5rem",justifyContent:"flex-end"},children:[e.jsx("button",{style:h.button,onClick:()=>_({isOpen:!1,book:null,missingFields:[]}),children:"ZruÅ¡it"}),e.jsx("button",{style:{...h.button,backgroundColor:"#6c757d",color:"white",border:"1px solid #6c757d"},onClick:()=>{x.book&&pn(x.book)},children:"ğŸ”„ Aktualizovat metadata"}),e.jsxs("button",{style:{...h.button,backgroundColor:"#007bff",color:"white",border:"1px solid #007bff"},onClick:dn,children:[e.jsx(Ve,{status:"pending"})," Odeslat do VDB"]})]})]})}),e.jsx(Te,{isOpen:et,onClose:Gt,title:"ZpracovÃ¡nÃ­ PDF souboru",children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[e.jsx("p",{style:{margin:0,color:"var(--text-secondary)"},children:"Vyberte, kterÃ© operace chcete provÃ©st s nahrÃ¡vanÃ½m PDF souborem:"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:H.performOCR,onChange:i=>ae(k=>({...k,performOCR:i.target.checked})),style:{marginRight:"0.5rem"}}),e.jsx("strong",{children:"ProvÃ©st OCR"}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9em"},children:"- RozpoznÃ¡nÃ­ textu v naskenovanÃ½ch dokumentech"})]}),H.performOCR&&e.jsx("div",{style:{marginLeft:"1.5rem",padding:"1rem",backgroundColor:"var(--background-tertiary)",borderRadius:"8px",border:"1px solid var(--border-color)"},children:e.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("strong",{style:{fontSize:"0.9em"},children:"Jazyk dokumentu pro OCR:"}),e.jsx("select",{value:ye,onChange:i=>je(i.target.value),style:{padding:"0.5rem",borderRadius:"4px",border:"1px solid var(--border-color)",backgroundColor:"var(--background-primary)",color:"var(--text-primary)",fontSize:"0.9em"},children:Ie.getAvailableLanguages().map(i=>e.jsx("option",{value:i.label,children:i.label},i.code))})]})}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:H.performCompression,onChange:i=>ae(k=>({...k,performCompression:i.target.checked})),style:{marginRight:"0.5rem"}}),e.jsx("strong",{children:"ProvÃ©st kompresi"}),e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"0.9em"},children:"- ZmenÅ¡enÃ­ velikosti souboru"})]}),H.performCompression&&e.jsxs("div",{style:{marginLeft:"1.5rem",padding:"1rem",backgroundColor:"var(--background-tertiary)",borderRadius:"8px",border:"1px solid var(--border-color)"},children:[e.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("strong",{style:{fontSize:"0.9em"},children:"ÃšroveÅˆ komprese:"}),e.jsxs("select",{value:ke,onChange:i=>He(i.target.value),style:{padding:"0.5rem",borderRadius:"4px",border:"1px solid var(--border-color)",backgroundColor:"var(--background-primary)",color:"var(--text-primary)",fontSize:"0.9em"},children:[e.jsx("option",{value:"low",children:"Low - MinimÃ¡lnÃ­ komprese (zachovÃ¡ kvalitu)"}),e.jsx("option",{value:"recommended",children:"Recommended - OptimÃ¡lnÃ­ pomÄ›r velikost/kvalita"}),e.jsx("option",{value:"extreme",children:"Extreme - MaximÃ¡lnÃ­ komprese (mÅ¯Å¾e snÃ­Å¾it kvalitu)"})]})]}),e.jsxs("div",{style:{marginTop:"0.5rem",fontSize:"0.8em",color:"var(--text-secondary)",lineHeight:"1.4"},children:[ke==="low"&&e.jsxs(e.Fragment,{children:["ğŸ”¹ ",e.jsx("strong",{children:"Low:"})," MinimÃ¡lnÃ­ komprese pro zachovÃ¡nÃ­ kvality bez ztrÃ¡ty dat"]}),ke==="recommended"&&e.jsxs(e.Fragment,{children:["ğŸ”¹ ",e.jsx("strong",{children:"Recommended:"})," NejlepÅ¡Ã­ mix komprese a kvality pro bÄ›Å¾nÃ© pouÅ¾itÃ­"]}),ke==="extreme"&&e.jsxs(e.Fragment,{children:["ğŸ”¹ ",e.jsx("strong",{children:"Extreme:"})," MaximÃ¡lnÃ­ komprese, mÅ¯Å¾e snÃ­Å¾it kvalitu obrÃ¡zkÅ¯"]})]})]})]}),(H.performOCR||H.performCompression)&&e.jsx("div",{style:{backgroundColor:"var(--background-tertiary)",padding:"1rem",borderRadius:"8px",border:"1px solid var(--border-color)"},children:e.jsxs("p",{style:{margin:0,fontSize:"0.9em",color:"var(--text-secondary)"},children:["â±ï¸ ZpracovÃ¡nÃ­ pomocÃ­ iLovePDF API mÅ¯Å¾e trvat nÄ›kolik sekund aÅ¾ minut v zÃ¡vislosti na velikosti souboru.",H.performOCR&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),"ğŸ” OCR bude provedeno v jazyce: ",e.jsx("strong",{children:ye})]}),H.performCompression&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),"ğŸ—œï¸ Komprese: ",e.jsx("strong",{children:ke})]})]})}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1rem"},children:[e.jsx("button",{style:h.button,onClick:Gt,children:"ZruÅ¡it"}),e.jsx("button",{style:{...h.button,backgroundColor:"var(--accent-primary)",color:"white"},onClick:tn,children:H.performOCR||H.performCompression?"Zpracovat a nahrÃ¡t":"NahrÃ¡t bez zpracovÃ¡nÃ­"})]})]})}),Y&&e.jsx(ur,{onClose:()=>te(!1),onOpenChat:(i,k)=>{console.log(`ğŸš€ OtevÃ­rÃ¡m chat: ${i}`,k),he({id:i,features:k})}}),e.jsx(Te,{isOpen:we,onClose:()=>$e(!1),title:"PÅ™idat video",children:e.jsxs("div",{style:{padding:"1rem 0"},children:[e.jsxs("div",{style:h.fieldGroup,children:[e.jsx("label",{style:h.label,children:"URL videa"}),e.jsx("input",{type:"text",value:De,onChange:i=>de(i.target.value),placeholder:"https://example.com/video.mp4",style:{...h.input,width:"100%",padding:"0.75rem",fontSize:"1rem"},disabled:Ce}),e.jsx("div",{style:{marginTop:"0.5rem",fontSize:"0.875rem",color:"var(--text-secondary)"},children:"VloÅ¾te URL videa, kterÃ© chcete odeslat ke zpracovÃ¡nÃ­"})]}),e.jsxs("div",{style:{marginTop:"2rem",display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[e.jsx("button",{style:{...h.button,backgroundColor:"var(--background-tertiary)",color:"var(--text-primary)"},onClick:()=>$e(!1),disabled:Ce,children:"ZruÅ¡it"}),e.jsx("button",{style:{...h.button,backgroundColor:"var(--accent-primary)",color:"white"},onClick:xn,disabled:Ce||!De.trim(),children:Ce?"OdesÃ­lÃ¡m...":"Odeslat"})]})]})}),Q&&e.jsx("div",{style:h.chatOverlay,children:e.jsx("div",{style:h.chatContainer,children:e.jsx("div",{style:h.chatContent,children:e.jsxs("div",{style:{height:"100%",display:"flex",flexDirection:"column"},children:[console.log("ğŸ“‹ PÅ™edÃ¡vÃ¡m chatbotId do FilteredSanaChatWithSettings:",Q.id),e.jsx(xr,{chatbotId:Q.id,onClose:()=>he(null)})]})})})}),u&&e.jsx(Xr,{currentUserId:t.id,onClose:()=>m(!1)}),b&&e.jsx(Te,{isOpen:b,onClose:()=>d(!1),title:"",children:e.jsx(Qr,{currentUser:t,onClose:()=>d(!1)})})]})},ws=({onUploadClick:t,viewMode:o,onViewModeChange:n,selectedCount:r,onBulkDelete:s,onBulkDownload:l,onExportXml:a,onConvertClick:c,isAnyBookSelected:g,onChatbotManagementClick:u,onAddVideoClick:m,currentUser:b,onUserManagementClick:d,onProfileSettingsClick:v,onLogoutClick:P})=>{const[f,z]=p.useState(!1),C=b.role==="spravce";return e.jsxs("header",{style:h.header,children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"2rem"},children:[e.jsx("img",{src:"https://modopafybeslbcqjxsve.supabase.co/storage/v1/object/public/web/image-removebg-preview%20(1).png ",alt:"MedBase Logo",style:{height:"60px",width:"auto",objectFit:"contain"}}),e.jsxs("div",{style:h.headerActions,className:"header-actions-responsive",children:[e.jsxs("button",{style:h.button,onClick:t,children:[e.jsx(ns,{})," ",e.jsx("span",{className:"button-text",children:"PÅ™idat knihu"})]}),e.jsxs("button",{style:h.button,onClick:m,children:[e.jsx(us,{})," ",e.jsx("span",{className:"button-text",children:"PÅ™idat video"})]}),e.jsx("button",{style:h.button,onClick:c,disabled:!g,children:e.jsx("span",{className:"button-text",children:"Konvertovat knihu"})}),C&&e.jsxs("button",{style:h.button,onClick:u,children:[e.jsx(ds,{})," ",e.jsx("span",{className:"button-text",children:"SprÃ¡va chatbotÅ¯"})]}),C&&e.jsxs("button",{style:h.button,onClick:d,children:[e.jsx(ps,{})," ",e.jsx("span",{className:"button-text",children:"SprÃ¡va uÅ¾ivatelÅ¯"})]}),r>0&&e.jsxs("div",{style:{position:"relative"},children:[e.jsxs("button",{style:h.button,onClick:()=>z(T=>!T),onBlur:()=>setTimeout(()=>z(!1),200),children:["HromadnÃ© akce (",r,") ",e.jsx(as,{})]}),f&&e.jsxs("div",{style:h.dropdownMenu,children:[e.jsxs("a",{style:h.dropdownMenuLink,onClick:()=>{s(),z(!1)},children:[e.jsx(Oe,{size:14})," Smazat vybranÃ©"]}),e.jsxs("a",{style:h.dropdownMenuLink,onClick:()=>{l(),z(!1)},children:[e.jsx(Mo,{})," StÃ¡hnout vybranÃ©"]}),e.jsxs("a",{style:h.dropdownMenuLink,onClick:()=>{a(),z(!1)},children:[e.jsx(cs,{})," Exportovat do XML"]})]})]})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"nowrap"},children:[e.jsxs("button",{className:"user-info-button",onClick:v,style:{display:"flex",alignItems:"center",gap:"8px",padding:"6px 12px",background:"var(--background-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",cursor:"pointer",transition:"all 0.2s",fontSize:"12px",color:"var(--text-primary)",whiteSpace:"nowrap"},title:b.email,children:[e.jsx("span",{className:"user-email-text",style:{fontWeight:"500",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"150px"},children:b.firstName}),e.jsx("span",{className:"user-role-badge",style:{fontSize:"10px",padding:"2px 6px",background:C?"#e0e7ff":"#f3e8ff",color:C?"#1e40af":"#6b21a8",borderRadius:"6px",fontWeight:"500"},children:C?"SprÃ¡vce":"Admin"})]}),e.jsxs("div",{style:h.viewToggle,children:[e.jsx("button",{style:{...h.iconButton,...o==="list"?h.iconButtonActive:{}},onClick:()=>n("list"),"aria-label":"List view",children:e.jsx(os,{})}),e.jsx("button",{style:{...h.iconButton,...o==="grid"?h.iconButtonActive:{}},onClick:()=>n("grid"),"aria-label":"Grid view",children:e.jsx(ts,{})})]}),e.jsx("button",{style:{...h.iconButton,padding:"0.5rem"},onClick:v,title:"NastavenÃ­ profilu",children:e.jsx(xs,{})}),e.jsxs("button",{className:"logout-button",style:{...h.button,background:"var(--background-secondary)",color:"var(--text-primary)",border:"1px solid var(--border-color)"},onClick:P,title:"OdhlÃ¡sit se",children:[e.jsx(hs,{})," ",e.jsx("span",{className:"logout-text",children:"OdhlÃ¡sit"})]})]})]})},ot=({items:t,selectedItems:o,onItemClick:n,maxVisible:r=10,renderItem:s})=>{const[l,a]=p.useState(!1);if(t.length===0)return e.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"0.9em",fontStyle:"italic"},children:"Å½Ã¡dnÃ© poloÅ¾ky"});const c=l?t:t.slice(0,r),g=t.length>r;return e.jsxs("div",{style:h.tagList,children:[c.map(u=>{const m=o.includes(u);return e.jsx("span",{onClick:()=>n(u),children:s?s(u,m):e.jsx("span",{style:{...h.tag,...m?h.tagSelected:{}},children:u})},u)}),g&&e.jsx("div",{style:{width:"100%",textAlign:"center",marginTop:"8px"},children:e.jsx("button",{onClick:()=>a(!l),style:{background:"none",border:"1px solid var(--border)",color:"var(--primary-color)",cursor:"pointer",fontSize:"0.8em",padding:"4px 12px",borderRadius:"12px",backgroundColor:"var(--surface)"},children:l?"â† Zobrazit mÃ©nÄ›":`Zobrazit vÃ­ce (+${t.length-r})`})})]})},Cs=({title:t,options:o,selectedValue:n,onChange:r})=>e.jsxs("div",{style:h.fieldGroup,children:[e.jsx("label",{style:h.label,children:t}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:o.map(s=>e.jsxs("button",{onClick:()=>r(s.value),style:{backgroundColor:n===s.value?"var(--accent-primary)":"transparent",color:n===s.value?"white":"var(--text-secondary)",border:`1px solid ${n===s.value?"var(--accent-primary)":"var(--border-color)"}`,borderRadius:"4px",padding:"4px 8px",fontSize:"0.75rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",transition:"all 0.2s ease",minWidth:"auto"},title:s.label,children:[s.icon&&e.jsx("span",{style:{display:"flex",alignItems:"center",fontSize:"12px"},children:s.icon}),e.jsx("span",{style:{fontSize:"0.75rem"},children:s.label})]},s.value))})]}),Ue=({title:t,children:o,onAdd:n,onDelete:r,allItems:s})=>{const[l,a]=p.useState(!1),[c,g]=p.useState(!1),[u,m]=p.useState({isOpen:!1,item:null}),b=p.useRef(null),d=P=>{m({isOpen:!0,item:P}),a(!1),g(!1)},v=()=>{u.item&&r&&r(u.item),m({isOpen:!1,item:null})};return p.useEffect(()=>{const P=f=>{b.current&&!b.current.contains(f.target)&&a(!1)};return document.addEventListener("mousedown",P),()=>document.removeEventListener("mousedown",P)},[]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:h.fieldGroup,children:[e.jsxs("div",{style:h.filterGroupHeader,children:[e.jsx("label",{style:h.label,children:t}),n&&e.jsxs("div",{style:{position:"relative"},ref:b,children:[e.jsx("button",{onClick:()=>a(!l),style:h.addTagButton,title:`Spravovat ${t.toLowerCase()}`,children:e.jsx(Qe,{})}),l&&e.jsxs("div",{style:{...h.tagDropdown,right:0,left:"auto",minWidth:"200px"},children:[e.jsxs("a",{onClick:()=>{a(!1),n()},style:{...h.dropdownMenuLink,...h.addNewTagLink},children:[e.jsx(Qe,{})," VytvoÅ™it novÃ½"]}),r&&s&&s.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{borderTop:"1px solid var(--border)",margin:"4px 0"}}),e.jsxs("a",{onClick:()=>{a(!1),g(!0)},style:{...h.dropdownMenuLink,color:"var(--danger-color)"},children:[e.jsx(Oe,{size:14})," Spravovat poloÅ¾ky"]})]})]})]})]}),o]}),c&&e.jsx(Te,{isOpen:c,onClose:()=>g(!1),title:`Spravovat ${t.toLowerCase()}`,children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",maxHeight:"400px",overflowY:"auto"},children:[e.jsx("p",{style:{fontSize:"0.9em",color:"var(--text-secondary)",margin:0},children:'KliknutÃ­m na tlaÄÃ­tko "Smazat" odstranÃ­te poloÅ¾ku ze systÃ©mu. Tato akce je nevratnÃ¡.'}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[s==null?void 0:s.map(P=>e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 12px",borderRadius:"6px",border:"1px solid var(--border)",backgroundColor:"var(--surface)"},children:[e.jsx("span",{style:{flex:1},children:P.replace("_"," ")}),e.jsxs("button",{onClick:()=>d(P),style:{background:"var(--danger-color)",color:"white",border:"none",borderRadius:"4px",padding:"4px 8px",cursor:"pointer",fontSize:"12px",display:"flex",alignItems:"center",gap:"4px"},title:`Smazat ${P}`,children:[e.jsx(Oe,{size:12})," Smazat"]})]},P)),(!s||s.length===0)&&e.jsx("p",{style:{textAlign:"center",color:"var(--text-secondary)",margin:"20px 0"},children:"Å½Ã¡dnÃ© poloÅ¾ky k zobrazenÃ­."})]})]})}),u.isOpen&&e.jsx(Te,{isOpen:u.isOpen,onClose:()=>m({isOpen:!1,item:null}),title:"PotvrzenÃ­ smazÃ¡nÃ­",children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsxs("p",{children:['Opravdu chcete smazat poloÅ¾ku "',u.item,'"?']}),e.jsx("p",{style:{fontSize:"0.9em",color:"var(--text-secondary)"},children:"Tato akce je nevratnÃ¡. PoloÅ¾ka bude odebrÃ¡na ze vÅ¡ech knih."}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>m({isOpen:!1,item:null}),style:{...h.button,background:"var(--surface)",color:"var(--text)"},children:"ZruÅ¡it"}),e.jsxs("button",{onClick:v,style:{...h.button,background:"var(--danger-color)",color:"white"},children:[e.jsx(Oe,{size:16})," Smazat"]})]})]})})]})},zs=t=>{const[o,n]=p.useState(!1),[r,s]=p.useState(null),[l,a]=p.useState(""),c=(d,v)=>{s({title:d,onAdd:v}),a(""),n(!0)},g=()=>{l.trim()&&r&&r.onAdd(l.trim()),n(!1)},u=(d,v,P)=>{const f=new Set(v);f.has(d)?f.delete(d):f.add(d),P(Array.from(f))},m=(d,v)=>{const P=parseInt(v,10),f={...t.dateAddedRange};d==="from"?f.from=Math.min(P,f.to):f.to=Math.max(P,f.from),t.onDateAddedRangeChange(f)},b=d=>{if(!d)return"";const[v,P]=d.split("-");return`${es[parseInt(P,10)-1]} ${v}`};return e.jsxs(e.Fragment,{children:[e.jsxs("aside",{style:h.leftPanel,children:[e.jsx(Ue,{title:"Hledat",children:e.jsx("input",{type:"text",placeholder:"NÃ¡zev, autor, klÃ­ÄovÃ© slovo...",style:h.input,value:t.filter,onChange:d=>t.onFilterChange(d.target.value)})}),e.jsx(Ue,{title:"Rok vydÃ¡nÃ­",children:e.jsxs("div",{style:h.rangeSliderContainer,children:[e.jsxs("div",{style:h.rangeSliderRowSimple,children:[e.jsx("span",{style:h.rangeLabel,children:"Od"}),e.jsx("input",{type:"range",min:t.minYear,max:t.maxYear,value:t.yearRange.from||t.minYear,onChange:d=>t.onYearRangeChange({...t.yearRange,from:parseInt(d.target.value)})}),e.jsx("span",{style:h.rangeValue,children:t.yearRange.from||t.minYear})]}),e.jsxs("div",{style:h.rangeSliderRowSimple,children:[e.jsx("span",{style:h.rangeLabel,children:"Do"}),e.jsx("input",{type:"range",min:t.minYear,max:t.maxYear,value:t.yearRange.to||t.maxYear,onChange:d=>t.onYearRangeChange({...t.yearRange,to:parseInt(d.target.value)})}),e.jsx("span",{style:h.rangeValue,children:t.yearRange.to||t.maxYear})]})]})}),e.jsx(Ue,{title:"Datum pÅ™idÃ¡nÃ­",children:e.jsxs("div",{style:h.rangeSliderContainer,children:[e.jsxs("div",{style:h.rangeSliderRowSimple,children:[e.jsx("span",{style:h.rangeLabel,children:"Od"}),e.jsx("input",{type:"range",min:0,max:t.availableMonths.length>0?t.availableMonths.length-1:0,value:t.dateAddedRange.from,disabled:t.availableMonths.length===0,onChange:d=>m("from",d.target.value)}),e.jsx("span",{style:h.rangeValue,children:b(t.availableMonths[t.dateAddedRange.from])})]}),e.jsxs("div",{style:h.rangeSliderRowSimple,children:[e.jsx("span",{style:h.rangeLabel,children:"Do"}),e.jsx("input",{type:"range",min:0,max:t.availableMonths.length>0?t.availableMonths.length-1:0,value:t.dateAddedRange.to,disabled:t.availableMonths.length===0,onChange:d=>m("to",d.target.value)}),e.jsx("span",{style:h.rangeValue,children:b(t.availableMonths[t.dateAddedRange.to])})]})]})}),e.jsx(Ue,{title:"Typy publikacÃ­",onAdd:()=>c("Zadejte nÃ¡zev novÃ©ho typu publikace",t.onAddType),onDelete:t.onDeleteType,allItems:t.allTypes,children:e.jsx(ot,{items:t.allTypes,selectedItems:t.selectedTypes,onItemClick:d=>u(d,t.selectedTypes,t.onTypeFilterChange),renderItem:(d,v)=>e.jsx("span",{style:{...h.tag,...v?h.tagSelected:{}},children:d.replace("_"," ")})})}),e.jsx(Ue,{title:"Kategorie",onAdd:()=>c("Zadejte nÃ¡zev novÃ© kategorie",t.onAddCategory),onDelete:t.onDeleteCategory,allItems:t.allCategories,children:e.jsx(ot,{items:t.allCategories,selectedItems:t.selectedCategories,onItemClick:d=>u(d,t.selectedCategories,t.onCategoryFilterChange)})}),e.jsx(Ue,{title:"Å tÃ­tky",onAdd:()=>c("Zadejte nÃ¡zev novÃ©ho Å¡tÃ­tku",t.onAddLabel),onDelete:t.onDeleteLabel,allItems:t.allLabels,children:e.jsx(ot,{items:t.allLabels,selectedItems:t.selectedLabels,onItemClick:d=>u(d,t.selectedLabels,t.onLabelFilterChange)})}),e.jsx(Ue,{title:"Jazyky",children:e.jsx(ot,{items:t.allLanguages,selectedItems:t.selectedLanguages,onItemClick:d=>u(d,t.selectedLanguages,t.onLanguageFilterChange),renderItem:(d,v)=>e.jsxs("span",{style:{...h.tag,...v?h.tagSelected:{}},children:[kt(d)," ",d]})})}),e.jsx(Ue,{title:"Verze vydÃ¡nÃ­",children:e.jsx(ot,{items:t.allVersions,selectedItems:t.selectedVersions,onItemClick:d=>u(d,t.selectedVersions,t.onVersionFilterChange),renderItem:(d,v)=>e.jsxs("span",{style:{...h.tag,...v?h.tagSelected:{}},children:["ğŸ“– ",d]})})}),e.jsx(Cs,{title:"VDB",selectedValue:t.vdbFilter,onChange:t.onVdbFilterChange,options:[{value:"all",label:"VÅ¡e"},{value:"success",label:"OK",icon:e.jsx(Ve,{status:"success"})},{value:"error",label:"Err",icon:e.jsx(Ve,{status:"error"})},{value:"pending",label:"...",icon:e.jsx(Ve,{status:"pending"})}]})]}),e.jsx(Te,{isOpen:o,onClose:()=>n(!1),title:(r==null?void 0:r.title)||"PÅ™idat poloÅ¾ku",children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsx("input",{type:"text",value:l,onChange:d=>a(d.target.value),style:h.input,placeholder:"Zadejte nÃ¡zev...",onKeyDown:d=>{d.key==="Enter"&&g()},autoFocus:!0}),e.jsxs("button",{onClick:g,style:{...h.button,alignSelf:"flex-end"},children:[e.jsx(Qe,{})," PÅ™idat"]})]})})]})},Ss=({books:t,selectedBookId:o,selectedBookIds:n,onSelectBook:r,onToggleSelection:s,onSelectAll:l,onDeleteBook:a,onDownloadBook:c,onTestWebhook:g,onVectorDatabaseAction:u,vectorProcessingBooks:m})=>{const b=t.length>0&&n.size===t.length;return e.jsx("div",{style:h.bookTableWrapper,children:e.jsxs("table",{style:h.bookTable,className:"book-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{...h.th,width:"40px"},children:e.jsx("input",{type:"checkbox",checked:b,onChange:d=>l(d.target.checked)})}),e.jsx("th",{style:{...h.th,width:"40px"}}),e.jsx("th",{style:h.th,children:"NÃ¡zev"}),e.jsx("th",{style:h.th,children:"Autor"}),e.jsx("th",{style:h.th,children:"Kategorie"}),e.jsx("th",{style:h.th,children:"Å tÃ­tky"}),e.jsx("th",{style:h.th,children:"Rok vydÃ¡nÃ­"}),e.jsx("th",{style:h.th,children:"Verze vydÃ¡nÃ­"}),e.jsx("th",{style:h.th,children:"Typ publikace"}),e.jsx("th",{style:h.th,children:"Jazyk"}),e.jsx("th",{style:h.th,children:"FormÃ¡t"}),e.jsx("th",{style:h.th,children:"Velikost"}),e.jsx("th",{style:h.th,children:"Datum pÅ™idÃ¡nÃ­"}),e.jsx("th",{style:h.th,children:"Akce"})]})}),e.jsx("tbody",{children:t.map(d=>e.jsxs("tr",{style:{...h.tr,...d.id===o?h.trSelected:{}},className:d.id===o?"selected":"",children:[e.jsx("td",{style:h.td,onClick:v=>v.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:n.has(d.id),onChange:()=>s(d.id)})}),e.jsx("td",{style:{...h.td,textAlign:"center",cursor:"pointer"},onClick:v=>{v.stopPropagation(),u(d)},title:`Stav vektorovÃ© databÃ¡ze: ${d.vectorStatus==="pending"?"ÄekÃ¡ na nahrÃ¡nÃ­":d.vectorStatus==="success"?"ÃºspÄ›Å¡nÄ› nahrÃ¡no":"chyba pÅ™i nahrÃ¡vÃ¡nÃ­"}

KliknÄ›te pro odeslÃ¡nÃ­ do vektorovÃ© databÃ¡ze.
${m.has(d.id)?"â³ ZpracovÃ¡vÃ¡ se... (mÅ¯Å¾e trvat aÅ¾ 5 minut)":"PÅ™ed odeslÃ¡nÃ­m budou zkontrolovÃ¡na povinnÃ¡ metadata."}`,children:e.jsx(Ve,{status:d.vectorStatus,isLoading:m.has(d.id)})}),e.jsx("td",{style:{...h.td,...h.tdTitle},onClick:()=>r(d.id),children:d.title}),e.jsx("td",{style:h.td,onClick:()=>r(d.id),children:d.author}),e.jsx("td",{style:{...h.td,minWidth:"150px"},onClick:()=>r(d.id),children:e.jsx(Ft,{items:d.categories,maxVisible:3,tableMode:!0,renderTag:v=>e.jsx("span",{className:"tag",style:{...h.tag,fontSize:"0.7rem",padding:"2px 6px"},children:v})})}),e.jsx("td",{style:{...h.td,minWidth:"150px"},onClick:()=>r(d.id),children:e.jsx(Ft,{items:d.labels,maxVisible:3,tableMode:!0,renderTag:v=>e.jsx("span",{className:"tag",style:{...h.tag,fontSize:"0.7rem",padding:"2px 6px"},children:v})})}),e.jsx("td",{style:h.td,onClick:()=>r(d.id),children:d.publicationYear||"â€“"}),e.jsx("td",{style:h.td,onClick:()=>r(d.id),children:d.releaseVersion||"â€“"}),e.jsx("td",{style:h.td,onClick:()=>r(d.id),children:e.jsx(Ft,{items:d.publicationTypes,maxVisible:3,tableMode:!0,renderTag:v=>e.jsx("span",{className:"tag",style:{...h.tag,fontSize:"0.7rem",padding:"2px 6px"},children:v.replace("_"," ")})})}),e.jsx("td",{style:h.td,onClick:()=>r(d.id),children:kt(d.language)}),e.jsx("td",{style:h.td,onClick:()=>r(d.id),children:d.format}),e.jsx("td",{style:h.td,onClick:()=>r(d.id),children:fs(d.fileSize)}),e.jsx("td",{style:h.td,onClick:()=>r(d.id),children:gs(d.dateAdded)}),e.jsxs("td",{style:{...h.td,...h.tdActions},onClick:v=>v.stopPropagation(),children:[e.jsx("button",{style:h.iconButton,onClick:()=>c(d.id),"aria-label":"StÃ¡hnout knihu",children:e.jsx(Mo,{})}),e.jsx("button",{style:{...h.iconButton,color:"#3b82f6"},onClick:()=>g(d.id),"aria-label":"Testovat webhook",title:"Testovat webhook (pouze zavolÃ¡ webhook bez mazÃ¡nÃ­ knihy)",children:e.jsx(Uo,{})}),e.jsx("button",{style:{...h.iconButton,color:"var(--danger-color)"},onClick:()=>a(d.id),"aria-label":"Smazat knihu",children:e.jsx(Oe,{})})]})]},d.id))})]})})},_s=({books:t,selectedBookId:o,onSelectBook:n})=>e.jsx("div",{style:h.gridContainer,children:t.map(r=>e.jsxs("div",{style:{...h.gridCard,...r.id===o?h.gridCardSelected:{}},onClick:()=>n(r.id),children:[e.jsx("img",{src:r.coverImageUrl,alt:`Cover of ${r.title}`,style:h.gridCardCover}),e.jsx("h3",{style:h.gridCardTitle,children:r.title}),e.jsx("p",{style:h.gridCardAuthor,children:r.author})]},r.id))}),Ns=({book:t,onUpdate:o,onDelete:n,onTestWebhook:r,onDebugStorage:s,onTestDeleteImages:l,onReadClick:a,allLabels:c,onAddNewLabel:g,onDeleteLabel:u,allCategories:m,onAddNewCategory:b,onDeleteCategory:d,allPublicationTypes:v,onAddNewPublicationType:P,onDeletePublicationType:f,allAvailableLanguages:z})=>{const[C,T]=p.useState(!1),[y,V]=p.useState(t),[F,S]=p.useState({}),[R,J]=p.useState(!1),[w,U]=p.useState(!1),[ne,q]=p.useState(!1),[I,se]=p.useState("AngliÄtina"),[G,oe]=p.useState(!1),[W,re]=p.useState("recommended"),[N,M]=p.useState(!1),[x,_]=p.useState(!1),j=p.useCallback(B=>{V(B)},[]);p.useEffect(()=>{(!y.id||y.id!==t.id)&&(V(t),T(!1))},[t.id,y.id]);const O=()=>{if(!t.filePath||t.format!=="PDF"){alert("OCR lze aplikovat pouze na PDF soubory");return}M(!0)},Y=async()=>{M(!1),U(!0);try{console.log(`ğŸ§ª OCR zpracovÃ¡nÃ­ pro knihu: ${t.title}`),console.log(`ğŸ“„ Soubor: ${t.filePath}`),console.log(`ğŸŒ Jazyk: ${I}`);const{data:B,error:H}=await E.storage.from("Books").download(t.filePath);if(H)throw H;const ae=new File([B],`${t.title}.pdf`,{type:"application/pdf"});console.log(`ğŸ“Š Velikost souboru: ${(ae.size/1024/1024).toFixed(2)} MB`);const ie=await Ie.performOCR(ae,I);console.log(`âœ… OCR dokonÄeno. NovÃ¡ velikost: ${(ie.size/1024/1024).toFixed(2)} MB`);const{error:le}=await E.storage.from("Books").update(t.filePath,ie,{cacheControl:"3600",upsert:!0});if(le)throw le;const ye=Math.round(ie.size/1024),je={...t,hasOCR:!0,fileSize:ye};await E.from("books").update({OCR:!0,file_size:ye}).eq("id",t.id),o(je);const ke=ae.size/1024/1024,He=ie.size/1024/1024,Ge=He>ke?"zvÄ›tÅ¡il":"zmenÅ¡il",Ye=Math.abs((He-ke)/ke*100);alert(`âœ… OCR ÃºspÄ›Å¡nÃ©!

Soubor byl zpracovÃ¡n s OCR (${I})
PÅ¯vodnÃ­ velikost: ${ke.toFixed(2)} MB
NovÃ¡ velikost: ${He.toFixed(2)} MB
Soubor se ${Ge} o ${Ye.toFixed(1)}%

PÅ¯vodnÃ­ soubor byl nahrazen OCR verzÃ­.
Cesta: ${t.filePath}`)}catch(B){console.error("âŒ OCR zpracovÃ¡nÃ­ selhalo:",B);let H=`âŒ OCR zpracovÃ¡nÃ­ selhalo:

${B.message}`;B.message.includes("HTTP 500")||B.message.includes("ServerError")?H=`âŒ OCR selhalo - iLovePDF API mÃ¡ problÃ©my

ğŸ”§ Co mÅ¯Å¾ete zkusit:
â€¢ Zkuste to za 5-10 minut
â€¢ Zkontrolujte velikost souboru (max ~50MB)
â€¢ OvÄ›Å™te, Å¾e PDF nenÃ­ poÅ¡kozenÃ©

TechnickÃ¡ chyba: ${B.message}`:(B.message.includes("network")||B.message.includes("fetch"))&&(H=`âŒ OCR selhalo - problÃ©m s pÅ™ipojenÃ­m

ğŸŒ Zkontrolujte internetovÃ© pÅ™ipojenÃ­ a zkuste znovu.

Chyba: ${B.message}`),alert(H)}finally{U(!1)}},te=()=>{if(!t.filePath||t.format!=="PDF"){alert("Kompresi lze aplikovat pouze na PDF soubory");return}_(!0)},Q=async()=>{_(!1),q(!0);try{console.log(`ğŸ§ª Komprese pro knihu: ${t.title}`),console.log(`ğŸ“„ Soubor: ${t.filePath}`),console.log(`ğŸ—œï¸ ÃšroveÅˆ: ${W}`);const{data:B,error:H}=await E.storage.from("Books").download(t.filePath);if(H)throw H;const ae=new File([B],`${t.title}.pdf`,{type:"application/pdf"}),ie=ae.size/1024/1024;console.log(`ğŸ“Š PÅ¯vodnÃ­ velikost: ${ie.toFixed(2)} MB`);const le=await Ie.compressPDF(ae,W),ye=le.size/1024/1024,je=(ie-ye)/ie*100;console.log(`âœ… Komprese dokonÄena. NovÃ¡ velikost: ${ye.toFixed(2)} MB`),console.log(`ğŸ’¾ UÅ¡etÅ™eno: ${je.toFixed(1)}%`);const{error:ke}=await E.storage.from("Books").update(t.filePath,le,{cacheControl:"3600",upsert:!0});if(ke)throw ke;const He={...t,fileSize:Math.round(le.size/1024)};await E.from("books").update({file_size:Math.round(le.size/1024)}).eq("id",t.id),o(He),alert(`âœ… Komprese ÃºspÄ›Å¡nÃ¡!

PÅ¯vodnÃ­ velikost: ${ie.toFixed(2)} MB
NovÃ¡ velikost: ${ye.toFixed(2)} MB
UÅ¡etÅ™eno: ${je.toFixed(1)}% (${W})

PÅ¯vodnÃ­ soubor byl nahrazen komprimovanou verzÃ­.
Cesta: ${t.filePath}`)}catch(B){console.error("âŒ Komprese selhala:",B),alert(`âŒ Komprese selhala:

${B.message}`)}finally{q(!1)}},he=p.useCallback(async B=>{S(H=>({...H,[B]:!0}));try{console.log("ğŸ¤– AI generovÃ¡nÃ­ spuÅ¡tÄ›no pro pole:",B);const H=Se(y.id);if(H.hasCache)console.log("ğŸ’¾ Text uÅ¾ je v mezipamÄ›ti z pÅ™edchozÃ­ OCR extrakce:",H.size,"znakÅ¯,",H.age,"starÃ½");else{console.log("ğŸ“¥ Text nenÃ­ v mezipamÄ›ti, spouÅ¡tÃ­m automatickou OCR extrakci pÅ™es webhook...");try{const le=await mt(y);console.log("âœ… Text automaticky extrahovÃ¡n pÅ™es OCR webhook do mezipamÄ›ti:",le.length,"znakÅ¯"),j(ye=>({...ye}))}catch(le){console.warn("âš ï¸ AutomatickÃ¡ OCR extrakce selhala, pokraÄuji s AI generovÃ¡nÃ­m bez textu:",le),alert("âš ï¸ NepodaÅ™ilo se extrahovat text pÅ™es OCR webhook. AI bude generovat metadata pouze z nÃ¡zvu knihy.")}}const ae=await bs(B,y);let ie=ae;B==="keywords"?ie=ae.split(",").map(le=>le.trim()):B==="publicationYear"&&(ie=parseInt(ae,10)||y.publicationYear),j(le=>({...le,[B]:ie}))}catch(H){console.error("âŒ Chyba pÅ™i AI generovÃ¡nÃ­:",H),alert(`Chyba pÅ™i generovÃ¡nÃ­ ${B}: ${H instanceof Error?H.message:String(H)}`)}finally{S(H=>({...H,[B]:!1}))}},[j,y.id,Se,mt]),we=async()=>{J(!0);try{if(y.format.toLowerCase()!=="pdf"){alert("âš ï¸ InteligentnÃ­ extrakce metadat je podporovÃ¡na pouze pro PDF soubory!"),J(!1);return}console.log("ğŸ¤– SpouÅ¡tÃ­m inteligentnÃ­ extrakci metadat...");const B=await ys(y);console.log("ğŸ“ Aplikuji extrahovanÃ¡ metadata:",B),j(H=>{const ae={...H,...B};return console.log("ğŸ“š AktualizovanÃ¡ kniha:",ae),ae}),console.log("âœ… InteligentnÃ­ metadata ÃºspÄ›Å¡nÄ› aplikovÃ¡na na knihu")}catch(B){console.error("âŒ Chyba pÅ™i inteligentnÃ­ extrakci metadat:",B),alert(`âŒ Chyba pÅ™i inteligentnÃ­ extrakci metadat:

${B instanceof Error?B.message:String(B)}

Zkuste to prosÃ­m znovu nebo pouÅ¾ijte jinou metodu.`)}finally{J(!1)}},$e=()=>{o(y),T(!1)},De=()=>{j(t),T(!1)},de=async()=>{try{console.log("ğŸ”„ Aktualizuji Qdrant metadata pro knihu:",t.id),console.log("ğŸ“‚ AktuÃ¡lnÃ­ categories:",y.categories),console.log("ğŸ“‚ AktuÃ¡lnÃ­ labels:",y.labels),console.log("ğŸ“‚ AktuÃ¡lnÃ­ publicationTypes:",y.publicationTypes),o(y);const B=await ce.updateQdrantMetadata(t.id,y.categories,y.labels,y.publicationTypes);B.success?(alert(B.message),T(!1)):alert(`âŒ ${B.message}`)}catch(B){console.error("âŒ Chyba pÅ™i aktualizaci Qdrant metadata:",B),alert(`âŒ NeoÄekÃ¡vanÃ¡ chyba pÅ™i aktualizaci metadata: ${B instanceof Error?B.message:"NeznÃ¡mÃ¡ chyba"}`)}},Ce=async B=>{var ae;const H=(ae=B.target.files)==null?void 0:ae[0];if(H){if(!H.type.startsWith("image/")){alert("âŒ ProsÃ­m vyberte pouze obrÃ¡zkovÃ© soubory (JPG, PNG, GIF, atd.)");return}if(H.size>10*1024*1024){alert("âŒ Soubor je pÅ™Ã­liÅ¡ velkÃ½. MaximÃ¡lnÃ­ velikost je 10MB.");return}try{console.log("ğŸ“· NahrÃ¡vÃ¡m cover obrÃ¡zek:",H.name,H.size,"bytes");const{filePath:ie}=await ce.uploadFileWithId(H,"Books",y.id),{data:le}=E.storage.from("Books").getPublicUrl(ie),ye=le.publicUrl;console.log("âœ… Cover ÃºspÄ›Å¡nÄ› nahrÃ¡n:",ye);const je={...y,coverImageUrl:ye};j(ke=>({...ke,coverImageUrl:ye})),o(je),alert(`âœ… Cover obrÃ¡zek byl ÃºspÄ›Å¡nÄ› nahrÃ¡n!

NovÃ½ cover: ${H.name}
Velikost: ${Math.round(H.size/1024)} KB`),B.target.value=""}catch(ie){console.error("âŒ Chyba pÅ™i nahrÃ¡vÃ¡nÃ­ cover:",ie),alert(`âŒ Chyba pÅ™i nahrÃ¡vÃ¡nÃ­ cover obrÃ¡zku: ${ie instanceof Error?ie.message:String(ie)}`)}}},me=()=>e.jsxs(e.Fragment,{children:[Fe("Autor",y.author),Fe("Rok vydÃ¡nÃ­",y.publicationYear),Fe("Verze vydÃ¡nÃ­",y.releaseVersion),Fe("NakladatelstvÃ­",y.publisher),Fe("Jazyk",y.language),Fe("Typ publikace",y.publicationTypes.length>0?y.publicationTypes.map(B=>e.jsx("span",{style:h.tag,children:B.replace("_"," ")},B)):null),Fe("Sumarizace",y.summary,!0),Fe("KlÃ­ÄovÃ¡ slova",y.keywords.length>0?y.keywords.map(B=>e.jsx("span",{style:h.tag,children:B},B)):null),Fe("Kategorie",y.categories.length>0?y.categories.map(B=>e.jsx("span",{style:h.tag,children:B},B)):null),Fe("Å tÃ­tky",y.labels.length>0?y.labels.map(B=>e.jsx("span",{style:h.tag,children:B},B)):null),Fe("Stav vektorovÃ© DB",e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(Ve,{status:y.vectorStatus}),e.jsx("span",{style:{color:y.vectorStatus==="success"?"#22c55e":y.vectorStatus==="error"?"#ef4444":"#6b7280"},children:y.vectorStatus==="pending"?"ÄŒekÃ¡ na nahrÃ¡nÃ­":y.vectorStatus==="success"?"ÃšspÄ›Å¡nÄ› nahrÃ¡no":"Chyba pÅ™i nahrÃ¡vÃ¡nÃ­"})]})),Fe("OCR extrakce textu",e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap"},children:[Se(y.id).hasCache&&e.jsxs("span",{style:{color:"#22c55e"},children:["âœ… Text extrahovÃ¡n (",Se(y.id).size," znakÅ¯, ",Se(y.id).age," starÃ½)"]}),Se(y.id).hasCache&&e.jsxs(e.Fragment,{children:[e.jsx("button",{style:{...h.button,fontSize:"0.8em",padding:"4px 8px",background:"var(--accent-primary)",color:"white"},onClick:()=>{const B=Tt(y.id);if(B){const H=document.createElement("div");H.style.cssText=`
                                            position: fixed; top: 0; left: 0; right: 0; bottom: 0; 
                                            background: rgba(0,0,0,0.8); z-index: 10000; 
                                            display: flex; justify-content: center; align-items: center; padding: 20px;
                                        `;const ae=document.createElement("div");ae.style.cssText=`
                                            background: white; border-radius: 8px; padding: 20px; 
                                            max-width: 80%; max-height: 80%; overflow: auto;
                                            position: relative;
                                        `;const ie=document.createElement("button");ie.innerHTML="âœ•",ie.style.cssText=`
                                            position: absolute; top: 10px; right: 10px; 
                                            background: #ef4444; color: white; border: none; 
                                            border-radius: 50%; width: 30px; height: 30px; 
                                            cursor: pointer; font-size: 16px;
                                        `,ie.onclick=()=>document.body.removeChild(H);const le=document.createElement("h3");le.textContent=`ExtrahovanÃ½ text z: ${y.title}`,le.style.cssText="margin: 0 0 15px 0; color: #333;";const ye=document.createElement("div");ye.style.cssText="white-space: pre-wrap; font-family: monospace; font-size: 12px; line-height: 1.4; color: #333;",ye.textContent=B;const je=document.createElement("div");je.style.cssText="margin-top: 15px; padding: 10px; background: #f3f4f6; border-radius: 4px; font-size: 12px; color: #666;",je.innerHTML=`ğŸ“Š Velikost: ${B.length} znakÅ¯ | ğŸ“… StaÅ¾eno: ${new Date().toLocaleString("cs-CZ")}`,ae.appendChild(ie),ae.appendChild(le),ae.appendChild(ye),ae.appendChild(je),H.appendChild(ae),document.body.appendChild(H),H.onclick=ke=>{ke.target===H&&document.body.removeChild(H)}}},title:"Zobrazit text z mezipamÄ›ti",children:"ğŸ‘ï¸ Zobrazit text"}),e.jsx("button",{style:{...h.button,fontSize:"0.8em",padding:"4px 8px",background:"var(--danger-color)",color:"white"},onClick:()=>{confirm("Opravdu chcete smazat text z mezipamÄ›ti?")&&($t(y.id),j({...y}),alert("ğŸ—‘ï¸ Text z mezipamÄ›ti smazÃ¡n"))},title:"Smazat text z mezipamÄ›ti",children:"ğŸ—‘ï¸ Smazat"})]})]}))]}),et=p.useMemo(()=>e.jsxs(e.Fragment,{children:[e.jsx(Ke,{label:"NÃ¡zev publikace",name:"title",value:y.title,setLocalBook:j,onAIGenerate:he,isGenerating:F.title||!1,type:"text"}),e.jsx(Ke,{label:"Autor",name:"author",value:y.author,setLocalBook:j,onAIGenerate:he,isGenerating:F.author||!1,type:"text"}),e.jsx(Ke,{label:"Rok vydÃ¡nÃ­",name:"publicationYear",value:String(y.publicationYear||""),setLocalBook:j,onAIGenerate:he,isGenerating:F.publicationYear||!1,type:"number"}),e.jsx(Ke,{label:"Verze vydÃ¡nÃ­",name:"releaseVersion",value:y.releaseVersion||"",setLocalBook:j,onAIGenerate:he,isGenerating:F.releaseVersion||!1,type:"text"}),e.jsx(Ke,{label:"NakladatelstvÃ­",name:"publisher",value:y.publisher,setLocalBook:j,onAIGenerate:he,isGenerating:F.publisher||!1,type:"text"}),e.jsx(Ps,{value:y.language,onChange:B=>V(H=>({...H,language:B})),onAIGenerate:he?()=>he("language"):null,isGenerating:F.language||!1,allLanguages:z}),e.jsx(Ke,{label:"Sumarizace",name:"summary",value:y.summary,setLocalBook:j,onAIGenerate:he,isGenerating:F.summary||!1,type:"textarea"}),e.jsx(Ke,{label:"KlÃ­ÄovÃ¡ slova (ÄÃ¡rkou)",name:"keywords",value:y.keywords.join(", "),setLocalBook:j,onAIGenerate:he,isGenerating:F.keywords||!1,type:"text"}),e.jsxs("div",{style:h.fieldGroup,children:[e.jsx("label",{style:h.label,children:"Kategorie"}),e.jsx(Lt,{selectedTags:y.categories,allTags:m,onChange:B=>j(H=>({...H,categories:B})),onAddNewTag:b,onDeleteTag:d,promptText:"PÅ™idat novou kategorii",creationText:"VytvoÅ™it novou kategorii"})]}),e.jsxs("div",{style:h.fieldGroup,children:[e.jsx("label",{style:h.label,children:"Å tÃ­tky"}),e.jsx(Lt,{selectedTags:y.labels,allTags:c,onChange:B=>j(H=>({...H,labels:B})),onAddNewTag:g,onDeleteTag:u,promptText:"PÅ™idat novÃ½ Å¡tÃ­tek",creationText:"VytvoÅ™it novÃ½ Å¡tÃ­tek"})]}),e.jsxs("div",{style:h.fieldGroup,children:[e.jsx("label",{style:h.label,children:"Typ publikace"}),e.jsx(Lt,{selectedTags:y.publicationTypes,allTags:v,onChange:B=>j(H=>({...H,publicationTypes:B})),onAddNewTag:P,onDeleteTag:f,promptText:"PÅ™idat novÃ½ typ publikace",creationText:"VytvoÅ™it novÃ½ typ"})]}),e.jsxs("div",{style:h.fieldGroup,children:[e.jsx("label",{style:h.label,children:"Stav vektorovÃ© databÃ¡ze"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(Ve,{status:y.vectorStatus}),e.jsxs("select",{value:y.vectorStatus,onChange:B=>j(H=>({...H,vectorStatus:B.target.value})),style:h.input,children:[e.jsx("option",{value:"pending",children:"ÄŒekÃ¡ na nahrÃ¡nÃ­"}),e.jsx("option",{value:"success",children:"ÃšspÄ›Å¡nÄ› nahrÃ¡no"}),e.jsx("option",{value:"error",children:"Chyba pÅ™i nahrÃ¡vÃ¡nÃ­"})]})]})]}),e.jsxs("div",{style:h.fieldGroup,children:[e.jsx("label",{style:h.label,children:"Extrakce textu"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap"},children:[e.jsx("span",{style:{color:Se(y.id).hasCache?"#22c55e":"#6b7280",fontSize:"0.9em"},children:Se(y.id).hasCache?`Text v mezipamÄ›ti (${Se(y.id).size} znakÅ¯, ${Se(y.id).age} starÃ½)`:"Text nenÃ­ v mezipamÄ›ti"}),e.jsx("button",{style:{...h.button,fontSize:"0.8em",padding:"4px 8px",background:"var(--accent-primary)",color:"white"},onClick:async()=>{try{if(!confirm(`ğŸ“„ ODESLÃNÃ BINÃRNÃHO SOUBORU

âš ï¸ DÅ®LEÅ½ITÃ‰: PÅ™ed kliknutÃ­m na OK:
1. PÅ™ejdÄ›te do n8n workflow
2. KliknÄ›te "Execute workflow" nebo "Listen for test event"
3. Hned potÃ© kliknÄ›te OK

OdeÅ¡le se binÃ¡rnÃ­ soubor knihy na webhook

PokraÄovat?`))return;console.log("ğŸ“„ OdesÃ­lÃ¡m binÃ¡rnÃ­ soubor na webhook...");const H=Se(y.id);if(H.hasCache&&!confirm(`Text uÅ¾ je v mezipamÄ›ti (${H.size} znakÅ¯, ${H.age} starÃ½). Chcete ho pÅ™epsat pÅ™es webhook?`)){console.log("âŒ UÅ¾ivatel zruÅ¡il pÅ™epsÃ¡nÃ­ mezipamÄ›ti");return}const ae=await mt(y);alert(`âœ… Text ÃºspÄ›Å¡nÄ› extrahovÃ¡n pÅ™es webhook a uloÅ¾en do mezipamÄ›ti!

Velikost: ${ae.length} znakÅ¯

PrvnÃ­ch 100 znakÅ¯:
${ae.substring(0,100)}...`),j({...y})}catch(B){console.error("âŒ Chyba pÅ™i extrakci textu pÅ™es webhook:",B),alert(`âŒ Chyba pÅ™i extrakci textu pÅ™es webhook: ${B instanceof Error?B.message:String(B)}`)}},title:"Extrahovat text pÅ™es n8n webhook (binÃ¡rnÃ­ soubor) - POZOR: NejdÅ™Ã­ve spusÅ¥te listening v n8n!",children:"ğŸŒ Webhook OCR"}),e.jsx("button",{style:{...h.button,fontSize:"0.8em",padding:"4px 8px",background:"#007bff",color:"white"},onClick:async()=>{try{if(!confirm(`KONTEXT PRO LLM

âš ï¸ DÅ®LEÅ½ITÃ‰:
â€¢ Dokument bude omezen na max 50 strÃ¡nek
â€¢ VÃ½sledek pÅ™epÃ­Å¡e stÃ¡vajÃ­cÃ­ OCR text v mezipamÄ›ti
â€¢ SpeciÃ¡lnÃ­ webhook pro pokroÄilou OCR extrakci

PokraÄovat?`))return;console.log("ğŸ§  OdesÃ­lÃ¡m dokument na LLM kontext webhook...");const H=Se(y.id);H.hasCache&&console.log(`ğŸ’¾ PÅ™epÃ­Å¡Ã­m existujÃ­cÃ­ OCR text v mezipamÄ›ti (${H.size} znakÅ¯, ${H.age} starÃ½)`);const ae=await ks(y);alert(`âœ… LLM kontext ÃºspÄ›Å¡nÄ› extrahovÃ¡n a uloÅ¾en do mezipamÄ›ti!

Velikost: ${ae.length} znakÅ¯
(Max 50 strÃ¡nek)

PrvnÃ­ch 100 znakÅ¯:
${ae.substring(0,100)}...`),j({...y})}catch(B){console.error("âŒ Chyba pÅ™i LLM kontext extrakci:",B),alert(`âŒ Chyba pÅ™i LLM kontext extrakci: ${B instanceof Error?B.message:String(B)}`)}},title:"Extrahovat obsah pro LLM kontext - max 50 strÃ¡nek (pÅ™epÃ­Å¡e stÃ¡vajÃ­cÃ­ OCR text)",children:"Kontext pro LLM"}),Se(y.id).hasCache&&e.jsxs(e.Fragment,{children:[e.jsx("button",{style:{...h.button,fontSize:"0.8em",padding:"4px 8px",background:"var(--accent-primary)",color:"white"},onClick:()=>{const B=Tt(y.id);if(B){const H=document.createElement("div");H.style.cssText=`
                                            position: fixed; top: 0; left: 0; right: 0; bottom: 0; 
                                            background: rgba(0,0,0,0.8); z-index: 10000; 
                                            display: flex; justify-content: center; align-items: center; padding: 20px;
                                        `;const ae=document.createElement("div");ae.style.cssText=`
                                            background: white; border-radius: 8px; padding: 20px; 
                                            max-width: 80%; max-height: 80%; overflow: auto;
                                            position: relative;
                                        `;const ie=document.createElement("button");ie.innerHTML="âœ•",ie.style.cssText=`
                                            position: absolute; top: 10px; right: 10px; 
                                            background: #ef4444; color: white; border: none; 
                                            border-radius: 50%; width: 30px; height: 30px; 
                                            cursor: pointer; font-size: 16px;
                                        `,ie.onclick=()=>document.body.removeChild(H);const le=document.createElement("h3");le.textContent=`ExtrahovanÃ½ text z: ${y.title}`,le.style.cssText="margin: 0 0 15px 0; color: #333;";const ye=document.createElement("div");ye.style.cssText="white-space: pre-wrap; font-family: monospace; font-size: 12px; line-height: 1.4; color: #333;",ye.textContent=B;const je=document.createElement("div");je.style.cssText="margin-top: 15px; padding: 10px; background: #f3f4f6; border-radius: 4px; font-size: 12px; color: #666;",je.innerHTML=`ğŸ“Š Velikost: ${B.length} znakÅ¯ | ğŸ“… StaÅ¾eno: ${new Date().toLocaleString("cs-CZ")}`,ae.appendChild(ie),ae.appendChild(le),ae.appendChild(ye),ae.appendChild(je),H.appendChild(ae),document.body.appendChild(H),H.onclick=ke=>{ke.target===H&&document.body.removeChild(H)}}},title:"Zobrazit text z mezipamÄ›ti",children:"ğŸ‘ï¸ Zobrazit text"}),e.jsx("button",{style:{...h.button,fontSize:"0.8em",padding:"4px 8px",background:"var(--danger-color)",color:"white"},onClick:()=>{confirm("Opravdu chcete smazat text z mezipamÄ›ti?")&&($t(y.id),j({...y}),alert("ğŸ—‘ï¸ Text z mezipamÄ›ti smazÃ¡n"))},title:"Smazat text z mezipamÄ›ti",children:"ğŸ—‘ï¸ Smazat"})]})]})]})]}),[y,j,he,F,m,b,d,c,g,u,v,P,f,Se,$t,Tt,mt,Ce]);return e.jsxs("div",{style:h.detailContent,children:[e.jsx("img",{src:y.coverImageUrl,alt:`ObÃ¡lka: ${y.title}`,style:h.detailCover}),e.jsx("h2",{style:h.detailTitle,children:y.title||"Bez nÃ¡zvu"}),e.jsx("div",{style:{...h.detailActions,flexDirection:"column",gap:"0.5rem"},children:C?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"center"},children:[e.jsx("button",{style:h.button,onClick:a,children:"ÄŒÃ­st knihu"}),e.jsx("input",{type:"file",accept:"image/*",id:"cover-upload",style:{display:"none"},onChange:Ce}),e.jsx("button",{style:h.button,onClick:()=>{var B;return(B=document.getElementById("cover-upload"))==null?void 0:B.click()},title:"NahrÃ¡t novÃ½ cover obrÃ¡zek",children:"NahrÃ¡t cover"})]}),e.jsx("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"center"},children:e.jsx("button",{style:{...h.button,background:"var(--accent-secondary)",color:"var(--text-primary)",border:"1px solid var(--accent-secondary)"},onClick:de,children:"Aktualizovat metadata"})}),t.format==="PDF"&&e.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"center"},children:[e.jsx("button",{style:{...h.button,backgroundColor:w?"#6c757d":"#007cba",color:"white",border:"none"},onClick:O,disabled:w,title:`OCR zpracovÃ¡nÃ­ (${I}) - nahradÃ­ pÅ¯vodnÃ­ soubor`,children:w?"ğŸ”„ OCR...":"ğŸ” OCR"}),e.jsx("button",{style:{...h.button,backgroundColor:ne?"#6c757d":"#ffc107",color:"white",border:"none"},onClick:te,disabled:ne,title:`Komprese (${W}) - nahradÃ­ pÅ¯vodnÃ­ soubor`,children:ne?"ğŸ”„ Komprese...":"ğŸ—œï¸ Komprese"})]}),e.jsx("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"center",flexWrap:"wrap"},children:e.jsx("button",{style:h.button,onClick:we,disabled:R||y.format.toLowerCase()!=="pdf",title:"InteligentnÃ­ extrakce metadat - automaticky detekuje OCR a volÃ¡ optimÃ¡lnÃ­ AI model",children:R?"Generuji...":e.jsxs(e.Fragment,{children:[e.jsx(Ao,{})," Vyplnit metadata"]})})}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"center"},children:[e.jsx("button",{style:{...h.button,color:"var(--danger-color)",background:"transparent",border:"1px solid var(--danger-color)"},onClick:De,children:"ZruÅ¡it"}),e.jsx("button",{style:{...h.button,background:"transparent",border:"1px solid var(--accent-primary)"},onClick:$e,children:e.jsx(ss,{})})]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"center"},children:[e.jsx("button",{style:h.button,onClick:a,children:"ÄŒÃ­st knihu"}),e.jsx("button",{style:h.iconButton,onClick:()=>T(!0),"aria-label":"Upravit metadata",children:e.jsx(rs,{})}),e.jsx("button",{style:{...h.iconButton,color:"var(--danger-color)"},onClick:()=>n(t.id),"aria-label":"Smazat knihu",children:e.jsx(Oe,{size:18})})]})})}),e.jsx("div",{style:h.detailMeta,children:C?et:e.jsx(me,{})}),N&&e.jsx("div",{style:h.modalOverlay,children:e.jsxs("div",{style:h.modalContent,children:[e.jsxs("div",{style:h.modalHeader,children:[e.jsx("h3",{style:{margin:0},children:"ğŸ” OCR ZpracovÃ¡nÃ­"}),e.jsx("button",{style:h.modalCloseButton,onClick:()=>M(!1),children:"âœ•"})]}),e.jsxs("div",{style:h.modalBody,children:[e.jsxs("p",{style:{marginBottom:"1rem"},children:['Vyberte jazyk pro OCR zpracovÃ¡nÃ­ knihy "',e.jsx("strong",{children:t.title}),'":']}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold"},children:"Jazyk OCR:"}),e.jsx("select",{value:I,onChange:B=>se(B.target.value),style:{width:"100%",padding:"0.5rem",borderRadius:"4px",border:"1px solid var(--border-color)",backgroundColor:"var(--background-primary)",color:"var(--text-primary)",fontSize:"1rem"},children:Ie.getAvailableLanguages().map(B=>e.jsx("option",{value:B.label,children:B.label},B.code))})]}),e.jsx("div",{style:{padding:"1rem",backgroundColor:"var(--background-tertiary)",borderRadius:"6px",marginBottom:"1rem",border:"1px solid var(--border-color)"},children:e.jsxs("p",{style:{margin:0,fontSize:"0.9rem",color:"var(--text-secondary)"},children:["âš ï¸ ",e.jsx("strong",{children:"UpozornÄ›nÃ­:"})," OCR zpracovÃ¡nÃ­ nahradÃ­ pÅ¯vodnÃ­ soubor verzÃ­ s rozpoznanÃ½m textem. Proces mÅ¯Å¾e trvat aÅ¾ hodinu pro velkÃ© soubory."]})}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"flex-end"},children:[e.jsx("button",{style:{...h.button,background:"transparent",border:"1px solid var(--border-color)",color:"var(--text-primary)"},onClick:()=>M(!1),children:"ZruÅ¡it"}),e.jsx("button",{style:{...h.button,backgroundColor:"#007cba",color:"white"},onClick:Y,children:"ğŸ” Spustit OCR"})]})]})]})}),x&&e.jsx("div",{style:h.modalOverlay,children:e.jsxs("div",{style:h.modalContent,children:[e.jsxs("div",{style:h.modalHeader,children:[e.jsx("h3",{style:{margin:0},children:"ğŸ—œï¸ Komprese PDF"}),e.jsx("button",{style:h.modalCloseButton,onClick:()=>_(!1),children:"âœ•"})]}),e.jsxs("div",{style:h.modalBody,children:[e.jsxs("p",{style:{marginBottom:"1rem"},children:['Vyberte ÃºroveÅˆ komprese pro knihu "',e.jsx("strong",{children:t.title}),'":']}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold"},children:"ÃšroveÅˆ komprese:"}),e.jsxs("select",{value:W,onChange:B=>re(B.target.value),style:{width:"100%",padding:"0.5rem",borderRadius:"4px",border:"1px solid var(--border-color)",backgroundColor:"var(--background-primary)",color:"var(--text-primary)",fontSize:"1rem"},children:[e.jsx("option",{value:"low",children:"Low - MinimÃ¡lnÃ­ komprese (zachovÃ¡ kvalitu)"}),e.jsx("option",{value:"recommended",children:"Recommended - OptimÃ¡lnÃ­ pomÄ›r velikost/kvalita"}),e.jsx("option",{value:"extreme",children:"Extreme - MaximÃ¡lnÃ­ komprese (mÅ¯Å¾e snÃ­Å¾it kvalitu)"})]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--background-tertiary)",borderRadius:"6px",marginBottom:"1rem",border:"1px solid var(--border-color)"},children:[e.jsxs("p",{style:{margin:"0 0 0.5rem 0",fontSize:"0.9rem"},children:["ğŸ“Š ",e.jsx("strong",{children:"AktuÃ¡lnÃ­ velikost:"})," ",(t.fileSize/1024).toFixed(2)," MB"]}),e.jsxs("p",{style:{margin:0,fontSize:"0.9rem",color:"var(--text-secondary)"},children:["âš ï¸ ",e.jsx("strong",{children:"UpozornÄ›nÃ­:"})," Komprese nahradÃ­ pÅ¯vodnÃ­ soubor komprimovanou verzÃ­. Proces mÅ¯Å¾e trvat aÅ¾ hodinu pro velkÃ© soubory."]})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"flex-end"},children:[e.jsx("button",{style:{...h.button,background:"transparent",border:"1px solid var(--border-color)",color:"var(--text-primary)"},onClick:()=>_(!1),children:"ZruÅ¡it"}),e.jsx("button",{style:{...h.button,backgroundColor:"#ffc107",color:"white"},onClick:Q,children:"ğŸ—œï¸ Spustit Kompresi"})]})]})]})}),e.jsxs("div",{style:{marginTop:"2rem",borderTop:"1px solid var(--border-color)",paddingTop:"1rem"},children:[e.jsxs("button",{onClick:()=>oe(!G),style:{width:"100%",padding:"8px 12px",backgroundColor:"var(--background-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",color:"var(--text-secondary)",fontSize:"0.85rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",transition:"all 0.2s"},children:[e.jsx("span",{children:"ğŸ› ï¸ VÃ½vojÃ¡Å™skÃ© nÃ¡stroje"}),e.jsx("span",{style:{transform:G?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"},children:"â–¼"})]}),G&&e.jsxs("div",{style:{marginTop:"0.5rem",padding:"1rem",backgroundColor:"var(--background-tertiary)",border:"1px solid var(--border-color)",borderRadius:"6px",display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[e.jsxs("button",{style:{...h.button,fontSize:"0.85rem",padding:"6px 12px",backgroundColor:"#3b82f6",color:"white",border:"none",display:"flex",alignItems:"center",gap:"6px"},onClick:()=>r(t.id),title:"Testovat webhook (pouze zavolÃ¡ webhook bez mazÃ¡nÃ­ knihy)",children:[e.jsx(Uo,{size:16}),"Testovat webhook"]}),e.jsx("button",{style:{...h.button,fontSize:"0.85rem",padding:"6px 12px",backgroundColor:"#10b981",color:"white",border:"none"},onClick:()=>s(t.id,t.title),title:"Zkontrolovat storage cesty (otevÅ™ete konzoli)",children:"ğŸ” Diagnostika storage"}),e.jsx("button",{style:{...h.button,fontSize:"0.85rem",padding:"6px 12px",backgroundColor:"#f59e0b",color:"white",border:"none"},onClick:()=>l(t.id),title:"Testovat mazÃ¡nÃ­ images sloÅ¾ky (skuteÄnÃ© smazÃ¡nÃ­!)",children:"ğŸ§ª Test mazÃ¡nÃ­ images"})]})]})]})},Ft=({items:t,maxVisible:o=3,renderTag:n,tableMode:r=!1})=>{const[s,l]=p.useState(!1);if(t.length===0)return null;const a=s?t:t.slice(0,o),c=t.length>o;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",flexWrap:s?"wrap":"nowrap",overflow:s?"visible":"hidden"},children:[a.map((g,u)=>e.jsx("span",{style:{flexShrink:0},children:n(g)},`${g}-${u}`)),c&&!s&&(r?e.jsxs("span",{style:{color:"var(--text-secondary)",fontSize:"0.8em",padding:"2px 4px",flexShrink:0,whiteSpace:"nowrap"},title:`+${t.length-o} dalÅ¡Ã­ch poloÅ¾ek`,children:["... (+",t.length-o,")"]}):e.jsxs("button",{onClick:()=>l(!0),style:{background:"none",border:"none",color:"var(--primary-color)",cursor:"pointer",fontSize:"0.9em",padding:"2px 4px",borderRadius:"4px",textDecoration:"underline",flexShrink:0,whiteSpace:"nowrap"},title:`Zobrazit vÅ¡ech ${t.length} poloÅ¾ek`,children:["... (+",t.length-o,")"]})),s&&c&&!r&&e.jsx("button",{onClick:()=>l(!1),style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",fontSize:"0.8em",padding:"2px 4px",borderRadius:"4px",flexShrink:0,whiteSpace:"nowrap"},title:"Zobrazit mÃ©nÄ›",children:"â† mÃ©nÄ›"})]})},Fe=(t,o,n=!1)=>{const r=o!=null&&(typeof o!="string"||o.trim()!=="")&&(!Array.isArray(o)||o.length>0);return e.jsxs("div",{style:h.fieldGroup,children:[e.jsx("label",{style:h.label,children:t}),e.jsxs("div",{style:h.staticTextContainer,children:[!r&&e.jsx(ls,{}),e.jsx("div",{style:n?h.staticTextParagraph:h.staticText,children:r?o:"â€“"})]})]})},Ps=({value:t,onChange:o,onAIGenerate:n,isGenerating:r,allLanguages:s})=>{const[l,a]=p.useState(!1),c=p.useRef(null);p.useEffect(()=>{const u=m=>{c.current&&!c.current.contains(m.target)&&a(!1)};return document.addEventListener("mousedown",u),()=>{document.removeEventListener("mousedown",u)}},[]);const g=u=>{o(u),a(!1)};return e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx("label",{style:{fontWeight:"bold",color:"var(--text-primary)"},children:"Jazyk:"}),n&&e.jsx("button",{onClick:n,disabled:r,style:{...h.aiButton,opacity:r?.6:1,cursor:r?"not-allowed":"pointer"},title:"AI generovÃ¡nÃ­ jazyka",children:r?"â³":"ğŸ¤–"})]}),e.jsxs("div",{style:{position:"relative"},ref:c,children:[e.jsxs("div",{onClick:()=>a(!l),style:{...h.input,display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",userSelect:"none"},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[kt(t)," ",t]}),e.jsx("span",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:l?"â–²":"â–¼"})]}),l&&e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:"var(--background-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",maxHeight:"200px",overflowY:"auto",zIndex:1e3,boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)"},children:s.map(u=>e.jsxs("div",{onClick:()=>g(u),style:{padding:"0.5rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",backgroundColor:u===t?"var(--background-secondary)":"transparent",borderBottom:"1px solid var(--border-color)"},onMouseEnter:m=>{m.currentTarget.style.backgroundColor="var(--background-secondary)"},onMouseLeave:m=>{m.currentTarget.style.backgroundColor=u===t?"var(--background-secondary)":"transparent"},children:[kt(u)," ",u]},u))})]})]})},Ke=({label:t,name:o,value:n,setLocalBook:r,onAIGenerate:s,isGenerating:l,type:a="text"})=>{const c=p.useCallback(m=>{const{name:b,value:d}=m.target;let v=d;b==="keywords"||b==="labels"||b==="categories"||b==="publicationTypes"?v=d.split(",").map(P=>P.trim()):b==="publicationYear"&&(v=d?parseInt(d,10):null),r(P=>({...P,[b]:v}))},[r]),g=p.useCallback(()=>{s&&s(o)},[s,o]),u=a==="textarea"?"textarea":"input";return e.jsxs("div",{style:h.fieldGroup,children:[e.jsx("label",{style:h.label,children:t}),e.jsxs("div",{style:h.inputWithAction,children:[e.jsx(u,{name:o,value:n,onChange:c,style:a==="textarea"?{...h.textarea,minHeight:"100px"}:h.input,type:a==="number"?"number":"text"}),s&&e.jsx("button",{onClick:g,disabled:l,style:{...h.aiButton,opacity:1,cursor:l?"not-allowed":"pointer"},"aria-label":`Generovat ${t}`,children:l?"...":e.jsx(Ao,{})})]})]})},h={appContainer:{display:"flex",flexDirection:"column",height:"100vh",backgroundColor:"var(--background-primary)",color:"var(--text-primary)"},header:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"20px 20px",backgroundColor:"var(--background-secondary)",borderBottom:"1px solid var(--border-color)",flexShrink:0},headerActions:{display:"flex",alignItems:"center",gap:"0.75rem"},mainContent:{display:"flex",flexGrow:1,overflow:"hidden"},leftPanel:{width:"320px",flexShrink:0,borderRight:"1px solid var(--border-color)",padding:"1rem",overflowY:"auto",display:"flex",flexDirection:"column",gap:"1.5rem",backgroundColor:"var(--background-secondary)"},bookListContainer:{flexGrow:1,overflow:"auto",padding:"1rem"},detailPanel:{width:"420px",flexShrink:0,borderLeft:"1px solid var(--border-color)",overflowY:"auto",backgroundColor:"var(--background-secondary)"},button:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 16px",backgroundColor:"var(--background-secondary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"8px",cursor:"pointer",fontWeight:500,transition:"all 0.2s ease",fontSize:"14px",boxShadow:"var(--shadow-sm)",whiteSpace:"nowrap"},buttonDanger:{backgroundColor:"var(--danger-color)",color:"white",borderColor:"var(--danger-color)"},viewToggle:{display:"flex",backgroundColor:"var(--background-primary)",borderRadius:"8px",border:"1px solid var(--border-color)",padding:"2px"},iconButton:{background:"none",border:"none",color:"var(--text-secondary)",padding:"6px",cursor:"pointer",borderRadius:"6px",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease"},iconButtonActive:{backgroundColor:"var(--accent-primary)",color:"#fff",boxShadow:"var(--shadow-sm)"},detailContent:{padding:"1.5rem",display:"flex",flexDirection:"column"},detailCover:{width:"150px",height:"225px",objectFit:"cover",borderRadius:"8px",alignSelf:"center",marginBottom:"0.5rem",backgroundColor:"var(--background-tertiary)",border:"1px solid var(--border-color)",boxShadow:"var(--shadow-md)"},detailTitle:{fontSize:"1.25rem",fontWeight:600,textAlign:"center",marginBottom:"1rem"},detailActions:{display:"flex",gap:"0.75rem",justifyContent:"center",alignItems:"center",marginBottom:"1.5rem",flexWrap:"wrap"},detailMeta:{display:"flex",flexDirection:"column",gap:"1.25rem"},fieldGroup:{display:"flex",flexDirection:"column",gap:"0.5rem"},filterGroupHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"4px"},label:{fontSize:"0.8rem",fontWeight:600,color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px"},input:{width:"100%",padding:"8px 12px",backgroundColor:"var(--background-primary)",border:"1px solid var(--border-color)",borderRadius:"6px",color:"var(--text-primary)",fontSize:"1rem"},textarea:{width:"100%",padding:"8px 12px",backgroundColor:"var(--background-primary)",border:"1px solid var(--border-color)",borderRadius:"6px",color:"var(--text-primary)",fontSize:"1rem",fontFamily:"inherit",resize:"vertical"},inputWithAction:{position:"relative",display:"flex"},aiButton:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",color:"var(--accent-primary)",cursor:"pointer",padding:"4px",display:"flex",borderRadius:"50%"},addTagButton:{background:"none",border:"none",cursor:"pointer",color:"var(--accent-primary)",padding:"2px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"},bookTableWrapper:{overflowX:"auto"},bookTable:{width:"100%",borderCollapse:"collapse"},th:{textAlign:"left",padding:"12px 8px",borderBottom:"2px solid var(--border-color)",color:"var(--text-secondary)",fontWeight:600,fontSize:"0.8rem",textTransform:"uppercase",letterSpacing:"0.5px",whiteSpace:"nowrap"},tr:{transition:"background-color 0.15s"},trSelected:{backgroundColor:"var(--accent-primary-hover)",color:"#fff"},td:{padding:"12px 8px",borderBottom:"1px solid var(--border-color)",cursor:"pointer",verticalAlign:"middle",fontSize:"0.9rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},tdActions:{display:"flex",gap:"4px",alignItems:"center"},tdTitle:{fontWeight:500},gridContainer:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(180px, 1fr))",gap:"1.5rem"},gridCard:{backgroundColor:"var(--background-secondary)",borderRadius:"8px",padding:"1rem",cursor:"pointer",transition:"transform 0.2s, box-shadow 0.2s",border:"1px solid var(--border-color)"},gridCardSelected:{borderColor:"var(--accent-primary)",boxShadow:"0 0 10px rgba(93, 127, 163, 0.3)"},gridCardCover:{width:"100%",height:"200px",objectFit:"cover",borderRadius:"6px",marginBottom:"1rem",backgroundColor:"var(--background-tertiary)"},gridCardTitle:{fontSize:"1rem",fontWeight:600,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},gridCardAuthor:{fontSize:"0.875rem",color:"var(--text-secondary)"},staticTextContainer:{display:"flex",alignItems:"center",gap:"8px"},staticText:{fontSize:"1rem"},staticTextParagraph:{fontSize:"0.95rem",lineHeight:1.6,whiteSpace:"pre-wrap",color:"var(--text-primary)"},tag:{backgroundColor:"var(--background-tertiary)",padding:"4px 8px",borderRadius:"4px",fontSize:"0.8rem",cursor:"pointer",transition:"all 0.2s ease",border:"1px solid var(--border-color)",display:"inline-block"},tagSelected:{backgroundColor:"var(--accent-beige)",color:"var(--background-secondary)",borderColor:"var(--accent-beige)"},tagList:{display:"flex",flexWrap:"wrap",gap:"8px"},dropdownMenu:{position:"absolute",top:"calc(100% + 5px)",right:0,backgroundColor:"var(--background-secondary)",borderRadius:"8px",boxShadow:"var(--shadow-md)",border:"1px solid var(--border-color)",zIndex:10,minWidth:"220px",overflow:"hidden",padding:"5px 0"},dropdownMenuLink:{display:"flex",alignItems:"center",gap:"10px",padding:"10px 15px",color:"var(--text-primary)",textDecoration:"none",cursor:"pointer",fontSize:"14px"},modalOverlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.6)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3,backdropFilter:"blur(4px)"},modalContent:{backgroundColor:"var(--background-secondary)",padding:"2rem",borderRadius:"12px",width:"90%",maxWidth:"600px",boxShadow:"var(--shadow-md)"},modalHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid var(--border-color)",paddingBottom:"1rem",marginBottom:"1rem"},modalCloseButton:{background:"none",border:"none",cursor:"pointer",color:"var(--text-secondary)",padding:0},modalBody:{},rangeSliderContainer:{display:"flex",flexDirection:"column",gap:"1rem"},rangeSliderRowSimple:{display:"grid",gridTemplateColumns:"auto 1fr auto",alignItems:"center",gap:"1rem"},rangeLabel:{fontSize:"0.9rem",color:"var(--text-secondary)"},rangeValue:{fontSize:"0.9rem",color:"var(--text-primary)",minWidth:"80px",textAlign:"right"},tagInputContainer:{display:"flex",flexWrap:"wrap",gap:"8px",padding:"4px 8px",backgroundColor:"var(--background-primary)",border:"1px solid var(--border-color)",borderRadius:"6px",minHeight:"42px",alignItems:"center"},tagRemoveButton:{background:"none",border:"none",color:"inherit",cursor:"pointer",marginLeft:"4px",padding:"0",fontSize:"14px",fontWeight:"bold",lineHeight:1,opacity:.5},tagInputAddButton:{background:"none",border:"1px dashed var(--border-color)",color:"var(--text-secondary)",borderRadius:"4px",padding:"4px 8px",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",fontSize:"12px",marginLeft:"auto"},tagDropdown:{position:"absolute",top:"calc(100% + 5px)",left:0,right:0,backgroundColor:"var(--background-secondary)",borderRadius:"8px",boxShadow:"var(--shadow-md)",border:"1px solid var(--border-color)",zIndex:10,maxHeight:"200px",overflowY:"auto",padding:"5px 0"},addNewTagLink:{borderTop:"1px solid var(--border-color)",color:"var(--accent-primary)",fontWeight:500},chatOverlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3,padding:"10px"},chatContainer:{backgroundColor:"white",borderRadius:"12px",width:"98%",maxWidth:"1000px",height:"98%",minHeight:"80vh",maxHeight:"95vh",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.3)","@media (max-width: 768px)":{width:"100%",height:"100%",borderRadius:"0px"}},chatContent:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column",minHeight:0}},Ts=zn.createRoot(document.getElementById("root"));Ts.render(e.jsx(No.StrictMode,{children:e.jsx(Ir,{children:t=>e.jsxs(e.Fragment,{children:[e.jsx(js,{currentUser:t}),e.jsx(Yn,{})]})})}));window.testILovePDFFixed=async()=>{console.log("ğŸ§ª TestovÃ¡nÃ­ opravenÃ© iLovePDF sluÅ¾by...");try{const t=await Ie.checkAPIStatus();return console.log("ğŸ“Š API Status:",t),t.available?(console.log(`âœ… API je dostupnÃ©, zbÃ½vajÃ­cÃ­ kredity: ${t.credits}`),t):(console.error("âŒ iLovePDF API nenÃ­ dostupnÃ©"),t)}catch(t){return console.error("âŒ Test selhaÅ‚:",t),{success:!1,error:t}}};
