import{s as m}from"./WaveLoader-DvqYMd3O.js";import"./preload-helper-B8tWKQ1F.js";async function _(t){if(t.length===0)return{success:!0,matches:[],unmatched:[]};try{const{data:n,error:o}=await m.rpc("get_products_with_pinyin_names");if(o)throw console.error("❌ Chyba při načítání produktů z databáze:",o),new Error(`Database error: ${o.message}`);if(!n||n.length===0)return{success:!0,matches:[],unmatched:t};const i=[],c=[];for(const e of t){const r=h(e,n);r&&r.similarity>=.5?i.push(r):c.push(e)}return{success:!0,matches:i,unmatched:c}}catch(n){return console.error("❌ Kritická chyba při matchingu produktů:",n),{success:!1,matches:[],unmatched:t,error:n instanceof Error?n.message:String(n)}}}function h(t,n){let o=null,i=0;const c=u(t);for(const e of n){const r=[e.pinyin_name,e.product_name,f(e.description_short)].filter(Boolean);for(const s of r){const a=d(c,u(s));a>i&&(i=a,o={id:e.id,product_code:e.product_code,product_name:e.product_name,pinyin_name:e.pinyin_name,url:e.url,similarity:a,matched_from:t})}}return o}function u(t){return t?t.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[–-]/g," ").replace(/\s+/g," ").replace(/[^\w\s]/g,""):""}function f(t){if(!t)return null;const n=t.match(/^\*\*([^*]+)\*\*/);return n?n[1].trim().replace(/^[0-9]+\s*[–-]?\s*/,""):null}function d(t,n){if(!t||!n)return 0;if(t===n)return 1;if(t.includes(n)||n.includes(t))return .9;const o=t.split(/\s+/),i=n.split(/\s+/),e=o.filter(l=>i.includes(l)&&l.length>2).length/Math.max(o.length,i.length),r=p(t,n),s=Math.max(t.length,n.length),a=1-r/s;return e*.6+a*.4}function p(t,n){const o=t.length,i=n.length,c=[];for(let e=0;e<=o;e++)c[e]=[e];for(let e=0;e<=i;e++)c[0][e]=e;for(let e=1;e<=o;e++)for(let r=1;r<=i;r++)t[e-1]===n[r-1]?c[e][r]=c[e-1][r-1]:c[e][r]=Math.min(c[e-1][r]+1,c[e][r-1]+1,c[e-1][r-1]+1);return c[o][i]}export{_ as matchProductNames};
