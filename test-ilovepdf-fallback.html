<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test iLovePDF Fallback</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { border-color: #4CAF50; background-color: #f0fff0; }
        .error { border-color: #f44336; background-color: #fff0f0; }
        .warning { border-color: #ff9800; background-color: #fff8e1; }
        button {
            background: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #005a87; }
        #log {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>Test iLovePDF API Fallback Mechanismus</h1>
    
    <div class="test-section warning">
        <h3>‚ö†Ô∏è Pozn√°mka</h3>
        <p>Tento test simuluje API chyby pro ovƒõ≈ôen√≠ fallback mechanismu. Skuteƒçn√Ω upload do aplikace nebude proveden.</p>
    </div>

    <div class="test-section">
        <h3>1. Test dostupnosti API</h3>
        <button onclick="testApiHealth()">Test API Health Check</button>
        <div id="health-result"></div>
    </div>

    <div class="test-section">
        <h3>2. Test error handling</h3>
        <button onclick="testNetworkError()">Simulovat s√≠≈•ovou chybu</button>
        <button onclick="testServerError()">Simulovat HTTP 500</button>
        <button onclick="testTimeoutError()">Simulovat timeout</button>
        <div id="error-result"></div>
    </div>

    <div class="test-section">
        <h3>3. Test retry mechanismu</h3>
        <button onclick="testRetryMechanism()">Test exponential backoff</button>
        <div id="retry-result"></div>
    </div>

    <div class="test-section">
        <h3>Console Log</h3>
        <div id="log"></div>
        <button onclick="clearLog()">Vymazat log</button>
    </div>

    <script>
        // Mock funkce pro testov√°n√≠ bez skuteƒçn√©ho API
        const originalFetch = window.fetch;
        let logContainer = document.getElementById('log');

        function log(message) {
            console.log(message);
            logContainer.innerHTML += message + '\n';
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function clearLog() {
            logContainer.innerHTML = '';
        }

        // Test API Health Check
        async function testApiHealth() {
            const resultDiv = document.getElementById('health-result');
            log('üîç Testuji API health check...');
            
            try {
                const response = await fetch('https://api.ilovepdf.com', {
                    method: 'HEAD',
                    signal: AbortSignal.timeout(3000)
                });
                
                const isHealthy = response.status < 500;
                if (isHealthy) {
                    resultDiv.innerHTML = '<span style="color: green;">‚úÖ API je dostupn√©</span>';
                    log('‚úÖ Health check: API dostupn√©');
                } else {
                    resultDiv.innerHTML = '<span style="color: orange;">‚ö†Ô∏è API m√° probl√©my (status: ' + response.status + ')</span>';
                    log('‚ö†Ô∏è Health check: API m√° probl√©my');
                }
            } catch (error) {
                resultDiv.innerHTML = '<span style="color: red;">‚ùå API nedostupn√©: ' + error.message + '</span>';
                log('‚ùå Health check: API nedostupn√©');
            }
        }

        // Test r≈Øzn√Ωch typ≈Ø chyb
        function testNetworkError() {
            const resultDiv = document.getElementById('error-result');
            const error = new Error('fetch failed - network error');
            const friendlyMessage = getFriendlyErrorMessage(error);
            resultDiv.innerHTML = '<strong>S√≠≈•ov√° chyba:</strong> ' + friendlyMessage;
            log('üì° Test s√≠≈•ov√© chyby: ' + friendlyMessage);
        }

        function testServerError() {
            const resultDiv = document.getElementById('error-result');
            const error = new Error('HTTP 500 - Internal Server Error');
            const friendlyMessage = getFriendlyErrorMessage(error);
            resultDiv.innerHTML = '<strong>Server chyba:</strong> ' + friendlyMessage;
            log('üî• Test server chyby: ' + friendlyMessage);
        }

        function testTimeoutError() {
            const resultDiv = document.getElementById('error-result');
            const error = new Error('Request timeout after 3000ms');
            const friendlyMessage = getFriendlyErrorMessage(error);
            resultDiv.innerHTML = '<strong>Timeout chyba:</strong> ' + friendlyMessage;
            log('‚è∞ Test timeout chyby: ' + friendlyMessage);
        }

        // Simulace friendly error messages
        function getFriendlyErrorMessage(error) {
            if (error.message.includes('500') || error.message.includes('Internal Server Error')) {
                return 'iLovePDF server m√° doƒçasn√Ω probl√©m (HTTP 500). Zkuste nahr√°t soubor bez zpracov√°n√≠ nebo to zkuste za chv√≠li.';
            }
            if (error.message.includes('network') || error.message.includes('fetch')) {
                return 'Probl√©m se s√≠≈•ov√Ωm p≈ôipojen√≠m k iLovePDF. Zkontrolujte internetov√© p≈ôipojen√≠ nebo nahrajte soubor bez zpracov√°n√≠.';
            }
            if (error.message.includes('timeout')) {
                return 'iLovePDF API odpov√≠d√° p≈ô√≠li≈° pomalu. Zkuste nahr√°t soubor bez zpracov√°n√≠ nebo to zkuste pozdƒõji.';
            }
            return 'Nezn√°m√° chyba: ' + error.message + '. M≈Ø≈æete zkusit nahr√°t soubor bez zpracov√°n√≠.';
        }

        // Test retry mechanismu
        async function testRetryMechanism() {
            const resultDiv = document.getElementById('retry-result');
            log('üîÑ Testuji retry mechanismus...');
            
            const delays = [2000, 4000, 8000]; // exponential backoff
            resultDiv.innerHTML = 'Simuluji 3 pokusy s exponential backoff...';
            
            for (let i = 0; i < 3; i++) {
                log(`‚ö†Ô∏è Pokus ${i + 1}/3 selhal`);
                if (i < 2) {
                    log(`‚è≥ ƒåek√°m ${delays[i]}ms p≈ôed dal≈°√≠m pokusem...`);
                    await new Promise(resolve => setTimeout(resolve, 1000)); // Zkr√°ceno pro demo
                }
            }
            
            log('‚ùå V≈°echny pokusy selhaly - aktivuje se fallback');
            resultDiv.innerHTML += '<br><span style="color: orange;">‚ö†Ô∏è Po 3 pokusech se aktivuje fallback upload</span>';
        }

        log('üöÄ Test str√°nka naƒçtena. M≈Ø≈æete testovat fallback mechanismus.');
    </script>
</body>
</html>
